function K2(a,d){return function(){return a.apply(d,arguments)}}const{toString:uP}=Object.prototype,{getPrototypeOf:cv}=Object,zg=(a=>d=>{const y=uP.call(d);return a[y]||(a[y]=y.slice(8,-1).toLowerCase())})(Object.create(null)),Wo=a=>(a=a.toLowerCase(),d=>zg(d)===a),Lg=a=>d=>typeof d===a,{isArray:ad}=Array,Ip=Lg("undefined");function hP(a){return a!==null&&!Ip(a)&&a.constructor!==null&&!Ip(a.constructor)&&Zs(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const J2=Wo("ArrayBuffer");function dP(a){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(a):d=a&&a.buffer&&J2(a.buffer),d}const fP=Lg("string"),Zs=Lg("function"),Q2=Lg("number"),Og=a=>a!==null&&typeof a=="object",pP=a=>a===!0||a===!1,Z_=a=>{if(zg(a)!=="object")return!1;const d=cv(a);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},mP=Wo("Date"),_P=Wo("File"),gP=Wo("Blob"),yP=Wo("FileList"),xP=a=>Og(a)&&Zs(a.pipe),vP=a=>{let d;return a&&(typeof FormData=="function"&&a instanceof FormData||Zs(a.append)&&((d=zg(a))==="formdata"||d==="object"&&Zs(a.toString)&&a.toString()==="[object FormData]"))},bP=Wo("URLSearchParams"),[wP,TP,SP,EP]=["ReadableStream","Request","Response","Headers"].map(Wo),MP=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qp(a,d,{allOwnKeys:y=!1}={}){if(a===null||typeof a>"u")return;let A,P;if(typeof a!="object"&&(a=[a]),ad(a))for(A=0,P=a.length;A<P;A++)d.call(null,a[A],A,a);else{const L=y?Object.getOwnPropertyNames(a):Object.keys(a),F=L.length;let r;for(A=0;A<F;A++)r=L[A],d.call(null,a[r],r,a)}}function eS(a,d){d=d.toLowerCase();const y=Object.keys(a);let A=y.length,P;for(;A-- >0;)if(P=y[A],d===P.toLowerCase())return P;return null}const uu=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),tS=a=>!Ip(a)&&a!==uu;function Ix(){const{caseless:a}=tS(this)&&this||{},d={},y=(A,P)=>{const L=a&&eS(d,P)||P;Z_(d[L])&&Z_(A)?d[L]=Ix(d[L],A):Z_(A)?d[L]=Ix({},A):ad(A)?d[L]=A.slice():d[L]=A};for(let A=0,P=arguments.length;A<P;A++)arguments[A]&&qp(arguments[A],y);return d}const AP=(a,d,y,{allOwnKeys:A}={})=>(qp(d,(P,L)=>{y&&Zs(P)?a[L]=K2(P,y):a[L]=P},{allOwnKeys:A}),a),IP=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),CP=(a,d,y,A)=>{a.prototype=Object.create(d.prototype,A),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:d.prototype}),y&&Object.assign(a.prototype,y)},PP=(a,d,y,A)=>{let P,L,F;const r={};if(d=d||{},a==null)return d;do{for(P=Object.getOwnPropertyNames(a),L=P.length;L-- >0;)F=P[L],(!A||A(F,a,d))&&!r[F]&&(d[F]=a[F],r[F]=!0);a=y!==!1&&cv(a)}while(a&&(!y||y(a,d))&&a!==Object.prototype);return d},RP=(a,d,y)=>{a=String(a),(y===void 0||y>a.length)&&(y=a.length),y-=d.length;const A=a.indexOf(d,y);return A!==-1&&A===y},DP=a=>{if(!a)return null;if(ad(a))return a;let d=a.length;if(!Q2(d))return null;const y=new Array(d);for(;d-- >0;)y[d]=a[d];return y},zP=(a=>d=>a&&d instanceof a)(typeof Uint8Array<"u"&&cv(Uint8Array)),LP=(a,d)=>{const A=(a&&a[Symbol.iterator]).call(a);let P;for(;(P=A.next())&&!P.done;){const L=P.value;d.call(a,L[0],L[1])}},OP=(a,d)=>{let y;const A=[];for(;(y=a.exec(d))!==null;)A.push(y);return A},kP=Wo("HTMLFormElement"),FP=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(y,A,P){return A.toUpperCase()+P}),DT=(({hasOwnProperty:a})=>(d,y)=>a.call(d,y))(Object.prototype),BP=Wo("RegExp"),iS=(a,d)=>{const y=Object.getOwnPropertyDescriptors(a),A={};qp(y,(P,L)=>{let F;(F=d(P,L,a))!==!1&&(A[L]=F||P)}),Object.defineProperties(a,A)},NP=a=>{iS(a,(d,y)=>{if(Zs(a)&&["arguments","caller","callee"].indexOf(y)!==-1)return!1;const A=a[y];if(Zs(A)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+y+"'")})}})},VP=(a,d)=>{const y={},A=P=>{P.forEach(L=>{y[L]=!0})};return ad(a)?A(a):A(String(a).split(d)),y},UP=()=>{},jP=(a,d)=>a!=null&&Number.isFinite(a=+a)?a:d,ux="abcdefghijklmnopqrstuvwxyz",zT="0123456789",nS={DIGIT:zT,ALPHA:ux,ALPHA_DIGIT:ux+ux.toUpperCase()+zT},GP=(a=16,d=nS.ALPHA_DIGIT)=>{let y="";const{length:A}=d;for(;a--;)y+=d[Math.random()*A|0];return y};function qP(a){return!!(a&&Zs(a.append)&&a[Symbol.toStringTag]==="FormData"&&a[Symbol.iterator])}const HP=a=>{const d=new Array(10),y=(A,P)=>{if(Og(A)){if(d.indexOf(A)>=0)return;if(!("toJSON"in A)){d[P]=A;const L=ad(A)?[]:{};return qp(A,(F,r)=>{const W=y(F,P+1);!Ip(W)&&(L[r]=W)}),d[P]=void 0,L}}return A};return y(a,0)},$P=Wo("AsyncFunction"),ZP=a=>a&&(Og(a)||Zs(a))&&Zs(a.then)&&Zs(a.catch),rS=((a,d)=>a?setImmediate:d?((y,A)=>(uu.addEventListener("message",({source:P,data:L})=>{P===uu&&L===y&&A.length&&A.shift()()},!1),P=>{A.push(P),uu.postMessage(y,"*")}))(`axios@${Math.random()}`,[]):y=>setTimeout(y))(typeof setImmediate=="function",Zs(uu.postMessage)),WP=typeof queueMicrotask<"u"?queueMicrotask.bind(uu):typeof process<"u"&&process.nextTick||rS,wt={isArray:ad,isArrayBuffer:J2,isBuffer:hP,isFormData:vP,isArrayBufferView:dP,isString:fP,isNumber:Q2,isBoolean:pP,isObject:Og,isPlainObject:Z_,isReadableStream:wP,isRequest:TP,isResponse:SP,isHeaders:EP,isUndefined:Ip,isDate:mP,isFile:_P,isBlob:gP,isRegExp:BP,isFunction:Zs,isStream:xP,isURLSearchParams:bP,isTypedArray:zP,isFileList:yP,forEach:qp,merge:Ix,extend:AP,trim:MP,stripBOM:IP,inherits:CP,toFlatObject:PP,kindOf:zg,kindOfTest:Wo,endsWith:RP,toArray:DP,forEachEntry:LP,matchAll:OP,isHTMLForm:kP,hasOwnProperty:DT,hasOwnProp:DT,reduceDescriptors:iS,freezeMethods:NP,toObjectSet:VP,toCamelCase:FP,noop:UP,toFiniteNumber:jP,findKey:eS,global:uu,isContextDefined:tS,ALPHABET:nS,generateString:GP,isSpecCompliantForm:qP,toJSONObject:HP,isAsyncFn:$P,isThenable:ZP,setImmediate:rS,asap:WP};function Qi(a,d,y,A,P){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",d&&(this.code=d),y&&(this.config=y),A&&(this.request=A),P&&(this.response=P,this.status=P.status?P.status:null)}wt.inherits(Qi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.status}}});const sS=Qi.prototype,oS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{oS[a]={value:a}});Object.defineProperties(Qi,oS);Object.defineProperty(sS,"isAxiosError",{value:!0});Qi.from=(a,d,y,A,P,L)=>{const F=Object.create(sS);return wt.toFlatObject(a,F,function(W){return W!==Error.prototype},r=>r!=="isAxiosError"),Qi.call(F,a.message,d,y,A,P),F.cause=a,F.name=a.name,L&&Object.assign(F,L),F};const XP=null;function Cx(a){return wt.isPlainObject(a)||wt.isArray(a)}function aS(a){return wt.endsWith(a,"[]")?a.slice(0,-2):a}function LT(a,d,y){return a?a.concat(d).map(function(P,L){return P=aS(P),!y&&L?"["+P+"]":P}).join(y?".":""):d}function YP(a){return wt.isArray(a)&&!a.some(Cx)}const KP=wt.toFlatObject(wt,{},null,function(d){return/^is[A-Z]/.test(d)});function kg(a,d,y){if(!wt.isObject(a))throw new TypeError("target must be an object");d=d||new FormData,y=wt.toFlatObject(y,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Le,ct){return!wt.isUndefined(ct[Le])});const A=y.metaTokens,P=y.visitor||Q,L=y.dots,F=y.indexes,W=(y.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(d);if(!wt.isFunction(P))throw new TypeError("visitor must be a function");function ne(Oe){if(Oe===null)return"";if(wt.isDate(Oe))return Oe.toISOString();if(!W&&wt.isBlob(Oe))throw new Qi("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(Oe)||wt.isTypedArray(Oe)?W&&typeof Blob=="function"?new Blob([Oe]):Buffer.from(Oe):Oe}function Q(Oe,Le,ct){let st=Oe;if(Oe&&!ct&&typeof Oe=="object"){if(wt.endsWith(Le,"{}"))Le=A?Le:Le.slice(0,-2),Oe=JSON.stringify(Oe);else if(wt.isArray(Oe)&&YP(Oe)||(wt.isFileList(Oe)||wt.endsWith(Le,"[]"))&&(st=wt.toArray(Oe)))return Le=aS(Le),st.forEach(function(He,Ve){!(wt.isUndefined(He)||He===null)&&d.append(F===!0?LT([Le],Ve,L):F===null?Le:Le+"[]",ne(He))}),!1}return Cx(Oe)?!0:(d.append(LT(ct,Le,L),ne(Oe)),!1)}const ce=[],ze=Object.assign(KP,{defaultVisitor:Q,convertValue:ne,isVisitable:Cx});function je(Oe,Le){if(!wt.isUndefined(Oe)){if(ce.indexOf(Oe)!==-1)throw Error("Circular reference detected in "+Le.join("."));ce.push(Oe),wt.forEach(Oe,function(st,gt){(!(wt.isUndefined(st)||st===null)&&P.call(d,st,wt.isString(gt)?gt.trim():gt,Le,ze))===!0&&je(st,Le?Le.concat(gt):[gt])}),ce.pop()}}if(!wt.isObject(a))throw new TypeError("data must be an object");return je(a),d}function OT(a){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(A){return d[A]})}function uv(a,d){this._pairs=[],a&&kg(a,this,d)}const lS=uv.prototype;lS.append=function(d,y){this._pairs.push([d,y])};lS.toString=function(d){const y=d?function(A){return d.call(this,A,OT)}:OT;return this._pairs.map(function(P){return y(P[0])+"="+y(P[1])},"").join("&")};function JP(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cS(a,d,y){if(!d)return a;const A=y&&y.encode||JP;wt.isFunction(y)&&(y={serialize:y});const P=y&&y.serialize;let L;if(P?L=P(d,y):L=wt.isURLSearchParams(d)?d.toString():new uv(d,y).toString(A),L){const F=a.indexOf("#");F!==-1&&(a=a.slice(0,F)),a+=(a.indexOf("?")===-1?"?":"&")+L}return a}class QP{constructor(){this.handlers=[]}use(d,y,A){return this.handlers.push({fulfilled:d,rejected:y,synchronous:A?A.synchronous:!1,runWhen:A?A.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){wt.forEach(this.handlers,function(A){A!==null&&d(A)})}}const kT=QP,uS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eR=typeof URLSearchParams<"u"?URLSearchParams:uv,tR=typeof FormData<"u"?FormData:null,iR=typeof Blob<"u"?Blob:null,nR={isBrowser:!0,classes:{URLSearchParams:eR,FormData:tR,Blob:iR},protocols:["http","https","file","blob","url","data"]},hv=typeof window<"u"&&typeof document<"u",Px=typeof navigator=="object"&&navigator||void 0,rR=hv&&(!Px||["ReactNative","NativeScript","NS"].indexOf(Px.product)<0),sR=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),oR=hv&&window.location.href||"http://localhost",aR=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hv,hasStandardBrowserEnv:rR,hasStandardBrowserWebWorkerEnv:sR,navigator:Px,origin:oR},Symbol.toStringTag,{value:"Module"})),ss={...aR,...nR};function lR(a,d){return kg(a,new ss.classes.URLSearchParams,Object.assign({visitor:function(y,A,P,L){return ss.isNode&&wt.isBuffer(y)?(this.append(A,y.toString("base64")),!1):L.defaultVisitor.apply(this,arguments)}},d))}function cR(a){return wt.matchAll(/\w+|\[(\w*)]/g,a).map(d=>d[0]==="[]"?"":d[1]||d[0])}function uR(a){const d={},y=Object.keys(a);let A;const P=y.length;let L;for(A=0;A<P;A++)L=y[A],d[L]=a[L];return d}function hS(a){function d(y,A,P,L){let F=y[L++];if(F==="__proto__")return!0;const r=Number.isFinite(+F),W=L>=y.length;return F=!F&&wt.isArray(P)?P.length:F,W?(wt.hasOwnProp(P,F)?P[F]=[P[F],A]:P[F]=A,!r):((!P[F]||!wt.isObject(P[F]))&&(P[F]=[]),d(y,A,P[F],L)&&wt.isArray(P[F])&&(P[F]=uR(P[F])),!r)}if(wt.isFormData(a)&&wt.isFunction(a.entries)){const y={};return wt.forEachEntry(a,(A,P)=>{d(cR(A),P,y,0)}),y}return null}function hR(a,d,y){if(wt.isString(a))try{return(d||JSON.parse)(a),wt.trim(a)}catch(A){if(A.name!=="SyntaxError")throw A}return(y||JSON.stringify)(a)}const dv={transitional:uS,adapter:["xhr","http","fetch"],transformRequest:[function(d,y){const A=y.getContentType()||"",P=A.indexOf("application/json")>-1,L=wt.isObject(d);if(L&&wt.isHTMLForm(d)&&(d=new FormData(d)),wt.isFormData(d))return P?JSON.stringify(hS(d)):d;if(wt.isArrayBuffer(d)||wt.isBuffer(d)||wt.isStream(d)||wt.isFile(d)||wt.isBlob(d)||wt.isReadableStream(d))return d;if(wt.isArrayBufferView(d))return d.buffer;if(wt.isURLSearchParams(d))return y.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let r;if(L){if(A.indexOf("application/x-www-form-urlencoded")>-1)return lR(d,this.formSerializer).toString();if((r=wt.isFileList(d))||A.indexOf("multipart/form-data")>-1){const W=this.env&&this.env.FormData;return kg(r?{"files[]":d}:d,W&&new W,this.formSerializer)}}return L||P?(y.setContentType("application/json",!1),hR(d)):d}],transformResponse:[function(d){const y=this.transitional||dv.transitional,A=y&&y.forcedJSONParsing,P=this.responseType==="json";if(wt.isResponse(d)||wt.isReadableStream(d))return d;if(d&&wt.isString(d)&&(A&&!this.responseType||P)){const F=!(y&&y.silentJSONParsing)&&P;try{return JSON.parse(d)}catch(r){if(F)throw r.name==="SyntaxError"?Qi.from(r,Qi.ERR_BAD_RESPONSE,this,null,this.response):r}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ss.classes.FormData,Blob:ss.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],a=>{dv.headers[a]={}});const fv=dv,dR=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fR=a=>{const d={};let y,A,P;return a&&a.split(`
`).forEach(function(F){P=F.indexOf(":"),y=F.substring(0,P).trim().toLowerCase(),A=F.substring(P+1).trim(),!(!y||d[y]&&dR[y])&&(y==="set-cookie"?d[y]?d[y].push(A):d[y]=[A]:d[y]=d[y]?d[y]+", "+A:A)}),d},FT=Symbol("internals");function hp(a){return a&&String(a).trim().toLowerCase()}function W_(a){return a===!1||a==null?a:wt.isArray(a)?a.map(W_):String(a)}function pR(a){const d=Object.create(null),y=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let A;for(;A=y.exec(a);)d[A[1]]=A[2];return d}const mR=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function hx(a,d,y,A,P){if(wt.isFunction(A))return A.call(this,d,y);if(P&&(d=y),!!wt.isString(d)){if(wt.isString(A))return d.indexOf(A)!==-1;if(wt.isRegExp(A))return A.test(d)}}function _R(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,y,A)=>y.toUpperCase()+A)}function gR(a,d){const y=wt.toCamelCase(" "+d);["get","set","has"].forEach(A=>{Object.defineProperty(a,A+y,{value:function(P,L,F){return this[A].call(this,d,P,L,F)},configurable:!0})})}class Fg{constructor(d){d&&this.set(d)}set(d,y,A){const P=this;function L(r,W,ne){const Q=hp(W);if(!Q)throw new Error("header name must be a non-empty string");const ce=wt.findKey(P,Q);(!ce||P[ce]===void 0||ne===!0||ne===void 0&&P[ce]!==!1)&&(P[ce||W]=W_(r))}const F=(r,W)=>wt.forEach(r,(ne,Q)=>L(ne,Q,W));if(wt.isPlainObject(d)||d instanceof this.constructor)F(d,y);else if(wt.isString(d)&&(d=d.trim())&&!mR(d))F(fR(d),y);else if(wt.isHeaders(d))for(const[r,W]of d.entries())L(W,r,A);else d!=null&&L(y,d,A);return this}get(d,y){if(d=hp(d),d){const A=wt.findKey(this,d);if(A){const P=this[A];if(!y)return P;if(y===!0)return pR(P);if(wt.isFunction(y))return y.call(this,P,A);if(wt.isRegExp(y))return y.exec(P);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,y){if(d=hp(d),d){const A=wt.findKey(this,d);return!!(A&&this[A]!==void 0&&(!y||hx(this,this[A],A,y)))}return!1}delete(d,y){const A=this;let P=!1;function L(F){if(F=hp(F),F){const r=wt.findKey(A,F);r&&(!y||hx(A,A[r],r,y))&&(delete A[r],P=!0)}}return wt.isArray(d)?d.forEach(L):L(d),P}clear(d){const y=Object.keys(this);let A=y.length,P=!1;for(;A--;){const L=y[A];(!d||hx(this,this[L],L,d,!0))&&(delete this[L],P=!0)}return P}normalize(d){const y=this,A={};return wt.forEach(this,(P,L)=>{const F=wt.findKey(A,L);if(F){y[F]=W_(P),delete y[L];return}const r=d?_R(L):String(L).trim();r!==L&&delete y[L],y[r]=W_(P),A[r]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const y=Object.create(null);return wt.forEach(this,(A,P)=>{A!=null&&A!==!1&&(y[P]=d&&wt.isArray(A)?A.join(", "):A)}),y}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,y])=>d+": "+y).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...y){const A=new this(d);return y.forEach(P=>A.set(P)),A}static accessor(d){const A=(this[FT]=this[FT]={accessors:{}}).accessors,P=this.prototype;function L(F){const r=hp(F);A[r]||(gR(P,F),A[r]=!0)}return wt.isArray(d)?d.forEach(L):L(d),this}}Fg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);wt.reduceDescriptors(Fg.prototype,({value:a},d)=>{let y=d[0].toUpperCase()+d.slice(1);return{get:()=>a,set(A){this[y]=A}}});wt.freezeMethods(Fg);const Ho=Fg;function dx(a,d){const y=this||fv,A=d||y,P=Ho.from(A.headers);let L=A.data;return wt.forEach(a,function(r){L=r.call(y,L,P.normalize(),d?d.status:void 0)}),P.normalize(),L}function dS(a){return!!(a&&a.__CANCEL__)}function ld(a,d,y){Qi.call(this,a??"canceled",Qi.ERR_CANCELED,d,y),this.name="CanceledError"}wt.inherits(ld,Qi,{__CANCEL__:!0});function fS(a,d,y){const A=y.config.validateStatus;!y.status||!A||A(y.status)?a(y):d(new Qi("Request failed with status code "+y.status,[Qi.ERR_BAD_REQUEST,Qi.ERR_BAD_RESPONSE][Math.floor(y.status/100)-4],y.config,y.request,y))}function yR(a){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return d&&d[1]||""}function xR(a,d){a=a||10;const y=new Array(a),A=new Array(a);let P=0,L=0,F;return d=d!==void 0?d:1e3,function(W){const ne=Date.now(),Q=A[L];F||(F=ne),y[P]=W,A[P]=ne;let ce=L,ze=0;for(;ce!==P;)ze+=y[ce++],ce=ce%a;if(P=(P+1)%a,P===L&&(L=(L+1)%a),ne-F<d)return;const je=Q&&ne-Q;return je?Math.round(ze*1e3/je):void 0}}function vR(a,d){let y=0,A=1e3/d,P,L;const F=(ne,Q=Date.now())=>{y=Q,P=null,L&&(clearTimeout(L),L=null),a.apply(null,ne)};return[(...ne)=>{const Q=Date.now(),ce=Q-y;ce>=A?F(ne,Q):(P=ne,L||(L=setTimeout(()=>{L=null,F(P)},A-ce)))},()=>P&&F(P)]}const sg=(a,d,y=3)=>{let A=0;const P=xR(50,250);return vR(L=>{const F=L.loaded,r=L.lengthComputable?L.total:void 0,W=F-A,ne=P(W),Q=F<=r;A=F;const ce={loaded:F,total:r,progress:r?F/r:void 0,bytes:W,rate:ne||void 0,estimated:ne&&r&&Q?(r-F)/ne:void 0,event:L,lengthComputable:r!=null,[d?"download":"upload"]:!0};a(ce)},y)},BT=(a,d)=>{const y=a!=null;return[A=>d[0]({lengthComputable:y,total:a,loaded:A}),d[1]]},NT=a=>(...d)=>wt.asap(()=>a(...d)),bR=ss.hasStandardBrowserEnv?((a,d)=>y=>(y=new URL(y,ss.origin),a.protocol===y.protocol&&a.host===y.host&&(d||a.port===y.port)))(new URL(ss.origin),ss.navigator&&/(msie|trident)/i.test(ss.navigator.userAgent)):()=>!0,wR=ss.hasStandardBrowserEnv?{write(a,d,y,A,P,L){const F=[a+"="+encodeURIComponent(d)];wt.isNumber(y)&&F.push("expires="+new Date(y).toGMTString()),wt.isString(A)&&F.push("path="+A),wt.isString(P)&&F.push("domain="+P),L===!0&&F.push("secure"),document.cookie=F.join("; ")},read(a){const d=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function TR(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function SR(a,d){return d?a.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):a}function pS(a,d){return a&&!TR(d)?SR(a,d):d}const VT=a=>a instanceof Ho?{...a}:a;function yu(a,d){d=d||{};const y={};function A(ne,Q,ce,ze){return wt.isPlainObject(ne)&&wt.isPlainObject(Q)?wt.merge.call({caseless:ze},ne,Q):wt.isPlainObject(Q)?wt.merge({},Q):wt.isArray(Q)?Q.slice():Q}function P(ne,Q,ce,ze){if(wt.isUndefined(Q)){if(!wt.isUndefined(ne))return A(void 0,ne,ce,ze)}else return A(ne,Q,ce,ze)}function L(ne,Q){if(!wt.isUndefined(Q))return A(void 0,Q)}function F(ne,Q){if(wt.isUndefined(Q)){if(!wt.isUndefined(ne))return A(void 0,ne)}else return A(void 0,Q)}function r(ne,Q,ce){if(ce in d)return A(ne,Q);if(ce in a)return A(void 0,ne)}const W={url:L,method:L,data:L,baseURL:F,transformRequest:F,transformResponse:F,paramsSerializer:F,timeout:F,timeoutMessage:F,withCredentials:F,withXSRFToken:F,adapter:F,responseType:F,xsrfCookieName:F,xsrfHeaderName:F,onUploadProgress:F,onDownloadProgress:F,decompress:F,maxContentLength:F,maxBodyLength:F,beforeRedirect:F,transport:F,httpAgent:F,httpsAgent:F,cancelToken:F,socketPath:F,responseEncoding:F,validateStatus:r,headers:(ne,Q,ce)=>P(VT(ne),VT(Q),ce,!0)};return wt.forEach(Object.keys(Object.assign({},a,d)),function(Q){const ce=W[Q]||P,ze=ce(a[Q],d[Q],Q);wt.isUndefined(ze)&&ce!==r||(y[Q]=ze)}),y}const mS=a=>{const d=yu({},a);let{data:y,withXSRFToken:A,xsrfHeaderName:P,xsrfCookieName:L,headers:F,auth:r}=d;d.headers=F=Ho.from(F),d.url=cS(pS(d.baseURL,d.url),a.params,a.paramsSerializer),r&&F.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let W;if(wt.isFormData(y)){if(ss.hasStandardBrowserEnv||ss.hasStandardBrowserWebWorkerEnv)F.setContentType(void 0);else if((W=F.getContentType())!==!1){const[ne,...Q]=W?W.split(";").map(ce=>ce.trim()).filter(Boolean):[];F.setContentType([ne||"multipart/form-data",...Q].join("; "))}}if(ss.hasStandardBrowserEnv&&(A&&wt.isFunction(A)&&(A=A(d)),A||A!==!1&&bR(d.url))){const ne=P&&L&&wR.read(L);ne&&F.set(P,ne)}return d},ER=typeof XMLHttpRequest<"u",MR=ER&&function(a){return new Promise(function(y,A){const P=mS(a);let L=P.data;const F=Ho.from(P.headers).normalize();let{responseType:r,onUploadProgress:W,onDownloadProgress:ne}=P,Q,ce,ze,je,Oe;function Le(){je&&je(),Oe&&Oe(),P.cancelToken&&P.cancelToken.unsubscribe(Q),P.signal&&P.signal.removeEventListener("abort",Q)}let ct=new XMLHttpRequest;ct.open(P.method.toUpperCase(),P.url,!0),ct.timeout=P.timeout;function st(){if(!ct)return;const He=Ho.from("getAllResponseHeaders"in ct&&ct.getAllResponseHeaders()),at={data:!r||r==="text"||r==="json"?ct.responseText:ct.response,status:ct.status,statusText:ct.statusText,headers:He,config:a,request:ct};fS(function(dt){y(dt),Le()},function(dt){A(dt),Le()},at),ct=null}"onloadend"in ct?ct.onloadend=st:ct.onreadystatechange=function(){!ct||ct.readyState!==4||ct.status===0&&!(ct.responseURL&&ct.responseURL.indexOf("file:")===0)||setTimeout(st)},ct.onabort=function(){ct&&(A(new Qi("Request aborted",Qi.ECONNABORTED,a,ct)),ct=null)},ct.onerror=function(){A(new Qi("Network Error",Qi.ERR_NETWORK,a,ct)),ct=null},ct.ontimeout=function(){let Ve=P.timeout?"timeout of "+P.timeout+"ms exceeded":"timeout exceeded";const at=P.transitional||uS;P.timeoutErrorMessage&&(Ve=P.timeoutErrorMessage),A(new Qi(Ve,at.clarifyTimeoutError?Qi.ETIMEDOUT:Qi.ECONNABORTED,a,ct)),ct=null},L===void 0&&F.setContentType(null),"setRequestHeader"in ct&&wt.forEach(F.toJSON(),function(Ve,at){ct.setRequestHeader(at,Ve)}),wt.isUndefined(P.withCredentials)||(ct.withCredentials=!!P.withCredentials),r&&r!=="json"&&(ct.responseType=P.responseType),ne&&([ze,Oe]=sg(ne,!0),ct.addEventListener("progress",ze)),W&&ct.upload&&([ce,je]=sg(W),ct.upload.addEventListener("progress",ce),ct.upload.addEventListener("loadend",je)),(P.cancelToken||P.signal)&&(Q=He=>{ct&&(A(!He||He.type?new ld(null,a,ct):He),ct.abort(),ct=null)},P.cancelToken&&P.cancelToken.subscribe(Q),P.signal&&(P.signal.aborted?Q():P.signal.addEventListener("abort",Q)));const gt=yR(P.url);if(gt&&ss.protocols.indexOf(gt)===-1){A(new Qi("Unsupported protocol "+gt+":",Qi.ERR_BAD_REQUEST,a));return}ct.send(L||null)})},AR=(a,d)=>{const{length:y}=a=a?a.filter(Boolean):[];if(d||y){let A=new AbortController,P;const L=function(ne){if(!P){P=!0,r();const Q=ne instanceof Error?ne:this.reason;A.abort(Q instanceof Qi?Q:new ld(Q instanceof Error?Q.message:Q))}};let F=d&&setTimeout(()=>{F=null,L(new Qi(`timeout ${d} of ms exceeded`,Qi.ETIMEDOUT))},d);const r=()=>{a&&(F&&clearTimeout(F),F=null,a.forEach(ne=>{ne.unsubscribe?ne.unsubscribe(L):ne.removeEventListener("abort",L)}),a=null)};a.forEach(ne=>ne.addEventListener("abort",L));const{signal:W}=A;return W.unsubscribe=()=>wt.asap(r),W}},IR=AR,CR=function*(a,d){let y=a.byteLength;if(!d||y<d){yield a;return}let A=0,P;for(;A<y;)P=A+d,yield a.slice(A,P),A=P},PR=async function*(a,d){for await(const y of RR(a))yield*CR(y,d)},RR=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const d=a.getReader();try{for(;;){const{done:y,value:A}=await d.read();if(y)break;yield A}}finally{await d.cancel()}},UT=(a,d,y,A)=>{const P=PR(a,d);let L=0,F,r=W=>{F||(F=!0,A&&A(W))};return new ReadableStream({async pull(W){try{const{done:ne,value:Q}=await P.next();if(ne){r(),W.close();return}let ce=Q.byteLength;if(y){let ze=L+=ce;y(ze)}W.enqueue(new Uint8Array(Q))}catch(ne){throw r(ne),ne}},cancel(W){return r(W),P.return()}},{highWaterMark:2})},Bg=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",_S=Bg&&typeof ReadableStream=="function",DR=Bg&&(typeof TextEncoder=="function"?(a=>d=>a.encode(d))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),gS=(a,...d)=>{try{return!!a(...d)}catch{return!1}},zR=_S&&gS(()=>{let a=!1;const d=new Request(ss.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!d}),jT=64*1024,Rx=_S&&gS(()=>wt.isReadableStream(new Response("").body)),og={stream:Rx&&(a=>a.body)};Bg&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!og[d]&&(og[d]=wt.isFunction(a[d])?y=>y[d]():(y,A)=>{throw new Qi(`Response type '${d}' is not supported`,Qi.ERR_NOT_SUPPORT,A)})})})(new Response);const LR=async a=>{if(a==null)return 0;if(wt.isBlob(a))return a.size;if(wt.isSpecCompliantForm(a))return(await new Request(ss.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(wt.isArrayBufferView(a)||wt.isArrayBuffer(a))return a.byteLength;if(wt.isURLSearchParams(a)&&(a=a+""),wt.isString(a))return(await DR(a)).byteLength},OR=async(a,d)=>{const y=wt.toFiniteNumber(a.getContentLength());return y??LR(d)},kR=Bg&&(async a=>{let{url:d,method:y,data:A,signal:P,cancelToken:L,timeout:F,onDownloadProgress:r,onUploadProgress:W,responseType:ne,headers:Q,withCredentials:ce="same-origin",fetchOptions:ze}=mS(a);ne=ne?(ne+"").toLowerCase():"text";let je=IR([P,L&&L.toAbortSignal()],F),Oe;const Le=je&&je.unsubscribe&&(()=>{je.unsubscribe()});let ct;try{if(W&&zR&&y!=="get"&&y!=="head"&&(ct=await OR(Q,A))!==0){let at=new Request(d,{method:"POST",body:A,duplex:"half"}),Pt;if(wt.isFormData(A)&&(Pt=at.headers.get("content-type"))&&Q.setContentType(Pt),at.body){const[dt,zt]=BT(ct,sg(NT(W)));A=UT(at.body,jT,dt,zt)}}wt.isString(ce)||(ce=ce?"include":"omit");const st="credentials"in Request.prototype;Oe=new Request(d,{...ze,signal:je,method:y.toUpperCase(),headers:Q.normalize().toJSON(),body:A,duplex:"half",credentials:st?ce:void 0});let gt=await fetch(Oe);const He=Rx&&(ne==="stream"||ne==="response");if(Rx&&(r||He&&Le)){const at={};["status","statusText","headers"].forEach(ut=>{at[ut]=gt[ut]});const Pt=wt.toFiniteNumber(gt.headers.get("content-length")),[dt,zt]=r&&BT(Pt,sg(NT(r),!0))||[];gt=new Response(UT(gt.body,jT,dt,()=>{zt&&zt(),Le&&Le()}),at)}ne=ne||"text";let Ve=await og[wt.findKey(og,ne)||"text"](gt,a);return!He&&Le&&Le(),await new Promise((at,Pt)=>{fS(at,Pt,{data:Ve,headers:Ho.from(gt.headers),status:gt.status,statusText:gt.statusText,config:a,request:Oe})})}catch(st){throw Le&&Le(),st&&st.name==="TypeError"&&/fetch/i.test(st.message)?Object.assign(new Qi("Network Error",Qi.ERR_NETWORK,a,Oe),{cause:st.cause||st}):Qi.from(st,st&&st.code,a,Oe)}}),Dx={http:XP,xhr:MR,fetch:kR};wt.forEach(Dx,(a,d)=>{if(a){try{Object.defineProperty(a,"name",{value:d})}catch{}Object.defineProperty(a,"adapterName",{value:d})}});const GT=a=>`- ${a}`,FR=a=>wt.isFunction(a)||a===null||a===!1,yS={getAdapter:a=>{a=wt.isArray(a)?a:[a];const{length:d}=a;let y,A;const P={};for(let L=0;L<d;L++){y=a[L];let F;if(A=y,!FR(y)&&(A=Dx[(F=String(y)).toLowerCase()],A===void 0))throw new Qi(`Unknown adapter '${F}'`);if(A)break;P[F||"#"+L]=A}if(!A){const L=Object.entries(P).map(([r,W])=>`adapter ${r} `+(W===!1?"is not supported by the environment":"is not available in the build"));let F=d?L.length>1?`since :
`+L.map(GT).join(`
`):" "+GT(L[0]):"as no adapter specified";throw new Qi("There is no suitable adapter to dispatch the request "+F,"ERR_NOT_SUPPORT")}return A},adapters:Dx};function fx(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new ld(null,a)}function qT(a){return fx(a),a.headers=Ho.from(a.headers),a.data=dx.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),yS.getAdapter(a.adapter||fv.adapter)(a).then(function(A){return fx(a),A.data=dx.call(a,a.transformResponse,A),A.headers=Ho.from(A.headers),A},function(A){return dS(A)||(fx(a),A&&A.response&&(A.response.data=dx.call(a,a.transformResponse,A.response),A.response.headers=Ho.from(A.response.headers))),Promise.reject(A)})}const xS="1.7.9",Ng={};["object","boolean","number","function","string","symbol"].forEach((a,d)=>{Ng[a]=function(A){return typeof A===a||"a"+(d<1?"n ":" ")+a}});const HT={};Ng.transitional=function(d,y,A){function P(L,F){return"[Axios v"+xS+"] Transitional option '"+L+"'"+F+(A?". "+A:"")}return(L,F,r)=>{if(d===!1)throw new Qi(P(F," has been removed"+(y?" in "+y:"")),Qi.ERR_DEPRECATED);return y&&!HT[F]&&(HT[F]=!0,console.warn(P(F," has been deprecated since v"+y+" and will be removed in the near future"))),d?d(L,F,r):!0}};Ng.spelling=function(d){return(y,A)=>(console.warn(`${A} is likely a misspelling of ${d}`),!0)};function BR(a,d,y){if(typeof a!="object")throw new Qi("options must be an object",Qi.ERR_BAD_OPTION_VALUE);const A=Object.keys(a);let P=A.length;for(;P-- >0;){const L=A[P],F=d[L];if(F){const r=a[L],W=r===void 0||F(r,L,a);if(W!==!0)throw new Qi("option "+L+" must be "+W,Qi.ERR_BAD_OPTION_VALUE);continue}if(y!==!0)throw new Qi("Unknown option "+L,Qi.ERR_BAD_OPTION)}}const X_={assertOptions:BR,validators:Ng},da=X_.validators;class ag{constructor(d){this.defaults=d,this.interceptors={request:new kT,response:new kT}}async request(d,y){try{return await this._request(d,y)}catch(A){if(A instanceof Error){let P={};Error.captureStackTrace?Error.captureStackTrace(P):P=new Error;const L=P.stack?P.stack.replace(/^.+\n/,""):"";try{A.stack?L&&!String(A.stack).endsWith(L.replace(/^.+\n.+\n/,""))&&(A.stack+=`
`+L):A.stack=L}catch{}}throw A}}_request(d,y){typeof d=="string"?(y=y||{},y.url=d):y=d||{},y=yu(this.defaults,y);const{transitional:A,paramsSerializer:P,headers:L}=y;A!==void 0&&X_.assertOptions(A,{silentJSONParsing:da.transitional(da.boolean),forcedJSONParsing:da.transitional(da.boolean),clarifyTimeoutError:da.transitional(da.boolean)},!1),P!=null&&(wt.isFunction(P)?y.paramsSerializer={serialize:P}:X_.assertOptions(P,{encode:da.function,serialize:da.function},!0)),X_.assertOptions(y,{baseUrl:da.spelling("baseURL"),withXsrfToken:da.spelling("withXSRFToken")},!0),y.method=(y.method||this.defaults.method||"get").toLowerCase();let F=L&&wt.merge(L.common,L[y.method]);L&&wt.forEach(["delete","get","head","post","put","patch","common"],Oe=>{delete L[Oe]}),y.headers=Ho.concat(F,L);const r=[];let W=!0;this.interceptors.request.forEach(function(Le){typeof Le.runWhen=="function"&&Le.runWhen(y)===!1||(W=W&&Le.synchronous,r.unshift(Le.fulfilled,Le.rejected))});const ne=[];this.interceptors.response.forEach(function(Le){ne.push(Le.fulfilled,Le.rejected)});let Q,ce=0,ze;if(!W){const Oe=[qT.bind(this),void 0];for(Oe.unshift.apply(Oe,r),Oe.push.apply(Oe,ne),ze=Oe.length,Q=Promise.resolve(y);ce<ze;)Q=Q.then(Oe[ce++],Oe[ce++]);return Q}ze=r.length;let je=y;for(ce=0;ce<ze;){const Oe=r[ce++],Le=r[ce++];try{je=Oe(je)}catch(ct){Le.call(this,ct);break}}try{Q=qT.call(this,je)}catch(Oe){return Promise.reject(Oe)}for(ce=0,ze=ne.length;ce<ze;)Q=Q.then(ne[ce++],ne[ce++]);return Q}getUri(d){d=yu(this.defaults,d);const y=pS(d.baseURL,d.url);return cS(y,d.params,d.paramsSerializer)}}wt.forEach(["delete","get","head","options"],function(d){ag.prototype[d]=function(y,A){return this.request(yu(A||{},{method:d,url:y,data:(A||{}).data}))}});wt.forEach(["post","put","patch"],function(d){function y(A){return function(L,F,r){return this.request(yu(r||{},{method:d,headers:A?{"Content-Type":"multipart/form-data"}:{},url:L,data:F}))}}ag.prototype[d]=y(),ag.prototype[d+"Form"]=y(!0)});const Y_=ag;class pv{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let y;this.promise=new Promise(function(L){y=L});const A=this;this.promise.then(P=>{if(!A._listeners)return;let L=A._listeners.length;for(;L-- >0;)A._listeners[L](P);A._listeners=null}),this.promise.then=P=>{let L;const F=new Promise(r=>{A.subscribe(r),L=r}).then(P);return F.cancel=function(){A.unsubscribe(L)},F},d(function(L,F,r){A.reason||(A.reason=new ld(L,F,r),y(A.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const y=this._listeners.indexOf(d);y!==-1&&this._listeners.splice(y,1)}toAbortSignal(){const d=new AbortController,y=A=>{d.abort(A)};return this.subscribe(y),d.signal.unsubscribe=()=>this.unsubscribe(y),d.signal}static source(){let d;return{token:new pv(function(P){d=P}),cancel:d}}}const NR=pv;function VR(a){return function(y){return a.apply(null,y)}}function UR(a){return wt.isObject(a)&&a.isAxiosError===!0}const zx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zx).forEach(([a,d])=>{zx[d]=a});const jR=zx;function vS(a){const d=new Y_(a),y=K2(Y_.prototype.request,d);return wt.extend(y,Y_.prototype,d,{allOwnKeys:!0}),wt.extend(y,d,null,{allOwnKeys:!0}),y.create=function(P){return vS(yu(a,P))},y}const Sr=vS(fv);Sr.Axios=Y_;Sr.CanceledError=ld;Sr.CancelToken=NR;Sr.isCancel=dS;Sr.VERSION=xS;Sr.toFormData=kg;Sr.AxiosError=Qi;Sr.Cancel=Sr.CanceledError;Sr.all=function(d){return Promise.all(d)};Sr.spread=VR;Sr.isAxiosError=UR;Sr.mergeConfig=yu;Sr.AxiosHeaders=Ho;Sr.formToJSON=a=>hS(wt.isHTMLForm(a)?new FormData(a):a);Sr.getAdapter=yS.getAdapter;Sr.HttpStatusCode=jR;Sr.default=Sr;const Xa=Sr;window.axios=Xa;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.axios.defaults.baseURL="melodiaconectada/docker/melodia-emja/public/api/";/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Xs(a){const d=Object.create(null);for(const y of a.split(","))d[y]=1;return y=>y in d}const ln={},Hh=[],Ur=()=>{},mp=()=>!1,wu=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),mv=a=>a.startsWith("onUpdate:"),cn=Object.assign,_v=(a,d)=>{const y=a.indexOf(d);y>-1&&a.splice(y,1)},GR=Object.prototype.hasOwnProperty,Tn=(a,d)=>GR.call(a,d),ci=Array.isArray,$h=a=>cd(a)==="[object Map]",Tu=a=>cd(a)==="[object Set]",$T=a=>cd(a)==="[object Date]",qR=a=>cd(a)==="[object RegExp]",Li=a=>typeof a=="function",Wi=a=>typeof a=="string",Ls=a=>typeof a=="symbol",Cn=a=>a!==null&&typeof a=="object",gv=a=>(Cn(a)||Li(a))&&Li(a.then)&&Li(a.catch),bS=Object.prototype.toString,cd=a=>bS.call(a),HR=a=>cd(a).slice(8,-1),Vg=a=>cd(a)==="[object Object]",yv=a=>Wi(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,Zl=Xs(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),$R=Xs("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),Ug=a=>{const d=Object.create(null);return y=>d[y]||(d[y]=a(y))},ZR=/-(\w)/g,Zn=Ug(a=>a.replace(ZR,(d,y)=>y?y.toUpperCase():"")),WR=/\B([A-Z])/g,Rs=Ug(a=>a.replace(WR,"-$1").toLowerCase()),Su=Ug(a=>a.charAt(0).toUpperCase()+a.slice(1)),Zh=Ug(a=>a?`on${Su(a)}`:""),ys=(a,d)=>!Object.is(a,d),Wh=(a,...d)=>{for(let y=0;y<a.length;y++)a[y](...d)},wS=(a,d,y,A=!1)=>{Object.defineProperty(a,d,{configurable:!0,enumerable:!1,writable:A,value:y})},lg=a=>{const d=parseFloat(a);return isNaN(d)?a:d},cg=a=>{const d=Wi(a)?Number(a):NaN;return isNaN(d)?a:d};let ZT;const jg=()=>ZT||(ZT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function XR(a,d){return a+JSON.stringify(d,(y,A)=>typeof A=="function"?A.toString():A)}const YR="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",KR=Xs(YR);function Hp(a){if(ci(a)){const d={};for(let y=0;y<a.length;y++){const A=a[y],P=Wi(A)?TS(A):Hp(A);if(P)for(const L in P)d[L]=P[L]}return d}else if(Wi(a)||Cn(a))return a}const JR=/;(?![^(]*\))/g,QR=/:([^]+)/,e3=/\/\*[^]*?\*\//g;function TS(a){const d={};return a.replace(e3,"").split(JR).forEach(y=>{if(y){const A=y.split(QR);A.length>1&&(d[A[0].trim()]=A[1].trim())}}),d}function $p(a){let d="";if(Wi(a))d=a;else if(ci(a))for(let y=0;y<a.length;y++){const A=$p(a[y]);A&&(d+=A+" ")}else if(Cn(a))for(const y in a)a[y]&&(d+=y+" ");return d.trim()}function t3(a){if(!a)return null;let{class:d,style:y}=a;return d&&!Wi(d)&&(a.class=$p(d)),y&&(a.style=Hp(y)),a}const i3="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",n3="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",r3="annotation,annotation-xml,maction,maligngroup,malignmark,math,menclose,merror,mfenced,mfrac,mfraction,mglyph,mi,mlabeledtr,mlongdiv,mmultiscripts,mn,mo,mover,mpadded,mphantom,mprescripts,mroot,mrow,ms,mscarries,mscarry,msgroup,msline,mspace,msqrt,msrow,mstack,mstyle,msub,msubsup,msup,mtable,mtd,mtext,mtr,munder,munderover,none,semantics",s3="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",o3=Xs(i3),a3=Xs(n3),l3=Xs(r3),c3=Xs(s3),u3="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",h3=Xs(u3);function SS(a){return!!a||a===""}function d3(a,d){if(a.length!==d.length)return!1;let y=!0;for(let A=0;y&&A<a.length;A++)y=Jl(a[A],d[A]);return y}function Jl(a,d){if(a===d)return!0;let y=$T(a),A=$T(d);if(y||A)return y&&A?a.getTime()===d.getTime():!1;if(y=Ls(a),A=Ls(d),y||A)return a===d;if(y=ci(a),A=ci(d),y||A)return y&&A?d3(a,d):!1;if(y=Cn(a),A=Cn(d),y||A){if(!y||!A)return!1;const P=Object.keys(a).length,L=Object.keys(d).length;if(P!==L)return!1;for(const F in a){const r=a.hasOwnProperty(F),W=d.hasOwnProperty(F);if(r&&!W||!r&&W||!Jl(a[F],d[F]))return!1}}return String(a)===String(d)}function Gg(a,d){return a.findIndex(y=>Jl(y,d))}const ES=a=>!!(a&&a.__v_isRef===!0),Gh=a=>Wi(a)?a:a==null?"":ci(a)||Cn(a)&&(a.toString===bS||!Li(a.toString))?ES(a)?Gh(a.value):JSON.stringify(a,MS,2):String(a),MS=(a,d)=>ES(d)?MS(a,d.value):$h(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((y,[A,P],L)=>(y[px(A,L)+" =>"]=P,y),{})}:Tu(d)?{[`Set(${d.size})`]:[...d.values()].map(y=>px(y))}:Ls(d)?px(d):Cn(d)&&!ci(d)&&!Vg(d)?String(d):d,px=(a,d="")=>{var y;return Ls(a)?`Symbol(${(y=a.description)!=null?y:d})`:a};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let gs;class xv{constructor(d=!1){this.detached=d,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=gs,!d&&gs&&(this.index=(gs.scopes||(gs.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let d,y;if(this.scopes)for(d=0,y=this.scopes.length;d<y;d++)this.scopes[d].pause();for(d=0,y=this.effects.length;d<y;d++)this.effects[d].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let d,y;if(this.scopes)for(d=0,y=this.scopes.length;d<y;d++)this.scopes[d].resume();for(d=0,y=this.effects.length;d<y;d++)this.effects[d].resume()}}run(d){if(this._active){const y=gs;try{return gs=this,d()}finally{gs=y}}}on(){gs=this}off(){gs=this.parent}stop(d){if(this._active){this._active=!1;let y,A;for(y=0,A=this.effects.length;y<A;y++)this.effects[y].stop();for(this.effects.length=0,y=0,A=this.cleanups.length;y<A;y++)this.cleanups[y]();if(this.cleanups.length=0,this.scopes){for(y=0,A=this.scopes.length;y<A;y++)this.scopes[y].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!d){const P=this.parent.scopes.pop();P&&P!==this&&(this.parent.scopes[this.index]=P,P.index=this.index)}this.parent=void 0}}}function f3(a){return new xv(a)}function AS(){return gs}function p3(a,d=!1){gs&&gs.cleanups.push(a)}let Vn;const mx=new WeakSet;class Cp{constructor(d){this.fn=d,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,gs&&gs.active&&gs.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,mx.has(this)&&(mx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||CS(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,WT(this),PS(this);const d=Vn,y=$o;Vn=this,$o=!0;try{return this.fn()}finally{RS(this),Vn=d,$o=y,this.flags&=-3}}stop(){if(this.flags&1){for(let d=this.deps;d;d=d.nextDep)wv(d);this.deps=this.depsTail=void 0,WT(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?mx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Lx(this)&&this.run()}get dirty(){return Lx(this)}}let IS=0,xp,vp;function CS(a,d=!1){if(a.flags|=8,d){a.next=vp,vp=a;return}a.next=xp,xp=a}function vv(){IS++}function bv(){if(--IS>0)return;if(vp){let d=vp;for(vp=void 0;d;){const y=d.next;d.next=void 0,d.flags&=-9,d=y}}let a;for(;xp;){let d=xp;for(xp=void 0;d;){const y=d.next;if(d.next=void 0,d.flags&=-9,d.flags&1)try{d.trigger()}catch(A){a||(a=A)}d=y}}if(a)throw a}function PS(a){for(let d=a.deps;d;d=d.nextDep)d.version=-1,d.prevActiveLink=d.dep.activeLink,d.dep.activeLink=d}function RS(a){let d,y=a.depsTail,A=y;for(;A;){const P=A.prevDep;A.version===-1?(A===y&&(y=P),wv(A),m3(A)):d=A,A.dep.activeLink=A.prevActiveLink,A.prevActiveLink=void 0,A=P}a.deps=d,a.depsTail=y}function Lx(a){for(let d=a.deps;d;d=d.nextDep)if(d.dep.version!==d.version||d.dep.computed&&(DS(d.dep.computed)||d.dep.version!==d.version))return!0;return!!a._dirty}function DS(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===Pp))return;a.globalVersion=Pp;const d=a.dep;if(a.flags|=2,d.version>0&&!a.isSSR&&a.deps&&!Lx(a)){a.flags&=-3;return}const y=Vn,A=$o;Vn=a,$o=!0;try{PS(a);const P=a.fn(a._value);(d.version===0||ys(P,a._value))&&(a._value=P,d.version++)}catch(P){throw d.version++,P}finally{Vn=y,$o=A,RS(a),a.flags&=-3}}function wv(a,d=!1){const{dep:y,prevSub:A,nextSub:P}=a;if(A&&(A.nextSub=P,a.prevSub=void 0),P&&(P.prevSub=A,a.nextSub=void 0),y.subs===a&&(y.subs=A,!A&&y.computed)){y.computed.flags&=-5;for(let L=y.computed.deps;L;L=L.nextDep)wv(L,!0)}!d&&!--y.sc&&y.map&&y.map.delete(y.key)}function m3(a){const{prevDep:d,nextDep:y}=a;d&&(d.nextDep=y,a.prevDep=void 0),y&&(y.prevDep=d,a.nextDep=void 0)}function _3(a,d){a.effect instanceof Cp&&(a=a.effect.fn);const y=new Cp(a);d&&cn(y,d);try{y.run()}catch(P){throw y.stop(),P}const A=y.run.bind(y);return A.effect=y,A}function g3(a){a.effect.stop()}let $o=!0;const zS=[];function tc(){zS.push($o),$o=!1}function ic(){const a=zS.pop();$o=a===void 0?!0:a}function WT(a){const{cleanup:d}=a;if(a.cleanup=void 0,d){const y=Vn;Vn=void 0;try{d()}finally{Vn=y}}}let Pp=0;class y3{constructor(d,y){this.sub=d,this.dep=y,this.version=y.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class qg{constructor(d){this.computed=d,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(d){if(!Vn||!$o||Vn===this.computed)return;let y=this.activeLink;if(y===void 0||y.sub!==Vn)y=this.activeLink=new y3(Vn,this),Vn.deps?(y.prevDep=Vn.depsTail,Vn.depsTail.nextDep=y,Vn.depsTail=y):Vn.deps=Vn.depsTail=y,LS(y);else if(y.version===-1&&(y.version=this.version,y.nextDep)){const A=y.nextDep;A.prevDep=y.prevDep,y.prevDep&&(y.prevDep.nextDep=A),y.prevDep=Vn.depsTail,y.nextDep=void 0,Vn.depsTail.nextDep=y,Vn.depsTail=y,Vn.deps===y&&(Vn.deps=A)}return y}trigger(d){this.version++,Pp++,this.notify(d)}notify(d){vv();try{for(let y=this.subs;y;y=y.prevSub)y.sub.notify()&&y.sub.dep.notify()}finally{bv()}}}function LS(a){if(a.dep.sc++,a.sub.flags&4){const d=a.dep.computed;if(d&&!a.dep.subs){d.flags|=20;for(let A=d.deps;A;A=A.nextDep)LS(A)}const y=a.dep.subs;y!==a&&(a.prevSub=y,y&&(y.nextSub=a)),a.dep.subs=a}}const ug=new WeakMap,fu=Symbol(""),Ox=Symbol(""),Rp=Symbol("");function ns(a,d,y){if($o&&Vn){let A=ug.get(a);A||ug.set(a,A=new Map);let P=A.get(y);P||(A.set(y,P=new qg),P.map=A,P.key=y),P.track()}}function $a(a,d,y,A,P,L){const F=ug.get(a);if(!F){Pp++;return}const r=W=>{W&&W.trigger()};if(vv(),d==="clear")F.forEach(r);else{const W=ci(a),ne=W&&yv(y);if(W&&y==="length"){const Q=Number(A);F.forEach((ce,ze)=>{(ze==="length"||ze===Rp||!Ls(ze)&&ze>=Q)&&r(ce)})}else switch((y!==void 0||F.has(void 0))&&r(F.get(y)),ne&&r(F.get(Rp)),d){case"add":W?ne&&r(F.get("length")):(r(F.get(fu)),$h(a)&&r(F.get(Ox)));break;case"delete":W||(r(F.get(fu)),$h(a)&&r(F.get(Ox)));break;case"set":$h(a)&&r(F.get(fu));break}}bv()}function x3(a,d){const y=ug.get(a);return y&&y.get(d)}function Bh(a){const d=gn(a);return d===a?d:(ns(d,"iterate",Rp),Ws(a)?d:d.map(rs))}function Hg(a){return ns(a=gn(a),"iterate",Rp),a}const v3={__proto__:null,[Symbol.iterator](){return _x(this,Symbol.iterator,rs)},concat(...a){return Bh(this).concat(...a.map(d=>ci(d)?Bh(d):d))},entries(){return _x(this,"entries",a=>(a[1]=rs(a[1]),a))},every(a,d){return ja(this,"every",a,d,void 0,arguments)},filter(a,d){return ja(this,"filter",a,d,y=>y.map(rs),arguments)},find(a,d){return ja(this,"find",a,d,rs,arguments)},findIndex(a,d){return ja(this,"findIndex",a,d,void 0,arguments)},findLast(a,d){return ja(this,"findLast",a,d,rs,arguments)},findLastIndex(a,d){return ja(this,"findLastIndex",a,d,void 0,arguments)},forEach(a,d){return ja(this,"forEach",a,d,void 0,arguments)},includes(...a){return gx(this,"includes",a)},indexOf(...a){return gx(this,"indexOf",a)},join(a){return Bh(this).join(a)},lastIndexOf(...a){return gx(this,"lastIndexOf",a)},map(a,d){return ja(this,"map",a,d,void 0,arguments)},pop(){return dp(this,"pop")},push(...a){return dp(this,"push",a)},reduce(a,...d){return XT(this,"reduce",a,d)},reduceRight(a,...d){return XT(this,"reduceRight",a,d)},shift(){return dp(this,"shift")},some(a,d){return ja(this,"some",a,d,void 0,arguments)},splice(...a){return dp(this,"splice",a)},toReversed(){return Bh(this).toReversed()},toSorted(a){return Bh(this).toSorted(a)},toSpliced(...a){return Bh(this).toSpliced(...a)},unshift(...a){return dp(this,"unshift",a)},values(){return _x(this,"values",rs)}};function _x(a,d,y){const A=Hg(a),P=A[d]();return A!==a&&!Ws(a)&&(P._next=P.next,P.next=()=>{const L=P._next();return L.value&&(L.value=y(L.value)),L}),P}const b3=Array.prototype;function ja(a,d,y,A,P,L){const F=Hg(a),r=F!==a&&!Ws(a),W=F[d];if(W!==b3[d]){const ce=W.apply(a,L);return r?rs(ce):ce}let ne=y;F!==a&&(r?ne=function(ce,ze){return y.call(this,rs(ce),ze,a)}:y.length>2&&(ne=function(ce,ze){return y.call(this,ce,ze,a)}));const Q=W.call(F,ne,A);return r&&P?P(Q):Q}function XT(a,d,y,A){const P=Hg(a);let L=y;return P!==a&&(Ws(a)?y.length>3&&(L=function(F,r,W){return y.call(this,F,r,W,a)}):L=function(F,r,W){return y.call(this,F,rs(r),W,a)}),P[d](L,...A)}function gx(a,d,y){const A=gn(a);ns(A,"iterate",Rp);const P=A[d](...y);return(P===-1||P===!1)&&Xg(y[0])?(y[0]=gn(y[0]),A[d](...y)):P}function dp(a,d,y=[]){tc(),vv();const A=gn(a)[d].apply(a,y);return bv(),ic(),A}const w3=Xs("__proto__,__v_isRef,__isVue"),OS=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(Ls));function T3(a){Ls(a)||(a=String(a));const d=gn(this);return ns(d,"has",a),d.hasOwnProperty(a)}class kS{constructor(d=!1,y=!1){this._isReadonly=d,this._isShallow=y}get(d,y,A){if(y==="__v_skip")return d.__v_skip;const P=this._isReadonly,L=this._isShallow;if(y==="__v_isReactive")return!P;if(y==="__v_isReadonly")return P;if(y==="__v_isShallow")return L;if(y==="__v_raw")return A===(P?L?jS:US:L?VS:NS).get(d)||Object.getPrototypeOf(d)===Object.getPrototypeOf(A)?d:void 0;const F=ci(d);if(!P){let W;if(F&&(W=v3[y]))return W;if(y==="hasOwnProperty")return T3}const r=Reflect.get(d,y,kr(d)?d:A);return(Ls(y)?OS.has(y):w3(y))||(P||ns(d,"get",y),L)?r:kr(r)?F&&yv(y)?r:r.value:Cn(r)?P?Tv(r):Zg(r):r}}class FS extends kS{constructor(d=!1){super(!1,d)}set(d,y,A,P){let L=d[y];if(!this._isShallow){const W=Ql(L);if(!Ws(A)&&!Ql(A)&&(L=gn(L),A=gn(A)),!ci(d)&&kr(L)&&!kr(A))return W?!1:(L.value=A,!0)}const F=ci(d)&&yv(y)?Number(y)<d.length:Tn(d,y),r=Reflect.set(d,y,A,kr(d)?d:P);return d===gn(P)&&(F?ys(A,L)&&$a(d,"set",y,A):$a(d,"add",y,A)),r}deleteProperty(d,y){const A=Tn(d,y);d[y];const P=Reflect.deleteProperty(d,y);return P&&A&&$a(d,"delete",y,void 0),P}has(d,y){const A=Reflect.has(d,y);return(!Ls(y)||!OS.has(y))&&ns(d,"has",y),A}ownKeys(d){return ns(d,"iterate",ci(d)?"length":fu),Reflect.ownKeys(d)}}class BS extends kS{constructor(d=!1){super(!0,d)}set(d,y){return!0}deleteProperty(d,y){return!0}}const S3=new FS,E3=new BS,M3=new FS(!0),A3=new BS(!0),kx=a=>a,L_=a=>Reflect.getPrototypeOf(a);function I3(a,d,y){return function(...A){const P=this.__v_raw,L=gn(P),F=$h(L),r=a==="entries"||a===Symbol.iterator&&F,W=a==="keys"&&F,ne=P[a](...A),Q=y?kx:d?Fx:rs;return!d&&ns(L,"iterate",W?Ox:fu),{next(){const{value:ce,done:ze}=ne.next();return ze?{value:ce,done:ze}:{value:r?[Q(ce[0]),Q(ce[1])]:Q(ce),done:ze}},[Symbol.iterator](){return this}}}}function O_(a){return function(...d){return a==="delete"?!1:a==="clear"?void 0:this}}function C3(a,d){const y={get(P){const L=this.__v_raw,F=gn(L),r=gn(P);a||(ys(P,r)&&ns(F,"get",P),ns(F,"get",r));const{has:W}=L_(F),ne=d?kx:a?Fx:rs;if(W.call(F,P))return ne(L.get(P));if(W.call(F,r))return ne(L.get(r));L!==F&&L.get(P)},get size(){const P=this.__v_raw;return!a&&ns(gn(P),"iterate",fu),Reflect.get(P,"size",P)},has(P){const L=this.__v_raw,F=gn(L),r=gn(P);return a||(ys(P,r)&&ns(F,"has",P),ns(F,"has",r)),P===r?L.has(P):L.has(P)||L.has(r)},forEach(P,L){const F=this,r=F.__v_raw,W=gn(r),ne=d?kx:a?Fx:rs;return!a&&ns(W,"iterate",fu),r.forEach((Q,ce)=>P.call(L,ne(Q),ne(ce),F))}};return cn(y,a?{add:O_("add"),set:O_("set"),delete:O_("delete"),clear:O_("clear")}:{add(P){!d&&!Ws(P)&&!Ql(P)&&(P=gn(P));const L=gn(this);return L_(L).has.call(L,P)||(L.add(P),$a(L,"add",P,P)),this},set(P,L){!d&&!Ws(L)&&!Ql(L)&&(L=gn(L));const F=gn(this),{has:r,get:W}=L_(F);let ne=r.call(F,P);ne||(P=gn(P),ne=r.call(F,P));const Q=W.call(F,P);return F.set(P,L),ne?ys(L,Q)&&$a(F,"set",P,L):$a(F,"add",P,L),this},delete(P){const L=gn(this),{has:F,get:r}=L_(L);let W=F.call(L,P);W||(P=gn(P),W=F.call(L,P)),r&&r.call(L,P);const ne=L.delete(P);return W&&$a(L,"delete",P,void 0),ne},clear(){const P=gn(this),L=P.size!==0,F=P.clear();return L&&$a(P,"clear",void 0,void 0),F}}),["keys","values","entries",Symbol.iterator].forEach(P=>{y[P]=I3(P,a,d)}),y}function $g(a,d){const y=C3(a,d);return(A,P,L)=>P==="__v_isReactive"?!a:P==="__v_isReadonly"?a:P==="__v_raw"?A:Reflect.get(Tn(y,P)&&P in A?y:A,P,L)}const P3={get:$g(!1,!1)},R3={get:$g(!1,!0)},D3={get:$g(!0,!1)},z3={get:$g(!0,!0)},NS=new WeakMap,VS=new WeakMap,US=new WeakMap,jS=new WeakMap;function L3(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function O3(a){return a.__v_skip||!Object.isExtensible(a)?0:L3(HR(a))}function Zg(a){return Ql(a)?a:Wg(a,!1,S3,P3,NS)}function GS(a){return Wg(a,!1,M3,R3,VS)}function Tv(a){return Wg(a,!0,E3,D3,US)}function k3(a){return Wg(a,!0,A3,z3,jS)}function Wg(a,d,y,A,P){if(!Cn(a)||a.__v_raw&&!(d&&a.__v_isReactive))return a;const L=P.get(a);if(L)return L;const F=O3(a);if(F===0)return a;const r=new Proxy(a,F===2?A:y);return P.set(a,r),r}function Wl(a){return Ql(a)?Wl(a.__v_raw):!!(a&&a.__v_isReactive)}function Ql(a){return!!(a&&a.__v_isReadonly)}function Ws(a){return!!(a&&a.__v_isShallow)}function Xg(a){return a?!!a.__v_raw:!1}function gn(a){const d=a&&a.__v_raw;return d?gn(d):a}function qS(a){return!Tn(a,"__v_skip")&&Object.isExtensible(a)&&wS(a,"__v_skip",!0),a}const rs=a=>Cn(a)?Zg(a):a,Fx=a=>Cn(a)?Tv(a):a;function kr(a){return a?a.__v_isRef===!0:!1}function bp(a){return $S(a,!1)}function HS(a){return $S(a,!0)}function $S(a,d){return kr(a)?a:new F3(a,d)}class F3{constructor(d,y){this.dep=new qg,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=y?d:gn(d),this._value=y?d:rs(d),this.__v_isShallow=y}get value(){return this.dep.track(),this._value}set value(d){const y=this._rawValue,A=this.__v_isShallow||Ws(d)||Ql(d);d=A?d:gn(d),ys(d,y)&&(this._rawValue=d,this._value=A?d:rs(d),this.dep.trigger())}}function B3(a){a.dep&&a.dep.trigger()}function Yg(a){return kr(a)?a.value:a}function N3(a){return Li(a)?a():Yg(a)}const V3={get:(a,d,y)=>d==="__v_raw"?a:Yg(Reflect.get(a,d,y)),set:(a,d,y,A)=>{const P=a[d];return kr(P)&&!kr(y)?(P.value=y,!0):Reflect.set(a,d,y,A)}};function Sv(a){return Wl(a)?a:new Proxy(a,V3)}class U3{constructor(d){this.__v_isRef=!0,this._value=void 0;const y=this.dep=new qg,{get:A,set:P}=d(y.track.bind(y),y.trigger.bind(y));this._get=A,this._set=P}get value(){return this._value=this._get()}set value(d){this._set(d)}}function ZS(a){return new U3(a)}function j3(a){const d=ci(a)?new Array(a.length):{};for(const y in a)d[y]=WS(a,y);return d}class G3{constructor(d,y,A){this._object=d,this._key=y,this._defaultValue=A,this.__v_isRef=!0,this._value=void 0}get value(){const d=this._object[this._key];return this._value=d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}get dep(){return x3(gn(this._object),this._key)}}class q3{constructor(d){this._getter=d,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function H3(a,d,y){return kr(a)?a:Li(a)?new q3(a):Cn(a)&&arguments.length>1?WS(a,d,y):bp(a)}function WS(a,d,y){const A=a[d];return kr(A)?A:new G3(a,d,y)}class $3{constructor(d,y,A){this.fn=d,this.setter=y,this._value=void 0,this.dep=new qg(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Pp-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!y,this.isSSR=A}notify(){if(this.flags|=16,!(this.flags&8)&&Vn!==this)return CS(this,!0),!0}get value(){const d=this.dep.track();return DS(this),d&&(d.version=this.dep.version),this._value}set value(d){this.setter&&this.setter(d)}}function Z3(a,d,y=!1){let A,P;return Li(a)?A=a:(A=a.get,P=a.set),new $3(A,P,y)}const W3={GET:"get",HAS:"has",ITERATE:"iterate"},X3={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},k_={},hg=new WeakMap;let jl;function Y3(){return jl}function XS(a,d=!1,y=jl){if(y){let A=hg.get(y);A||hg.set(y,A=[]),A.push(a)}}function K3(a,d,y=ln){const{immediate:A,deep:P,once:L,scheduler:F,augmentJob:r,call:W}=y,ne=Ve=>P?Ve:Ws(Ve)||P===!1||P===0?Za(Ve,1):Za(Ve);let Q,ce,ze,je,Oe=!1,Le=!1;if(kr(a)?(ce=()=>a.value,Oe=Ws(a)):Wl(a)?(ce=()=>ne(a),Oe=!0):ci(a)?(Le=!0,Oe=a.some(Ve=>Wl(Ve)||Ws(Ve)),ce=()=>a.map(Ve=>{if(kr(Ve))return Ve.value;if(Wl(Ve))return ne(Ve);if(Li(Ve))return W?W(Ve,2):Ve()})):Li(a)?d?ce=W?()=>W(a,2):a:ce=()=>{if(ze){tc();try{ze()}finally{ic()}}const Ve=jl;jl=Q;try{return W?W(a,3,[je]):a(je)}finally{jl=Ve}}:ce=Ur,d&&P){const Ve=ce,at=P===!0?1/0:P;ce=()=>Za(Ve(),at)}const ct=AS(),st=()=>{Q.stop(),ct&&ct.active&&_v(ct.effects,Q)};if(L&&d){const Ve=d;d=(...at)=>{Ve(...at),st()}}let gt=Le?new Array(a.length).fill(k_):k_;const He=Ve=>{if(!(!(Q.flags&1)||!Q.dirty&&!Ve))if(d){const at=Q.run();if(P||Oe||(Le?at.some((Pt,dt)=>ys(Pt,gt[dt])):ys(at,gt))){ze&&ze();const Pt=jl;jl=Q;try{const dt=[at,gt===k_?void 0:Le&&gt[0]===k_?[]:gt,je];W?W(d,3,dt):d(...dt),gt=at}finally{jl=Pt}}}else Q.run()};return r&&r(He),Q=new Cp(ce),Q.scheduler=F?()=>F(He,!1):He,je=Ve=>XS(Ve,!1,Q),ze=Q.onStop=()=>{const Ve=hg.get(Q);if(Ve){if(W)W(Ve,4);else for(const at of Ve)at();hg.delete(Q)}},d?A?He(!0):gt=Q.run():F?F(He.bind(null,!0),!0):Q.run(),st.pause=Q.pause.bind(Q),st.resume=Q.resume.bind(Q),st.stop=st,st}function Za(a,d=1/0,y){if(d<=0||!Cn(a)||a.__v_skip||(y=y||new Set,y.has(a)))return a;if(y.add(a),d--,kr(a))Za(a.value,d,y);else if(ci(a))for(let A=0;A<a.length;A++)Za(a[A],d,y);else if(Tu(a)||$h(a))a.forEach(A=>{Za(A,d,y)});else if(Vg(a)){for(const A in a)Za(a[A],d,y);for(const A of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,A)&&Za(a[A],d,y)}return a}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const YS=[];function J3(a){YS.push(a)}function Q3(){YS.pop()}function eD(a,d){}const tD={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},iD={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function ud(a,d,y,A){try{return A?a(...A):a()}catch(P){Eu(P,d,y)}}function wo(a,d,y,A){if(Li(a)){const P=ud(a,d,y,A);return P&&gv(P)&&P.catch(L=>{Eu(L,d,y)}),P}if(ci(a)){const P=[];for(let L=0;L<a.length;L++)P.push(wo(a[L],d,y,A));return P}}function Eu(a,d,y,A=!0){const P=d?d.vnode:null,{errorHandler:L,throwUnhandledErrorInProduction:F}=d&&d.appContext.config||ln;if(d){let r=d.parent;const W=d.proxy,ne=`https://vuejs.org/error-reference/#runtime-${y}`;for(;r;){const Q=r.ec;if(Q){for(let ce=0;ce<Q.length;ce++)if(Q[ce](a,W,ne)===!1)return}r=r.parent}if(L){tc(),ud(L,null,10,[a,W,ne]),ic();return}}nD(a,y,P,A,F)}function nD(a,d,y,A=!0,P=!1){if(P)throw a;console.error(a)}const xs=[];let pa=-1;const Xh=[];let Gl=null,Uh=0;const KS=Promise.resolve();let dg=null;function Kg(a){const d=dg||KS;return a?d.then(this?a.bind(this):a):d}function rD(a){let d=pa+1,y=xs.length;for(;d<y;){const A=d+y>>>1,P=xs[A],L=zp(P);L<a||L===a&&P.flags&2?d=A+1:y=A}return d}function Ev(a){if(!(a.flags&1)){const d=zp(a),y=xs[xs.length-1];!y||!(a.flags&2)&&d>=zp(y)?xs.push(a):xs.splice(rD(d),0,a),a.flags|=1,JS()}}function JS(){dg||(dg=KS.then(QS))}function Dp(a){ci(a)?Xh.push(...a):Gl&&a.id===-1?Gl.splice(Uh+1,0,a):a.flags&1||(Xh.push(a),a.flags|=1),JS()}function YT(a,d,y=pa+1){for(;y<xs.length;y++){const A=xs[y];if(A&&A.flags&2){if(a&&A.id!==a.uid)continue;xs.splice(y,1),y--,A.flags&4&&(A.flags&=-2),A(),A.flags&4||(A.flags&=-2)}}}function fg(a){if(Xh.length){const d=[...new Set(Xh)].sort((y,A)=>zp(y)-zp(A));if(Xh.length=0,Gl){Gl.push(...d);return}for(Gl=d,Uh=0;Uh<Gl.length;Uh++){const y=Gl[Uh];y.flags&4&&(y.flags&=-2),y.flags&8||y(),y.flags&=-2}Gl=null,Uh=0}}const zp=a=>a.id==null?a.flags&2?-1:1/0:a.id;function QS(a){const d=Ur;try{for(pa=0;pa<xs.length;pa++){const y=xs[pa];y&&!(y.flags&8)&&(y.flags&4&&(y.flags&=-2),ud(y,y.i,y.i?15:14),y.flags&4||(y.flags&=-2))}}finally{for(;pa<xs.length;pa++){const y=xs[pa];y&&(y.flags&=-2)}pa=-1,xs.length=0,fg(),dg=null,(xs.length||Xh.length)&&QS()}}let jh,F_=[];function eE(a,d){var y,A;jh=a,jh?(jh.enabled=!0,F_.forEach(({event:P,args:L})=>jh.emit(P,...L)),F_=[]):typeof window<"u"&&window.HTMLElement&&!((A=(y=window.navigator)==null?void 0:y.userAgent)!=null&&A.includes("jsdom"))?((d.__VUE_DEVTOOLS_HOOK_REPLAY__=d.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(L=>{eE(L,d)}),setTimeout(()=>{jh||(d.__VUE_DEVTOOLS_HOOK_REPLAY__=null,F_=[])},3e3)):F_=[]}let Or=null,Jg=null;function Lp(a){const d=Or;return Or=a,Jg=a&&a.type.__scopeId||null,d}function sD(a){Jg=a}function oD(){Jg=null}const aD=a=>Mv;function Mv(a,d=Or,y){if(!d||a._n)return a;const A=(...P)=>{A._d&&$x(-1);const L=Lp(d);let F;try{F=a(...P)}finally{Lp(L),A._d&&$x(1)}return F};return A._n=!0,A._c=!0,A._d=!0,A}function _p(a,d){if(Or===null)return a;const y=Yp(Or),A=a.dirs||(a.dirs=[]);for(let P=0;P<d.length;P++){let[L,F,r,W=ln]=d[P];L&&(Li(L)&&(L={mounted:L,updated:L}),L.deep&&Za(F),A.push({dir:L,instance:y,value:F,oldValue:void 0,arg:r,modifiers:W}))}return a}function ma(a,d,y,A){const P=a.dirs,L=d&&d.dirs;for(let F=0;F<P.length;F++){const r=P[F];L&&(r.oldValue=L[F].value);let W=r.dir[A];W&&(tc(),wo(W,y,8,[a.el,r,a,d]),ic())}}const tE=Symbol("_vte"),iE=a=>a.__isTeleport,wp=a=>a&&(a.disabled||a.disabled===""),KT=a=>a&&(a.defer||a.defer===""),JT=a=>typeof SVGElement<"u"&&a instanceof SVGElement,QT=a=>typeof MathMLElement=="function"&&a instanceof MathMLElement,Bx=(a,d)=>{const y=a&&a.to;return Wi(y)?d?d(y):null:y},nE={name:"Teleport",__isTeleport:!0,process(a,d,y,A,P,L,F,r,W,ne){const{mc:Q,pc:ce,pbc:ze,o:{insert:je,querySelector:Oe,createText:Le,createComment:ct}}=ne,st=wp(d.props);let{shapeFlag:gt,children:He,dynamicChildren:Ve}=d;if(a==null){const at=d.el=Le(""),Pt=d.anchor=Le("");je(at,y,A),je(Pt,y,A);const dt=(ut,Je)=>{gt&16&&(P&&P.isCE&&(P.ce._teleportTarget=ut),Q(He,ut,Je,P,L,F,r,W))},zt=()=>{const ut=d.target=Bx(d.props,Oe),Je=rE(ut,d,Le,je);ut&&(F!=="svg"&&JT(ut)?F="svg":F!=="mathml"&&QT(ut)&&(F="mathml"),st||(dt(ut,Je),K_(d,!1)))};st&&(dt(y,Pt),K_(d,!0)),KT(d.props)?Dr(()=>{zt(),d.el.__isMounted=!0},L):zt()}else{if(KT(d.props)&&!a.el.__isMounted){Dr(()=>{nE.process(a,d,y,A,P,L,F,r,W,ne),delete a.el.__isMounted},L);return}d.el=a.el,d.targetStart=a.targetStart;const at=d.anchor=a.anchor,Pt=d.target=a.target,dt=d.targetAnchor=a.targetAnchor,zt=wp(a.props),ut=zt?y:Pt,Je=zt?at:dt;if(F==="svg"||JT(Pt)?F="svg":(F==="mathml"||QT(Pt))&&(F="mathml"),Ve?(ze(a.dynamicChildren,Ve,ut,P,L,F,r),Fv(a,d,!0)):W||ce(a,d,ut,Je,P,L,F,r,!1),st)zt?d.props&&a.props&&d.props.to!==a.props.to&&(d.props.to=a.props.to):B_(d,y,at,ne,1);else if((d.props&&d.props.to)!==(a.props&&a.props.to)){const ht=d.target=Bx(d.props,Oe);ht&&B_(d,ht,null,ne,0)}else zt&&B_(d,Pt,dt,ne,1);K_(d,st)}},remove(a,d,y,{um:A,o:{remove:P}},L){const{shapeFlag:F,children:r,anchor:W,targetStart:ne,targetAnchor:Q,target:ce,props:ze}=a;if(ce&&(P(ne),P(Q)),L&&P(W),F&16){const je=L||!wp(ze);for(let Oe=0;Oe<r.length;Oe++){const Le=r[Oe];A(Le,d,y,je,!!Le.dynamicChildren)}}},move:B_,hydrate:lD};function B_(a,d,y,{o:{insert:A},m:P},L=2){L===0&&A(a.targetAnchor,d,y);const{el:F,anchor:r,shapeFlag:W,children:ne,props:Q}=a,ce=L===2;if(ce&&A(F,d,y),(!ce||wp(Q))&&W&16)for(let ze=0;ze<ne.length;ze++)P(ne[ze],d,y,2);ce&&A(r,d,y)}function lD(a,d,y,A,P,L,{o:{nextSibling:F,parentNode:r,querySelector:W,insert:ne,createText:Q}},ce){const ze=d.target=Bx(d.props,W);if(ze){const je=wp(d.props),Oe=ze._lpa||ze.firstChild;if(d.shapeFlag&16)if(je)d.anchor=ce(F(a),d,r(a),y,A,P,L),d.targetStart=Oe,d.targetAnchor=Oe&&F(Oe);else{d.anchor=F(a);let Le=Oe;for(;Le;){if(Le&&Le.nodeType===8){if(Le.data==="teleport start anchor")d.targetStart=Le;else if(Le.data==="teleport anchor"){d.targetAnchor=Le,ze._lpa=d.targetAnchor&&F(d.targetAnchor);break}}Le=F(Le)}d.targetAnchor||rE(ze,d,Q,ne),ce(Oe&&F(Oe),d,ze,y,A,P,L)}K_(d,je)}return d.anchor&&F(d.anchor)}const cD=nE;function K_(a,d){const y=a.ctx;if(y&&y.ut){let A,P;for(d?(A=a.el,P=a.anchor):(A=a.targetStart,P=a.targetAnchor);A&&A!==P;)A.nodeType===1&&A.setAttribute("data-v-owner",y.uid),A=A.nextSibling;y.ut()}}function rE(a,d,y,A){const P=d.targetStart=y(""),L=d.targetAnchor=y("");return P[tE]=L,a&&(A(P,a),A(L,a)),L}const ql=Symbol("_leaveCb"),N_=Symbol("_enterCb");function Av(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Wp(()=>{a.isMounted=!0}),iy(()=>{a.isUnmounting=!0}),a}const yo=[Function,Array],Iv={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:yo,onEnter:yo,onAfterEnter:yo,onEnterCancelled:yo,onBeforeLeave:yo,onLeave:yo,onAfterLeave:yo,onLeaveCancelled:yo,onBeforeAppear:yo,onAppear:yo,onAfterAppear:yo,onAppearCancelled:yo},sE=a=>{const d=a.subTree;return d.component?sE(d.component):d},uD={name:"BaseTransition",props:Iv,setup(a,{slots:d}){const y=To(),A=Av();return()=>{const P=d.default&&Qg(d.default(),!0);if(!P||!P.length)return;const L=oE(P),F=gn(a),{mode:r}=F;if(A.isLeaving)return yx(L);const W=e2(L);if(!W)return yx(L);let ne=Jh(W,F,A,y,ce=>ne=ce);W.type!==Tr&&Ka(W,ne);let Q=y.subTree&&e2(y.subTree);if(Q&&Q.type!==Tr&&!qo(W,Q)&&sE(y).type!==Tr){let ce=Jh(Q,F,A,y);if(Ka(Q,ce),r==="out-in"&&W.type!==Tr)return A.isLeaving=!0,ce.afterLeave=()=>{A.isLeaving=!1,y.job.flags&8||y.update(),delete ce.afterLeave,Q=void 0},yx(L);r==="in-out"&&W.type!==Tr?ce.delayLeave=(ze,je,Oe)=>{const Le=lE(A,Q);Le[String(Q.key)]=Q,ze[ql]=()=>{je(),ze[ql]=void 0,delete ne.delayedLeave,Q=void 0},ne.delayedLeave=()=>{Oe(),delete ne.delayedLeave,Q=void 0}}:Q=void 0}else Q&&(Q=void 0);return L}}};function oE(a){let d=a[0];if(a.length>1){for(const y of a)if(y.type!==Tr){d=y;break}}return d}const aE=uD;function lE(a,d){const{leavingVNodes:y}=a;let A=y.get(d.type);return A||(A=Object.create(null),y.set(d.type,A)),A}function Jh(a,d,y,A,P){const{appear:L,mode:F,persisted:r=!1,onBeforeEnter:W,onEnter:ne,onAfterEnter:Q,onEnterCancelled:ce,onBeforeLeave:ze,onLeave:je,onAfterLeave:Oe,onLeaveCancelled:Le,onBeforeAppear:ct,onAppear:st,onAfterAppear:gt,onAppearCancelled:He}=d,Ve=String(a.key),at=lE(y,a),Pt=(ut,Je)=>{ut&&wo(ut,A,9,Je)},dt=(ut,Je)=>{const ht=Je[1];Pt(ut,Je),ci(ut)?ut.every(vt=>vt.length<=1)&&ht():ut.length<=1&&ht()},zt={mode:F,persisted:r,beforeEnter(ut){let Je=W;if(!y.isMounted)if(L)Je=ct||W;else return;ut[ql]&&ut[ql](!0);const ht=at[Ve];ht&&qo(a,ht)&&ht.el[ql]&&ht.el[ql](),Pt(Je,[ut])},enter(ut){let Je=ne,ht=Q,vt=ce;if(!y.isMounted)if(L)Je=st||ne,ht=gt||Q,vt=He||ce;else return;let Wt=!1;const vi=ut[N_]=Ft=>{Wt||(Wt=!0,Ft?Pt(vt,[ut]):Pt(ht,[ut]),zt.delayedLeave&&zt.delayedLeave(),ut[N_]=void 0)};Je?dt(Je,[ut,vi]):vi()},leave(ut,Je){const ht=String(a.key);if(ut[N_]&&ut[N_](!0),y.isUnmounting)return Je();Pt(ze,[ut]);let vt=!1;const Wt=ut[ql]=vi=>{vt||(vt=!0,Je(),vi?Pt(Le,[ut]):Pt(Oe,[ut]),ut[ql]=void 0,at[ht]===a&&delete at[ht])};at[ht]=a,je?dt(je,[ut,Wt]):Wt()},clone(ut){const Je=Jh(ut,d,y,A,P);return P&&P(Je),Je}};return zt}function yx(a){if(Zp(a))return a=ga(a),a.children=null,a}function e2(a){if(!Zp(a))return iE(a.type)&&a.children?oE(a.children):a;const{shapeFlag:d,children:y}=a;if(y){if(d&16)return y[0];if(d&32&&Li(y.default))return y.default()}}function Ka(a,d){a.shapeFlag&6&&a.component?(a.transition=d,Ka(a.component.subTree,d)):a.shapeFlag&128?(a.ssContent.transition=d.clone(a.ssContent),a.ssFallback.transition=d.clone(a.ssFallback)):a.transition=d}function Qg(a,d=!1,y){let A=[],P=0;for(let L=0;L<a.length;L++){let F=a[L];const r=y==null?F.key:String(y)+String(F.key!=null?F.key:L);F.type===wr?(F.patchFlag&128&&P++,A=A.concat(Qg(F.children,d,r))):(d||F.type!==Tr)&&A.push(r!=null?ga(F,{key:r}):F)}if(P>1)for(let L=0;L<A.length;L++)A[L].patchFlag=-2;return A}/*! #__NO_SIDE_EFFECTS__ */function Cv(a,d){return Li(a)?(()=>cn({name:a.name},d,{setup:a}))():a}function hD(){const a=To();return a?(a.appContext.config.idPrefix||"v")+"-"+a.ids[0]+a.ids[1]++:""}function Pv(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function dD(a){const d=To(),y=HS(null);if(d){const P=d.refs===ln?d.refs={}:d.refs;Object.defineProperty(P,a,{enumerable:!0,get:()=>y.value,set:L=>y.value=L})}return y}function Op(a,d,y,A,P=!1){if(ci(a)){a.forEach((Oe,Le)=>Op(Oe,d&&(ci(d)?d[Le]:d),y,A,P));return}if(Xl(A)&&!P){A.shapeFlag&512&&A.type.__asyncResolved&&A.component.subTree.component&&Op(a,d,y,A.component.subTree);return}const L=A.shapeFlag&4?Yp(A.component):A.el,F=P?null:L,{i:r,r:W}=a,ne=d&&d.r,Q=r.refs===ln?r.refs={}:r.refs,ce=r.setupState,ze=gn(ce),je=ce===ln?()=>!1:Oe=>Tn(ze,Oe);if(ne!=null&&ne!==W&&(Wi(ne)?(Q[ne]=null,je(ne)&&(ce[ne]=null)):kr(ne)&&(ne.value=null)),Li(W))ud(W,r,12,[F,Q]);else{const Oe=Wi(W),Le=kr(W);if(Oe||Le){const ct=()=>{if(a.f){const st=Oe?je(W)?ce[W]:Q[W]:W.value;P?ci(st)&&_v(st,L):ci(st)?st.includes(L)||st.push(L):Oe?(Q[W]=[L],je(W)&&(ce[W]=Q[W])):(W.value=[L],a.k&&(Q[a.k]=W.value))}else Oe?(Q[W]=F,je(W)&&(ce[W]=F)):Le&&(W.value=F,a.k&&(Q[a.k]=F))};F?(ct.id=-1,Dr(ct,y)):ct()}}}let t2=!1;const Nh=()=>{t2||(console.error("Hydration completed but contains mismatches."),t2=!0)},fD=a=>a.namespaceURI.includes("svg")&&a.tagName!=="foreignObject",pD=a=>a.namespaceURI.includes("MathML"),V_=a=>{if(a.nodeType===1){if(fD(a))return"svg";if(pD(a))return"mathml"}},qh=a=>a.nodeType===8;function mD(a){const{mt:d,p:y,o:{patchProp:A,createText:P,nextSibling:L,parentNode:F,remove:r,insert:W,createComment:ne}}=a,Q=(He,Ve)=>{if(!Ve.hasChildNodes()){y(null,He,Ve),fg(),Ve._vnode=He;return}ce(Ve.firstChild,He,null,null,null),fg(),Ve._vnode=He},ce=(He,Ve,at,Pt,dt,zt=!1)=>{zt=zt||!!Ve.dynamicChildren;const ut=qh(He)&&He.data==="[",Je=()=>Le(He,Ve,at,Pt,dt,ut),{type:ht,ref:vt,shapeFlag:Wt,patchFlag:vi}=Ve;let Ft=He.nodeType;Ve.el=He,vi===-2&&(zt=!1,Ve.dynamicChildren=null);let Qt=null;switch(ht){case Yl:Ft!==3?Ve.children===""?(W(Ve.el=P(""),F(He),He),Qt=He):Qt=Je():(He.data!==Ve.children&&(Nh(),He.data=Ve.children),Qt=L(He));break;case Tr:gt(He)?(Qt=L(He),st(Ve.el=He.content.firstChild,He,at)):Ft!==8||ut?Qt=Je():Qt=L(He);break;case mu:if(ut&&(He=L(He),Ft=He.nodeType),Ft===1||Ft===3){Qt=He;const Ti=!Ve.children.length;for(let hi=0;hi<Ve.staticCount;hi++)Ti&&(Ve.children+=Qt.nodeType===1?Qt.outerHTML:Qt.data),hi===Ve.staticCount-1&&(Ve.anchor=Qt),Qt=L(Qt);return ut?L(Qt):Qt}else Je();break;case wr:ut?Qt=Oe(He,Ve,at,Pt,dt,zt):Qt=Je();break;default:if(Wt&1)(Ft!==1||Ve.type.toLowerCase()!==He.tagName.toLowerCase())&&!gt(He)?Qt=Je():Qt=ze(He,Ve,at,Pt,dt,zt);else if(Wt&6){Ve.slotScopeIds=dt;const Ti=F(He);if(ut?Qt=ct(He):qh(He)&&He.data==="teleport start"?Qt=ct(He,He.data,"teleport end"):Qt=L(He),d(Ve,Ti,null,at,Pt,V_(Ti),zt),Xl(Ve)&&!Ve.type.__asyncResolved){let hi;ut?(hi=$n(wr),hi.anchor=Qt?Qt.previousSibling:Ti.lastChild):hi=He.nodeType===3?Bv(""):$n("div"),hi.el=He,Ve.component.subTree=hi}}else Wt&64?Ft!==8?Qt=Je():Qt=Ve.type.hydrate(He,Ve,at,Pt,dt,zt,a,je):Wt&128&&(Qt=Ve.type.hydrate(He,Ve,at,Pt,V_(F(He)),dt,zt,a,ce))}return vt!=null&&Op(vt,null,Pt,Ve),Qt},ze=(He,Ve,at,Pt,dt,zt)=>{zt=zt||!!Ve.dynamicChildren;const{type:ut,props:Je,patchFlag:ht,shapeFlag:vt,dirs:Wt,transition:vi}=Ve,Ft=ut==="input"||ut==="option";if(Ft||ht!==-1){Wt&&ma(Ve,null,at,"created");let Qt=!1;if(gt(He)){Qt=LE(null,vi)&&at&&at.vnode.props&&at.vnode.props.appear;const hi=He.content.firstChild;Qt&&vi.beforeEnter(hi),st(hi,He,at),Ve.el=He=hi}if(vt&16&&!(Je&&(Je.innerHTML||Je.textContent))){let hi=je(He.firstChild,Ve,He,at,Pt,dt,zt);for(;hi;){U_(He,1)||Nh();const ri=hi;hi=hi.nextSibling,r(ri)}}else if(vt&8){let hi=Ve.children;hi[0]===`
`&&(He.tagName==="PRE"||He.tagName==="TEXTAREA")&&(hi=hi.slice(1)),He.textContent!==hi&&(U_(He,0)||Nh(),He.textContent=Ve.children)}if(Je){if(Ft||!zt||ht&48){const hi=He.tagName.includes("-");for(const ri in Je)(Ft&&(ri.endsWith("value")||ri==="indeterminate")||wu(ri)&&!Zl(ri)||ri[0]==="."||hi)&&A(He,ri,null,Je[ri],void 0,at)}else if(Je.onClick)A(He,"onClick",null,Je.onClick,void 0,at);else if(ht&4&&Wl(Je.style))for(const hi in Je.style)Je.style[hi]}let Ti;(Ti=Je&&Je.onVnodeBeforeMount)&&Cs(Ti,at,Ve),Wt&&ma(Ve,null,at,"beforeMount"),((Ti=Je&&Je.onVnodeMounted)||Wt||Qt)&&GE(()=>{Ti&&Cs(Ti,at,Ve),Qt&&vi.enter(He),Wt&&ma(Ve,null,at,"mounted")},Pt)}return He.nextSibling},je=(He,Ve,at,Pt,dt,zt,ut)=>{ut=ut||!!Ve.dynamicChildren;const Je=Ve.children,ht=Je.length;for(let vt=0;vt<ht;vt++){const Wt=ut?Je[vt]:Je[vt]=Ps(Je[vt]),vi=Wt.type===Yl;He?(vi&&!ut&&vt+1<ht&&Ps(Je[vt+1]).type===Yl&&(W(P(He.data.slice(Wt.children.length)),at,L(He)),He.data=Wt.children),He=ce(He,Wt,Pt,dt,zt,ut)):vi&&!Wt.children?W(Wt.el=P(""),at):(U_(at,1)||Nh(),y(null,Wt,at,null,Pt,dt,V_(at),zt))}return He},Oe=(He,Ve,at,Pt,dt,zt)=>{const{slotScopeIds:ut}=Ve;ut&&(dt=dt?dt.concat(ut):ut);const Je=F(He),ht=je(L(He),Ve,Je,at,Pt,dt,zt);return ht&&qh(ht)&&ht.data==="]"?L(Ve.anchor=ht):(Nh(),W(Ve.anchor=ne("]"),Je,ht),ht)},Le=(He,Ve,at,Pt,dt,zt)=>{if(U_(He.parentElement,1)||Nh(),Ve.el=null,zt){const ht=ct(He);for(;;){const vt=L(He);if(vt&&vt!==ht)r(vt);else break}}const ut=L(He),Je=F(He);return r(He),y(null,Ve,Je,ut,at,Pt,V_(Je),dt),at&&(at.vnode.el=Ve.el,sy(at,Ve.el)),ut},ct=(He,Ve="[",at="]")=>{let Pt=0;for(;He;)if(He=L(He),He&&qh(He)&&(He.data===Ve&&Pt++,He.data===at)){if(Pt===0)return L(He);Pt--}return He},st=(He,Ve,at)=>{const Pt=Ve.parentNode;Pt&&Pt.replaceChild(He,Ve);let dt=at;for(;dt;)dt.vnode.el===Ve&&(dt.vnode.el=dt.subTree.el=He),dt=dt.parent},gt=He=>He.nodeType===1&&He.tagName==="TEMPLATE";return[Q,ce]}const i2="data-allow-mismatch",_D={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function U_(a,d){if(d===0||d===1)for(;a&&!a.hasAttribute(i2);)a=a.parentElement;const y=a&&a.getAttribute(i2);if(y==null)return!1;if(y==="")return!0;{const A=y.split(",");return d===0&&A.includes("children")?!0:y.split(",").includes(_D[d])}}const gD=jg().requestIdleCallback||(a=>setTimeout(a,1)),yD=jg().cancelIdleCallback||(a=>clearTimeout(a)),xD=(a=1e4)=>d=>{const y=gD(d,{timeout:a});return()=>yD(y)};function vD(a){const{top:d,left:y,bottom:A,right:P}=a.getBoundingClientRect(),{innerHeight:L,innerWidth:F}=window;return(d>0&&d<L||A>0&&A<L)&&(y>0&&y<F||P>0&&P<F)}const bD=a=>(d,y)=>{const A=new IntersectionObserver(P=>{for(const L of P)if(L.isIntersecting){A.disconnect(),d();break}},a);return y(P=>{if(P instanceof Element){if(vD(P))return d(),A.disconnect(),!1;A.observe(P)}}),()=>A.disconnect()},wD=a=>d=>{if(a){const y=matchMedia(a);if(y.matches)d();else return y.addEventListener("change",d,{once:!0}),()=>y.removeEventListener("change",d)}},TD=(a=[])=>(d,y)=>{Wi(a)&&(a=[a]);let A=!1;const P=F=>{A||(A=!0,L(),d(),F.target.dispatchEvent(new F.constructor(F.type,F)))},L=()=>{y(F=>{for(const r of a)F.removeEventListener(r,P)})};return y(F=>{for(const r of a)F.addEventListener(r,P,{once:!0})}),L};function SD(a,d){if(qh(a)&&a.data==="["){let y=1,A=a.nextSibling;for(;A;){if(A.nodeType===1){if(d(A)===!1)break}else if(qh(A))if(A.data==="]"){if(--y===0)break}else A.data==="["&&y++;A=A.nextSibling}}else d(a)}const Xl=a=>!!a.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function ED(a){Li(a)&&(a={loader:a});const{loader:d,loadingComponent:y,errorComponent:A,delay:P=200,hydrate:L,timeout:F,suspensible:r=!0,onError:W}=a;let ne=null,Q,ce=0;const ze=()=>(ce++,ne=null,je()),je=()=>{let Oe;return ne||(Oe=ne=d().catch(Le=>{if(Le=Le instanceof Error?Le:new Error(String(Le)),W)return new Promise((ct,st)=>{W(Le,()=>ct(ze()),()=>st(Le),ce+1)});throw Le}).then(Le=>Oe!==ne&&ne?ne:(Le&&(Le.__esModule||Le[Symbol.toStringTag]==="Module")&&(Le=Le.default),Q=Le,Le)))};return Cv({name:"AsyncComponentWrapper",__asyncLoader:je,__asyncHydrate(Oe,Le,ct){const st=L?()=>{const gt=L(ct,He=>SD(Oe,He));gt&&(Le.bum||(Le.bum=[])).push(gt)}:ct;Q?st():je().then(()=>!Le.isUnmounted&&st())},get __asyncResolved(){return Q},setup(){const Oe=Lr;if(Pv(Oe),Q)return()=>xx(Q,Oe);const Le=He=>{ne=null,Eu(He,Oe,13,!A)};if(r&&Oe.suspense||Qh)return je().then(He=>()=>xx(He,Oe)).catch(He=>(Le(He),()=>A?$n(A,{error:He}):null));const ct=bp(!1),st=bp(),gt=bp(!!P);return P&&setTimeout(()=>{gt.value=!1},P),F!=null&&setTimeout(()=>{if(!ct.value&&!st.value){const He=new Error(`Async component timed out after ${F}ms.`);Le(He),st.value=He}},F),je().then(()=>{ct.value=!0,Oe.parent&&Zp(Oe.parent.vnode)&&Oe.parent.update()}).catch(He=>{Le(He),st.value=He}),()=>{if(ct.value&&Q)return xx(Q,Oe);if(st.value&&A)return $n(A,{error:st.value});if(y&&!gt.value)return $n(y)}}})}function xx(a,d){const{ref:y,props:A,children:P,ce:L}=d.vnode,F=$n(a,A,P);return F.ref=y,F.ce=L,delete d.vnode.ce,F}const Zp=a=>a.type.__isKeepAlive,MD={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(a,{slots:d}){const y=To(),A=y.ctx;if(!A.renderer)return()=>{const gt=d.default&&d.default();return gt&&gt.length===1?gt[0]:gt};const P=new Map,L=new Set;let F=null;const r=y.suspense,{renderer:{p:W,m:ne,um:Q,o:{createElement:ce}}}=A,ze=ce("div");A.activate=(gt,He,Ve,at,Pt)=>{const dt=gt.component;ne(gt,He,Ve,0,r),W(dt.vnode,gt,He,Ve,dt,r,at,gt.slotScopeIds,Pt),Dr(()=>{dt.isDeactivated=!1,dt.a&&Wh(dt.a);const zt=gt.props&&gt.props.onVnodeMounted;zt&&Cs(zt,dt.parent,gt)},r)},A.deactivate=gt=>{const He=gt.component;mg(He.m),mg(He.a),ne(gt,ze,null,1,r),Dr(()=>{He.da&&Wh(He.da);const Ve=gt.props&&gt.props.onVnodeUnmounted;Ve&&Cs(Ve,He.parent,gt),He.isDeactivated=!0},r)};function je(gt){vx(gt),Q(gt,y,r,!0)}function Oe(gt){P.forEach((He,Ve)=>{const at=Kx(He.type);at&&!gt(at)&&Le(Ve)})}function Le(gt){const He=P.get(gt);He&&(!F||!qo(He,F))?je(He):F&&vx(F),P.delete(gt),L.delete(gt)}Yh(()=>[a.include,a.exclude],([gt,He])=>{gt&&Oe(Ve=>gp(gt,Ve)),He&&Oe(Ve=>!gp(He,Ve))},{flush:"post",deep:!0});let ct=null;const st=()=>{ct!=null&&(_g(y.subTree.type)?Dr(()=>{P.set(ct,j_(y.subTree))},y.subTree.suspense):P.set(ct,j_(y.subTree)))};return Wp(st),ty(st),iy(()=>{P.forEach(gt=>{const{subTree:He,suspense:Ve}=y,at=j_(He);if(gt.type===at.type&&gt.key===at.key){vx(at);const Pt=at.component.da;Pt&&Dr(Pt,Ve);return}je(gt)})}),()=>{if(ct=null,!d.default)return F=null;const gt=d.default(),He=gt[0];if(gt.length>1)return F=null,gt;if(!Ja(He)||!(He.shapeFlag&4)&&!(He.shapeFlag&128))return F=null,He;let Ve=j_(He);if(Ve.type===Tr)return F=null,Ve;const at=Ve.type,Pt=Kx(Xl(Ve)?Ve.type.__asyncResolved||{}:at),{include:dt,exclude:zt,max:ut}=a;if(dt&&(!Pt||!gp(dt,Pt))||zt&&Pt&&gp(zt,Pt))return Ve.shapeFlag&=-257,F=Ve,He;const Je=Ve.key==null?at:Ve.key,ht=P.get(Je);return Ve.el&&(Ve=ga(Ve),He.shapeFlag&128&&(He.ssContent=Ve)),ct=Je,ht?(Ve.el=ht.el,Ve.component=ht.component,Ve.transition&&Ka(Ve,Ve.transition),Ve.shapeFlag|=512,L.delete(Je),L.add(Je)):(L.add(Je),ut&&L.size>parseInt(ut,10)&&Le(L.values().next().value)),Ve.shapeFlag|=256,F=Ve,_g(He.type)?He:Ve}}},AD=MD;function gp(a,d){return ci(a)?a.some(y=>gp(y,d)):Wi(a)?a.split(",").includes(d):qR(a)?(a.lastIndex=0,a.test(d)):!1}function cE(a,d){hE(a,"a",d)}function uE(a,d){hE(a,"da",d)}function hE(a,d,y=Lr){const A=a.__wdc||(a.__wdc=()=>{let P=y;for(;P;){if(P.isDeactivated)return;P=P.parent}return a()});if(ey(d,A,y),y){let P=y.parent;for(;P&&P.parent;)Zp(P.parent.vnode)&&ID(A,d,y,P),P=P.parent}}function ID(a,d,y,A){const P=ey(d,a,A,!0);ny(()=>{_v(A[d],P)},y)}function vx(a){a.shapeFlag&=-257,a.shapeFlag&=-513}function j_(a){return a.shapeFlag&128?a.ssContent:a}function ey(a,d,y=Lr,A=!1){if(y){const P=y[a]||(y[a]=[]),L=d.__weh||(d.__weh=(...F)=>{tc();const r=vu(y),W=wo(d,y,a,F);return r(),ic(),W});return A?P.unshift(L):P.push(L),L}}const Qa=a=>(d,y=Lr)=>{(!Qh||a==="sp")&&ey(a,(...A)=>d(...A),y)},dE=Qa("bm"),Wp=Qa("m"),Rv=Qa("bu"),ty=Qa("u"),iy=Qa("bum"),ny=Qa("um"),fE=Qa("sp"),pE=Qa("rtg"),mE=Qa("rtc");function _E(a,d=Lr){ey("ec",a,d)}const Dv="components",CD="directives";function PD(a,d){return zv(Dv,a,!0,d)||a}const gE=Symbol.for("v-ndc");function RD(a){return Wi(a)?zv(Dv,a,!1)||a:a||gE}function DD(a){return zv(CD,a)}function zv(a,d,y=!0,A=!1){const P=Or||Lr;if(P){const L=P.type;if(a===Dv){const r=Kx(L,!1);if(r&&(r===d||r===Zn(d)||r===Su(Zn(d))))return L}const F=n2(P[a]||L[a],d)||n2(P.appContext[a],d);return!F&&A?L:F}}function n2(a,d){return a&&(a[d]||a[Zn(d)]||a[Su(Zn(d))])}function Nx(a,d,y,A){let P;const L=y&&y[A],F=ci(a);if(F||Wi(a)){const r=F&&Wl(a);let W=!1;r&&(W=!Ws(a),a=Hg(a)),P=new Array(a.length);for(let ne=0,Q=a.length;ne<Q;ne++)P[ne]=d(W?rs(a[ne]):a[ne],ne,void 0,L&&L[ne])}else if(typeof a=="number"){P=new Array(a);for(let r=0;r<a;r++)P[r]=d(r+1,r,void 0,L&&L[r])}else if(Cn(a))if(a[Symbol.iterator])P=Array.from(a,(r,W)=>d(r,W,void 0,L&&L[W]));else{const r=Object.keys(a);P=new Array(r.length);for(let W=0,ne=r.length;W<ne;W++){const Q=r[W];P[W]=d(a[Q],Q,W,L&&L[W])}}else P=[];return y&&(y[A]=P),P}function zD(a,d){for(let y=0;y<d.length;y++){const A=d[y];if(ci(A))for(let P=0;P<A.length;P++)a[A[P].name]=A[P].fn;else A&&(a[A.name]=A.key?(...P)=>{const L=A.fn(...P);return L&&(L.key=A.key),L}:A.fn)}return a}function LD(a,d,y={},A,P){if(Or.ce||Or.parent&&Xl(Or.parent)&&Or.parent.ce)return d!=="default"&&(y.name=d),Ds(),gg(wr,null,[$n("slot",y,A&&A())],64);let L=a[d];L&&L._c&&(L._d=!1),Ds();const F=L&&Lv(L(y)),r=y.key||F&&F.key,W=gg(wr,{key:(r&&!Ls(r)?r:`_${d}`)+(!F&&A?"_fb":"")},F||(A?A():[]),F&&a._===1?64:-2);return!P&&W.scopeId&&(W.slotScopeIds=[W.scopeId+"-s"]),L&&L._c&&(L._d=!0),W}function Lv(a){return a.some(d=>Ja(d)?!(d.type===Tr||d.type===wr&&!Lv(d.children)):!0)?a:null}function OD(a,d){const y={};for(const A in a)y[d&&/[A-Z]/.test(A)?`on:${A}`:Zh(A)]=a[A];return y}const Vx=a=>a?KE(a)?Yp(a):Vx(a.parent):null,Tp=cn(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Vx(a.parent),$root:a=>Vx(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>Ov(a),$forceUpdate:a=>a.f||(a.f=()=>{Ev(a.update)}),$nextTick:a=>a.n||(a.n=Kg.bind(a.proxy)),$watch:a=>fz.bind(a)}),bx=(a,d)=>a!==ln&&!a.__isScriptSetup&&Tn(a,d),Ux={get({_:a},d){if(d==="__v_skip")return!0;const{ctx:y,setupState:A,data:P,props:L,accessCache:F,type:r,appContext:W}=a;let ne;if(d[0]!=="$"){const je=F[d];if(je!==void 0)switch(je){case 1:return A[d];case 2:return P[d];case 4:return y[d];case 3:return L[d]}else{if(bx(A,d))return F[d]=1,A[d];if(P!==ln&&Tn(P,d))return F[d]=2,P[d];if((ne=a.propsOptions[0])&&Tn(ne,d))return F[d]=3,L[d];if(y!==ln&&Tn(y,d))return F[d]=4,y[d];jx&&(F[d]=0)}}const Q=Tp[d];let ce,ze;if(Q)return d==="$attrs"&&ns(a.attrs,"get",""),Q(a);if((ce=r.__cssModules)&&(ce=ce[d]))return ce;if(y!==ln&&Tn(y,d))return F[d]=4,y[d];if(ze=W.config.globalProperties,Tn(ze,d))return ze[d]},set({_:a},d,y){const{data:A,setupState:P,ctx:L}=a;return bx(P,d)?(P[d]=y,!0):A!==ln&&Tn(A,d)?(A[d]=y,!0):Tn(a.props,d)||d[0]==="$"&&d.slice(1)in a?!1:(L[d]=y,!0)},has({_:{data:a,setupState:d,accessCache:y,ctx:A,appContext:P,propsOptions:L}},F){let r;return!!y[F]||a!==ln&&Tn(a,F)||bx(d,F)||(r=L[0])&&Tn(r,F)||Tn(A,F)||Tn(Tp,F)||Tn(P.config.globalProperties,F)},defineProperty(a,d,y){return y.get!=null?a._.accessCache[d]=0:Tn(y,"value")&&this.set(a,d,y.value,null),Reflect.defineProperty(a,d,y)}},kD=cn({},Ux,{get(a,d){if(d!==Symbol.unscopables)return Ux.get(a,d,a)},has(a,d){return d[0]!=="_"&&!KR(d)}});function FD(){return null}function BD(){return null}function ND(a){}function VD(a){}function UD(){return null}function jD(){}function GD(a,d){return null}function qD(){return yE().slots}function HD(){return yE().attrs}function yE(){const a=To();return a.setupContext||(a.setupContext=tM(a))}function kp(a){return ci(a)?a.reduce((d,y)=>(d[y]=null,d),{}):a}function $D(a,d){const y=kp(a);for(const A in d){if(A.startsWith("__skip"))continue;let P=y[A];P?ci(P)||Li(P)?P=y[A]={type:P,default:d[A]}:P.default=d[A]:P===null&&(P=y[A]={default:d[A]}),P&&d[`__skip_${A}`]&&(P.skipFactory=!0)}return y}function ZD(a,d){return!a||!d?a||d:ci(a)&&ci(d)?a.concat(d):cn({},kp(a),kp(d))}function WD(a,d){const y={};for(const A in a)d.includes(A)||Object.defineProperty(y,A,{enumerable:!0,get:()=>a[A]});return y}function XD(a){const d=To();let y=a();return Wx(),gv(y)&&(y=y.catch(A=>{throw vu(d),A})),[y,()=>vu(d)]}let jx=!0;function YD(a){const d=Ov(a),y=a.proxy,A=a.ctx;jx=!1,d.beforeCreate&&r2(d.beforeCreate,a,"bc");const{data:P,computed:L,methods:F,watch:r,provide:W,inject:ne,created:Q,beforeMount:ce,mounted:ze,beforeUpdate:je,updated:Oe,activated:Le,deactivated:ct,beforeDestroy:st,beforeUnmount:gt,destroyed:He,unmounted:Ve,render:at,renderTracked:Pt,renderTriggered:dt,errorCaptured:zt,serverPrefetch:ut,expose:Je,inheritAttrs:ht,components:vt,directives:Wt,filters:vi}=d;if(ne&&KD(ne,A,null),F)for(const Ti in F){const hi=F[Ti];Li(hi)&&(A[Ti]=hi.bind(y))}if(P){const Ti=P.call(y,y);Cn(Ti)&&(a.data=Zg(Ti))}if(jx=!0,L)for(const Ti in L){const hi=L[Ti],ri=Li(hi)?hi.bind(y,y):Li(hi.get)?hi.get.bind(y,y):Ur,rr=!Li(hi)&&Li(hi.set)?hi.set.bind(y):Ur,mr=iM({get:ri,set:rr});Object.defineProperty(A,Ti,{enumerable:!0,configurable:!0,get:()=>mr.value,set:ar=>mr.value=ar})}if(r)for(const Ti in r)xE(r[Ti],A,y,Ti);if(W){const Ti=Li(W)?W.call(y):W;Reflect.ownKeys(Ti).forEach(hi=>{bE(hi,Ti[hi])})}Q&&r2(Q,a,"c");function Qt(Ti,hi){ci(hi)?hi.forEach(ri=>Ti(ri.bind(y))):hi&&Ti(hi.bind(y))}if(Qt(dE,ce),Qt(Wp,ze),Qt(Rv,je),Qt(ty,Oe),Qt(cE,Le),Qt(uE,ct),Qt(_E,zt),Qt(mE,Pt),Qt(pE,dt),Qt(iy,gt),Qt(ny,Ve),Qt(fE,ut),ci(Je))if(Je.length){const Ti=a.exposed||(a.exposed={});Je.forEach(hi=>{Object.defineProperty(Ti,hi,{get:()=>y[hi],set:ri=>y[hi]=ri})})}else a.exposed||(a.exposed={});at&&a.render===Ur&&(a.render=at),ht!=null&&(a.inheritAttrs=ht),vt&&(a.components=vt),Wt&&(a.directives=Wt),ut&&Pv(a)}function KD(a,d,y=Ur){ci(a)&&(a=Gx(a));for(const A in a){const P=a[A];let L;Cn(P)?"default"in P?L=Sp(P.from||A,P.default,!0):L=Sp(P.from||A):L=Sp(P),kr(L)?Object.defineProperty(d,A,{enumerable:!0,configurable:!0,get:()=>L.value,set:F=>L.value=F}):d[A]=L}}function r2(a,d,y){wo(ci(a)?a.map(A=>A.bind(d.proxy)):a.bind(d.proxy),d,y)}function xE(a,d,y,A){let P=A.includes(".")?NE(y,A):()=>y[A];if(Wi(a)){const L=d[a];Li(L)&&Yh(P,L)}else if(Li(a))Yh(P,a.bind(y));else if(Cn(a))if(ci(a))a.forEach(L=>xE(L,d,y,A));else{const L=Li(a.handler)?a.handler.bind(y):d[a.handler];Li(L)&&Yh(P,L,a)}}function Ov(a){const d=a.type,{mixins:y,extends:A}=d,{mixins:P,optionsCache:L,config:{optionMergeStrategies:F}}=a.appContext,r=L.get(d);let W;return r?W=r:!P.length&&!y&&!A?W=d:(W={},P.length&&P.forEach(ne=>pg(W,ne,F,!0)),pg(W,d,F)),Cn(d)&&L.set(d,W),W}function pg(a,d,y,A=!1){const{mixins:P,extends:L}=d;L&&pg(a,L,y,!0),P&&P.forEach(F=>pg(a,F,y,!0));for(const F in d)if(!(A&&F==="expose")){const r=JD[F]||y&&y[F];a[F]=r?r(a[F],d[F]):d[F]}return a}const JD={data:s2,props:o2,emits:o2,methods:yp,computed:yp,beforeCreate:_s,created:_s,beforeMount:_s,mounted:_s,beforeUpdate:_s,updated:_s,beforeDestroy:_s,beforeUnmount:_s,destroyed:_s,unmounted:_s,activated:_s,deactivated:_s,errorCaptured:_s,serverPrefetch:_s,components:yp,directives:yp,watch:ez,provide:s2,inject:QD};function s2(a,d){return d?a?function(){return cn(Li(a)?a.call(this,this):a,Li(d)?d.call(this,this):d)}:d:a}function QD(a,d){return yp(Gx(a),Gx(d))}function Gx(a){if(ci(a)){const d={};for(let y=0;y<a.length;y++)d[a[y]]=a[y];return d}return a}function _s(a,d){return a?[...new Set([].concat(a,d))]:d}function yp(a,d){return a?cn(Object.create(null),a,d):d}function o2(a,d){return a?ci(a)&&ci(d)?[...new Set([...a,...d])]:cn(Object.create(null),kp(a),kp(d??{})):d}function ez(a,d){if(!a)return d;if(!d)return a;const y=cn(Object.create(null),a);for(const A in d)y[A]=_s(a[A],d[A]);return y}function vE(){return{app:null,config:{isNativeTag:mp,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let tz=0;function iz(a,d){return function(A,P=null){Li(A)||(A=cn({},A)),P!=null&&!Cn(P)&&(P=null);const L=vE(),F=new WeakSet,r=[];let W=!1;const ne=L.app={_uid:tz++,_component:A,_props:P,_container:null,_context:L,_instance:null,version:sM,get config(){return L.config},set config(Q){},use(Q,...ce){return F.has(Q)||(Q&&Li(Q.install)?(F.add(Q),Q.install(ne,...ce)):Li(Q)&&(F.add(Q),Q(ne,...ce))),ne},mixin(Q){return L.mixins.includes(Q)||L.mixins.push(Q),ne},component(Q,ce){return ce?(L.components[Q]=ce,ne):L.components[Q]},directive(Q,ce){return ce?(L.directives[Q]=ce,ne):L.directives[Q]},mount(Q,ce,ze){if(!W){const je=ne._ceVNode||$n(A,P);return je.appContext=L,ze===!0?ze="svg":ze===!1&&(ze=void 0),ce&&d?d(je,Q):a(je,Q,ze),W=!0,ne._container=Q,Q.__vue_app__=ne,Yp(je.component)}},onUnmount(Q){r.push(Q)},unmount(){W&&(wo(r,ne._instance,16),a(null,ne._container),delete ne._container.__vue_app__)},provide(Q,ce){return L.provides[Q]=ce,ne},runWithContext(Q){const ce=pu;pu=ne;try{return Q()}finally{pu=ce}}};return ne}}let pu=null;function bE(a,d){if(Lr){let y=Lr.provides;const A=Lr.parent&&Lr.parent.provides;A===y&&(y=Lr.provides=Object.create(A)),y[a]=d}}function Sp(a,d,y=!1){const A=Lr||Or;if(A||pu){const P=pu?pu._context.provides:A?A.parent==null?A.vnode.appContext&&A.vnode.appContext.provides:A.parent.provides:void 0;if(P&&a in P)return P[a];if(arguments.length>1)return y&&Li(d)?d.call(A&&A.proxy):d}}function nz(){return!!(Lr||Or||pu)}const wE={},TE=()=>Object.create(wE),SE=a=>Object.getPrototypeOf(a)===wE;function rz(a,d,y,A=!1){const P={},L=TE();a.propsDefaults=Object.create(null),EE(a,d,P,L);for(const F in a.propsOptions[0])F in P||(P[F]=void 0);y?a.props=A?P:GS(P):a.type.props?a.props=P:a.props=L,a.attrs=L}function sz(a,d,y,A){const{props:P,attrs:L,vnode:{patchFlag:F}}=a,r=gn(P),[W]=a.propsOptions;let ne=!1;if((A||F>0)&&!(F&16)){if(F&8){const Q=a.vnode.dynamicProps;for(let ce=0;ce<Q.length;ce++){let ze=Q[ce];if(ry(a.emitsOptions,ze))continue;const je=d[ze];if(W)if(Tn(L,ze))je!==L[ze]&&(L[ze]=je,ne=!0);else{const Oe=Zn(ze);P[Oe]=qx(W,r,Oe,je,a,!1)}else je!==L[ze]&&(L[ze]=je,ne=!0)}}}else{EE(a,d,P,L)&&(ne=!0);let Q;for(const ce in r)(!d||!Tn(d,ce)&&((Q=Rs(ce))===ce||!Tn(d,Q)))&&(W?y&&(y[ce]!==void 0||y[Q]!==void 0)&&(P[ce]=qx(W,r,ce,void 0,a,!0)):delete P[ce]);if(L!==r)for(const ce in L)(!d||!Tn(d,ce))&&(delete L[ce],ne=!0)}ne&&$a(a.attrs,"set","")}function EE(a,d,y,A){const[P,L]=a.propsOptions;let F=!1,r;if(d)for(let W in d){if(Zl(W))continue;const ne=d[W];let Q;P&&Tn(P,Q=Zn(W))?!L||!L.includes(Q)?y[Q]=ne:(r||(r={}))[Q]=ne:ry(a.emitsOptions,W)||(!(W in A)||ne!==A[W])&&(A[W]=ne,F=!0)}if(L){const W=gn(y),ne=r||ln;for(let Q=0;Q<L.length;Q++){const ce=L[Q];y[ce]=qx(P,W,ce,ne[ce],a,!Tn(ne,ce))}}return F}function qx(a,d,y,A,P,L){const F=a[y];if(F!=null){const r=Tn(F,"default");if(r&&A===void 0){const W=F.default;if(F.type!==Function&&!F.skipFactory&&Li(W)){const{propsDefaults:ne}=P;if(y in ne)A=ne[y];else{const Q=vu(P);A=ne[y]=W.call(null,d),Q()}}else A=W;P.ce&&P.ce._setProp(y,A)}F[0]&&(L&&!r?A=!1:F[1]&&(A===""||A===Rs(y))&&(A=!0))}return A}const oz=new WeakMap;function ME(a,d,y=!1){const A=y?oz:d.propsCache,P=A.get(a);if(P)return P;const L=a.props,F={},r=[];let W=!1;if(!Li(a)){const Q=ce=>{W=!0;const[ze,je]=ME(ce,d,!0);cn(F,ze),je&&r.push(...je)};!y&&d.mixins.length&&d.mixins.forEach(Q),a.extends&&Q(a.extends),a.mixins&&a.mixins.forEach(Q)}if(!L&&!W)return Cn(a)&&A.set(a,Hh),Hh;if(ci(L))for(let Q=0;Q<L.length;Q++){const ce=Zn(L[Q]);a2(ce)&&(F[ce]=ln)}else if(L)for(const Q in L){const ce=Zn(Q);if(a2(ce)){const ze=L[Q],je=F[ce]=ci(ze)||Li(ze)?{type:ze}:cn({},ze),Oe=je.type;let Le=!1,ct=!0;if(ci(Oe))for(let st=0;st<Oe.length;++st){const gt=Oe[st],He=Li(gt)&&gt.name;if(He==="Boolean"){Le=!0;break}else He==="String"&&(ct=!1)}else Le=Li(Oe)&&Oe.name==="Boolean";je[0]=Le,je[1]=ct,(Le||Tn(je,"default"))&&r.push(ce)}}const ne=[F,r];return Cn(a)&&A.set(a,ne),ne}function a2(a){return a[0]!=="$"&&!Zl(a)}const AE=a=>a[0]==="_"||a==="$stable",kv=a=>ci(a)?a.map(Ps):[Ps(a)],az=(a,d,y)=>{if(d._n)return d;const A=Mv((...P)=>kv(d(...P)),y);return A._c=!1,A},IE=(a,d,y)=>{const A=a._ctx;for(const P in a){if(AE(P))continue;const L=a[P];if(Li(L))d[P]=az(P,L,A);else if(L!=null){const F=kv(L);d[P]=()=>F}}},CE=(a,d)=>{const y=kv(d);a.slots.default=()=>y},PE=(a,d,y)=>{for(const A in d)(y||A!=="_")&&(a[A]=d[A])},lz=(a,d,y)=>{const A=a.slots=TE();if(a.vnode.shapeFlag&32){const P=d._;P?(PE(A,d,y),y&&wS(A,"_",P,!0)):IE(d,A)}else d&&CE(a,d)},cz=(a,d,y)=>{const{vnode:A,slots:P}=a;let L=!0,F=ln;if(A.shapeFlag&32){const r=d._;r?y&&r===1?L=!1:PE(P,d,y):(L=!d.$stable,IE(d,P)),F=d}else d&&(CE(a,d),F={default:1});if(L)for(const r in P)!AE(r)&&F[r]==null&&delete P[r]},Dr=GE;function RE(a){return zE(a)}function DE(a){return zE(a,mD)}function zE(a,d){const y=jg();y.__VUE__=!0;const{insert:A,remove:P,patchProp:L,createElement:F,createText:r,createComment:W,setText:ne,setElementText:Q,parentNode:ce,nextSibling:ze,setScopeId:je=Ur,insertStaticContent:Oe}=a,Le=(Be,ge,_t,Ot=null,kt=null,mt=null,Gt=void 0,$t=null,Zt=!!ge.dynamicChildren)=>{if(Be===ge)return;Be&&!qo(Be,ge)&&(Ot=Os(Be),ar(Be,kt,mt,!0),Be=null),ge.patchFlag===-2&&(Zt=!1,ge.dynamicChildren=null);const{type:Ut,ref:bi,shapeFlag:Mt}=ge;switch(Ut){case Yl:ct(Be,ge,_t,Ot);break;case Tr:st(Be,ge,_t,Ot);break;case mu:Be==null&&gt(ge,_t,Ot,Gt);break;case wr:vt(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt);break;default:Mt&1?at(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt):Mt&6?Wt(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt):(Mt&64||Mt&128)&&Ut.process(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt,Te)}bi!=null&&kt&&Op(bi,Be&&Be.ref,mt,ge||Be,!ge)},ct=(Be,ge,_t,Ot)=>{if(Be==null)A(ge.el=r(ge.children),_t,Ot);else{const kt=ge.el=Be.el;ge.children!==Be.children&&ne(kt,ge.children)}},st=(Be,ge,_t,Ot)=>{Be==null?A(ge.el=W(ge.children||""),_t,Ot):ge.el=Be.el},gt=(Be,ge,_t,Ot)=>{[Be.el,Be.anchor]=Oe(Be.children,ge,_t,Ot,Be.el,Be.anchor)},He=({el:Be,anchor:ge},_t,Ot)=>{let kt;for(;Be&&Be!==ge;)kt=ze(Be),A(Be,_t,Ot),Be=kt;A(ge,_t,Ot)},Ve=({el:Be,anchor:ge})=>{let _t;for(;Be&&Be!==ge;)_t=ze(Be),P(Be),Be=_t;P(ge)},at=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt)=>{ge.type==="svg"?Gt="svg":ge.type==="math"&&(Gt="mathml"),Be==null?Pt(ge,_t,Ot,kt,mt,Gt,$t,Zt):ut(Be,ge,kt,mt,Gt,$t,Zt)},Pt=(Be,ge,_t,Ot,kt,mt,Gt,$t)=>{let Zt,Ut;const{props:bi,shapeFlag:Mt,transition:di,dirs:wi}=Be;if(Zt=Be.el=F(Be.type,mt,bi&&bi.is,bi),Mt&8?Q(Zt,Be.children):Mt&16&&zt(Be.children,Zt,null,Ot,kt,wx(Be,mt),Gt,$t),wi&&ma(Be,null,Ot,"created"),dt(Zt,Be,Be.scopeId,Gt,Ot),bi){for(const qi in bi)qi!=="value"&&!Zl(qi)&&L(Zt,qi,null,bi[qi],mt,Ot);"value"in bi&&L(Zt,"value",null,bi.value,mt),(Ut=bi.onVnodeBeforeMount)&&Cs(Ut,Ot,Be)}wi&&ma(Be,null,Ot,"beforeMount");const Gi=LE(kt,di);Gi&&di.beforeEnter(Zt),A(Zt,ge,_t),((Ut=bi&&bi.onVnodeMounted)||Gi||wi)&&Dr(()=>{Ut&&Cs(Ut,Ot,Be),Gi&&di.enter(Zt),wi&&ma(Be,null,Ot,"mounted")},kt)},dt=(Be,ge,_t,Ot,kt)=>{if(_t&&je(Be,_t),Ot)for(let mt=0;mt<Ot.length;mt++)je(Be,Ot[mt]);if(kt){let mt=kt.subTree;if(ge===mt||_g(mt.type)&&(mt.ssContent===ge||mt.ssFallback===ge)){const Gt=kt.vnode;dt(Be,Gt,Gt.scopeId,Gt.slotScopeIds,kt.parent)}}},zt=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt=0)=>{for(let Ut=Zt;Ut<Be.length;Ut++){const bi=Be[Ut]=$t?Hl(Be[Ut]):Ps(Be[Ut]);Le(null,bi,ge,_t,Ot,kt,mt,Gt,$t)}},ut=(Be,ge,_t,Ot,kt,mt,Gt)=>{const $t=ge.el=Be.el;let{patchFlag:Zt,dynamicChildren:Ut,dirs:bi}=ge;Zt|=Be.patchFlag&16;const Mt=Be.props||ln,di=ge.props||ln;let wi;if(_t&&au(_t,!1),(wi=di.onVnodeBeforeUpdate)&&Cs(wi,_t,ge,Be),bi&&ma(ge,Be,_t,"beforeUpdate"),_t&&au(_t,!0),(Mt.innerHTML&&di.innerHTML==null||Mt.textContent&&di.textContent==null)&&Q($t,""),Ut?Je(Be.dynamicChildren,Ut,$t,_t,Ot,wx(ge,kt),mt):Gt||hi(Be,ge,$t,null,_t,Ot,wx(ge,kt),mt,!1),Zt>0){if(Zt&16)ht($t,Mt,di,_t,kt);else if(Zt&2&&Mt.class!==di.class&&L($t,"class",null,di.class,kt),Zt&4&&L($t,"style",Mt.style,di.style,kt),Zt&8){const Gi=ge.dynamicProps;for(let qi=0;qi<Gi.length;qi++){const tn=Gi[qi],Qn=Mt[tn],Un=di[tn];(Un!==Qn||tn==="value")&&L($t,tn,Qn,Un,kt,_t)}}Zt&1&&Be.children!==ge.children&&Q($t,ge.children)}else!Gt&&Ut==null&&ht($t,Mt,di,_t,kt);((wi=di.onVnodeUpdated)||bi)&&Dr(()=>{wi&&Cs(wi,_t,ge,Be),bi&&ma(ge,Be,_t,"updated")},Ot)},Je=(Be,ge,_t,Ot,kt,mt,Gt)=>{for(let $t=0;$t<ge.length;$t++){const Zt=Be[$t],Ut=ge[$t],bi=Zt.el&&(Zt.type===wr||!qo(Zt,Ut)||Zt.shapeFlag&70)?ce(Zt.el):_t;Le(Zt,Ut,bi,null,Ot,kt,mt,Gt,!0)}},ht=(Be,ge,_t,Ot,kt)=>{if(ge!==_t){if(ge!==ln)for(const mt in ge)!Zl(mt)&&!(mt in _t)&&L(Be,mt,ge[mt],null,kt,Ot);for(const mt in _t){if(Zl(mt))continue;const Gt=_t[mt],$t=ge[mt];Gt!==$t&&mt!=="value"&&L(Be,mt,$t,Gt,kt,Ot)}"value"in _t&&L(Be,"value",ge.value,_t.value,kt)}},vt=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt)=>{const Ut=ge.el=Be?Be.el:r(""),bi=ge.anchor=Be?Be.anchor:r("");let{patchFlag:Mt,dynamicChildren:di,slotScopeIds:wi}=ge;wi&&($t=$t?$t.concat(wi):wi),Be==null?(A(Ut,_t,Ot),A(bi,_t,Ot),zt(ge.children||[],_t,bi,kt,mt,Gt,$t,Zt)):Mt>0&&Mt&64&&di&&Be.dynamicChildren?(Je(Be.dynamicChildren,di,_t,kt,mt,Gt,$t),(ge.key!=null||kt&&ge===kt.subTree)&&Fv(Be,ge,!0)):hi(Be,ge,_t,bi,kt,mt,Gt,$t,Zt)},Wt=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt)=>{ge.slotScopeIds=$t,Be==null?ge.shapeFlag&512?kt.ctx.activate(ge,_t,Ot,Gt,Zt):vi(ge,_t,Ot,kt,mt,Gt,Zt):Ft(Be,ge,Zt)},vi=(Be,ge,_t,Ot,kt,mt,Gt)=>{const $t=Be.component=YE(Be,Ot,kt);if(Zp(Be)&&($t.ctx.renderer=Te),JE($t,!1,Gt),$t.asyncDep){if(kt&&kt.registerDep($t,Qt,Gt),!Be.el){const Zt=$t.subTree=$n(Tr);st(null,Zt,ge,_t)}}else Qt($t,Be,ge,_t,kt,mt,Gt)},Ft=(Be,ge,_t)=>{const Ot=ge.component=Be.component;if(xz(Be,ge,_t))if(Ot.asyncDep&&!Ot.asyncResolved){Ti(Ot,ge,_t);return}else Ot.next=ge,Ot.update();else ge.el=Be.el,Ot.vnode=ge},Qt=(Be,ge,_t,Ot,kt,mt,Gt)=>{const $t=()=>{if(Be.isMounted){let{next:Mt,bu:di,u:wi,parent:Gi,vnode:qi}=Be;{const xn=OE(Be);if(xn){Mt&&(Mt.el=qi.el,Ti(Be,Mt,Gt)),xn.asyncDep.then(()=>{Be.isUnmounted||$t()});return}}let tn=Mt,Qn;au(Be,!1),Mt?(Mt.el=qi.el,Ti(Be,Mt,Gt)):Mt=qi,di&&Wh(di),(Qn=Mt.props&&Mt.props.onVnodeBeforeUpdate)&&Cs(Qn,Gi,Mt,qi),au(Be,!0);const Un=J_(Be),_r=Be.subTree;Be.subTree=Un,Le(_r,Un,ce(_r.el),Os(_r),Be,kt,mt),Mt.el=Un.el,tn===null&&sy(Be,Un.el),wi&&Dr(wi,kt),(Qn=Mt.props&&Mt.props.onVnodeUpdated)&&Dr(()=>Cs(Qn,Gi,Mt,qi),kt)}else{let Mt;const{el:di,props:wi}=ge,{bm:Gi,m:qi,parent:tn,root:Qn,type:Un}=Be,_r=Xl(ge);if(au(Be,!1),Gi&&Wh(Gi),!_r&&(Mt=wi&&wi.onVnodeBeforeMount)&&Cs(Mt,tn,ge),au(Be,!0),di&&Js){const xn=()=>{Be.subTree=J_(Be),Js(di,Be.subTree,Be,kt,null)};_r&&Un.__asyncHydrate?Un.__asyncHydrate(di,Be,xn):xn()}else{Qn.ce&&Qn.ce._injectChildStyle(Un);const xn=Be.subTree=J_(Be);Le(null,xn,_t,Ot,Be,kt,mt),ge.el=xn.el}if(qi&&Dr(qi,kt),!_r&&(Mt=wi&&wi.onVnodeMounted)){const xn=ge;Dr(()=>Cs(Mt,tn,xn),kt)}(ge.shapeFlag&256||tn&&Xl(tn.vnode)&&tn.vnode.shapeFlag&256)&&Be.a&&Dr(Be.a,kt),Be.isMounted=!0,ge=_t=Ot=null}};Be.scope.on();const Zt=Be.effect=new Cp($t);Be.scope.off();const Ut=Be.update=Zt.run.bind(Zt),bi=Be.job=Zt.runIfDirty.bind(Zt);bi.i=Be,bi.id=Be.uid,Zt.scheduler=()=>Ev(bi),au(Be,!0),Ut()},Ti=(Be,ge,_t)=>{ge.component=Be;const Ot=Be.vnode.props;Be.vnode=ge,Be.next=null,sz(Be,ge.props,Ot,_t),cz(Be,ge.children,_t),tc(),YT(Be),ic()},hi=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt=!1)=>{const Ut=Be&&Be.children,bi=Be?Be.shapeFlag:0,Mt=ge.children,{patchFlag:di,shapeFlag:wi}=ge;if(di>0){if(di&128){rr(Ut,Mt,_t,Ot,kt,mt,Gt,$t,Zt);return}else if(di&256){ri(Ut,Mt,_t,Ot,kt,mt,Gt,$t,Zt);return}}wi&8?(bi&16&&vs(Ut,kt,mt),Mt!==Ut&&Q(_t,Mt)):bi&16?wi&16?rr(Ut,Mt,_t,Ot,kt,mt,Gt,$t,Zt):vs(Ut,kt,mt,!0):(bi&8&&Q(_t,""),wi&16&&zt(Mt,_t,Ot,kt,mt,Gt,$t,Zt))},ri=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt)=>{Be=Be||Hh,ge=ge||Hh;const Ut=Be.length,bi=ge.length,Mt=Math.min(Ut,bi);let di;for(di=0;di<Mt;di++){const wi=ge[di]=Zt?Hl(ge[di]):Ps(ge[di]);Le(Be[di],wi,_t,null,kt,mt,Gt,$t,Zt)}Ut>bi?vs(Be,kt,mt,!0,!1,Mt):zt(ge,_t,Ot,kt,mt,Gt,$t,Zt,Mt)},rr=(Be,ge,_t,Ot,kt,mt,Gt,$t,Zt)=>{let Ut=0;const bi=ge.length;let Mt=Be.length-1,di=bi-1;for(;Ut<=Mt&&Ut<=di;){const wi=Be[Ut],Gi=ge[Ut]=Zt?Hl(ge[Ut]):Ps(ge[Ut]);if(qo(wi,Gi))Le(wi,Gi,_t,null,kt,mt,Gt,$t,Zt);else break;Ut++}for(;Ut<=Mt&&Ut<=di;){const wi=Be[Mt],Gi=ge[di]=Zt?Hl(ge[di]):Ps(ge[di]);if(qo(wi,Gi))Le(wi,Gi,_t,null,kt,mt,Gt,$t,Zt);else break;Mt--,di--}if(Ut>Mt){if(Ut<=di){const wi=di+1,Gi=wi<bi?ge[wi].el:Ot;for(;Ut<=di;)Le(null,ge[Ut]=Zt?Hl(ge[Ut]):Ps(ge[Ut]),_t,Gi,kt,mt,Gt,$t,Zt),Ut++}}else if(Ut>di)for(;Ut<=Mt;)ar(Be[Ut],kt,mt,!0),Ut++;else{const wi=Ut,Gi=Ut,qi=new Map;for(Ut=Gi;Ut<=di;Ut++){const Mn=ge[Ut]=Zt?Hl(ge[Ut]):Ps(ge[Ut]);Mn.key!=null&&qi.set(Mn.key,Ut)}let tn,Qn=0;const Un=di-Gi+1;let _r=!1,xn=0;const bs=new Array(Un);for(Ut=0;Ut<Un;Ut++)bs[Ut]=0;for(Ut=wi;Ut<=Mt;Ut++){const Mn=Be[Ut];if(Qn>=Un){ar(Mn,kt,mt,!0);continue}let gr;if(Mn.key!=null)gr=qi.get(Mn.key);else for(tn=Gi;tn<=di;tn++)if(bs[tn-Gi]===0&&qo(Mn,ge[tn])){gr=tn;break}gr===void 0?ar(Mn,kt,mt,!0):(bs[gr-Gi]=Ut+1,gr>=xn?xn=gr:_r=!0,Le(Mn,ge[gr],_t,null,kt,mt,Gt,$t,Zt),Qn++)}const Eo=_r?uz(bs):Hh;for(tn=Eo.length-1,Ut=Un-1;Ut>=0;Ut--){const Mn=Gi+Ut,gr=ge[Mn],_i=Mn+1<bi?ge[Mn+1].el:Ot;bs[Ut]===0?Le(null,gr,_t,_i,kt,mt,Gt,$t,Zt):_r&&(tn<0||Ut!==Eo[tn]?mr(gr,_t,_i,2):tn--)}}},mr=(Be,ge,_t,Ot,kt=null)=>{const{el:mt,type:Gt,transition:$t,children:Zt,shapeFlag:Ut}=Be;if(Ut&6){mr(Be.component.subTree,ge,_t,Ot);return}if(Ut&128){Be.suspense.move(ge,_t,Ot);return}if(Ut&64){Gt.move(Be,ge,_t,Te);return}if(Gt===wr){A(mt,ge,_t);for(let Mt=0;Mt<Zt.length;Mt++)mr(Zt[Mt],ge,_t,Ot);A(Be.anchor,ge,_t);return}if(Gt===mu){He(Be,ge,_t);return}if(Ot!==2&&Ut&1&&$t)if(Ot===0)$t.beforeEnter(mt),A(mt,ge,_t),Dr(()=>$t.enter(mt),kt);else{const{leave:Mt,delayLeave:di,afterLeave:wi}=$t,Gi=()=>A(mt,ge,_t),qi=()=>{Mt(mt,()=>{Gi(),wi&&wi()})};di?di(mt,Gi,qi):qi()}else A(mt,ge,_t)},ar=(Be,ge,_t,Ot=!1,kt=!1)=>{const{type:mt,props:Gt,ref:$t,children:Zt,dynamicChildren:Ut,shapeFlag:bi,patchFlag:Mt,dirs:di,cacheIndex:wi}=Be;if(Mt===-2&&(kt=!1),$t!=null&&Op($t,null,_t,Be,!0),wi!=null&&(ge.renderCache[wi]=void 0),bi&256){ge.ctx.deactivate(Be);return}const Gi=bi&1&&di,qi=!Xl(Be);let tn;if(qi&&(tn=Gt&&Gt.onVnodeBeforeUnmount)&&Cs(tn,ge,Be),bi&6)Xo(Be.component,_t,Ot);else{if(bi&128){Be.suspense.unmount(_t,Ot);return}Gi&&ma(Be,null,ge,"beforeUnmount"),bi&64?Be.type.remove(Be,ge,_t,Te,Ot):Ut&&!Ut.hasOnce&&(mt!==wr||Mt>0&&Mt&64)?vs(Ut,ge,_t,!1,!0):(mt===wr&&Mt&384||!kt&&bi&16)&&vs(Zt,ge,_t),Ot&&mi(Be)}(qi&&(tn=Gt&&Gt.onVnodeUnmounted)||Gi)&&Dr(()=>{tn&&Cs(tn,ge,Be),Gi&&ma(Be,null,ge,"unmounted")},_t)},mi=Be=>{const{type:ge,el:_t,anchor:Ot,transition:kt}=Be;if(ge===wr){nc(_t,Ot);return}if(ge===mu){Ve(Be);return}const mt=()=>{P(_t),kt&&!kt.persisted&&kt.afterLeave&&kt.afterLeave()};if(Be.shapeFlag&1&&kt&&!kt.persisted){const{leave:Gt,delayLeave:$t}=kt,Zt=()=>Gt(_t,mt);$t?$t(Be.el,mt,Zt):Zt()}else mt()},nc=(Be,ge)=>{let _t;for(;Be!==ge;)_t=ze(Be),P(Be),Be=_t;P(ge)},Xo=(Be,ge,_t)=>{const{bum:Ot,scope:kt,job:mt,subTree:Gt,um:$t,m:Zt,a:Ut}=Be;mg(Zt),mg(Ut),Ot&&Wh(Ot),kt.stop(),mt&&(mt.flags|=8,ar(Gt,Be,ge,_t)),$t&&Dr($t,ge),Dr(()=>{Be.isUnmounted=!0},ge),ge&&ge.pendingBranch&&!ge.isUnmounted&&Be.asyncDep&&!Be.asyncResolved&&Be.suspenseId===ge.pendingId&&(ge.deps--,ge.deps===0&&ge.resolve())},vs=(Be,ge,_t,Ot=!1,kt=!1,mt=0)=>{for(let Gt=mt;Gt<Be.length;Gt++)ar(Be[Gt],ge,_t,Ot,kt)},Os=Be=>{if(Be.shapeFlag&6)return Os(Be.component.subTree);if(Be.shapeFlag&128)return Be.suspense.next();const ge=ze(Be.anchor||Be.el),_t=ge&&ge[tE];return _t?ze(_t):ge};let Zr=!1;const So=(Be,ge,_t)=>{Be==null?ge._vnode&&ar(ge._vnode,null,null,!0):Le(ge._vnode||null,Be,ge,null,null,null,_t),ge._vnode=Be,Zr||(Zr=!0,YT(),fg(),Zr=!1)},Te={p:Le,um:ar,m:mr,r:mi,mt:vi,mc:zt,pc:hi,pbc:Je,n:Os,o:a};let Ks,Js;return d&&([Ks,Js]=d(Te)),{render:So,hydrate:Ks,createApp:iz(So,Ks)}}function wx({type:a,props:d},y){return y==="svg"&&a==="foreignObject"||y==="mathml"&&a==="annotation-xml"&&d&&d.encoding&&d.encoding.includes("html")?void 0:y}function au({effect:a,job:d},y){y?(a.flags|=32,d.flags|=4):(a.flags&=-33,d.flags&=-5)}function LE(a,d){return(!a||a&&!a.pendingBranch)&&d&&!d.persisted}function Fv(a,d,y=!1){const A=a.children,P=d.children;if(ci(A)&&ci(P))for(let L=0;L<A.length;L++){const F=A[L];let r=P[L];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=P[L]=Hl(P[L]),r.el=F.el),!y&&r.patchFlag!==-2&&Fv(F,r)),r.type===Yl&&(r.el=F.el)}}function uz(a){const d=a.slice(),y=[0];let A,P,L,F,r;const W=a.length;for(A=0;A<W;A++){const ne=a[A];if(ne!==0){if(P=y[y.length-1],a[P]<ne){d[A]=P,y.push(A);continue}for(L=0,F=y.length-1;L<F;)r=L+F>>1,a[y[r]]<ne?L=r+1:F=r;ne<a[y[L]]&&(L>0&&(d[A]=y[L-1]),y[L]=A)}}for(L=y.length,F=y[L-1];L-- >0;)y[L]=F,F=d[F];return y}function OE(a){const d=a.subTree.component;if(d)return d.asyncDep&&!d.asyncResolved?d:OE(d)}function mg(a){if(a)for(let d=0;d<a.length;d++)a[d].flags|=8}const kE=Symbol.for("v-scx"),FE=()=>Sp(kE);function hz(a,d){return Xp(a,null,d)}function dz(a,d){return Xp(a,null,{flush:"post"})}function BE(a,d){return Xp(a,null,{flush:"sync"})}function Yh(a,d,y){return Xp(a,d,y)}function Xp(a,d,y=ln){const{immediate:A,deep:P,flush:L,once:F}=y,r=cn({},y),W=d&&A||!d&&L!=="post";let ne;if(Qh){if(L==="sync"){const je=FE();ne=je.__watcherHandles||(je.__watcherHandles=[])}else if(!W){const je=()=>{};return je.stop=Ur,je.resume=Ur,je.pause=Ur,je}}const Q=Lr;r.call=(je,Oe,Le)=>wo(je,Q,Oe,Le);let ce=!1;L==="post"?r.scheduler=je=>{Dr(je,Q&&Q.suspense)}:L!=="sync"&&(ce=!0,r.scheduler=(je,Oe)=>{Oe?je():Ev(je)}),r.augmentJob=je=>{d&&(je.flags|=4),ce&&(je.flags|=2,Q&&(je.id=Q.uid,je.i=Q))};const ze=K3(a,d,r);return Qh&&(ne?ne.push(ze):W&&ze()),ze}function fz(a,d,y){const A=this.proxy,P=Wi(a)?a.includes(".")?NE(A,a):()=>A[a]:a.bind(A,A);let L;Li(d)?L=d:(L=d.handler,y=d);const F=vu(this),r=Xp(P,L.bind(A),y);return F(),r}function NE(a,d){const y=d.split(".");return()=>{let A=a;for(let P=0;P<y.length&&A;P++)A=A[y[P]];return A}}function pz(a,d,y=ln){const A=To(),P=Zn(d),L=Rs(d),F=VE(a,P),r=ZS((W,ne)=>{let Q,ce=ln,ze;return BE(()=>{const je=a[P];ys(Q,je)&&(Q=je,ne())}),{get(){return W(),y.get?y.get(Q):Q},set(je){const Oe=y.set?y.set(je):je;if(!ys(Oe,Q)&&!(ce!==ln&&ys(je,ce)))return;const Le=A.vnode.props;Le&&(d in Le||P in Le||L in Le)&&(`onUpdate:${d}`in Le||`onUpdate:${P}`in Le||`onUpdate:${L}`in Le)||(Q=je,ne()),A.emit(`update:${d}`,Oe),ys(je,Oe)&&ys(je,ce)&&!ys(Oe,ze)&&ne(),ce=je,ze=Oe}}});return r[Symbol.iterator]=()=>{let W=0;return{next(){return W<2?{value:W++?F||ln:r,done:!1}:{done:!0}}}},r}const VE=(a,d)=>d==="modelValue"||d==="model-value"?a.modelModifiers:a[`${d}Modifiers`]||a[`${Zn(d)}Modifiers`]||a[`${Rs(d)}Modifiers`];function mz(a,d,...y){if(a.isUnmounted)return;const A=a.vnode.props||ln;let P=y;const L=d.startsWith("update:"),F=L&&VE(A,d.slice(7));F&&(F.trim&&(P=y.map(Q=>Wi(Q)?Q.trim():Q)),F.number&&(P=y.map(lg)));let r,W=A[r=Zh(d)]||A[r=Zh(Zn(d))];!W&&L&&(W=A[r=Zh(Rs(d))]),W&&wo(W,a,6,P);const ne=A[r+"Once"];if(ne){if(!a.emitted)a.emitted={};else if(a.emitted[r])return;a.emitted[r]=!0,wo(ne,a,6,P)}}function UE(a,d,y=!1){const A=d.emitsCache,P=A.get(a);if(P!==void 0)return P;const L=a.emits;let F={},r=!1;if(!Li(a)){const W=ne=>{const Q=UE(ne,d,!0);Q&&(r=!0,cn(F,Q))};!y&&d.mixins.length&&d.mixins.forEach(W),a.extends&&W(a.extends),a.mixins&&a.mixins.forEach(W)}return!L&&!r?(Cn(a)&&A.set(a,null),null):(ci(L)?L.forEach(W=>F[W]=null):cn(F,L),Cn(a)&&A.set(a,F),F)}function ry(a,d){return!a||!wu(d)?!1:(d=d.slice(2).replace(/Once$/,""),Tn(a,d[0].toLowerCase()+d.slice(1))||Tn(a,Rs(d))||Tn(a,d))}function J_(a){const{type:d,vnode:y,proxy:A,withProxy:P,propsOptions:[L],slots:F,attrs:r,emit:W,render:ne,renderCache:Q,props:ce,data:ze,setupState:je,ctx:Oe,inheritAttrs:Le}=a,ct=Lp(a);let st,gt;try{if(y.shapeFlag&4){const Ve=P||A,at=Ve;st=Ps(ne.call(at,Ve,Q,ce,je,ze,Oe)),gt=r}else{const Ve=d;st=Ps(Ve.length>1?Ve(ce,{attrs:r,slots:F,emit:W}):Ve(ce,null)),gt=d.props?r:gz(r)}}catch(Ve){Ep.length=0,Eu(Ve,a,1),st=$n(Tr)}let He=st;if(gt&&Le!==!1){const Ve=Object.keys(gt),{shapeFlag:at}=He;Ve.length&&at&7&&(L&&Ve.some(mv)&&(gt=yz(gt,L)),He=ga(He,gt,!1,!0))}return y.dirs&&(He=ga(He,null,!1,!0),He.dirs=He.dirs?He.dirs.concat(y.dirs):y.dirs),y.transition&&Ka(He,y.transition),st=He,Lp(ct),st}function _z(a,d=!0){let y;for(let A=0;A<a.length;A++){const P=a[A];if(Ja(P)){if(P.type!==Tr||P.children==="v-if"){if(y)return;y=P}}else return}return y}const gz=a=>{let d;for(const y in a)(y==="class"||y==="style"||wu(y))&&((d||(d={}))[y]=a[y]);return d},yz=(a,d)=>{const y={};for(const A in a)(!mv(A)||!(A.slice(9)in d))&&(y[A]=a[A]);return y};function xz(a,d,y){const{props:A,children:P,component:L}=a,{props:F,children:r,patchFlag:W}=d,ne=L.emitsOptions;if(d.dirs||d.transition)return!0;if(y&&W>=0){if(W&1024)return!0;if(W&16)return A?l2(A,F,ne):!!F;if(W&8){const Q=d.dynamicProps;for(let ce=0;ce<Q.length;ce++){const ze=Q[ce];if(F[ze]!==A[ze]&&!ry(ne,ze))return!0}}}else return(P||r)&&(!r||!r.$stable)?!0:A===F?!1:A?F?l2(A,F,ne):!0:!!F;return!1}function l2(a,d,y){const A=Object.keys(d);if(A.length!==Object.keys(a).length)return!0;for(let P=0;P<A.length;P++){const L=A[P];if(d[L]!==a[L]&&!ry(y,L))return!0}return!1}function sy({vnode:a,parent:d},y){for(;d;){const A=d.subTree;if(A.suspense&&A.suspense.activeBranch===a&&(A.el=a.el),A===a)(a=d.vnode).el=y,d=d.parent;else break}}const _g=a=>a.__isSuspense;let Hx=0;const vz={name:"Suspense",__isSuspense:!0,process(a,d,y,A,P,L,F,r,W,ne){if(a==null)wz(d,y,A,P,L,F,r,W,ne);else{if(L&&L.deps>0&&!a.suspense.isInFallback){d.suspense=a.suspense,d.suspense.vnode=d,d.el=a.el;return}Tz(a,d,y,A,P,F,r,W,ne)}},hydrate:Sz,normalize:Ez},bz=vz;function Fp(a,d){const y=a.props&&a.props[d];Li(y)&&y()}function wz(a,d,y,A,P,L,F,r,W){const{p:ne,o:{createElement:Q}}=W,ce=Q("div"),ze=a.suspense=jE(a,P,A,d,ce,y,L,F,r,W);ne(null,ze.pendingBranch=a.ssContent,ce,null,A,ze,L,F),ze.deps>0?(Fp(a,"onPending"),Fp(a,"onFallback"),ne(null,a.ssFallback,d,y,A,null,L,F),Kh(ze,a.ssFallback)):ze.resolve(!1,!0)}function Tz(a,d,y,A,P,L,F,r,{p:W,um:ne,o:{createElement:Q}}){const ce=d.suspense=a.suspense;ce.vnode=d,d.el=a.el;const ze=d.ssContent,je=d.ssFallback,{activeBranch:Oe,pendingBranch:Le,isInFallback:ct,isHydrating:st}=ce;if(Le)ce.pendingBranch=ze,qo(ze,Le)?(W(Le,ze,ce.hiddenContainer,null,P,ce,L,F,r),ce.deps<=0?ce.resolve():ct&&(st||(W(Oe,je,y,A,P,null,L,F,r),Kh(ce,je)))):(ce.pendingId=Hx++,st?(ce.isHydrating=!1,ce.activeBranch=Le):ne(Le,P,ce),ce.deps=0,ce.effects.length=0,ce.hiddenContainer=Q("div"),ct?(W(null,ze,ce.hiddenContainer,null,P,ce,L,F,r),ce.deps<=0?ce.resolve():(W(Oe,je,y,A,P,null,L,F,r),Kh(ce,je))):Oe&&qo(ze,Oe)?(W(Oe,ze,y,A,P,ce,L,F,r),ce.resolve(!0)):(W(null,ze,ce.hiddenContainer,null,P,ce,L,F,r),ce.deps<=0&&ce.resolve()));else if(Oe&&qo(ze,Oe))W(Oe,ze,y,A,P,ce,L,F,r),Kh(ce,ze);else if(Fp(d,"onPending"),ce.pendingBranch=ze,ze.shapeFlag&512?ce.pendingId=ze.component.suspenseId:ce.pendingId=Hx++,W(null,ze,ce.hiddenContainer,null,P,ce,L,F,r),ce.deps<=0)ce.resolve();else{const{timeout:gt,pendingId:He}=ce;gt>0?setTimeout(()=>{ce.pendingId===He&&ce.fallback(je)},gt):gt===0&&ce.fallback(je)}}function jE(a,d,y,A,P,L,F,r,W,ne,Q=!1){const{p:ce,m:ze,um:je,n:Oe,o:{parentNode:Le,remove:ct}}=ne;let st;const gt=Mz(a);gt&&d&&d.pendingBranch&&(st=d.pendingId,d.deps++);const He=a.props?cg(a.props.timeout):void 0,Ve=L,at={vnode:a,parent:d,parentComponent:y,namespace:F,container:A,hiddenContainer:P,deps:0,pendingId:Hx++,timeout:typeof He=="number"?He:-1,activeBranch:null,pendingBranch:null,isInFallback:!Q,isHydrating:Q,isUnmounted:!1,effects:[],resolve(Pt=!1,dt=!1){const{vnode:zt,activeBranch:ut,pendingBranch:Je,pendingId:ht,effects:vt,parentComponent:Wt,container:vi}=at;let Ft=!1;at.isHydrating?at.isHydrating=!1:Pt||(Ft=ut&&Je.transition&&Je.transition.mode==="out-in",Ft&&(ut.transition.afterLeave=()=>{ht===at.pendingId&&(ze(Je,vi,L===Ve?Oe(ut):L,0),Dp(vt))}),ut&&(Le(ut.el)===vi&&(L=Oe(ut)),je(ut,Wt,at,!0)),Ft||ze(Je,vi,L,0)),Kh(at,Je),at.pendingBranch=null,at.isInFallback=!1;let Qt=at.parent,Ti=!1;for(;Qt;){if(Qt.pendingBranch){Qt.effects.push(...vt),Ti=!0;break}Qt=Qt.parent}!Ti&&!Ft&&Dp(vt),at.effects=[],gt&&d&&d.pendingBranch&&st===d.pendingId&&(d.deps--,d.deps===0&&!dt&&d.resolve()),Fp(zt,"onResolve")},fallback(Pt){if(!at.pendingBranch)return;const{vnode:dt,activeBranch:zt,parentComponent:ut,container:Je,namespace:ht}=at;Fp(dt,"onFallback");const vt=Oe(zt),Wt=()=>{at.isInFallback&&(ce(null,Pt,Je,vt,ut,null,ht,r,W),Kh(at,Pt))},vi=Pt.transition&&Pt.transition.mode==="out-in";vi&&(zt.transition.afterLeave=Wt),at.isInFallback=!0,je(zt,ut,null,!0),vi||Wt()},move(Pt,dt,zt){at.activeBranch&&ze(at.activeBranch,Pt,dt,zt),at.container=Pt},next(){return at.activeBranch&&Oe(at.activeBranch)},registerDep(Pt,dt,zt){const ut=!!at.pendingBranch;ut&&at.deps++;const Je=Pt.vnode.el;Pt.asyncDep.catch(ht=>{Eu(ht,Pt,0)}).then(ht=>{if(Pt.isUnmounted||at.isUnmounted||at.pendingId!==Pt.suspenseId)return;Pt.asyncResolved=!0;const{vnode:vt}=Pt;Xx(Pt,ht,!1),Je&&(vt.el=Je);const Wt=!Je&&Pt.subTree.el;dt(Pt,vt,Le(Je||Pt.subTree.el),Je?null:Oe(Pt.subTree),at,F,zt),Wt&&ct(Wt),sy(Pt,vt.el),ut&&--at.deps===0&&at.resolve()})},unmount(Pt,dt){at.isUnmounted=!0,at.activeBranch&&je(at.activeBranch,y,Pt,dt),at.pendingBranch&&je(at.pendingBranch,y,Pt,dt)}};return at}function Sz(a,d,y,A,P,L,F,r,W){const ne=d.suspense=jE(d,A,y,a.parentNode,document.createElement("div"),null,P,L,F,r,!0),Q=W(a,ne.pendingBranch=d.ssContent,y,ne,L,F);return ne.deps===0&&ne.resolve(!1,!0),Q}function Ez(a){const{shapeFlag:d,children:y}=a,A=d&32;a.ssContent=c2(A?y.default:y),a.ssFallback=A?c2(y.fallback):$n(Tr)}function c2(a){let d;if(Li(a)){const y=xu&&a._c;y&&(a._d=!1,Ds()),a=a(),y&&(a._d=!0,d=os,qE())}return ci(a)&&(a=_z(a)),a=Ps(a),d&&!a.dynamicChildren&&(a.dynamicChildren=d.filter(y=>y!==a)),a}function GE(a,d){d&&d.pendingBranch?ci(a)?d.effects.push(...a):d.effects.push(a):Dp(a)}function Kh(a,d){a.activeBranch=d;const{vnode:y,parentComponent:A}=a;let P=d.el;for(;!P&&d.component;)d=d.component.subTree,P=d.el;y.el=P,A&&A.subTree===y&&(A.vnode.el=P,sy(A,P))}function Mz(a){const d=a.props&&a.props.suspensible;return d!=null&&d!==!1}const wr=Symbol.for("v-fgt"),Yl=Symbol.for("v-txt"),Tr=Symbol.for("v-cmt"),mu=Symbol.for("v-stc"),Ep=[];let os=null;function Ds(a=!1){Ep.push(os=a?null:[])}function qE(){Ep.pop(),os=Ep[Ep.length-1]||null}let xu=1;function $x(a,d=!1){xu+=a,a<0&&os&&d&&(os.hasOnce=!0)}function HE(a){return a.dynamicChildren=xu>0?os||Hh:null,qE(),xu>0&&os&&os.push(a),a}function _a(a,d,y,A,P,L){return HE(yn(a,d,y,A,P,L,!0))}function gg(a,d,y,A,P){return HE($n(a,d,y,A,P,!0))}function Ja(a){return a?a.__v_isVNode===!0:!1}function qo(a,d){return a.type===d.type&&a.key===d.key}function Az(a){}const $E=({key:a})=>a??null,Q_=({ref:a,ref_key:d,ref_for:y})=>(typeof a=="number"&&(a=""+a),a!=null?Wi(a)||kr(a)||Li(a)?{i:Or,r:a,k:d,f:!!y}:a:null);function yn(a,d=null,y=null,A=0,P=null,L=a===wr?0:1,F=!1,r=!1){const W={__v_isVNode:!0,__v_skip:!0,type:a,props:d,key:d&&$E(d),ref:d&&Q_(d),scopeId:Jg,slotScopeIds:null,children:y,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:L,patchFlag:A,dynamicProps:P,dynamicChildren:null,appContext:null,ctx:Or};return r?(Nv(W,y),L&128&&a.normalize(W)):y&&(W.shapeFlag|=Wi(y)?8:16),xu>0&&!F&&os&&(W.patchFlag>0||L&6)&&W.patchFlag!==32&&os.push(W),W}const $n=Iz;function Iz(a,d=null,y=null,A=0,P=null,L=!1){if((!a||a===gE)&&(a=Tr),Ja(a)){const r=ga(a,d,!0);return y&&Nv(r,y),xu>0&&!L&&os&&(r.shapeFlag&6?os[os.indexOf(a)]=r:os.push(r)),r.patchFlag=-2,r}if(Oz(a)&&(a=a.__vccOpts),d){d=ZE(d);let{class:r,style:W}=d;r&&!Wi(r)&&(d.class=$p(r)),Cn(W)&&(Xg(W)&&!ci(W)&&(W=cn({},W)),d.style=Hp(W))}const F=Wi(a)?1:_g(a)?128:iE(a)?64:Cn(a)?4:Li(a)?2:0;return yn(a,d,y,A,P,F,L,!0)}function ZE(a){return a?Xg(a)||SE(a)?cn({},a):a:null}function ga(a,d,y=!1,A=!1){const{props:P,ref:L,patchFlag:F,children:r,transition:W}=a,ne=d?XE(P||{},d):P,Q={__v_isVNode:!0,__v_skip:!0,type:a.type,props:ne,key:ne&&$E(ne),ref:d&&d.ref?y&&L?ci(L)?L.concat(Q_(d)):[L,Q_(d)]:Q_(d):L,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:r,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:d&&a.type!==wr?F===-1?16:F|16:F,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:W,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&ga(a.ssContent),ssFallback:a.ssFallback&&ga(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return W&&A&&Ka(Q,W.clone(Q)),Q}function Bv(a=" ",d=0){return $n(Yl,null,a,d)}function Cz(a,d){const y=$n(mu,null,a);return y.staticCount=d,y}function WE(a="",d=!1){return d?(Ds(),gg(Tr,null,a)):$n(Tr,null,a)}function Ps(a){return a==null||typeof a=="boolean"?$n(Tr):ci(a)?$n(wr,null,a.slice()):Ja(a)?Hl(a):$n(Yl,null,String(a))}function Hl(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:ga(a)}function Nv(a,d){let y=0;const{shapeFlag:A}=a;if(d==null)d=null;else if(ci(d))y=16;else if(typeof d=="object")if(A&65){const P=d.default;P&&(P._c&&(P._d=!1),Nv(a,P()),P._c&&(P._d=!0));return}else{y=32;const P=d._;!P&&!SE(d)?d._ctx=Or:P===3&&Or&&(Or.slots._===1?d._=1:(d._=2,a.patchFlag|=1024))}else Li(d)?(d={default:d,_ctx:Or},y=32):(d=String(d),A&64?(y=16,d=[Bv(d)]):y=8);a.children=d,a.shapeFlag|=y}function XE(...a){const d={};for(let y=0;y<a.length;y++){const A=a[y];for(const P in A)if(P==="class")d.class!==A.class&&(d.class=$p([d.class,A.class]));else if(P==="style")d.style=Hp([d.style,A.style]);else if(wu(P)){const L=d[P],F=A[P];F&&L!==F&&!(ci(L)&&L.includes(F))&&(d[P]=L?[].concat(L,F):F)}else P!==""&&(d[P]=A[P])}return d}function Cs(a,d,y,A=null){wo(a,d,7,[y,A])}const Pz=vE();let Rz=0;function YE(a,d,y){const A=a.type,P=(d?d.appContext:a.appContext)||Pz,L={uid:Rz++,vnode:a,type:A,parent:d,appContext:P,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new xv(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(P.provides),ids:d?d.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ME(A,P),emitsOptions:UE(A,P),emit:null,emitted:null,propsDefaults:ln,inheritAttrs:A.inheritAttrs,ctx:ln,data:ln,props:ln,attrs:ln,slots:ln,refs:ln,setupState:ln,setupContext:null,suspense:y,suspenseId:y?y.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return L.ctx={_:L},L.root=d?d.root:L,L.emit=mz.bind(null,L),a.ce&&a.ce(L),L}let Lr=null;const To=()=>Lr||Or;let yg,Zx;{const a=jg(),d=(y,A)=>{let P;return(P=a[y])||(P=a[y]=[]),P.push(A),L=>{P.length>1?P.forEach(F=>F(L)):P[0](L)}};yg=d("__VUE_INSTANCE_SETTERS__",y=>Lr=y),Zx=d("__VUE_SSR_SETTERS__",y=>Qh=y)}const vu=a=>{const d=Lr;return yg(a),a.scope.on(),()=>{a.scope.off(),yg(d)}},Wx=()=>{Lr&&Lr.scope.off(),yg(null)};function KE(a){return a.vnode.shapeFlag&4}let Qh=!1;function JE(a,d=!1,y=!1){d&&Zx(d);const{props:A,children:P}=a.vnode,L=KE(a);rz(a,A,L,d),lz(a,P,y);const F=L?Dz(a,d):void 0;return d&&Zx(!1),F}function Dz(a,d){const y=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,Ux);const{setup:A}=y;if(A){tc();const P=a.setupContext=A.length>1?tM(a):null,L=vu(a),F=ud(A,a,0,[a.props,P]),r=gv(F);if(ic(),L(),(r||a.sp)&&!Xl(a)&&Pv(a),r){if(F.then(Wx,Wx),d)return F.then(W=>{Xx(a,W,d)}).catch(W=>{Eu(W,a,0)});a.asyncDep=F}else Xx(a,F,d)}else eM(a,d)}function Xx(a,d,y){Li(d)?a.type.__ssrInlineRender?a.ssrRender=d:a.render=d:Cn(d)&&(a.setupState=Sv(d)),eM(a,y)}let xg,Yx;function QE(a){xg=a,Yx=d=>{d.render._rc&&(d.withProxy=new Proxy(d.ctx,kD))}}const zz=()=>!xg;function eM(a,d,y){const A=a.type;if(!a.render){if(!d&&xg&&!A.render){const P=A.template||Ov(a).template;if(P){const{isCustomElement:L,compilerOptions:F}=a.appContext.config,{delimiters:r,compilerOptions:W}=A,ne=cn(cn({isCustomElement:L,delimiters:r},F),W);A.render=xg(P,ne)}}a.render=A.render||Ur,Yx&&Yx(a)}{const P=vu(a);tc();try{YD(a)}finally{ic(),P()}}}const Lz={get(a,d){return ns(a,"get",""),a[d]}};function tM(a){const d=y=>{a.exposed=y||{}};return{attrs:new Proxy(a.attrs,Lz),slots:a.slots,emit:a.emit,expose:d}}function Yp(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(Sv(qS(a.exposed)),{get(d,y){if(y in d)return d[y];if(y in Tp)return Tp[y](a)},has(d,y){return y in d||y in Tp}})):a.proxy}function Kx(a,d=!0){return Li(a)?a.displayName||a.name:a.name||d&&a.__name}function Oz(a){return Li(a)&&"__vccOpts"in a}const iM=(a,d)=>Z3(a,d,Qh);function nM(a,d,y){const A=arguments.length;return A===2?Cn(d)&&!ci(d)?Ja(d)?$n(a,null,[d]):$n(a,d):$n(a,null,d):(A>3?y=Array.prototype.slice.call(arguments,2):A===3&&Ja(y)&&(y=[y]),$n(a,d,y))}function kz(){}function Fz(a,d,y,A){const P=y[A];if(P&&rM(P,a))return P;const L=d();return L.memo=a.slice(),L.cacheIndex=A,y[A]=L}function rM(a,d){const y=a.memo;if(y.length!=d.length)return!1;for(let A=0;A<y.length;A++)if(ys(y[A],d[A]))return!1;return xu>0&&os&&os.push(a),!0}const sM="3.5.13",Bz=Ur,Nz=iD,Vz=jh,Uz=eE,jz={createComponentInstance:YE,setupComponent:JE,renderComponentRoot:J_,setCurrentRenderingInstance:Lp,isVNode:Ja,normalizeVNode:Ps,getComponentPublicInstance:Yp,ensureValidVNode:Lv,pushWarningContext:J3,popWarningContext:Q3},Gz=jz,qz=null,Hz=null,$z=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Jx;const u2=typeof window<"u"&&window.trustedTypes;if(u2)try{Jx=u2.createPolicy("vue",{createHTML:a=>a})}catch{}const oM=Jx?a=>Jx.createHTML(a):a=>a,Zz="http://www.w3.org/2000/svg",Wz="http://www.w3.org/1998/Math/MathML",Ha=typeof document<"u"?document:null,h2=Ha&&Ha.createElement("template"),Xz={insert:(a,d,y)=>{d.insertBefore(a,y||null)},remove:a=>{const d=a.parentNode;d&&d.removeChild(a)},createElement:(a,d,y,A)=>{const P=d==="svg"?Ha.createElementNS(Zz,a):d==="mathml"?Ha.createElementNS(Wz,a):y?Ha.createElement(a,{is:y}):Ha.createElement(a);return a==="select"&&A&&A.multiple!=null&&P.setAttribute("multiple",A.multiple),P},createText:a=>Ha.createTextNode(a),createComment:a=>Ha.createComment(a),setText:(a,d)=>{a.nodeValue=d},setElementText:(a,d)=>{a.textContent=d},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Ha.querySelector(a),setScopeId(a,d){a.setAttribute(d,"")},insertStaticContent(a,d,y,A,P,L){const F=y?y.previousSibling:d.lastChild;if(P&&(P===L||P.nextSibling))for(;d.insertBefore(P.cloneNode(!0),y),!(P===L||!(P=P.nextSibling)););else{h2.innerHTML=oM(A==="svg"?`<svg>${a}</svg>`:A==="mathml"?`<math>${a}</math>`:a);const r=h2.content;if(A==="svg"||A==="mathml"){const W=r.firstChild;for(;W.firstChild;)r.appendChild(W.firstChild);r.removeChild(W)}d.insertBefore(r,y)}return[F?F.nextSibling:d.firstChild,y?y.previousSibling:d.lastChild]}},Nl="transition",fp="animation",ed=Symbol("_vtc"),aM={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},lM=cn({},Iv,aM),Yz=a=>(a.displayName="Transition",a.props=lM,a),Kz=Yz((a,{slots:d})=>nM(aE,cM(a),d)),lu=(a,d=[])=>{ci(a)?a.forEach(y=>y(...d)):a&&a(...d)},d2=a=>a?ci(a)?a.some(d=>d.length>1):a.length>1:!1;function cM(a){const d={};for(const vt in a)vt in aM||(d[vt]=a[vt]);if(a.css===!1)return d;const{name:y="v",type:A,duration:P,enterFromClass:L=`${y}-enter-from`,enterActiveClass:F=`${y}-enter-active`,enterToClass:r=`${y}-enter-to`,appearFromClass:W=L,appearActiveClass:ne=F,appearToClass:Q=r,leaveFromClass:ce=`${y}-leave-from`,leaveActiveClass:ze=`${y}-leave-active`,leaveToClass:je=`${y}-leave-to`}=a,Oe=Jz(P),Le=Oe&&Oe[0],ct=Oe&&Oe[1],{onBeforeEnter:st,onEnter:gt,onEnterCancelled:He,onLeave:Ve,onLeaveCancelled:at,onBeforeAppear:Pt=st,onAppear:dt=gt,onAppearCancelled:zt=He}=d,ut=(vt,Wt,vi,Ft)=>{vt._enterCancelled=Ft,Ul(vt,Wt?Q:r),Ul(vt,Wt?ne:F),vi&&vi()},Je=(vt,Wt)=>{vt._isLeaving=!1,Ul(vt,ce),Ul(vt,je),Ul(vt,ze),Wt&&Wt()},ht=vt=>(Wt,vi)=>{const Ft=vt?dt:gt,Qt=()=>ut(Wt,vt,vi);lu(Ft,[Wt,Qt]),f2(()=>{Ul(Wt,vt?W:L),fa(Wt,vt?Q:r),d2(Ft)||p2(Wt,A,Le,Qt)})};return cn(d,{onBeforeEnter(vt){lu(st,[vt]),fa(vt,L),fa(vt,F)},onBeforeAppear(vt){lu(Pt,[vt]),fa(vt,W),fa(vt,ne)},onEnter:ht(!1),onAppear:ht(!0),onLeave(vt,Wt){vt._isLeaving=!0;const vi=()=>Je(vt,Wt);fa(vt,ce),vt._enterCancelled?(fa(vt,ze),Qx()):(Qx(),fa(vt,ze)),f2(()=>{vt._isLeaving&&(Ul(vt,ce),fa(vt,je),d2(Ve)||p2(vt,A,ct,vi))}),lu(Ve,[vt,vi])},onEnterCancelled(vt){ut(vt,!1,void 0,!0),lu(He,[vt])},onAppearCancelled(vt){ut(vt,!0,void 0,!0),lu(zt,[vt])},onLeaveCancelled(vt){Je(vt),lu(at,[vt])}})}function Jz(a){if(a==null)return null;if(Cn(a))return[Tx(a.enter),Tx(a.leave)];{const d=Tx(a);return[d,d]}}function Tx(a){return cg(a)}function fa(a,d){d.split(/\s+/).forEach(y=>y&&a.classList.add(y)),(a[ed]||(a[ed]=new Set)).add(d)}function Ul(a,d){d.split(/\s+/).forEach(A=>A&&a.classList.remove(A));const y=a[ed];y&&(y.delete(d),y.size||(a[ed]=void 0))}function f2(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let Qz=0;function p2(a,d,y,A){const P=a._endId=++Qz,L=()=>{P===a._endId&&A()};if(y!=null)return setTimeout(L,y);const{type:F,timeout:r,propCount:W}=uM(a,d);if(!F)return A();const ne=F+"end";let Q=0;const ce=()=>{a.removeEventListener(ne,ze),L()},ze=je=>{je.target===a&&++Q>=W&&ce()};setTimeout(()=>{Q<W&&ce()},r+1),a.addEventListener(ne,ze)}function uM(a,d){const y=window.getComputedStyle(a),A=Oe=>(y[Oe]||"").split(", "),P=A(`${Nl}Delay`),L=A(`${Nl}Duration`),F=m2(P,L),r=A(`${fp}Delay`),W=A(`${fp}Duration`),ne=m2(r,W);let Q=null,ce=0,ze=0;d===Nl?F>0&&(Q=Nl,ce=F,ze=L.length):d===fp?ne>0&&(Q=fp,ce=ne,ze=W.length):(ce=Math.max(F,ne),Q=ce>0?F>ne?Nl:fp:null,ze=Q?Q===Nl?L.length:W.length:0);const je=Q===Nl&&/\b(transform|all)(,|$)/.test(A(`${Nl}Property`).toString());return{type:Q,timeout:ce,propCount:ze,hasTransform:je}}function m2(a,d){for(;a.length<d.length;)a=a.concat(a);return Math.max(...d.map((y,A)=>_2(y)+_2(a[A])))}function _2(a){return a==="auto"?0:Number(a.slice(0,-1).replace(",","."))*1e3}function Qx(){return document.body.offsetHeight}function eL(a,d,y){const A=a[ed];A&&(d=(d?[d,...A]:[...A]).join(" ")),d==null?a.removeAttribute("class"):y?a.setAttribute("class",d):a.className=d}const vg=Symbol("_vod"),hM=Symbol("_vsh"),dM={beforeMount(a,{value:d},{transition:y}){a[vg]=a.style.display==="none"?"":a.style.display,y&&d?y.beforeEnter(a):pp(a,d)},mounted(a,{value:d},{transition:y}){y&&d&&y.enter(a)},updated(a,{value:d,oldValue:y},{transition:A}){!d!=!y&&(A?d?(A.beforeEnter(a),pp(a,!0),A.enter(a)):A.leave(a,()=>{pp(a,!1)}):pp(a,d))},beforeUnmount(a,{value:d}){pp(a,d)}};function pp(a,d){a.style.display=d?a[vg]:"none",a[hM]=!d}function tL(){dM.getSSRProps=({value:a})=>{if(!a)return{style:{display:"none"}}}}const fM=Symbol("");function iL(a){const d=To();if(!d)return;const y=d.ut=(P=a(d.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${d.uid}"]`)).forEach(L=>bg(L,P))},A=()=>{const P=a(d.proxy);d.ce?bg(d.ce,P):ev(d.subTree,P),y(P)};Rv(()=>{Dp(A)}),Wp(()=>{Yh(A,Ur,{flush:"post"});const P=new MutationObserver(A);P.observe(d.subTree.el.parentNode,{childList:!0}),ny(()=>P.disconnect())})}function ev(a,d){if(a.shapeFlag&128){const y=a.suspense;a=y.activeBranch,y.pendingBranch&&!y.isHydrating&&y.effects.push(()=>{ev(y.activeBranch,d)})}for(;a.component;)a=a.component.subTree;if(a.shapeFlag&1&&a.el)bg(a.el,d);else if(a.type===wr)a.children.forEach(y=>ev(y,d));else if(a.type===mu){let{el:y,anchor:A}=a;for(;y&&(bg(y,d),y!==A);)y=y.nextSibling}}function bg(a,d){if(a.nodeType===1){const y=a.style;let A="";for(const P in d)y.setProperty(`--${P}`,d[P]),A+=`--${P}: ${d[P]};`;y[fM]=A}}const nL=/(^|;)\s*display\s*:/;function rL(a,d,y){const A=a.style,P=Wi(y);let L=!1;if(y&&!P){if(d)if(Wi(d))for(const F of d.split(";")){const r=F.slice(0,F.indexOf(":")).trim();y[r]==null&&eg(A,r,"")}else for(const F in d)y[F]==null&&eg(A,F,"");for(const F in y)F==="display"&&(L=!0),eg(A,F,y[F])}else if(P){if(d!==y){const F=A[fM];F&&(y+=";"+F),A.cssText=y,L=nL.test(y)}}else d&&a.removeAttribute("style");vg in a&&(a[vg]=L?A.display:"",a[hM]&&(A.display="none"))}const g2=/\s*!important$/;function eg(a,d,y){if(ci(y))y.forEach(A=>eg(a,d,A));else if(y==null&&(y=""),d.startsWith("--"))a.setProperty(d,y);else{const A=sL(a,d);g2.test(y)?a.setProperty(Rs(A),y.replace(g2,""),"important"):a[A]=y}}const y2=["Webkit","Moz","ms"],Sx={};function sL(a,d){const y=Sx[d];if(y)return y;let A=Zn(d);if(A!=="filter"&&A in a)return Sx[d]=A;A=Su(A);for(let P=0;P<y2.length;P++){const L=y2[P]+A;if(L in a)return Sx[d]=L}return d}const x2="http://www.w3.org/1999/xlink";function v2(a,d,y,A,P,L=h3(d)){A&&d.startsWith("xlink:")?y==null?a.removeAttributeNS(x2,d.slice(6,d.length)):a.setAttributeNS(x2,d,y):y==null||L&&!SS(y)?a.removeAttribute(d):a.setAttribute(d,L?"":Ls(y)?String(y):y)}function b2(a,d,y,A,P){if(d==="innerHTML"||d==="textContent"){y!=null&&(a[d]=d==="innerHTML"?oM(y):y);return}const L=a.tagName;if(d==="value"&&L!=="PROGRESS"&&!L.includes("-")){const r=L==="OPTION"?a.getAttribute("value")||"":a.value,W=y==null?a.type==="checkbox"?"on":"":String(y);(r!==W||!("_value"in a))&&(a.value=W),y==null&&a.removeAttribute(d),a._value=y;return}let F=!1;if(y===""||y==null){const r=typeof a[d];r==="boolean"?y=SS(y):y==null&&r==="string"?(y="",F=!0):r==="number"&&(y=0,F=!0)}try{a[d]=y}catch{}F&&a.removeAttribute(P||d)}function Wa(a,d,y,A){a.addEventListener(d,y,A)}function oL(a,d,y,A){a.removeEventListener(d,y,A)}const w2=Symbol("_vei");function aL(a,d,y,A,P=null){const L=a[w2]||(a[w2]={}),F=L[d];if(A&&F)F.value=A;else{const[r,W]=lL(d);if(A){const ne=L[d]=hL(A,P);Wa(a,r,ne,W)}else F&&(oL(a,r,F,W),L[d]=void 0)}}const T2=/(?:Once|Passive|Capture)$/;function lL(a){let d;if(T2.test(a)){d={};let A;for(;A=a.match(T2);)a=a.slice(0,a.length-A[0].length),d[A[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):Rs(a.slice(2)),d]}let Ex=0;const cL=Promise.resolve(),uL=()=>Ex||(cL.then(()=>Ex=0),Ex=Date.now());function hL(a,d){const y=A=>{if(!A._vts)A._vts=Date.now();else if(A._vts<=y.attached)return;wo(dL(A,y.value),d,5,[A])};return y.value=a,y.attached=uL(),y}function dL(a,d){if(ci(d)){const y=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{y.call(a),a._stopped=!0},d.map(A=>P=>!P._stopped&&A&&A(P))}else return d}const S2=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,fL=(a,d,y,A,P,L)=>{const F=P==="svg";d==="class"?eL(a,A,F):d==="style"?rL(a,y,A):wu(d)?mv(d)||aL(a,d,y,A,L):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):pL(a,d,A,F))?(b2(a,d,A),!a.tagName.includes("-")&&(d==="value"||d==="checked"||d==="selected")&&v2(a,d,A,F,L,d!=="value")):a._isVueCE&&(/[A-Z]/.test(d)||!Wi(A))?b2(a,Zn(d),A,L,d):(d==="true-value"?a._trueValue=A:d==="false-value"&&(a._falseValue=A),v2(a,d,A,F))};function pL(a,d,y,A){if(A)return!!(d==="innerHTML"||d==="textContent"||d in a&&S2(d)&&Li(y));if(d==="spellcheck"||d==="draggable"||d==="translate"||d==="form"||d==="list"&&a.tagName==="INPUT"||d==="type"&&a.tagName==="TEXTAREA")return!1;if(d==="width"||d==="height"){const P=a.tagName;if(P==="IMG"||P==="VIDEO"||P==="CANVAS"||P==="SOURCE")return!1}return S2(d)&&Wi(y)?!1:d in a}const E2={};/*! #__NO_SIDE_EFFECTS__ */function pM(a,d,y){const A=Cv(a,d);Vg(A)&&cn(A,d);class P extends oy{constructor(F){super(A,F,y)}}return P.def=A,P}/*! #__NO_SIDE_EFFECTS__ */const mL=(a,d)=>pM(a,d,MM),_L=typeof HTMLElement<"u"?HTMLElement:class{};class oy extends _L{constructor(d,y={},A=Sg){super(),this._def=d,this._props=y,this._createApp=A,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&A!==Sg?this._root=this.shadowRoot:d.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let d=this;for(;d=d&&(d.parentNode||d.host);)if(d instanceof oy){this._parent=d;break}this._instance||(this._resolved?(this._setParent(),this._update()):d&&d._pendingResolve?this._pendingResolve=d._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(d=this._parent){d&&(this._instance.parent=d._instance,this._instance.provides=d._instance.provides)}disconnectedCallback(){this._connected=!1,Kg(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let A=0;A<this.attributes.length;A++)this._setAttr(this.attributes[A].name);this._ob=new MutationObserver(A=>{for(const P of A)this._setAttr(P.attributeName)}),this._ob.observe(this,{attributes:!0});const d=(A,P=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:L,styles:F}=A;let r;if(L&&!ci(L))for(const W in L){const ne=L[W];(ne===Number||ne&&ne.type===Number)&&(W in this._props&&(this._props[W]=cg(this._props[W])),(r||(r=Object.create(null)))[Zn(W)]=!0)}this._numberProps=r,P&&this._resolveProps(A),this.shadowRoot&&this._applyStyles(F),this._mount(A)},y=this._def.__asyncLoader;y?this._pendingResolve=y().then(A=>d(this._def=A,!0)):d(this._def)}_mount(d){this._app=this._createApp(d),d.configureApp&&d.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const y=this._instance&&this._instance.exposed;if(y)for(const A in y)Tn(this,A)||Object.defineProperty(this,A,{get:()=>Yg(y[A])})}_resolveProps(d){const{props:y}=d,A=ci(y)?y:Object.keys(y||{});for(const P of Object.keys(this))P[0]!=="_"&&A.includes(P)&&this._setProp(P,this[P]);for(const P of A.map(Zn))Object.defineProperty(this,P,{get(){return this._getProp(P)},set(L){this._setProp(P,L,!0,!0)}})}_setAttr(d){if(d.startsWith("data-v-"))return;const y=this.hasAttribute(d);let A=y?this.getAttribute(d):E2;const P=Zn(d);y&&this._numberProps&&this._numberProps[P]&&(A=cg(A)),this._setProp(P,A,!1,!0)}_getProp(d){return this._props[d]}_setProp(d,y,A=!0,P=!1){if(y!==this._props[d]&&(y===E2?delete this._props[d]:(this._props[d]=y,d==="key"&&this._app&&(this._app._ceVNode.key=y)),P&&this._instance&&this._update(),A)){const L=this._ob;L&&L.disconnect(),y===!0?this.setAttribute(Rs(d),""):typeof y=="string"||typeof y=="number"?this.setAttribute(Rs(d),y+""):y||this.removeAttribute(Rs(d)),L&&L.observe(this,{attributes:!0})}}_update(){EM(this._createVNode(),this._root)}_createVNode(){const d={};this.shadowRoot||(d.onVnodeMounted=d.onVnodeUpdated=this._renderSlots.bind(this));const y=$n(this._def,cn(d,this._props));return this._instance||(y.ce=A=>{this._instance=A,A.ce=this,A.isCE=!0;const P=(L,F)=>{this.dispatchEvent(new CustomEvent(L,Vg(F[0])?cn({detail:F},F[0]):{detail:F}))};A.emit=(L,...F)=>{P(L,F),Rs(L)!==L&&P(Rs(L),F)},this._setParent()}),y}_applyStyles(d,y){if(!d)return;if(y){if(y===this._def||this._styleChildren.has(y))return;this._styleChildren.add(y)}const A=this._nonce;for(let P=d.length-1;P>=0;P--){const L=document.createElement("style");A&&L.setAttribute("nonce",A),L.textContent=d[P],this.shadowRoot.prepend(L)}}_parseSlots(){const d=this._slots={};let y;for(;y=this.firstChild;){const A=y.nodeType===1&&y.getAttribute("slot")||"default";(d[A]||(d[A]=[])).push(y),this.removeChild(y)}}_renderSlots(){const d=(this._teleportTarget||this).querySelectorAll("slot"),y=this._instance.type.__scopeId;for(let A=0;A<d.length;A++){const P=d[A],L=P.getAttribute("name")||"default",F=this._slots[L],r=P.parentNode;if(F)for(const W of F){if(y&&W.nodeType===1){const ne=y+"-s",Q=document.createTreeWalker(W,1);W.setAttribute(ne,"");let ce;for(;ce=Q.nextNode();)ce.setAttribute(ne,"")}r.insertBefore(W,P)}else for(;P.firstChild;)r.insertBefore(P.firstChild,P);r.removeChild(P)}}_injectChildStyle(d){this._applyStyles(d.styles,d)}_removeChildStyle(d){}}function mM(a){const d=To(),y=d&&d.ce;return y||null}function gL(){const a=mM();return a&&a.shadowRoot}function yL(a="$style"){{const d=To();if(!d)return ln;const y=d.type.__cssModules;if(!y)return ln;const A=y[a];return A||ln}}const _M=new WeakMap,gM=new WeakMap,wg=Symbol("_moveCb"),M2=Symbol("_enterCb"),xL=a=>(delete a.props.mode,a),vL=xL({name:"TransitionGroup",props:cn({},lM,{tag:String,moveClass:String}),setup(a,{slots:d}){const y=To(),A=Av();let P,L;return ty(()=>{if(!P.length)return;const F=a.moveClass||`${a.name||"v"}-move`;if(!EL(P[0].el,y.vnode.el,F))return;P.forEach(wL),P.forEach(TL);const r=P.filter(SL);Qx(),r.forEach(W=>{const ne=W.el,Q=ne.style;fa(ne,F),Q.transform=Q.webkitTransform=Q.transitionDuration="";const ce=ne[wg]=ze=>{ze&&ze.target!==ne||(!ze||/transform$/.test(ze.propertyName))&&(ne.removeEventListener("transitionend",ce),ne[wg]=null,Ul(ne,F))};ne.addEventListener("transitionend",ce)})}),()=>{const F=gn(a),r=cM(F);let W=F.tag||wr;if(P=[],L)for(let ne=0;ne<L.length;ne++){const Q=L[ne];Q.el&&Q.el instanceof Element&&(P.push(Q),Ka(Q,Jh(Q,r,A,y)),_M.set(Q,Q.el.getBoundingClientRect()))}L=d.default?Qg(d.default()):[];for(let ne=0;ne<L.length;ne++){const Q=L[ne];Q.key!=null&&Ka(Q,Jh(Q,r,A,y))}return $n(W,null,L)}}}),bL=vL;function wL(a){const d=a.el;d[wg]&&d[wg](),d[M2]&&d[M2]()}function TL(a){gM.set(a,a.el.getBoundingClientRect())}function SL(a){const d=_M.get(a),y=gM.get(a),A=d.left-y.left,P=d.top-y.top;if(A||P){const L=a.el.style;return L.transform=L.webkitTransform=`translate(${A}px,${P}px)`,L.transitionDuration="0s",a}}function EL(a,d,y){const A=a.cloneNode(),P=a[ed];P&&P.forEach(r=>{r.split(/\s+/).forEach(W=>W&&A.classList.remove(W))}),y.split(/\s+/).forEach(r=>r&&A.classList.add(r)),A.style.display="none";const L=d.nodeType===1?d:d.parentNode;L.appendChild(A);const{hasTransform:F}=uM(A);return L.removeChild(A),F}const ec=a=>{const d=a.props["onUpdate:modelValue"]||!1;return ci(d)?y=>Wh(d,y):d};function ML(a){a.target.composing=!0}function A2(a){const d=a.target;d.composing&&(d.composing=!1,d.dispatchEvent(new Event("input")))}const bo=Symbol("_assign"),td={created(a,{modifiers:{lazy:d,trim:y,number:A}},P){a[bo]=ec(P);const L=A||P.props&&P.props.type==="number";Wa(a,d?"change":"input",F=>{if(F.target.composing)return;let r=a.value;y&&(r=r.trim()),L&&(r=lg(r)),a[bo](r)}),y&&Wa(a,"change",()=>{a.value=a.value.trim()}),d||(Wa(a,"compositionstart",ML),Wa(a,"compositionend",A2),Wa(a,"change",A2))},mounted(a,{value:d}){a.value=d??""},beforeUpdate(a,{value:d,oldValue:y,modifiers:{lazy:A,trim:P,number:L}},F){if(a[bo]=ec(F),a.composing)return;const r=(L||a.type==="number")&&!/^0\d/.test(a.value)?lg(a.value):a.value,W=d??"";r!==W&&(document.activeElement===a&&a.type!=="range"&&(A&&d===y||P&&a.value.trim()===W)||(a.value=W))}},Vv={deep:!0,created(a,d,y){a[bo]=ec(y),Wa(a,"change",()=>{const A=a._modelValue,P=id(a),L=a.checked,F=a[bo];if(ci(A)){const r=Gg(A,P),W=r!==-1;if(L&&!W)F(A.concat(P));else if(!L&&W){const ne=[...A];ne.splice(r,1),F(ne)}}else if(Tu(A)){const r=new Set(A);L?r.add(P):r.delete(P),F(r)}else F(yM(a,L))})},mounted:I2,beforeUpdate(a,d,y){a[bo]=ec(y),I2(a,d,y)}};function I2(a,{value:d,oldValue:y},A){a._modelValue=d;let P;if(ci(d))P=Gg(d,A.props.value)>-1;else if(Tu(d))P=d.has(A.props.value);else{if(d===y)return;P=Jl(d,yM(a,!0))}a.checked!==P&&(a.checked=P)}const Uv={created(a,{value:d},y){a.checked=Jl(d,y.props.value),a[bo]=ec(y),Wa(a,"change",()=>{a[bo](id(a))})},beforeUpdate(a,{value:d,oldValue:y},A){a[bo]=ec(A),d!==y&&(a.checked=Jl(d,A.props.value))}},Tg={deep:!0,created(a,{value:d,modifiers:{number:y}},A){const P=Tu(d);Wa(a,"change",()=>{const L=Array.prototype.filter.call(a.options,F=>F.selected).map(F=>y?lg(id(F)):id(F));a[bo](a.multiple?P?new Set(L):L:L[0]),a._assigning=!0,Kg(()=>{a._assigning=!1})}),a[bo]=ec(A)},mounted(a,{value:d}){C2(a,d)},beforeUpdate(a,d,y){a[bo]=ec(y)},updated(a,{value:d}){a._assigning||C2(a,d)}};function C2(a,d){const y=a.multiple,A=ci(d);if(!(y&&!A&&!Tu(d))){for(let P=0,L=a.options.length;P<L;P++){const F=a.options[P],r=id(F);if(y)if(A){const W=typeof r;W==="string"||W==="number"?F.selected=d.some(ne=>String(ne)===String(r)):F.selected=Gg(d,r)>-1}else F.selected=d.has(r);else if(Jl(id(F),d)){a.selectedIndex!==P&&(a.selectedIndex=P);return}}!y&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function id(a){return"_value"in a?a._value:a.value}function yM(a,d){const y=d?"_trueValue":"_falseValue";return y in a?a[y]:d}const xM={created(a,d,y){G_(a,d,y,null,"created")},mounted(a,d,y){G_(a,d,y,null,"mounted")},beforeUpdate(a,d,y,A){G_(a,d,y,A,"beforeUpdate")},updated(a,d,y,A){G_(a,d,y,A,"updated")}};function vM(a,d){switch(a){case"SELECT":return Tg;case"TEXTAREA":return td;default:switch(d){case"checkbox":return Vv;case"radio":return Uv;default:return td}}}function G_(a,d,y,A,P){const F=vM(a.tagName,y.props&&y.props.type)[P];F&&F(a,d,y,A)}function AL(){td.getSSRProps=({value:a})=>({value:a}),Uv.getSSRProps=({value:a},d)=>{if(d.props&&Jl(d.props.value,a))return{checked:!0}},Vv.getSSRProps=({value:a},d)=>{if(ci(a)){if(d.props&&Gg(a,d.props.value)>-1)return{checked:!0}}else if(Tu(a)){if(d.props&&a.has(d.props.value))return{checked:!0}}else if(a)return{checked:!0}},xM.getSSRProps=(a,d)=>{if(typeof d.type!="string")return;const y=vM(d.type.toUpperCase(),d.props&&d.props.type);if(y.getSSRProps)return y.getSSRProps(a,d)}}const IL=["ctrl","shift","alt","meta"],CL={stop:a=>a.stopPropagation(),prevent:a=>a.preventDefault(),self:a=>a.target!==a.currentTarget,ctrl:a=>!a.ctrlKey,shift:a=>!a.shiftKey,alt:a=>!a.altKey,meta:a=>!a.metaKey,left:a=>"button"in a&&a.button!==0,middle:a=>"button"in a&&a.button!==1,right:a=>"button"in a&&a.button!==2,exact:(a,d)=>IL.some(y=>a[`${y}Key`]&&!d.includes(y))},bM=(a,d)=>{const y=a._withMods||(a._withMods={}),A=d.join(".");return y[A]||(y[A]=(P,...L)=>{for(let F=0;F<d.length;F++){const r=CL[d[F]];if(r&&r(P,d))return}return a(P,...L)})},PL={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},RL=(a,d)=>{const y=a._withKeys||(a._withKeys={}),A=d.join(".");return y[A]||(y[A]=P=>{if(!("key"in P))return;const L=Rs(P.key);if(d.some(F=>F===L||PL[F]===L))return a(P)})},wM=cn({patchProp:fL},Xz);let Mp,P2=!1;function TM(){return Mp||(Mp=RE(wM))}function SM(){return Mp=P2?Mp:DE(wM),P2=!0,Mp}const EM=(...a)=>{TM().render(...a)},DL=(...a)=>{SM().hydrate(...a)},Sg=(...a)=>{const d=TM().createApp(...a),{mount:y}=d;return d.mount=A=>{const P=IM(A);if(!P)return;const L=d._component;!Li(L)&&!L.render&&!L.template&&(L.template=P.innerHTML),P.nodeType===1&&(P.textContent="");const F=y(P,!1,AM(P));return P instanceof Element&&(P.removeAttribute("v-cloak"),P.setAttribute("data-v-app","")),F},d},MM=(...a)=>{const d=SM().createApp(...a),{mount:y}=d;return d.mount=A=>{const P=IM(A);if(P)return y(P,!0,AM(P))},d};function AM(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function IM(a){return Wi(a)?document.querySelector(a):a}let R2=!1;const zL=()=>{R2||(R2=!0,AL(),tL())},LL=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:aE,BaseTransitionPropsValidators:Iv,Comment:Tr,DeprecationTypes:$z,EffectScope:xv,ErrorCodes:tD,ErrorTypeStrings:Nz,Fragment:wr,KeepAlive:AD,ReactiveEffect:Cp,Static:mu,Suspense:bz,Teleport:cD,Text:Yl,TrackOpTypes:W3,Transition:Kz,TransitionGroup:bL,TriggerOpTypes:X3,VueElement:oy,assertNumber:eD,callWithAsyncErrorHandling:wo,callWithErrorHandling:ud,camelize:Zn,capitalize:Su,cloneVNode:ga,compatUtils:Hz,computed:iM,createApp:Sg,createBlock:gg,createCommentVNode:WE,createElementBlock:_a,createElementVNode:yn,createHydrationRenderer:DE,createPropsRestProxy:WD,createRenderer:RE,createSSRApp:MM,createSlots:zD,createStaticVNode:Cz,createTextVNode:Bv,createVNode:$n,customRef:ZS,defineAsyncComponent:ED,defineComponent:Cv,defineCustomElement:pM,defineEmits:BD,defineExpose:ND,defineModel:jD,defineOptions:VD,defineProps:FD,defineSSRCustomElement:mL,defineSlots:UD,devtools:Vz,effect:_3,effectScope:f3,getCurrentInstance:To,getCurrentScope:AS,getCurrentWatcher:Y3,getTransitionRawChildren:Qg,guardReactiveProps:ZE,h:nM,handleError:Eu,hasInjectionContext:nz,hydrate:DL,hydrateOnIdle:xD,hydrateOnInteraction:TD,hydrateOnMediaQuery:wD,hydrateOnVisible:bD,initCustomFormatter:kz,initDirectivesForSSR:zL,inject:Sp,isMemoSame:rM,isProxy:Xg,isReactive:Wl,isReadonly:Ql,isRef:kr,isRuntimeOnly:zz,isShallow:Ws,isVNode:Ja,markRaw:qS,mergeDefaults:$D,mergeModels:ZD,mergeProps:XE,nextTick:Kg,normalizeClass:$p,normalizeProps:t3,normalizeStyle:Hp,onActivated:cE,onBeforeMount:dE,onBeforeUnmount:iy,onBeforeUpdate:Rv,onDeactivated:uE,onErrorCaptured:_E,onMounted:Wp,onRenderTracked:mE,onRenderTriggered:pE,onScopeDispose:p3,onServerPrefetch:fE,onUnmounted:ny,onUpdated:ty,onWatcherCleanup:XS,openBlock:Ds,popScopeId:oD,provide:bE,proxyRefs:Sv,pushScopeId:sD,queuePostFlushCb:Dp,reactive:Zg,readonly:Tv,ref:bp,registerRuntimeCompiler:QE,render:EM,renderList:Nx,renderSlot:LD,resolveComponent:PD,resolveDirective:DD,resolveDynamicComponent:RD,resolveFilter:qz,resolveTransitionHooks:Jh,setBlockTracking:$x,setDevtoolsHook:Uz,setTransitionHooks:Ka,shallowReactive:GS,shallowReadonly:k3,shallowRef:HS,ssrContextKey:kE,ssrUtils:Gz,stop:g3,toDisplayString:Gh,toHandlerKey:Zh,toHandlers:OD,toRaw:gn,toRef:H3,toRefs:j3,toValue:N3,transformVNodeArgs:Az,triggerRef:B3,unref:Yg,useAttrs:HD,useCssModule:yL,useCssVars:iL,useHost:mM,useId:hD,useModel:pz,useSSRContext:FE,useShadowRoot:gL,useSlots:qD,useTemplateRef:dD,useTransitionState:Av,vModelCheckbox:Vv,vModelDynamic:xM,vModelRadio:Uv,vModelSelect:Tg,vModelText:td,vShow:dM,version:sM,warn:Bz,watch:Yh,watchEffect:hz,watchPostEffect:dz,watchSyncEffect:BE,withAsyncContext:XD,withCtx:Mv,withDefaults:GD,withDirectives:_p,withKeys:RL,withMemo:Fz,withModifiers:bM,withScopeId:aD},Symbol.toStringTag,{value:"Module"}));/**
* @vue/compiler-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Bp=Symbol(""),Ap=Symbol(""),jv=Symbol(""),Eg=Symbol(""),CM=Symbol(""),bu=Symbol(""),PM=Symbol(""),RM=Symbol(""),Gv=Symbol(""),qv=Symbol(""),Kp=Symbol(""),Hv=Symbol(""),DM=Symbol(""),$v=Symbol(""),Zv=Symbol(""),Wv=Symbol(""),Xv=Symbol(""),Yv=Symbol(""),Kv=Symbol(""),zM=Symbol(""),LM=Symbol(""),ay=Symbol(""),Mg=Symbol(""),Jv=Symbol(""),Qv=Symbol(""),Np=Symbol(""),Jp=Symbol(""),e1=Symbol(""),tv=Symbol(""),OL=Symbol(""),iv=Symbol(""),Ag=Symbol(""),kL=Symbol(""),FL=Symbol(""),t1=Symbol(""),BL=Symbol(""),NL=Symbol(""),i1=Symbol(""),OM=Symbol(""),nd={[Bp]:"Fragment",[Ap]:"Teleport",[jv]:"Suspense",[Eg]:"KeepAlive",[CM]:"BaseTransition",[bu]:"openBlock",[PM]:"createBlock",[RM]:"createElementBlock",[Gv]:"createVNode",[qv]:"createElementVNode",[Kp]:"createCommentVNode",[Hv]:"createTextVNode",[DM]:"createStaticVNode",[$v]:"resolveComponent",[Zv]:"resolveDynamicComponent",[Wv]:"resolveDirective",[Xv]:"resolveFilter",[Yv]:"withDirectives",[Kv]:"renderList",[zM]:"renderSlot",[LM]:"createSlots",[ay]:"toDisplayString",[Mg]:"mergeProps",[Jv]:"normalizeClass",[Qv]:"normalizeStyle",[Np]:"normalizeProps",[Jp]:"guardReactiveProps",[e1]:"toHandlers",[tv]:"camelize",[OL]:"capitalize",[iv]:"toHandlerKey",[Ag]:"setBlockTracking",[kL]:"pushScopeId",[FL]:"popScopeId",[t1]:"withCtx",[BL]:"unref",[NL]:"isRef",[i1]:"withMemo",[OM]:"isMemoSame"};function VL(a){Object.getOwnPropertySymbols(a).forEach(d=>{nd[d]=a[d]})}const Ys={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function UL(a,d=""){return{type:0,source:d,children:a,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:Ys}}function Vp(a,d,y,A,P,L,F,r=!1,W=!1,ne=!1,Q=Ys){return a&&(r?(a.helper(bu),a.helper(od(a.inSSR,ne))):a.helper(sd(a.inSSR,ne)),F&&a.helper(Yv)),{type:13,tag:d,props:y,children:A,patchFlag:P,dynamicProps:L,directives:F,isBlock:r,disableTracking:W,isComponent:ne,loc:Q}}function _u(a,d=Ys){return{type:17,loc:d,elements:a}}function vo(a,d=Ys){return{type:15,loc:d,properties:a}}function pr(a,d){return{type:16,loc:Ys,key:Wi(a)?en(a,!0):a,value:d}}function en(a,d=!1,y=Ys,A=0){return{type:4,loc:y,content:a,isStatic:d,constType:d?3:A}}function Zo(a,d=Ys){return{type:8,loc:d,children:a}}function zr(a,d=[],y=Ys){return{type:14,loc:y,callee:a,arguments:d}}function rd(a,d=void 0,y=!1,A=!1,P=Ys){return{type:18,params:a,returns:d,newline:y,isSlot:A,loc:P}}function nv(a,d,y,A=!0){return{type:19,test:a,consequent:d,alternate:y,newline:A,loc:Ys}}function jL(a,d,y=!1,A=!1){return{type:20,index:a,value:d,needPauseTracking:y,inVOnce:A,needArraySpread:!1,loc:Ys}}function GL(a){return{type:21,body:a,loc:Ys}}function sd(a,d){return a||d?Gv:qv}function od(a,d){return a||d?PM:RM}function n1(a,{helper:d,removeHelper:y,inSSR:A}){a.isBlock||(a.isBlock=!0,y(sd(A,a.isComponent)),d(bu),d(od(A,a.isComponent)))}const D2=new Uint8Array([123,123]),z2=new Uint8Array([125,125]);function L2(a){return a>=97&&a<=122||a>=65&&a<=90}function Hs(a){return a===32||a===10||a===9||a===12||a===13}function Vl(a){return a===47||a===62||Hs(a)}function Ig(a){const d=new Uint8Array(a.length);for(let y=0;y<a.length;y++)d[y]=a.charCodeAt(y);return d}const es={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class qL{constructor(d,y){this.stack=d,this.cbs=y,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=D2,this.delimiterClose=z2,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return this.mode===2&&this.stack.length===0}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=D2,this.delimiterClose=z2}getPos(d){let y=1,A=d+1;for(let P=this.newlines.length-1;P>=0;P--){const L=this.newlines[P];if(d>L){y=P+2,A=d-L;break}}return{column:A,line:y,offset:d}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(d){d===60?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):!this.inVPre&&d===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(d))}stateInterpolationOpen(d){if(d===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const y=this.index+1-this.delimiterOpen.length;y>this.sectionStart&&this.cbs.ontext(this.sectionStart,y),this.state=3,this.sectionStart=y}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(d)):(this.state=1,this.stateText(d))}stateInterpolation(d){d===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(d))}stateInterpolationClose(d){d===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(d))}stateSpecialStartSequence(d){const y=this.sequenceIndex===this.currentSequence.length;if(!(y?Vl(d):(d|32)===this.currentSequence[this.sequenceIndex]))this.inRCDATA=!1;else if(!y){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=6,this.stateInTagName(d)}stateInRCDATA(d){if(this.sequenceIndex===this.currentSequence.length){if(d===62||Hs(d)){const y=this.index-this.currentSequence.length;if(this.sectionStart<y){const A=this.index;this.index=y,this.cbs.ontext(this.sectionStart,y),this.index=A}this.sectionStart=y+2,this.stateInClosingTagName(d),this.inRCDATA=!1;return}this.sequenceIndex=0}(d|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===es.TitleEnd||this.currentSequence===es.TextareaEnd&&!this.inSFCRoot?!this.inVPre&&d===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(d)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=+(d===60)}stateCDATASequence(d){d===es.Cdata[this.sequenceIndex]?++this.sequenceIndex===es.Cdata.length&&(this.state=28,this.currentSequence=es.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(d))}fastForwardTo(d){for(;++this.index<this.buffer.length;){const y=this.buffer.charCodeAt(this.index);if(y===10&&this.newlines.push(this.index),y===d)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(d){d===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===es.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):d!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(d,y){this.enterRCDATA(d,y),this.state=31}enterRCDATA(d,y){this.inRCDATA=!0,this.currentSequence=d,this.sequenceIndex=y}stateBeforeTagName(d){d===33?(this.state=22,this.sectionStart=this.index+1):d===63?(this.state=24,this.sectionStart=this.index+1):L2(d)?(this.sectionStart=this.index,this.mode===0?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:d===116?this.state=30:this.state=d===115?29:6):d===47?this.state=8:(this.state=1,this.stateText(d))}stateInTagName(d){Vl(d)&&this.handleTagName(d)}stateInSFCRootTagName(d){if(Vl(d)){const y=this.buffer.slice(this.sectionStart,this.index);y!=="template"&&this.enterRCDATA(Ig("</"+y),0),this.handleTagName(d)}}handleTagName(d){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(d)}stateBeforeClosingTagName(d){Hs(d)||(d===62?(this.state=1,this.sectionStart=this.index+1):(this.state=L2(d)?9:27,this.sectionStart=this.index))}stateInClosingTagName(d){(d===62||Hs(d))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(d))}stateAfterClosingTagName(d){d===62&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(d){d===62?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):d===47?this.state=7:d===60&&this.peek()===47?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):Hs(d)||this.handleAttrStart(d)}handleAttrStart(d){d===118&&this.peek()===45?(this.state=13,this.sectionStart=this.index):d===46||d===58||d===64||d===35?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(d){d===62?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):Hs(d)||(this.state=11,this.stateBeforeAttrName(d))}stateInAttrName(d){(d===61||Vl(d))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(d))}stateInDirName(d){d===61||Vl(d)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(d)):d===58?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):d===46&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(d){d===61||Vl(d)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(d)):d===91?this.state=15:d===46&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(d){d===93?this.state=14:(d===61||Vl(d))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(d))}stateInDirModifier(d){d===61||Vl(d)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(d)):d===46&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(d){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(d)}stateAfterAttrName(d){d===61?this.state=18:d===47||d===62?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(d)):Hs(d)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(d))}stateBeforeAttrValue(d){d===34?(this.state=19,this.sectionStart=this.index+1):d===39?(this.state=20,this.sectionStart=this.index+1):Hs(d)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(d))}handleInAttrValue(d,y){(d===y||this.fastForwardTo(y))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(y===34?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(d){this.handleInAttrValue(d,34)}stateInAttrValueSingleQuotes(d){this.handleInAttrValue(d,39)}stateInAttrValueNoQuotes(d){Hs(d)||d===62?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(d)):(d===39||d===60||d===61||d===96)&&this.cbs.onerr(18,this.index)}stateBeforeDeclaration(d){d===91?(this.state=26,this.sequenceIndex=0):this.state=d===45?25:23}stateInDeclaration(d){(d===62||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(d){(d===62||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(d){d===45?(this.state=28,this.currentSequence=es.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(d){(d===62||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(d){d===es.ScriptEnd[3]?this.startSpecial(es.ScriptEnd,4):d===es.StyleEnd[3]?this.startSpecial(es.StyleEnd,4):(this.state=6,this.stateInTagName(d))}stateBeforeSpecialT(d){d===es.TitleEnd[3]?this.startSpecial(es.TitleEnd,4):d===es.TextareaEnd[3]?this.startSpecial(es.TextareaEnd,4):(this.state=6,this.stateInTagName(d))}startEntity(){}stateInEntity(){}parse(d){for(this.buffer=d;this.index<this.buffer.length;){const y=this.buffer.charCodeAt(this.index);switch(y===10&&this.newlines.push(this.index),this.state){case 1:{this.stateText(y);break}case 2:{this.stateInterpolationOpen(y);break}case 3:{this.stateInterpolation(y);break}case 4:{this.stateInterpolationClose(y);break}case 31:{this.stateSpecialStartSequence(y);break}case 32:{this.stateInRCDATA(y);break}case 26:{this.stateCDATASequence(y);break}case 19:{this.stateInAttrValueDoubleQuotes(y);break}case 12:{this.stateInAttrName(y);break}case 13:{this.stateInDirName(y);break}case 14:{this.stateInDirArg(y);break}case 15:{this.stateInDynamicDirArg(y);break}case 16:{this.stateInDirModifier(y);break}case 28:{this.stateInCommentLike(y);break}case 27:{this.stateInSpecialComment(y);break}case 11:{this.stateBeforeAttrName(y);break}case 6:{this.stateInTagName(y);break}case 34:{this.stateInSFCRootTagName(y);break}case 9:{this.stateInClosingTagName(y);break}case 5:{this.stateBeforeTagName(y);break}case 17:{this.stateAfterAttrName(y);break}case 20:{this.stateInAttrValueSingleQuotes(y);break}case 18:{this.stateBeforeAttrValue(y);break}case 8:{this.stateBeforeClosingTagName(y);break}case 10:{this.stateAfterClosingTagName(y);break}case 29:{this.stateBeforeSpecialS(y);break}case 30:{this.stateBeforeSpecialT(y);break}case 21:{this.stateInAttrValueNoQuotes(y);break}case 7:{this.stateInSelfClosingTag(y);break}case 23:{this.stateInDeclaration(y);break}case 22:{this.stateBeforeDeclaration(y);break}case 25:{this.stateBeforeComment(y);break}case 24:{this.stateInProcessingInstruction(y);break}case 33:{this.stateInEntity();break}}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(this.state===1||this.state===32&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===19||this.state===20||this.state===21)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const d=this.buffer.length;this.sectionStart>=d||(this.state===28?this.currentSequence===es.CdataEnd?this.cbs.oncdata(this.sectionStart,d):this.cbs.oncomment(this.sectionStart,d):this.state===6||this.state===11||this.state===18||this.state===17||this.state===12||this.state===13||this.state===14||this.state===15||this.state===16||this.state===20||this.state===19||this.state===21||this.state===9||this.cbs.ontext(this.sectionStart,d))}emitCodePoint(d,y){}}function O2(a,{compatConfig:d}){const y=d&&d[a];return a==="MODE"?y||3:y}function gu(a,d){const y=O2("MODE",d),A=O2(a,d);return y===3?A===!0:A!==!1}function Up(a,d,y,...A){return gu(a,d)}function r1(a){throw a}function kM(a){}function Jn(a,d,y,A){const P=`https://vuejs.org/error-reference/#compiler-${a}`,L=new SyntaxError(String(P));return L.code=a,L.loc=d,L}const zs=a=>a.type===4&&a.isStatic;function FM(a){switch(a){case"Teleport":case"teleport":return Ap;case"Suspense":case"suspense":return jv;case"KeepAlive":case"keep-alive":return Eg;case"BaseTransition":case"base-transition":return CM}}const HL=/^\d|[^\$\w\xA0-\uFFFF]/,s1=a=>!HL.test(a),$L=/[A-Za-z_$\xA0-\uFFFF]/,ZL=/[\.\?\w$\xA0-\uFFFF]/,WL=/\s+[.[]\s*|\s*[.[]\s+/g,BM=a=>a.type===4?a.content:a.loc.source,XL=a=>{const d=BM(a).trim().replace(WL,r=>r.trim());let y=0,A=[],P=0,L=0,F=null;for(let r=0;r<d.length;r++){const W=d.charAt(r);switch(y){case 0:if(W==="[")A.push(y),y=1,P++;else if(W==="(")A.push(y),y=2,L++;else if(!(r===0?$L:ZL).test(W))return!1;break;case 1:W==="'"||W==='"'||W==="`"?(A.push(y),y=3,F=W):W==="["?P++:W==="]"&&(--P||(y=A.pop()));break;case 2:if(W==="'"||W==='"'||W==="`")A.push(y),y=3,F=W;else if(W==="(")L++;else if(W===")"){if(r===d.length-1)return!1;--L||(y=A.pop())}break;case 3:W===F&&(y=A.pop(),F=null);break}}return!P&&!L},NM=XL,YL=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,KL=a=>YL.test(BM(a)),JL=KL;function xo(a,d,y=!1){for(let A=0;A<a.props.length;A++){const P=a.props[A];if(P.type===7&&(y||P.exp)&&(Wi(d)?P.name===d:d.test(P.name)))return P}}function ly(a,d,y=!1,A=!1){for(let P=0;P<a.props.length;P++){const L=a.props[P];if(L.type===6){if(y)continue;if(L.name===d&&(L.value||A))return L}else if(L.name==="bind"&&(L.exp||A)&&hu(L.arg,d))return L}}function hu(a,d){return!!(a&&zs(a)&&a.content===d)}function QL(a){return a.props.some(d=>d.type===7&&d.name==="bind"&&(!d.arg||d.arg.type!==4||!d.arg.isStatic))}function Mx(a){return a.type===5||a.type===2}function eO(a){return a.type===7&&a.name==="slot"}function Cg(a){return a.type===1&&a.tagType===3}function Pg(a){return a.type===1&&a.tagType===2}const tO=new Set([Np,Jp]);function VM(a,d=[]){if(a&&!Wi(a)&&a.type===14){const y=a.callee;if(!Wi(y)&&tO.has(y))return VM(a.arguments[0],d.concat(a))}return[a,d]}function Rg(a,d,y){let A,P=a.type===13?a.props:a.arguments[2],L=[],F;if(P&&!Wi(P)&&P.type===14){const r=VM(P);P=r[0],L=r[1],F=L[L.length-1]}if(P==null||Wi(P))A=vo([d]);else if(P.type===14){const r=P.arguments[0];!Wi(r)&&r.type===15?k2(d,r)||r.properties.unshift(d):P.callee===e1?A=zr(y.helper(Mg),[vo([d]),P]):P.arguments.unshift(vo([d])),!A&&(A=P)}else P.type===15?(k2(d,P)||P.properties.unshift(d),A=P):(A=zr(y.helper(Mg),[vo([d]),P]),F&&F.callee===Jp&&(F=L[L.length-2]));a.type===13?F?F.arguments[0]=A:a.props=A:F?F.arguments[0]=A:a.arguments[2]=A}function k2(a,d){let y=!1;if(a.key.type===4){const A=a.key.content;y=d.properties.some(P=>P.key.type===4&&P.key.content===A)}return y}function jp(a,d){return`_${d}_${a.replace(/[^\w]/g,(y,A)=>y==="-"?"_":a.charCodeAt(A).toString())}`}function iO(a){return a.type===14&&a.callee===i1?a.arguments[1].returns:a}const nO=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,UM={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:mp,isPreTag:mp,isIgnoreNewlineTag:mp,isCustomElement:mp,onError:r1,onWarn:kM,comments:!1,prefixIdentifiers:!1};let Sn=UM,Gp=null,Ya="",is=null,_n=null,Is="",qa=-1,cu=-1,o1=0,$l=!1,rv=null;const Kn=[],or=new qL(Kn,{onerr:Ga,ontext(a,d){q_($r(a,d),a,d)},ontextentity(a,d,y){q_(a,d,y)},oninterpolation(a,d){if($l)return q_($r(a,d),a,d);let y=a+or.delimiterOpen.length,A=d-or.delimiterClose.length;for(;Hs(Ya.charCodeAt(y));)y++;for(;Hs(Ya.charCodeAt(A-1));)A--;let P=$r(y,A);P.includes("&")&&(P=Sn.decodeEntities(P,!1)),sv({type:5,content:ig(P,!1,fr(y,A)),loc:fr(a,d)})},onopentagname(a,d){const y=$r(a,d);is={type:1,tag:y,ns:Sn.getNamespace(y,Kn[0],Sn.ns),tagType:0,props:[],children:[],loc:fr(a-1,d),codegenNode:void 0}},onopentagend(a){B2(a)},onclosetag(a,d){const y=$r(a,d);if(!Sn.isVoidTag(y)){let A=!1;for(let P=0;P<Kn.length;P++)if(Kn[P].tag.toLowerCase()===y.toLowerCase()){A=!0,P>0&&Ga(24,Kn[0].loc.start.offset);for(let F=0;F<=P;F++){const r=Kn.shift();tg(r,d,F<P)}break}A||Ga(23,jM(a,60))}},onselfclosingtag(a){const d=is.tag;is.isSelfClosing=!0,B2(a),Kn[0]&&Kn[0].tag===d&&tg(Kn.shift(),a)},onattribname(a,d){_n={type:6,name:$r(a,d),nameLoc:fr(a,d),value:void 0,loc:fr(a)}},ondirname(a,d){const y=$r(a,d),A=y==="."||y===":"?"bind":y==="@"?"on":y==="#"?"slot":y.slice(2);if(!$l&&A===""&&Ga(26,a),$l||A==="")_n={type:6,name:y,nameLoc:fr(a,d),value:void 0,loc:fr(a)};else if(_n={type:7,name:A,rawName:y,exp:void 0,arg:void 0,modifiers:y==="."?[en("prop")]:[],loc:fr(a)},A==="pre"){$l=or.inVPre=!0,rv=is;const P=is.props;for(let L=0;L<P.length;L++)P[L].type===7&&(P[L]=pO(P[L]))}},ondirarg(a,d){if(a===d)return;const y=$r(a,d);if($l)_n.name+=y,du(_n.nameLoc,d);else{const A=y[0]!=="[";_n.arg=ig(A?y:y.slice(1,-1),A,fr(a,d),A?3:0)}},ondirmodifier(a,d){const y=$r(a,d);if($l)_n.name+="."+y,du(_n.nameLoc,d);else if(_n.name==="slot"){const A=_n.arg;A&&(A.content+="."+y,du(A.loc,d))}else{const A=en(y,!0,fr(a,d));_n.modifiers.push(A)}},onattribdata(a,d){Is+=$r(a,d),qa<0&&(qa=a),cu=d},onattribentity(a,d,y){Is+=a,qa<0&&(qa=d),cu=y},onattribnameend(a){const d=_n.loc.start.offset,y=$r(d,a);_n.type===7&&(_n.rawName=y),is.props.some(A=>(A.type===7?A.rawName:A.name)===y)&&Ga(2,d)},onattribend(a,d){if(is&&_n){if(du(_n.loc,d),a!==0)if(Is.includes("&")&&(Is=Sn.decodeEntities(Is,!0)),_n.type===6)_n.name==="class"&&(Is=qM(Is).trim()),a===1&&!Is&&Ga(13,d),_n.value={type:2,content:Is,loc:a===1?fr(qa,cu):fr(qa-1,cu+1)},or.inSFCRoot&&is.tag==="template"&&_n.name==="lang"&&Is&&Is!=="html"&&or.enterRCDATA(Ig("</template"),0);else{let y=0;_n.exp=ig(Is,!1,fr(qa,cu),0,y),_n.name==="for"&&(_n.forParseResult=sO(_n.exp));let A=-1;_n.name==="bind"&&(A=_n.modifiers.findIndex(P=>P.content==="sync"))>-1&&Up("COMPILER_V_BIND_SYNC",Sn,_n.loc,_n.rawName)&&(_n.name="model",_n.modifiers.splice(A,1))}(_n.type!==7||_n.name!=="pre")&&is.props.push(_n)}Is="",qa=cu=-1},oncomment(a,d){Sn.comments&&sv({type:3,content:$r(a,d),loc:fr(a-4,d+3)})},onend(){const a=Ya.length;for(let d=0;d<Kn.length;d++)tg(Kn[d],a-1),Ga(24,Kn[d].loc.start.offset)},oncdata(a,d){Kn[0].ns!==0?q_($r(a,d),a,d):Ga(1,a-9)},onprocessinginstruction(a){(Kn[0]?Kn[0].ns:Sn.ns)===0&&Ga(21,a-1)}}),F2=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,rO=/^\(|\)$/g;function sO(a){const d=a.loc,y=a.content,A=y.match(nO);if(!A)return;const[,P,L]=A,F=(ce,ze,je=!1)=>{const Oe=d.start.offset+ze,Le=Oe+ce.length;return ig(ce,!1,fr(Oe,Le),0,je?1:0)},r={source:F(L.trim(),y.indexOf(L,P.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let W=P.trim().replace(rO,"").trim();const ne=P.indexOf(W),Q=W.match(F2);if(Q){W=W.replace(F2,"").trim();const ce=Q[1].trim();let ze;if(ce&&(ze=y.indexOf(ce,ne+W.length),r.key=F(ce,ze,!0)),Q[2]){const je=Q[2].trim();je&&(r.index=F(je,y.indexOf(je,r.key?ze+ce.length:ne+W.length),!0))}}return W&&(r.value=F(W,ne,!0)),r}function $r(a,d){return Ya.slice(a,d)}function B2(a){or.inSFCRoot&&(is.innerLoc=fr(a+1,a+1)),sv(is);const{tag:d,ns:y}=is;y===0&&Sn.isPreTag(d)&&o1++,Sn.isVoidTag(d)?tg(is,a):(Kn.unshift(is),(y===1||y===2)&&(or.inXML=!0)),is=null}function q_(a,d,y){{const L=Kn[0]&&Kn[0].tag;L!=="script"&&L!=="style"&&a.includes("&")&&(a=Sn.decodeEntities(a,!1))}const A=Kn[0]||Gp,P=A.children[A.children.length-1];P&&P.type===2?(P.content+=a,du(P.loc,y)):A.children.push({type:2,content:a,loc:fr(d,y)})}function tg(a,d,y=!1){y?du(a.loc,jM(d,60)):du(a.loc,oO(d,62)+1),or.inSFCRoot&&(a.children.length?a.innerLoc.end=cn({},a.children[a.children.length-1].loc.end):a.innerLoc.end=cn({},a.innerLoc.start),a.innerLoc.source=$r(a.innerLoc.start.offset,a.innerLoc.end.offset));const{tag:A,ns:P,children:L}=a;if($l||(A==="slot"?a.tagType=2:N2(a)?a.tagType=3:lO(a)&&(a.tagType=1)),or.inRCDATA||(a.children=GM(L)),P===0&&Sn.isIgnoreNewlineTag(A)){const F=L[0];F&&F.type===2&&(F.content=F.content.replace(/^\r?\n/,""))}P===0&&Sn.isPreTag(A)&&o1--,rv===a&&($l=or.inVPre=!1,rv=null),or.inXML&&(Kn[0]?Kn[0].ns:Sn.ns)===0&&(or.inXML=!1);{const F=a.props;if(!or.inSFCRoot&&gu("COMPILER_NATIVE_TEMPLATE",Sn)&&a.tag==="template"&&!N2(a)){const W=Kn[0]||Gp,ne=W.children.indexOf(a);W.children.splice(ne,1,...a.children)}const r=F.find(W=>W.type===6&&W.name==="inline-template");r&&Up("COMPILER_INLINE_TEMPLATE",Sn,r.loc)&&a.children.length&&(r.value={type:2,content:$r(a.children[0].loc.start.offset,a.children[a.children.length-1].loc.end.offset),loc:r.loc})}}function oO(a,d){let y=a;for(;Ya.charCodeAt(y)!==d&&y<Ya.length-1;)y++;return y}function jM(a,d){let y=a;for(;Ya.charCodeAt(y)!==d&&y>=0;)y--;return y}const aO=new Set(["if","else","else-if","for","slot"]);function N2({tag:a,props:d}){if(a==="template"){for(let y=0;y<d.length;y++)if(d[y].type===7&&aO.has(d[y].name))return!0}return!1}function lO({tag:a,props:d}){if(Sn.isCustomElement(a))return!1;if(a==="component"||cO(a.charCodeAt(0))||FM(a)||Sn.isBuiltInComponent&&Sn.isBuiltInComponent(a)||Sn.isNativeTag&&!Sn.isNativeTag(a))return!0;for(let y=0;y<d.length;y++){const A=d[y];if(A.type===6){if(A.name==="is"&&A.value){if(A.value.content.startsWith("vue:"))return!0;if(Up("COMPILER_IS_ON_ELEMENT",Sn,A.loc))return!0}}else if(A.name==="bind"&&hu(A.arg,"is")&&Up("COMPILER_IS_ON_ELEMENT",Sn,A.loc))return!0}return!1}function cO(a){return a>64&&a<91}const uO=/\r\n/g;function GM(a,d){const y=Sn.whitespace!=="preserve";let A=!1;for(let P=0;P<a.length;P++){const L=a[P];if(L.type===2)if(o1)L.content=L.content.replace(uO,`
`);else if(hO(L.content)){const F=a[P-1]&&a[P-1].type,r=a[P+1]&&a[P+1].type;!F||!r||y&&(F===3&&(r===3||r===1)||F===1&&(r===3||r===1&&dO(L.content)))?(A=!0,a[P]=null):L.content=" "}else y&&(L.content=qM(L.content))}return A?a.filter(Boolean):a}function hO(a){for(let d=0;d<a.length;d++)if(!Hs(a.charCodeAt(d)))return!1;return!0}function dO(a){for(let d=0;d<a.length;d++){const y=a.charCodeAt(d);if(y===10||y===13)return!0}return!1}function qM(a){let d="",y=!1;for(let A=0;A<a.length;A++)Hs(a.charCodeAt(A))?y||(d+=" ",y=!0):(d+=a[A],y=!1);return d}function sv(a){(Kn[0]||Gp).children.push(a)}function fr(a,d){return{start:or.getPos(a),end:d==null?d:or.getPos(d),source:d==null?d:$r(a,d)}}function fO(a){return fr(a.start.offset,a.end.offset)}function du(a,d){a.end=or.getPos(d),a.source=$r(a.start.offset,d)}function pO(a){const d={type:6,name:a.rawName,nameLoc:fr(a.loc.start.offset,a.loc.start.offset+a.rawName.length),value:void 0,loc:a.loc};if(a.exp){const y=a.exp.loc;y.end.offset<a.loc.end.offset&&(y.start.offset--,y.start.column--,y.end.offset++,y.end.column++),d.value={type:2,content:a.exp.content,loc:y}}return d}function ig(a,d=!1,y,A=0,P=0){return en(a,d,y,A)}function Ga(a,d,y){Sn.onError(Jn(a,fr(d,d)))}function mO(){or.reset(),is=null,_n=null,Is="",qa=-1,cu=-1,Kn.length=0}function _O(a,d){if(mO(),Ya=a,Sn=cn({},UM),d){let P;for(P in d)d[P]!=null&&(Sn[P]=d[P])}or.mode=Sn.parseMode==="html"?1:Sn.parseMode==="sfc"?2:0,or.inXML=Sn.ns===1||Sn.ns===2;const y=d&&d.delimiters;y&&(or.delimiterOpen=Ig(y[0]),or.delimiterClose=Ig(y[1]));const A=Gp=UL([],a);return or.parse(Ya),A.loc=fr(0,a.length),A.children=GM(A.children),Gp=null,A}function gO(a,d){ng(a,void 0,d,HM(a,a.children[0]))}function HM(a,d){const{children:y}=a;return y.length===1&&d.type===1&&!Pg(d)}function ng(a,d,y,A=!1,P=!1){const{children:L}=a,F=[];for(let Q=0;Q<L.length;Q++){const ce=L[Q];if(ce.type===1&&ce.tagType===0){const ze=A?0:$s(ce,y);if(ze>0){if(ze>=2){ce.codegenNode.patchFlag=-1,F.push(ce);continue}}else{const je=ce.codegenNode;if(je.type===13){const Oe=je.patchFlag;if((Oe===void 0||Oe===512||Oe===1)&&ZM(ce,y)>=2){const Le=WM(ce);Le&&(je.props=y.hoist(Le))}je.dynamicProps&&(je.dynamicProps=y.hoist(je.dynamicProps))}}}else if(ce.type===12&&(A?0:$s(ce,y))>=2){F.push(ce);continue}if(ce.type===1){const ze=ce.tagType===1;ze&&y.scopes.vSlot++,ng(ce,a,y,!1,P),ze&&y.scopes.vSlot--}else if(ce.type===11)ng(ce,a,y,ce.children.length===1,!0);else if(ce.type===9)for(let ze=0;ze<ce.branches.length;ze++)ng(ce.branches[ze],a,y,ce.branches[ze].children.length===1,P)}let r=!1;if(F.length===L.length&&a.type===1){if(a.tagType===0&&a.codegenNode&&a.codegenNode.type===13&&ci(a.codegenNode.children))a.codegenNode.children=W(_u(a.codegenNode.children)),r=!0;else if(a.tagType===1&&a.codegenNode&&a.codegenNode.type===13&&a.codegenNode.children&&!ci(a.codegenNode.children)&&a.codegenNode.children.type===15){const Q=ne(a.codegenNode,"default");Q&&(Q.returns=W(_u(Q.returns)),r=!0)}else if(a.tagType===3&&d&&d.type===1&&d.tagType===1&&d.codegenNode&&d.codegenNode.type===13&&d.codegenNode.children&&!ci(d.codegenNode.children)&&d.codegenNode.children.type===15){const Q=xo(a,"slot",!0),ce=Q&&Q.arg&&ne(d.codegenNode,Q.arg);ce&&(ce.returns=W(_u(ce.returns)),r=!0)}}if(!r)for(const Q of F)Q.codegenNode=y.cache(Q.codegenNode);function W(Q){const ce=y.cache(Q);return P&&y.hmr&&(ce.needArraySpread=!0),ce}function ne(Q,ce){if(Q.children&&!ci(Q.children)&&Q.children.type===15){const ze=Q.children.properties.find(je=>je.key===ce||je.key.content===ce);return ze&&ze.value}}F.length&&y.transformHoist&&y.transformHoist(L,y,a)}function $s(a,d){const{constantCache:y}=d;switch(a.type){case 1:if(a.tagType!==0)return 0;const A=y.get(a);if(A!==void 0)return A;const P=a.codegenNode;if(P.type!==13||P.isBlock&&a.tag!=="svg"&&a.tag!=="foreignObject"&&a.tag!=="math")return 0;if(P.patchFlag===void 0){let F=3;const r=ZM(a,d);if(r===0)return y.set(a,0),0;r<F&&(F=r);for(let W=0;W<a.children.length;W++){const ne=$s(a.children[W],d);if(ne===0)return y.set(a,0),0;ne<F&&(F=ne)}if(F>1)for(let W=0;W<a.props.length;W++){const ne=a.props[W];if(ne.type===7&&ne.name==="bind"&&ne.exp){const Q=$s(ne.exp,d);if(Q===0)return y.set(a,0),0;Q<F&&(F=Q)}}if(P.isBlock){for(let W=0;W<a.props.length;W++)if(a.props[W].type===7)return y.set(a,0),0;d.removeHelper(bu),d.removeHelper(od(d.inSSR,P.isComponent)),P.isBlock=!1,d.helper(sd(d.inSSR,P.isComponent))}return y.set(a,F),F}else return y.set(a,0),0;case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return $s(a.content,d);case 4:return a.constType;case 8:let L=3;for(let F=0;F<a.children.length;F++){const r=a.children[F];if(Wi(r)||Ls(r))continue;const W=$s(r,d);if(W===0)return 0;W<L&&(L=W)}return L;case 20:return 2;default:return 0}}const yO=new Set([Jv,Qv,Np,Jp]);function $M(a,d){if(a.type===14&&!Wi(a.callee)&&yO.has(a.callee)){const y=a.arguments[0];if(y.type===4)return $s(y,d);if(y.type===14)return $M(y,d)}return 0}function ZM(a,d){let y=3;const A=WM(a);if(A&&A.type===15){const{properties:P}=A;for(let L=0;L<P.length;L++){const{key:F,value:r}=P[L],W=$s(F,d);if(W===0)return W;W<y&&(y=W);let ne;if(r.type===4?ne=$s(r,d):r.type===14?ne=$M(r,d):ne=0,ne===0)return ne;ne<y&&(y=ne)}}return y}function WM(a){const d=a.codegenNode;if(d.type===13)return d.props}function xO(a,{filename:d="",prefixIdentifiers:y=!1,hoistStatic:A=!1,hmr:P=!1,cacheHandlers:L=!1,nodeTransforms:F=[],directiveTransforms:r={},transformHoist:W=null,isBuiltInComponent:ne=Ur,isCustomElement:Q=Ur,expressionPlugins:ce=[],scopeId:ze=null,slotted:je=!0,ssr:Oe=!1,inSSR:Le=!1,ssrCssVars:ct="",bindingMetadata:st=ln,inline:gt=!1,isTS:He=!1,onError:Ve=r1,onWarn:at=kM,compatConfig:Pt}){const dt=d.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),zt={filename:d,selfName:dt&&Su(Zn(dt[1])),prefixIdentifiers:y,hoistStatic:A,hmr:P,cacheHandlers:L,nodeTransforms:F,directiveTransforms:r,transformHoist:W,isBuiltInComponent:ne,isCustomElement:Q,expressionPlugins:ce,scopeId:ze,slotted:je,ssr:Oe,inSSR:Le,ssrCssVars:ct,bindingMetadata:st,inline:gt,isTS:He,onError:Ve,onWarn:at,compatConfig:Pt,root:a,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:a,childIndex:0,inVOnce:!1,helper(ut){const Je=zt.helpers.get(ut)||0;return zt.helpers.set(ut,Je+1),ut},removeHelper(ut){const Je=zt.helpers.get(ut);if(Je){const ht=Je-1;ht?zt.helpers.set(ut,ht):zt.helpers.delete(ut)}},helperString(ut){return`_${nd[zt.helper(ut)]}`},replaceNode(ut){zt.parent.children[zt.childIndex]=zt.currentNode=ut},removeNode(ut){const Je=zt.parent.children,ht=ut?Je.indexOf(ut):zt.currentNode?zt.childIndex:-1;!ut||ut===zt.currentNode?(zt.currentNode=null,zt.onNodeRemoved()):zt.childIndex>ht&&(zt.childIndex--,zt.onNodeRemoved()),zt.parent.children.splice(ht,1)},onNodeRemoved:Ur,addIdentifiers(ut){},removeIdentifiers(ut){},hoist(ut){Wi(ut)&&(ut=en(ut)),zt.hoists.push(ut);const Je=en(`_hoisted_${zt.hoists.length}`,!1,ut.loc,2);return Je.hoisted=ut,Je},cache(ut,Je=!1,ht=!1){const vt=jL(zt.cached.length,ut,Je,ht);return zt.cached.push(vt),vt}};return zt.filters=new Set,zt}function vO(a,d){const y=xO(a,d);cy(a,y),d.hoistStatic&&gO(a,y),d.ssr||bO(a,y),a.helpers=new Set([...y.helpers.keys()]),a.components=[...y.components],a.directives=[...y.directives],a.imports=y.imports,a.hoists=y.hoists,a.temps=y.temps,a.cached=y.cached,a.transformed=!0,a.filters=[...y.filters]}function bO(a,d){const{helper:y}=d,{children:A}=a;if(A.length===1){const P=A[0];if(HM(a,P)&&P.codegenNode){const L=P.codegenNode;L.type===13&&n1(L,d),a.codegenNode=L}else a.codegenNode=P}else if(A.length>1){let P=64;a.codegenNode=Vp(d,y(Bp),void 0,a.children,P,void 0,void 0,!0,void 0,!1)}}function wO(a,d){let y=0;const A=()=>{y--};for(;y<a.children.length;y++){const P=a.children[y];Wi(P)||(d.grandParent=d.parent,d.parent=a,d.childIndex=y,d.onNodeRemoved=A,cy(P,d))}}function cy(a,d){d.currentNode=a;const{nodeTransforms:y}=d,A=[];for(let L=0;L<y.length;L++){const F=y[L](a,d);if(F&&(ci(F)?A.push(...F):A.push(F)),d.currentNode)a=d.currentNode;else return}switch(a.type){case 3:d.ssr||d.helper(Kp);break;case 5:d.ssr||d.helper(ay);break;case 9:for(let L=0;L<a.branches.length;L++)cy(a.branches[L],d);break;case 10:case 11:case 1:case 0:wO(a,d);break}d.currentNode=a;let P=A.length;for(;P--;)A[P]()}function XM(a,d){const y=Wi(a)?A=>A===a:A=>a.test(A);return(A,P)=>{if(A.type===1){const{props:L}=A;if(A.tagType===3&&L.some(eO))return;const F=[];for(let r=0;r<L.length;r++){const W=L[r];if(W.type===7&&y(W.name)){L.splice(r,1),r--;const ne=d(A,W,P);ne&&F.push(ne)}}return F}}}const uy="/*@__PURE__*/",YM=a=>`${nd[a]}: _${nd[a]}`;function TO(a,{mode:d="function",prefixIdentifiers:y=d==="module",sourceMap:A=!1,filename:P="template.vue.html",scopeId:L=null,optimizeImports:F=!1,runtimeGlobalName:r="Vue",runtimeModuleName:W="vue",ssrRuntimeModuleName:ne="vue/server-renderer",ssr:Q=!1,isTS:ce=!1,inSSR:ze=!1}){const je={mode:d,prefixIdentifiers:y,sourceMap:A,filename:P,scopeId:L,optimizeImports:F,runtimeGlobalName:r,runtimeModuleName:W,ssrRuntimeModuleName:ne,ssr:Q,isTS:ce,inSSR:ze,source:a.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(Le){return`_${nd[Le]}`},push(Le,ct=-2,st){je.code+=Le},indent(){Oe(++je.indentLevel)},deindent(Le=!1){Le?--je.indentLevel:Oe(--je.indentLevel)},newline(){Oe(je.indentLevel)}};function Oe(Le){je.push(`
`+"  ".repeat(Le),0)}return je}function SO(a,d={}){const y=TO(a,d);d.onContextCreated&&d.onContextCreated(y);const{mode:A,push:P,prefixIdentifiers:L,indent:F,deindent:r,newline:W,scopeId:ne,ssr:Q}=y,ce=Array.from(a.helpers),ze=ce.length>0,je=!L&&A!=="module";EO(a,y);const Le=Q?"ssrRender":"render",st=(Q?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(P(`function ${Le}(${st}) {`),F(),je&&(P("with (_ctx) {"),F(),ze&&(P(`const { ${ce.map(YM).join(", ")} } = _Vue
`,-1),W())),a.components.length&&(Ax(a.components,"component",y),(a.directives.length||a.temps>0)&&W()),a.directives.length&&(Ax(a.directives,"directive",y),a.temps>0&&W()),a.filters&&a.filters.length&&(W(),Ax(a.filters,"filter",y),W()),a.temps>0){P("let ");for(let gt=0;gt<a.temps;gt++)P(`${gt>0?", ":""}_temp${gt}`)}return(a.components.length||a.directives.length||a.temps)&&(P(`
`,0),W()),Q||P("return "),a.codegenNode?as(a.codegenNode,y):P("null"),je&&(r(),P("}")),r(),P("}"),{ast:a,code:y.code,preamble:"",map:y.map?y.map.toJSON():void 0}}function EO(a,d){const{ssr:y,prefixIdentifiers:A,push:P,newline:L,runtimeModuleName:F,runtimeGlobalName:r,ssrRuntimeModuleName:W}=d,ne=r,Q=Array.from(a.helpers);if(Q.length>0&&(P(`const _Vue = ${ne}
`,-1),a.hoists.length)){const ce=[Gv,qv,Kp,Hv,DM].filter(ze=>Q.includes(ze)).map(YM).join(", ");P(`const { ${ce} } = _Vue
`,-1)}MO(a.hoists,d),L(),P("return ")}function Ax(a,d,{helper:y,push:A,newline:P,isTS:L}){const F=y(d==="filter"?Xv:d==="component"?$v:Wv);for(let r=0;r<a.length;r++){let W=a[r];const ne=W.endsWith("__self");ne&&(W=W.slice(0,-6)),A(`const ${jp(W,d)} = ${F}(${JSON.stringify(W)}${ne?", true":""})${L?"!":""}`),r<a.length-1&&P()}}function MO(a,d){if(!a.length)return;d.pure=!0;const{push:y,newline:A}=d;A();for(let P=0;P<a.length;P++){const L=a[P];L&&(y(`const _hoisted_${P+1} = `),as(L,d),A())}d.pure=!1}function a1(a,d){const y=a.length>3||!1;d.push("["),y&&d.indent(),Qp(a,d,y),y&&d.deindent(),d.push("]")}function Qp(a,d,y=!1,A=!0){const{push:P,newline:L}=d;for(let F=0;F<a.length;F++){const r=a[F];Wi(r)?P(r,-3):ci(r)?a1(r,d):as(r,d),F<a.length-1&&(y?(A&&P(","),L()):A&&P(", "))}}function as(a,d){if(Wi(a)){d.push(a,-3);return}if(Ls(a)){d.push(d.helper(a));return}switch(a.type){case 1:case 9:case 11:as(a.codegenNode,d);break;case 2:AO(a,d);break;case 4:KM(a,d);break;case 5:IO(a,d);break;case 12:as(a.codegenNode,d);break;case 8:JM(a,d);break;case 3:PO(a,d);break;case 13:RO(a,d);break;case 14:zO(a,d);break;case 15:LO(a,d);break;case 17:OO(a,d);break;case 18:kO(a,d);break;case 19:FO(a,d);break;case 20:BO(a,d);break;case 21:Qp(a.body,d,!0,!1);break}}function AO(a,d){d.push(JSON.stringify(a.content),-3,a)}function KM(a,d){const{content:y,isStatic:A}=a;d.push(A?JSON.stringify(y):y,-3,a)}function IO(a,d){const{push:y,helper:A,pure:P}=d;P&&y(uy),y(`${A(ay)}(`),as(a.content,d),y(")")}function JM(a,d){for(let y=0;y<a.children.length;y++){const A=a.children[y];Wi(A)?d.push(A,-3):as(A,d)}}function CO(a,d){const{push:y}=d;if(a.type===8)y("["),JM(a,d),y("]");else if(a.isStatic){const A=s1(a.content)?a.content:JSON.stringify(a.content);y(A,-2,a)}else y(`[${a.content}]`,-3,a)}function PO(a,d){const{push:y,helper:A,pure:P}=d;P&&y(uy),y(`${A(Kp)}(${JSON.stringify(a.content)})`,-3,a)}function RO(a,d){const{push:y,helper:A,pure:P}=d,{tag:L,props:F,children:r,patchFlag:W,dynamicProps:ne,directives:Q,isBlock:ce,disableTracking:ze,isComponent:je}=a;let Oe;W&&(Oe=String(W)),Q&&y(A(Yv)+"("),ce&&y(`(${A(bu)}(${ze?"true":""}), `),P&&y(uy);const Le=ce?od(d.inSSR,je):sd(d.inSSR,je);y(A(Le)+"(",-2,a),Qp(DO([L,F,r,Oe,ne]),d),y(")"),ce&&y(")"),Q&&(y(", "),as(Q,d),y(")"))}function DO(a){let d=a.length;for(;d--&&a[d]==null;);return a.slice(0,d+1).map(y=>y||"null")}function zO(a,d){const{push:y,helper:A,pure:P}=d,L=Wi(a.callee)?a.callee:A(a.callee);P&&y(uy),y(L+"(",-2,a),Qp(a.arguments,d),y(")")}function LO(a,d){const{push:y,indent:A,deindent:P,newline:L}=d,{properties:F}=a;if(!F.length){y("{}",-2,a);return}const r=F.length>1||!1;y(r?"{":"{ "),r&&A();for(let W=0;W<F.length;W++){const{key:ne,value:Q}=F[W];CO(ne,d),y(": "),as(Q,d),W<F.length-1&&(y(","),L())}r&&P(),y(r?"}":" }")}function OO(a,d){a1(a.elements,d)}function kO(a,d){const{push:y,indent:A,deindent:P}=d,{params:L,returns:F,body:r,newline:W,isSlot:ne}=a;ne&&y(`_${nd[t1]}(`),y("(",-2,a),ci(L)?Qp(L,d):L&&as(L,d),y(") => "),(W||r)&&(y("{"),A()),F?(W&&y("return "),ci(F)?a1(F,d):as(F,d)):r&&as(r,d),(W||r)&&(P(),y("}")),ne&&(a.isNonScopedSlot&&y(", undefined, true"),y(")"))}function FO(a,d){const{test:y,consequent:A,alternate:P,newline:L}=a,{push:F,indent:r,deindent:W,newline:ne}=d;if(y.type===4){const ce=!s1(y.content);ce&&F("("),KM(y,d),ce&&F(")")}else F("("),as(y,d),F(")");L&&r(),d.indentLevel++,L||F(" "),F("? "),as(A,d),d.indentLevel--,L&&ne(),L||F(" "),F(": ");const Q=P.type===19;Q||d.indentLevel++,as(P,d),Q||d.indentLevel--,L&&W(!0)}function BO(a,d){const{push:y,helper:A,indent:P,deindent:L,newline:F}=d,{needPauseTracking:r,needArraySpread:W}=a;W&&y("[...("),y(`_cache[${a.index}] || (`),r&&(P(),y(`${A(Ag)}(-1`),a.inVOnce&&y(", true"),y("),"),F(),y("(")),y(`_cache[${a.index}] = `),as(a.value,d),r&&(y(`).cacheIndex = ${a.index},`),F(),y(`${A(Ag)}(1),`),F(),y(`_cache[${a.index}]`),L()),y(")"),W&&y(")]")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const NO=XM(/^(if|else|else-if)$/,(a,d,y)=>VO(a,d,y,(A,P,L)=>{const F=y.parent.children;let r=F.indexOf(A),W=0;for(;r-->=0;){const ne=F[r];ne&&ne.type===9&&(W+=ne.branches.length)}return()=>{if(L)A.codegenNode=U2(P,W,y);else{const ne=UO(A.codegenNode);ne.alternate=U2(P,W+A.branches.length-1,y)}}}));function VO(a,d,y,A){if(d.name!=="else"&&(!d.exp||!d.exp.content.trim())){const P=d.exp?d.exp.loc:a.loc;y.onError(Jn(28,d.loc)),d.exp=en("true",!1,P)}if(d.name==="if"){const P=V2(a,d),L={type:9,loc:fO(a.loc),branches:[P]};if(y.replaceNode(L),A)return A(L,P,!0)}else{const P=y.parent.children;let L=P.indexOf(a);for(;L-->=-1;){const F=P[L];if(F&&F.type===3){y.removeNode(F);continue}if(F&&F.type===2&&!F.content.trim().length){y.removeNode(F);continue}if(F&&F.type===9){d.name==="else-if"&&F.branches[F.branches.length-1].condition===void 0&&y.onError(Jn(30,a.loc)),y.removeNode();const r=V2(a,d);F.branches.push(r);const W=A&&A(F,r,!1);cy(r,y),W&&W(),y.currentNode=null}else y.onError(Jn(30,a.loc));break}}}function V2(a,d){const y=a.tagType===3;return{type:10,loc:a.loc,condition:d.name==="else"?void 0:d.exp,children:y&&!xo(a,"for")?a.children:[a],userKey:ly(a,"key"),isTemplateIf:y}}function U2(a,d,y){return a.condition?nv(a.condition,j2(a,d,y),zr(y.helper(Kp),['""',"true"])):j2(a,d,y)}function j2(a,d,y){const{helper:A}=y,P=pr("key",en(`${d}`,!1,Ys,2)),{children:L}=a,F=L[0];if(L.length!==1||F.type!==1)if(L.length===1&&F.type===11){const W=F.codegenNode;return Rg(W,P,y),W}else{let W=64;return Vp(y,A(Bp),vo([P]),L,W,void 0,void 0,!0,!1,!1,a.loc)}else{const W=F.codegenNode,ne=iO(W);return ne.type===13&&n1(ne,y),Rg(ne,P,y),W}}function UO(a){for(;;)if(a.type===19)if(a.alternate.type===19)a=a.alternate;else return a;else a.type===20&&(a=a.value)}const jO=(a,d,y)=>{const{modifiers:A,loc:P}=a,L=a.arg;let{exp:F}=a;if(F&&F.type===4&&!F.content.trim()&&(F=void 0),!F){if(L.type!==4||!L.isStatic)return y.onError(Jn(52,L.loc)),{props:[pr(L,en("",!0,P))]};QM(a),F=a.exp}return L.type!==4?(L.children.unshift("("),L.children.push(') || ""')):L.isStatic||(L.content=`${L.content} || ""`),A.some(r=>r.content==="camel")&&(L.type===4?L.isStatic?L.content=Zn(L.content):L.content=`${y.helperString(tv)}(${L.content})`:(L.children.unshift(`${y.helperString(tv)}(`),L.children.push(")"))),y.inSSR||(A.some(r=>r.content==="prop")&&G2(L,"."),A.some(r=>r.content==="attr")&&G2(L,"^")),{props:[pr(L,F)]}},QM=(a,d)=>{const y=a.arg,A=Zn(y.content);a.exp=en(A,!1,y.loc)},G2=(a,d)=>{a.type===4?a.isStatic?a.content=d+a.content:a.content=`\`${d}\${${a.content}}\``:(a.children.unshift(`'${d}' + (`),a.children.push(")"))},GO=XM("for",(a,d,y)=>{const{helper:A,removeHelper:P}=y;return qO(a,d,y,L=>{const F=zr(A(Kv),[L.source]),r=Cg(a),W=xo(a,"memo"),ne=ly(a,"key",!1,!0);ne&&ne.type===7&&!ne.exp&&QM(ne);let ce=ne&&(ne.type===6?ne.value?en(ne.value.content,!0):void 0:ne.exp);const ze=ne&&ce?pr("key",ce):null,je=L.source.type===4&&L.source.constType>0,Oe=je?64:ne?128:256;return L.codegenNode=Vp(y,A(Bp),void 0,F,Oe,void 0,void 0,!0,!je,!1,a.loc),()=>{let Le;const{children:ct}=L,st=ct.length!==1||ct[0].type!==1,gt=Pg(a)?a:r&&a.children.length===1&&Pg(a.children[0])?a.children[0]:null;if(gt?(Le=gt.codegenNode,r&&ze&&Rg(Le,ze,y)):st?Le=Vp(y,A(Bp),ze?vo([ze]):void 0,a.children,64,void 0,void 0,!0,void 0,!1):(Le=ct[0].codegenNode,r&&ze&&Rg(Le,ze,y),Le.isBlock!==!je&&(Le.isBlock?(P(bu),P(od(y.inSSR,Le.isComponent))):P(sd(y.inSSR,Le.isComponent))),Le.isBlock=!je,Le.isBlock?(A(bu),A(od(y.inSSR,Le.isComponent))):A(sd(y.inSSR,Le.isComponent))),W){const He=rd(ov(L.parseResult,[en("_cached")]));He.body=GL([Zo(["const _memo = (",W.exp,")"]),Zo(["if (_cached",...ce?[" && _cached.key === ",ce]:[],` && ${y.helperString(OM)}(_cached, _memo)) return _cached`]),Zo(["const _item = ",Le]),en("_item.memo = _memo"),en("return _item")]),F.arguments.push(He,en("_cache"),en(String(y.cached.length))),y.cached.push(null)}else F.arguments.push(rd(ov(L.parseResult),Le,!0))}})});function qO(a,d,y,A){if(!d.exp){y.onError(Jn(31,d.loc));return}const P=d.forParseResult;if(!P){y.onError(Jn(32,d.loc));return}eA(P);const{addIdentifiers:L,removeIdentifiers:F,scopes:r}=y,{source:W,value:ne,key:Q,index:ce}=P,ze={type:11,loc:d.loc,source:W,valueAlias:ne,keyAlias:Q,objectIndexAlias:ce,parseResult:P,children:Cg(a)?a.children:[a]};y.replaceNode(ze),r.vFor++;const je=A&&A(ze);return()=>{r.vFor--,je&&je()}}function eA(a,d){a.finalized||(a.finalized=!0)}function ov({value:a,key:d,index:y},A=[]){return HO([a,d,y,...A])}function HO(a){let d=a.length;for(;d--&&!a[d];);return a.slice(0,d+1).map((y,A)=>y||en("_".repeat(A+1),!1))}const q2=en("undefined",!1),$O=(a,d)=>{if(a.type===1&&(a.tagType===1||a.tagType===3)){const y=xo(a,"slot");if(y)return y.exp,d.scopes.vSlot++,()=>{d.scopes.vSlot--}}},ZO=(a,d,y,A)=>rd(a,y,!1,!0,y.length?y[0].loc:A);function WO(a,d,y=ZO){d.helper(t1);const{children:A,loc:P}=a,L=[],F=[];let r=d.scopes.vSlot>0||d.scopes.vFor>0;const W=xo(a,"slot",!0);if(W){const{arg:ct,exp:st}=W;ct&&!zs(ct)&&(r=!0),L.push(pr(ct||en("default",!0),y(st,void 0,A,P)))}let ne=!1,Q=!1;const ce=[],ze=new Set;let je=0;for(let ct=0;ct<A.length;ct++){const st=A[ct];let gt;if(!Cg(st)||!(gt=xo(st,"slot",!0))){st.type!==3&&ce.push(st);continue}if(W){d.onError(Jn(37,gt.loc));break}ne=!0;const{children:He,loc:Ve}=st,{arg:at=en("default",!0),exp:Pt,loc:dt}=gt;let zt;zs(at)?zt=at?at.content:"default":r=!0;const ut=xo(st,"for"),Je=y(Pt,ut,He,Ve);let ht,vt;if(ht=xo(st,"if"))r=!0,F.push(nv(ht.exp,H_(at,Je,je++),q2));else if(vt=xo(st,/^else(-if)?$/,!0)){let Wt=ct,vi;for(;Wt--&&(vi=A[Wt],vi.type===3););if(vi&&Cg(vi)&&xo(vi,/^(else-)?if$/)){let Ft=F[F.length-1];for(;Ft.alternate.type===19;)Ft=Ft.alternate;Ft.alternate=vt.exp?nv(vt.exp,H_(at,Je,je++),q2):H_(at,Je,je++)}else d.onError(Jn(30,vt.loc))}else if(ut){r=!0;const Wt=ut.forParseResult;Wt?(eA(Wt),F.push(zr(d.helper(Kv),[Wt.source,rd(ov(Wt),H_(at,Je),!0)]))):d.onError(Jn(32,ut.loc))}else{if(zt){if(ze.has(zt)){d.onError(Jn(38,dt));continue}ze.add(zt),zt==="default"&&(Q=!0)}L.push(pr(at,Je))}}if(!W){const ct=(st,gt)=>{const He=y(st,void 0,gt,P);return d.compatConfig&&(He.isNonScopedSlot=!0),pr("default",He)};ne?ce.length&&ce.some(st=>tA(st))&&(Q?d.onError(Jn(39,ce[0].loc)):L.push(ct(void 0,ce))):L.push(ct(void 0,A))}const Oe=r?2:rg(a.children)?3:1;let Le=vo(L.concat(pr("_",en(Oe+"",!1))),P);return F.length&&(Le=zr(d.helper(LM),[Le,_u(F)])),{slots:Le,hasDynamicSlots:r}}function H_(a,d,y){const A=[pr("name",a),pr("fn",d)];return y!=null&&A.push(pr("key",en(String(y),!0))),vo(A)}function rg(a){for(let d=0;d<a.length;d++){const y=a[d];switch(y.type){case 1:if(y.tagType===2||rg(y.children))return!0;break;case 9:if(rg(y.branches))return!0;break;case 10:case 11:if(rg(y.children))return!0;break}}return!1}function tA(a){return a.type!==2&&a.type!==12?!0:a.type===2?!!a.content.trim():tA(a.content)}const iA=new WeakMap,XO=(a,d)=>function(){if(a=d.currentNode,!(a.type===1&&(a.tagType===0||a.tagType===1)))return;const{tag:A,props:P}=a,L=a.tagType===1;let F=L?YO(a,d):`"${A}"`;const r=Cn(F)&&F.callee===Zv;let W,ne,Q=0,ce,ze,je,Oe=r||F===Ap||F===jv||!L&&(A==="svg"||A==="foreignObject"||A==="math");if(P.length>0){const Le=nA(a,d,void 0,L,r);W=Le.props,Q=Le.patchFlag,ze=Le.dynamicPropNames;const ct=Le.directives;je=ct&&ct.length?_u(ct.map(st=>JO(st,d))):void 0,Le.shouldUseBlock&&(Oe=!0)}if(a.children.length>0)if(F===Eg&&(Oe=!0,Q|=1024),L&&F!==Ap&&F!==Eg){const{slots:ct,hasDynamicSlots:st}=WO(a,d);ne=ct,st&&(Q|=1024)}else if(a.children.length===1&&F!==Ap){const ct=a.children[0],st=ct.type,gt=st===5||st===8;gt&&$s(ct,d)===0&&(Q|=1),gt||st===2?ne=ct:ne=a.children}else ne=a.children;ze&&ze.length&&(ce=QO(ze)),a.codegenNode=Vp(d,F,W,ne,Q===0?void 0:Q,ce,je,!!Oe,!1,L,a.loc)};function YO(a,d,y=!1){let{tag:A}=a;const P=av(A),L=ly(a,"is",!1,!0);if(L)if(P||gu("COMPILER_IS_ON_ELEMENT",d)){let r;if(L.type===6?r=L.value&&en(L.value.content,!0):(r=L.exp,r||(r=en("is",!1,L.arg.loc))),r)return zr(d.helper(Zv),[r])}else L.type===6&&L.value.content.startsWith("vue:")&&(A=L.value.content.slice(4));const F=FM(A)||d.isBuiltInComponent(A);return F?(y||d.helper(F),F):(d.helper($v),d.components.add(A),jp(A,"component"))}function nA(a,d,y=a.props,A,P,L=!1){const{tag:F,loc:r,children:W}=a;let ne=[];const Q=[],ce=[],ze=W.length>0;let je=!1,Oe=0,Le=!1,ct=!1,st=!1,gt=!1,He=!1,Ve=!1;const at=[],Pt=Je=>{ne.length&&(Q.push(vo(H2(ne),r)),ne=[]),Je&&Q.push(Je)},dt=()=>{d.scopes.vFor>0&&ne.push(pr(en("ref_for",!0),en("true")))},zt=({key:Je,value:ht})=>{if(zs(Je)){const vt=Je.content,Wt=wu(vt);if(Wt&&(!A||P)&&vt.toLowerCase()!=="onclick"&&vt!=="onUpdate:modelValue"&&!Zl(vt)&&(gt=!0),Wt&&Zl(vt)&&(Ve=!0),Wt&&ht.type===14&&(ht=ht.arguments[0]),ht.type===20||(ht.type===4||ht.type===8)&&$s(ht,d)>0)return;vt==="ref"?Le=!0:vt==="class"?ct=!0:vt==="style"?st=!0:vt!=="key"&&!at.includes(vt)&&at.push(vt),A&&(vt==="class"||vt==="style")&&!at.includes(vt)&&at.push(vt)}else He=!0};for(let Je=0;Je<y.length;Je++){const ht=y[Je];if(ht.type===6){const{loc:vt,name:Wt,nameLoc:vi,value:Ft}=ht;let Qt=!0;if(Wt==="ref"&&(Le=!0,dt()),Wt==="is"&&(av(F)||Ft&&Ft.content.startsWith("vue:")||gu("COMPILER_IS_ON_ELEMENT",d)))continue;ne.push(pr(en(Wt,!0,vi),en(Ft?Ft.content:"",Qt,Ft?Ft.loc:vt)))}else{const{name:vt,arg:Wt,exp:vi,loc:Ft,modifiers:Qt}=ht,Ti=vt==="bind",hi=vt==="on";if(vt==="slot"){A||d.onError(Jn(40,Ft));continue}if(vt==="once"||vt==="memo"||vt==="is"||Ti&&hu(Wt,"is")&&(av(F)||gu("COMPILER_IS_ON_ELEMENT",d))||hi&&L)continue;if((Ti&&hu(Wt,"key")||hi&&ze&&hu(Wt,"vue:before-update"))&&(je=!0),Ti&&hu(Wt,"ref")&&dt(),!Wt&&(Ti||hi)){if(He=!0,vi)if(Ti){if(dt(),Pt(),gu("COMPILER_V_BIND_OBJECT_ORDER",d)){Q.unshift(vi);continue}Q.push(vi)}else Pt({type:14,loc:Ft,callee:d.helper(e1),arguments:A?[vi]:[vi,"true"]});else d.onError(Jn(Ti?34:35,Ft));continue}Ti&&Qt.some(rr=>rr.content==="prop")&&(Oe|=32);const ri=d.directiveTransforms[vt];if(ri){const{props:rr,needRuntime:mr}=ri(ht,a,d);!L&&rr.forEach(zt),hi&&Wt&&!zs(Wt)?Pt(vo(rr,r)):ne.push(...rr),mr&&(ce.push(ht),Ls(mr)&&iA.set(ht,mr))}else $R(vt)||(ce.push(ht),ze&&(je=!0))}}let ut;if(Q.length?(Pt(),Q.length>1?ut=zr(d.helper(Mg),Q,r):ut=Q[0]):ne.length&&(ut=vo(H2(ne),r)),He?Oe|=16:(ct&&!A&&(Oe|=2),st&&!A&&(Oe|=4),at.length&&(Oe|=8),gt&&(Oe|=32)),!je&&(Oe===0||Oe===32)&&(Le||Ve||ce.length>0)&&(Oe|=512),!d.inSSR&&ut)switch(ut.type){case 15:let Je=-1,ht=-1,vt=!1;for(let Ft=0;Ft<ut.properties.length;Ft++){const Qt=ut.properties[Ft].key;zs(Qt)?Qt.content==="class"?Je=Ft:Qt.content==="style"&&(ht=Ft):Qt.isHandlerKey||(vt=!0)}const Wt=ut.properties[Je],vi=ut.properties[ht];vt?ut=zr(d.helper(Np),[ut]):(Wt&&!zs(Wt.value)&&(Wt.value=zr(d.helper(Jv),[Wt.value])),vi&&(st||vi.value.type===4&&vi.value.content.trim()[0]==="["||vi.value.type===17)&&(vi.value=zr(d.helper(Qv),[vi.value])));break;case 14:break;default:ut=zr(d.helper(Np),[zr(d.helper(Jp),[ut])]);break}return{props:ut,directives:ce,patchFlag:Oe,dynamicPropNames:at,shouldUseBlock:je}}function H2(a){const d=new Map,y=[];for(let A=0;A<a.length;A++){const P=a[A];if(P.key.type===8||!P.key.isStatic){y.push(P);continue}const L=P.key.content,F=d.get(L);F?(L==="style"||L==="class"||wu(L))&&KO(F,P):(d.set(L,P),y.push(P))}return y}function KO(a,d){a.value.type===17?a.value.elements.push(d.value):a.value=_u([a.value,d.value],a.loc)}function JO(a,d){const y=[],A=iA.get(a);A?y.push(d.helperString(A)):(d.helper(Wv),d.directives.add(a.name),y.push(jp(a.name,"directive")));const{loc:P}=a;if(a.exp&&y.push(a.exp),a.arg&&(a.exp||y.push("void 0"),y.push(a.arg)),Object.keys(a.modifiers).length){a.arg||(a.exp||y.push("void 0"),y.push("void 0"));const L=en("true",!1,P);y.push(vo(a.modifiers.map(F=>pr(F,L)),P))}return _u(y,a.loc)}function QO(a){let d="[";for(let y=0,A=a.length;y<A;y++)d+=JSON.stringify(a[y]),y<A-1&&(d+=", ");return d+"]"}function av(a){return a==="component"||a==="Component"}const ek=(a,d)=>{if(Pg(a)){const{children:y,loc:A}=a,{slotName:P,slotProps:L}=tk(a,d),F=[d.prefixIdentifiers?"_ctx.$slots":"$slots",P,"{}","undefined","true"];let r=2;L&&(F[2]=L,r=3),y.length&&(F[3]=rd([],y,!1,!1,A),r=4),d.scopeId&&!d.slotted&&(r=5),F.splice(r),a.codegenNode=zr(d.helper(zM),F,A)}};function tk(a,d){let y='"default"',A;const P=[];for(let L=0;L<a.props.length;L++){const F=a.props[L];if(F.type===6)F.value&&(F.name==="name"?y=JSON.stringify(F.value.content):(F.name=Zn(F.name),P.push(F)));else if(F.name==="bind"&&hu(F.arg,"name")){if(F.exp)y=F.exp;else if(F.arg&&F.arg.type===4){const r=Zn(F.arg.content);y=F.exp=en(r,!1,F.arg.loc)}}else F.name==="bind"&&F.arg&&zs(F.arg)&&(F.arg.content=Zn(F.arg.content)),P.push(F)}if(P.length>0){const{props:L,directives:F}=nA(a,d,P,!1,!1);A=L,F.length&&d.onError(Jn(36,F[0].loc))}return{slotName:y,slotProps:A}}const rA=(a,d,y,A)=>{const{loc:P,modifiers:L,arg:F}=a;!a.exp&&!L.length&&y.onError(Jn(35,P));let r;if(F.type===4)if(F.isStatic){let ce=F.content;ce.startsWith("vue:")&&(ce=`vnode-${ce.slice(4)}`);const ze=d.tagType!==0||ce.startsWith("vnode")||!/[A-Z]/.test(ce)?Zh(Zn(ce)):`on:${ce}`;r=en(ze,!0,F.loc)}else r=Zo([`${y.helperString(iv)}(`,F,")"]);else r=F,r.children.unshift(`${y.helperString(iv)}(`),r.children.push(")");let W=a.exp;W&&!W.content.trim()&&(W=void 0);let ne=y.cacheHandlers&&!W&&!y.inVOnce;if(W){const ce=NM(W),ze=!(ce||JL(W)),je=W.content.includes(";");(ze||ne&&ce)&&(W=Zo([`${ze?"$event":"(...args)"} => ${je?"{":"("}`,W,je?"}":")"]))}let Q={props:[pr(r,W||en("() => {}",!1,P))]};return A&&(Q=A(Q)),ne&&(Q.props[0].value=y.cache(Q.props[0].value)),Q.props.forEach(ce=>ce.key.isHandlerKey=!0),Q},ik=(a,d)=>{if(a.type===0||a.type===1||a.type===11||a.type===10)return()=>{const y=a.children;let A,P=!1;for(let L=0;L<y.length;L++){const F=y[L];if(Mx(F)){P=!0;for(let r=L+1;r<y.length;r++){const W=y[r];if(Mx(W))A||(A=y[L]=Zo([F],F.loc)),A.children.push(" + ",W),y.splice(r,1),r--;else{A=void 0;break}}}}if(!(!P||y.length===1&&(a.type===0||a.type===1&&a.tagType===0&&!a.props.find(L=>L.type===7&&!d.directiveTransforms[L.name])&&a.tag!=="template")))for(let L=0;L<y.length;L++){const F=y[L];if(Mx(F)||F.type===8){const r=[];(F.type!==2||F.content!==" ")&&r.push(F),!d.ssr&&$s(F,d)===0&&r.push("1"),y[L]={type:12,content:F,loc:F.loc,codegenNode:zr(d.helper(Hv),r)}}}}},$2=new WeakSet,nk=(a,d)=>{if(a.type===1&&xo(a,"once",!0))return $2.has(a)||d.inVOnce||d.inSSR?void 0:($2.add(a),d.inVOnce=!0,d.helper(Ag),()=>{d.inVOnce=!1;const y=d.currentNode;y.codegenNode&&(y.codegenNode=d.cache(y.codegenNode,!0,!0))})},sA=(a,d,y)=>{const{exp:A,arg:P}=a;if(!A)return y.onError(Jn(41,a.loc)),$_();const L=A.loc.source.trim(),F=A.type===4?A.content:L,r=y.bindingMetadata[L];if(r==="props"||r==="props-aliased")return y.onError(Jn(44,A.loc)),$_();const W=!1;if(!F.trim()||!NM(A)&&!W)return y.onError(Jn(42,A.loc)),$_();const ne=P||en("modelValue",!0),Q=P?zs(P)?`onUpdate:${Zn(P.content)}`:Zo(['"onUpdate:" + ',P]):"onUpdate:modelValue";let ce;const ze=y.isTS?"($event: any)":"$event";ce=Zo([`${ze} => ((`,A,") = $event)"]);const je=[pr(ne,a.exp),pr(Q,ce)];if(a.modifiers.length&&d.tagType===1){const Oe=a.modifiers.map(ct=>ct.content).map(ct=>(s1(ct)?ct:JSON.stringify(ct))+": true").join(", "),Le=P?zs(P)?`${P.content}Modifiers`:Zo([P,' + "Modifiers"']):"modelModifiers";je.push(pr(Le,en(`{ ${Oe} }`,!1,a.loc,2)))}return $_(je)};function $_(a=[]){return{props:a}}const rk=/[\w).+\-_$\]]/,sk=(a,d)=>{gu("COMPILER_FILTERS",d)&&(a.type===5?Dg(a.content,d):a.type===1&&a.props.forEach(y=>{y.type===7&&y.name!=="for"&&y.exp&&Dg(y.exp,d)}))};function Dg(a,d){if(a.type===4)Z2(a,d);else for(let y=0;y<a.children.length;y++){const A=a.children[y];typeof A=="object"&&(A.type===4?Z2(A,d):A.type===8?Dg(a,d):A.type===5&&Dg(A.content,d))}}function Z2(a,d){const y=a.content;let A=!1,P=!1,L=!1,F=!1,r=0,W=0,ne=0,Q=0,ce,ze,je,Oe,Le=[];for(je=0;je<y.length;je++)if(ze=ce,ce=y.charCodeAt(je),A)ce===39&&ze!==92&&(A=!1);else if(P)ce===34&&ze!==92&&(P=!1);else if(L)ce===96&&ze!==92&&(L=!1);else if(F)ce===47&&ze!==92&&(F=!1);else if(ce===124&&y.charCodeAt(je+1)!==124&&y.charCodeAt(je-1)!==124&&!r&&!W&&!ne)Oe===void 0?(Q=je+1,Oe=y.slice(0,je).trim()):ct();else{switch(ce){case 34:P=!0;break;case 39:A=!0;break;case 96:L=!0;break;case 40:ne++;break;case 41:ne--;break;case 91:W++;break;case 93:W--;break;case 123:r++;break;case 125:r--;break}if(ce===47){let st=je-1,gt;for(;st>=0&&(gt=y.charAt(st),gt===" ");st--);(!gt||!rk.test(gt))&&(F=!0)}}Oe===void 0?Oe=y.slice(0,je).trim():Q!==0&&ct();function ct(){Le.push(y.slice(Q,je).trim()),Q=je+1}if(Le.length){for(je=0;je<Le.length;je++)Oe=ok(Oe,Le[je],d);a.content=Oe,a.ast=void 0}}function ok(a,d,y){y.helper(Xv);const A=d.indexOf("(");if(A<0)return y.filters.add(d),`${jp(d,"filter")}(${a})`;{const P=d.slice(0,A),L=d.slice(A+1);return y.filters.add(P),`${jp(P,"filter")}(${a}${L!==")"?","+L:L}`}}const W2=new WeakSet,ak=(a,d)=>{if(a.type===1){const y=xo(a,"memo");return!y||W2.has(a)?void 0:(W2.add(a),()=>{const A=a.codegenNode||d.currentNode.codegenNode;A&&A.type===13&&(a.tagType!==1&&n1(A,d),a.codegenNode=zr(d.helper(i1),[y.exp,rd(void 0,A),"_cache",String(d.cached.length)]),d.cached.push(null))})}};function lk(a){return[[nk,NO,ak,GO,sk,ek,XO,$O,ik],{on:rA,bind:jO,model:sA}]}function ck(a,d={}){const y=d.onError||r1,A=d.mode==="module";d.prefixIdentifiers===!0?y(Jn(47)):A&&y(Jn(48));const P=!1;d.cacheHandlers&&y(Jn(49)),d.scopeId&&!A&&y(Jn(50));const L=cn({},d,{prefixIdentifiers:P}),F=Wi(a)?_O(a,L):a,[r,W]=lk();return vO(F,cn({},L,{nodeTransforms:[...r,...d.nodeTransforms||[]],directiveTransforms:cn({},W,d.directiveTransforms||{})})),SO(F,L)}const uk=()=>({props:[]});/**
* @vue/compiler-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const oA=Symbol(""),aA=Symbol(""),lA=Symbol(""),cA=Symbol(""),lv=Symbol(""),uA=Symbol(""),hA=Symbol(""),dA=Symbol(""),fA=Symbol(""),pA=Symbol("");VL({[oA]:"vModelRadio",[aA]:"vModelCheckbox",[lA]:"vModelText",[cA]:"vModelSelect",[lv]:"vModelDynamic",[uA]:"withModifiers",[hA]:"withKeys",[dA]:"vShow",[fA]:"Transition",[pA]:"TransitionGroup"});let Vh;function hk(a,d=!1){return Vh||(Vh=document.createElement("div")),d?(Vh.innerHTML=`<div foo="${a.replace(/"/g,"&quot;")}">`,Vh.children[0].getAttribute("foo")):(Vh.innerHTML=a,Vh.textContent)}const dk={parseMode:"html",isVoidTag:c3,isNativeTag:a=>o3(a)||a3(a)||l3(a),isPreTag:a=>a==="pre",isIgnoreNewlineTag:a=>a==="pre"||a==="textarea",decodeEntities:hk,isBuiltInComponent:a=>{if(a==="Transition"||a==="transition")return fA;if(a==="TransitionGroup"||a==="transition-group")return pA},getNamespace(a,d,y){let A=d?d.ns:y;if(d&&A===2)if(d.tag==="annotation-xml"){if(a==="svg")return 1;d.props.some(P=>P.type===6&&P.name==="encoding"&&P.value!=null&&(P.value.content==="text/html"||P.value.content==="application/xhtml+xml"))&&(A=0)}else/^m(?:[ions]|text)$/.test(d.tag)&&a!=="mglyph"&&a!=="malignmark"&&(A=0);else d&&A===1&&(d.tag==="foreignObject"||d.tag==="desc"||d.tag==="title")&&(A=0);if(A===0){if(a==="svg")return 1;if(a==="math")return 2}return A}},fk=a=>{a.type===1&&a.props.forEach((d,y)=>{d.type===6&&d.name==="style"&&d.value&&(a.props[y]={type:7,name:"bind",arg:en("style",!0,d.loc),exp:pk(d.value.content,d.loc),modifiers:[],loc:d.loc})})},pk=(a,d)=>{const y=TS(a);return en(JSON.stringify(y),!1,d,3)};function Kl(a,d){return Jn(a,d)}const mk=(a,d,y)=>{const{exp:A,loc:P}=a;return A||y.onError(Kl(53,P)),d.children.length&&(y.onError(Kl(54,P)),d.children.length=0),{props:[pr(en("innerHTML",!0,P),A||en("",!0))]}},_k=(a,d,y)=>{const{exp:A,loc:P}=a;return A||y.onError(Kl(55,P)),d.children.length&&(y.onError(Kl(56,P)),d.children.length=0),{props:[pr(en("textContent",!0),A?$s(A,y)>0?A:zr(y.helperString(ay),[A],P):en("",!0))]}},gk=(a,d,y)=>{const A=sA(a,d,y);if(!A.props.length||d.tagType===1)return A;a.arg&&y.onError(Kl(58,a.arg.loc));const{tag:P}=d,L=y.isCustomElement(P);if(P==="input"||P==="textarea"||P==="select"||L){let F=lA,r=!1;if(P==="input"||L){const W=ly(d,"type");if(W){if(W.type===7)F=lv;else if(W.value)switch(W.value.content){case"radio":F=oA;break;case"checkbox":F=aA;break;case"file":r=!0,y.onError(Kl(59,a.loc));break}}else QL(d)&&(F=lv)}else P==="select"&&(F=cA);r||(A.needRuntime=y.helper(F))}else y.onError(Kl(57,a.loc));return A.props=A.props.filter(F=>!(F.key.type===4&&F.key.content==="modelValue")),A},yk=Xs("passive,once,capture"),xk=Xs("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),vk=Xs("left,right"),mA=Xs("onkeyup,onkeydown,onkeypress"),bk=(a,d,y,A)=>{const P=[],L=[],F=[];for(let r=0;r<d.length;r++){const W=d[r].content;W==="native"&&Up("COMPILER_V_ON_NATIVE",y)||yk(W)?F.push(W):vk(W)?zs(a)?mA(a.content.toLowerCase())?P.push(W):L.push(W):(P.push(W),L.push(W)):xk(W)?L.push(W):P.push(W)}return{keyModifiers:P,nonKeyModifiers:L,eventOptionModifiers:F}},X2=(a,d)=>zs(a)&&a.content.toLowerCase()==="onclick"?en(d,!0):a.type!==4?Zo(["(",a,`) === "onClick" ? "${d}" : (`,a,")"]):a,wk=(a,d,y)=>rA(a,d,y,A=>{const{modifiers:P}=a;if(!P.length)return A;let{key:L,value:F}=A.props[0];const{keyModifiers:r,nonKeyModifiers:W,eventOptionModifiers:ne}=bk(L,P,y,a.loc);if(W.includes("right")&&(L=X2(L,"onContextmenu")),W.includes("middle")&&(L=X2(L,"onMouseup")),W.length&&(F=zr(y.helper(uA),[F,JSON.stringify(W)])),r.length&&(!zs(L)||mA(L.content.toLowerCase()))&&(F=zr(y.helper(hA),[F,JSON.stringify(r)])),ne.length){const Q=ne.map(Su).join("");L=zs(L)?en(`${L.content}${Q}`,!0):Zo(["(",L,`) + "${Q}"`])}return{props:[pr(L,F)]}}),Tk=(a,d,y)=>{const{exp:A,loc:P}=a;return A||y.onError(Kl(61,P)),{props:[],needRuntime:y.helper(dA)}},Sk=(a,d)=>{a.type===1&&a.tagType===0&&(a.tag==="script"||a.tag==="style")&&d.removeNode()},Ek=[fk],Mk={cloak:uk,html:mk,text:_k,model:gk,on:wk,show:Tk};function Ak(a,d={}){return ck(a,cn({},dk,d,{nodeTransforms:[Sk,...Ek,...d.nodeTransforms||[]],directiveTransforms:cn({},Mk,d.directiveTransforms||{}),transformHoist:null}))}/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Y2=Object.create(null);function Ik(a,d){if(!Wi(a))if(a.nodeType)a=a.innerHTML;else return Ur;const y=XR(a,d),A=Y2[y];if(A)return A;if(a[0]==="#"){const r=document.querySelector(a);a=r?r.innerHTML:""}const P=cn({hoistStatic:!0,onError:void 0,onWarn:Ur},d);!P.isCustomElement&&typeof customElements<"u"&&(P.isCustomElement=r=>!!customElements.get(r));const{code:L}=Ak(a,P),F=new Function("Vue",L)(LL);return F._rc=!0,Y2[y]=F}QE(Ik);var Ck=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pk(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var _A={exports:{}};(function(a,d){(function(y,A){a.exports=A()})(Ck,function(){var y,A,P;function L(r,W){if(!y)y=W;else if(!A)A=W;else{var ne="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+A+")(sharedChunk); self.onerror = null;",Q={};y(Q),P=W(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(P.workerUrl=window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"})))}}L(["exports"],function(r){function W(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ne,Q={},ce={};function ze(){if(ne)return ce;ne=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.setMatrixArrayType=function(h){ce.ARRAY_TYPE=e=h},ce.toRadian=function(h){return h*o},ce.equals=function(h,l){return Math.abs(h-l)<=s*Math.max(1,Math.abs(h),Math.abs(l))},ce.RANDOM=ce.ARRAY_TYPE=ce.EPSILON=void 0;var s=1e-6;ce.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;ce.ARRAY_TYPE=e;var i=Math.random;ce.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var h=0,l=arguments.length;l--;)h+=arguments[l]*arguments[l];return Math.sqrt(h)}),ce}var je,Oe={};function Le(){if(je)return Oe;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}je=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},Oe.clone=function(l){var f=new e.ARRAY_TYPE(4);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f},Oe.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l},Oe.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},Oe.fromValues=function(l,f,g,b){var M=new e.ARRAY_TYPE(4);return M[0]=l,M[1]=f,M[2]=g,M[3]=b,M},Oe.set=function(l,f,g,b,M){return l[0]=f,l[1]=g,l[2]=b,l[3]=M,l},Oe.transpose=function(l,f){if(l===f){var g=f[1];l[1]=f[2],l[2]=g}else l[0]=f[0],l[1]=f[2],l[2]=f[1],l[3]=f[3];return l},Oe.invert=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=g*m-M*b;return w?(l[0]=m*(w=1/w),l[1]=-b*w,l[2]=-M*w,l[3]=g*w,l):null},Oe.adjoint=function(l,f){var g=f[0];return l[0]=f[3],l[1]=-f[1],l[2]=-f[2],l[3]=g,l},Oe.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},Oe.multiply=o,Oe.rotate=function(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=Math.sin(g),v=Math.cos(g);return l[0]=b*v+m*E,l[1]=M*v+w*E,l[2]=b*-E+m*v,l[3]=M*-E+w*v,l},Oe.scale=function(l,f,g){var b=f[1],M=f[2],m=f[3],w=g[0],E=g[1];return l[0]=f[0]*w,l[1]=b*w,l[2]=M*E,l[3]=m*E,l},Oe.fromRotation=function(l,f){var g=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=g,l[2]=-g,l[3]=b,l},Oe.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l},Oe.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},Oe.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},Oe.LDU=function(l,f,g,b){return l[2]=b[2]/b[0],g[0]=b[0],g[1]=b[1],g[3]=b[3]-l[2]*g[1],[l,f,g]},Oe.add=function(l,f,g){return l[0]=f[0]+g[0],l[1]=f[1]+g[1],l[2]=f[2]+g[2],l[3]=f[3]+g[3],l},Oe.subtract=h,Oe.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]},Oe.equals=function(l,f){var g=l[0],b=l[1],M=l[2],m=l[3],w=f[0],E=f[1],v=f[2],T=f[3];return Math.abs(g-w)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(b-E)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(M-v)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(v))&&Math.abs(m-T)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(T))},Oe.multiplyScalar=function(l,f,g){return l[0]=f[0]*g,l[1]=f[1]*g,l[2]=f[2]*g,l[3]=f[3]*g,l},Oe.multiplyScalarAndAdd=function(l,f,g,b){return l[0]=f[0]+g[0]*b,l[1]=f[1]+g[1]*b,l[2]=f[2]+g[2]*b,l[3]=f[3]+g[3]*b,l},Oe.sub=Oe.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var w=M?Object.getOwnPropertyDescriptor(l,m):null;w&&(w.get||w.set)?Object.defineProperty(b,m,w):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(ze());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:f})(l)}function o(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=g[0],v=g[1],T=g[2],I=g[3];return l[0]=b*E+m*v,l[1]=M*E+w*v,l[2]=b*T+m*I,l[3]=M*T+w*I,l}function h(l,f,g){return l[0]=f[0]-g[0],l[1]=f[1]-g[1],l[2]=f[2]-g[2],l[3]=f[3]-g[3],l}return Oe.mul=o,Oe.sub=h,Oe}var ct,st={};function gt(){if(ct)return st;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}ct=1,Object.defineProperty(st,"__esModule",{value:!0}),st.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},st.clone=function(l){var f=new e.ARRAY_TYPE(6);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f},st.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l},st.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},st.fromValues=function(l,f,g,b,M,m){var w=new e.ARRAY_TYPE(6);return w[0]=l,w[1]=f,w[2]=g,w[3]=b,w[4]=M,w[5]=m,w},st.set=function(l,f,g,b,M,m,w){return l[0]=f,l[1]=g,l[2]=b,l[3]=M,l[4]=m,l[5]=w,l},st.invert=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=f[4],E=f[5],v=g*m-b*M;return v?(l[0]=m*(v=1/v),l[1]=-b*v,l[2]=-M*v,l[3]=g*v,l[4]=(M*E-m*w)*v,l[5]=(b*w-g*E)*v,l):null},st.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},st.multiply=o,st.rotate=function(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=Math.sin(g),I=Math.cos(g);return l[0]=b*I+m*T,l[1]=M*I+w*T,l[2]=b*-T+m*I,l[3]=M*-T+w*I,l[4]=E,l[5]=v,l},st.scale=function(l,f,g){var b=f[1],M=f[2],m=f[3],w=f[4],E=f[5],v=g[0],T=g[1];return l[0]=f[0]*v,l[1]=b*v,l[2]=M*T,l[3]=m*T,l[4]=w,l[5]=E,l},st.translate=function(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=g[0],I=g[1];return l[0]=b,l[1]=M,l[2]=m,l[3]=w,l[4]=b*T+m*I+E,l[5]=M*T+w*I+v,l},st.fromRotation=function(l,f){var g=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=g,l[2]=-g,l[3]=b,l[4]=0,l[5]=0,l},st.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l[4]=0,l[5]=0,l},st.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=f[0],l[5]=f[1],l},st.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},st.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},st.add=function(l,f,g){return l[0]=f[0]+g[0],l[1]=f[1]+g[1],l[2]=f[2]+g[2],l[3]=f[3]+g[3],l[4]=f[4]+g[4],l[5]=f[5]+g[5],l},st.subtract=h,st.multiplyScalar=function(l,f,g){return l[0]=f[0]*g,l[1]=f[1]*g,l[2]=f[2]*g,l[3]=f[3]*g,l[4]=f[4]*g,l[5]=f[5]*g,l},st.multiplyScalarAndAdd=function(l,f,g,b){return l[0]=f[0]+g[0]*b,l[1]=f[1]+g[1]*b,l[2]=f[2]+g[2]*b,l[3]=f[3]+g[3]*b,l[4]=f[4]+g[4]*b,l[5]=f[5]+g[5]*b,l},st.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]},st.equals=function(l,f){var g=l[0],b=l[1],M=l[2],m=l[3],w=l[4],E=l[5],v=f[0],T=f[1],I=f[2],z=f[3],O=f[4],V=f[5];return Math.abs(g-v)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(v))&&Math.abs(b-T)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(M-I)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(I))&&Math.abs(m-z)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(w-O)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(O))&&Math.abs(E-V)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(V))},st.sub=st.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var w=M?Object.getOwnPropertyDescriptor(l,m):null;w&&(w.get||w.set)?Object.defineProperty(b,m,w):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(ze());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:f})(l)}function o(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=g[0],I=g[1],z=g[2],O=g[3],V=g[4],j=g[5];return l[0]=b*T+m*I,l[1]=M*T+w*I,l[2]=b*z+m*O,l[3]=M*z+w*O,l[4]=b*V+m*j+E,l[5]=M*V+w*j+v,l}function h(l,f,g){return l[0]=f[0]-g[0],l[1]=f[1]-g[1],l[2]=f[2]-g[2],l[3]=f[3]-g[3],l[4]=f[4]-g[4],l[5]=f[5]-g[5],l}return st.mul=o,st.sub=h,st}var He,Ve={};function at(){if(He)return Ve;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}He=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},Ve.fromMat4=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[4],l[4]=f[5],l[5]=f[6],l[6]=f[8],l[7]=f[9],l[8]=f[10],l},Ve.clone=function(l){var f=new e.ARRAY_TYPE(9);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f},Ve.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},Ve.fromValues=function(l,f,g,b,M,m,w,E,v){var T=new e.ARRAY_TYPE(9);return T[0]=l,T[1]=f,T[2]=g,T[3]=b,T[4]=M,T[5]=m,T[6]=w,T[7]=E,T[8]=v,T},Ve.set=function(l,f,g,b,M,m,w,E,v,T){return l[0]=f,l[1]=g,l[2]=b,l[3]=M,l[4]=m,l[5]=w,l[6]=E,l[7]=v,l[8]=T,l},Ve.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Ve.transpose=function(l,f){if(l===f){var g=f[1],b=f[2],M=f[5];l[1]=f[3],l[2]=f[6],l[3]=g,l[5]=f[7],l[6]=b,l[7]=M}else l[0]=f[0],l[1]=f[3],l[2]=f[6],l[3]=f[1],l[4]=f[4],l[5]=f[7],l[6]=f[2],l[7]=f[5],l[8]=f[8];return l},Ve.invert=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=f[4],E=f[5],v=f[6],T=f[7],I=f[8],z=I*w-E*T,O=-I*m+E*v,V=T*m-w*v,j=g*z+b*O+M*V;return j?(l[0]=z*(j=1/j),l[1]=(-I*b+M*T)*j,l[2]=(E*b-M*w)*j,l[3]=O*j,l[4]=(I*g-M*v)*j,l[5]=(-E*g+M*m)*j,l[6]=V*j,l[7]=(-T*g+b*v)*j,l[8]=(w*g-b*m)*j,l):null},Ve.adjoint=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=f[4],E=f[5],v=f[6],T=f[7],I=f[8];return l[0]=w*I-E*T,l[1]=M*T-b*I,l[2]=b*E-M*w,l[3]=E*v-m*I,l[4]=g*I-M*v,l[5]=M*m-g*E,l[6]=m*T-w*v,l[7]=b*v-g*T,l[8]=g*w-b*m,l},Ve.determinant=function(l){var f=l[3],g=l[4],b=l[5],M=l[6],m=l[7],w=l[8];return l[0]*(w*g-b*m)+l[1]*(-w*f+b*M)+l[2]*(m*f-g*M)},Ve.multiply=o,Ve.translate=function(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=f[6],I=f[7],z=f[8],O=g[0],V=g[1];return l[0]=b,l[1]=M,l[2]=m,l[3]=w,l[4]=E,l[5]=v,l[6]=O*b+V*w+T,l[7]=O*M+V*E+I,l[8]=O*m+V*v+z,l},Ve.rotate=function(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=f[6],I=f[7],z=f[8],O=Math.sin(g),V=Math.cos(g);return l[0]=V*b+O*w,l[1]=V*M+O*E,l[2]=V*m+O*v,l[3]=V*w-O*b,l[4]=V*E-O*M,l[5]=V*v-O*m,l[6]=T,l[7]=I,l[8]=z,l},Ve.scale=function(l,f,g){var b=g[0],M=g[1];return l[0]=b*f[0],l[1]=b*f[1],l[2]=b*f[2],l[3]=M*f[3],l[4]=M*f[4],l[5]=M*f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},Ve.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=f[0],l[7]=f[1],l[8]=1,l},Ve.fromRotation=function(l,f){var g=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=g,l[2]=0,l[3]=-g,l[4]=b,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Ve.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=0,l[4]=f[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},Ve.fromMat2d=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=0,l[3]=f[2],l[4]=f[3],l[5]=0,l[6]=f[4],l[7]=f[5],l[8]=1,l},Ve.fromQuat=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=g+g,E=b+b,v=M+M,T=g*w,I=b*w,z=b*E,O=M*w,V=M*E,j=M*v,N=m*w,G=m*E,H=m*v;return l[0]=1-z-j,l[3]=I-H,l[6]=O+G,l[1]=I+H,l[4]=1-T-j,l[7]=V-N,l[2]=O-G,l[5]=V+N,l[8]=1-T-z,l},Ve.normalFromMat4=function(l,f){var g=f[0],b=f[1],M=f[2],m=f[3],w=f[4],E=f[5],v=f[6],T=f[7],I=f[8],z=f[9],O=f[10],V=f[11],j=f[12],N=f[13],G=f[14],H=f[15],K=g*E-b*w,se=g*v-M*w,re=g*T-m*w,ie=b*v-M*E,_e=b*T-m*E,oe=M*T-m*v,ye=I*N-z*j,be=I*G-O*j,ve=I*H-V*j,Ee=z*G-O*N,Ie=z*H-V*N,De=O*H-V*G,Ae=K*De-se*Ie+re*Ee+ie*ve-_e*be+oe*ye;return Ae?(l[0]=(E*De-v*Ie+T*Ee)*(Ae=1/Ae),l[1]=(v*ve-w*De-T*be)*Ae,l[2]=(w*Ie-E*ve+T*ye)*Ae,l[3]=(M*Ie-b*De-m*Ee)*Ae,l[4]=(g*De-M*ve+m*be)*Ae,l[5]=(b*ve-g*Ie-m*ye)*Ae,l[6]=(N*oe-G*_e+H*ie)*Ae,l[7]=(G*re-j*oe-H*se)*Ae,l[8]=(j*_e-N*re+H*K)*Ae,l):null},Ve.projection=function(l,f,g){return l[0]=2/f,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/g,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},Ve.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},Ve.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},Ve.add=function(l,f,g){return l[0]=f[0]+g[0],l[1]=f[1]+g[1],l[2]=f[2]+g[2],l[3]=f[3]+g[3],l[4]=f[4]+g[4],l[5]=f[5]+g[5],l[6]=f[6]+g[6],l[7]=f[7]+g[7],l[8]=f[8]+g[8],l},Ve.subtract=h,Ve.multiplyScalar=function(l,f,g){return l[0]=f[0]*g,l[1]=f[1]*g,l[2]=f[2]*g,l[3]=f[3]*g,l[4]=f[4]*g,l[5]=f[5]*g,l[6]=f[6]*g,l[7]=f[7]*g,l[8]=f[8]*g,l},Ve.multiplyScalarAndAdd=function(l,f,g,b){return l[0]=f[0]+g[0]*b,l[1]=f[1]+g[1]*b,l[2]=f[2]+g[2]*b,l[3]=f[3]+g[3]*b,l[4]=f[4]+g[4]*b,l[5]=f[5]+g[5]*b,l[6]=f[6]+g[6]*b,l[7]=f[7]+g[7]*b,l[8]=f[8]+g[8]*b,l},Ve.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]&&l[6]===f[6]&&l[7]===f[7]&&l[8]===f[8]},Ve.equals=function(l,f){var g=l[0],b=l[1],M=l[2],m=l[3],w=l[4],E=l[5],v=l[6],T=l[7],I=l[8],z=f[0],O=f[1],V=f[2],j=f[3],N=f[4],G=f[5],H=f[6],K=f[7],se=f[8];return Math.abs(g-z)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(b-O)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(O))&&Math.abs(M-V)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(V))&&Math.abs(m-j)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(E-G)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(v-H)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(T-K)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(K))&&Math.abs(I-se)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(se))},Ve.sub=Ve.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var g=i(void 0);if(g&&g.has(l))return g.get(l);var b={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in l)if(m!=="default"&&Object.prototype.hasOwnProperty.call(l,m)){var w=M?Object.getOwnPropertyDescriptor(l,m):null;w&&(w.get||w.set)?Object.defineProperty(b,m,w):b[m]=l[m]}return b.default=l,g&&g.set(l,b),b}(ze());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,g=new WeakMap;return(i=function(b){return b?g:f})(l)}function o(l,f,g){var b=f[0],M=f[1],m=f[2],w=f[3],E=f[4],v=f[5],T=f[6],I=f[7],z=f[8],O=g[0],V=g[1],j=g[2],N=g[3],G=g[4],H=g[5],K=g[6],se=g[7],re=g[8];return l[0]=O*b+V*w+j*T,l[1]=O*M+V*E+j*I,l[2]=O*m+V*v+j*z,l[3]=N*b+G*w+H*T,l[4]=N*M+G*E+H*I,l[5]=N*m+G*v+H*z,l[6]=K*b+se*w+re*T,l[7]=K*M+se*E+re*I,l[8]=K*m+se*v+re*z,l}function h(l,f,g){return l[0]=f[0]-g[0],l[1]=f[1]-g[1],l[2]=f[2]-g[2],l[3]=f[3]-g[3],l[4]=f[4]-g[4],l[5]=f[5]-g[5],l[6]=f[6]-g[6],l[7]=f[7]-g[7],l[8]=f[8]-g[8],l}return Ve.mul=o,Ve.sub=h,Ve}var Pt,dt={};function zt(){if(Pt)return dt;function s(m){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},s(m)}Pt=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.create=function(){var m=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0),m[0]=1,m[5]=1,m[10]=1,m[15]=1,m},dt.clone=function(m){var w=new e.ARRAY_TYPE(16);return w[0]=m[0],w[1]=m[1],w[2]=m[2],w[3]=m[3],w[4]=m[4],w[5]=m[5],w[6]=m[6],w[7]=m[7],w[8]=m[8],w[9]=m[9],w[10]=m[10],w[11]=m[11],w[12]=m[12],w[13]=m[13],w[14]=m[14],w[15]=m[15],w},dt.copy=function(m,w){return m[0]=w[0],m[1]=w[1],m[2]=w[2],m[3]=w[3],m[4]=w[4],m[5]=w[5],m[6]=w[6],m[7]=w[7],m[8]=w[8],m[9]=w[9],m[10]=w[10],m[11]=w[11],m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15],m},dt.fromValues=function(m,w,E,v,T,I,z,O,V,j,N,G,H,K,se,re){var ie=new e.ARRAY_TYPE(16);return ie[0]=m,ie[1]=w,ie[2]=E,ie[3]=v,ie[4]=T,ie[5]=I,ie[6]=z,ie[7]=O,ie[8]=V,ie[9]=j,ie[10]=N,ie[11]=G,ie[12]=H,ie[13]=K,ie[14]=se,ie[15]=re,ie},dt.set=function(m,w,E,v,T,I,z,O,V,j,N,G,H,K,se,re,ie){return m[0]=w,m[1]=E,m[2]=v,m[3]=T,m[4]=I,m[5]=z,m[6]=O,m[7]=V,m[8]=j,m[9]=N,m[10]=G,m[11]=H,m[12]=K,m[13]=se,m[14]=re,m[15]=ie,m},dt.identity=o,dt.transpose=function(m,w){if(m===w){var E=w[1],v=w[2],T=w[3],I=w[6],z=w[7],O=w[11];m[1]=w[4],m[2]=w[8],m[3]=w[12],m[4]=E,m[6]=w[9],m[7]=w[13],m[8]=v,m[9]=I,m[11]=w[14],m[12]=T,m[13]=z,m[14]=O}else m[0]=w[0],m[1]=w[4],m[2]=w[8],m[3]=w[12],m[4]=w[1],m[5]=w[5],m[6]=w[9],m[7]=w[13],m[8]=w[2],m[9]=w[6],m[10]=w[10],m[11]=w[14],m[12]=w[3],m[13]=w[7],m[14]=w[11],m[15]=w[15];return m},dt.invert=function(m,w){var E=w[0],v=w[1],T=w[2],I=w[3],z=w[4],O=w[5],V=w[6],j=w[7],N=w[8],G=w[9],H=w[10],K=w[11],se=w[12],re=w[13],ie=w[14],_e=w[15],oe=E*O-v*z,ye=E*V-T*z,be=E*j-I*z,ve=v*V-T*O,Ee=v*j-I*O,Ie=T*j-I*V,De=N*re-G*se,Ae=N*ie-H*se,Ye=N*_e-K*se,rt=G*ie-H*re,Xe=G*_e-K*re,It=H*_e-K*ie,Et=oe*It-ye*Xe+be*rt+ve*Ye-Ee*Ae+Ie*De;return Et?(m[0]=(O*It-V*Xe+j*rt)*(Et=1/Et),m[1]=(T*Xe-v*It-I*rt)*Et,m[2]=(re*Ie-ie*Ee+_e*ve)*Et,m[3]=(H*Ee-G*Ie-K*ve)*Et,m[4]=(V*Ye-z*It-j*Ae)*Et,m[5]=(E*It-T*Ye+I*Ae)*Et,m[6]=(ie*be-se*Ie-_e*ye)*Et,m[7]=(N*Ie-H*be+K*ye)*Et,m[8]=(z*Xe-O*Ye+j*De)*Et,m[9]=(v*Ye-E*Xe-I*De)*Et,m[10]=(se*Ee-re*be+_e*oe)*Et,m[11]=(G*be-N*Ee-K*oe)*Et,m[12]=(O*Ae-z*rt-V*De)*Et,m[13]=(E*rt-v*Ae+T*De)*Et,m[14]=(re*ye-se*ve-ie*oe)*Et,m[15]=(N*ve-G*ye+H*oe)*Et,m):null},dt.adjoint=function(m,w){var E=w[0],v=w[1],T=w[2],I=w[3],z=w[4],O=w[5],V=w[6],j=w[7],N=w[8],G=w[9],H=w[10],K=w[11],se=w[12],re=w[13],ie=w[14],_e=w[15];return m[0]=O*(H*_e-K*ie)-G*(V*_e-j*ie)+re*(V*K-j*H),m[1]=-(v*(H*_e-K*ie)-G*(T*_e-I*ie)+re*(T*K-I*H)),m[2]=v*(V*_e-j*ie)-O*(T*_e-I*ie)+re*(T*j-I*V),m[3]=-(v*(V*K-j*H)-O*(T*K-I*H)+G*(T*j-I*V)),m[4]=-(z*(H*_e-K*ie)-N*(V*_e-j*ie)+se*(V*K-j*H)),m[5]=E*(H*_e-K*ie)-N*(T*_e-I*ie)+se*(T*K-I*H),m[6]=-(E*(V*_e-j*ie)-z*(T*_e-I*ie)+se*(T*j-I*V)),m[7]=E*(V*K-j*H)-z*(T*K-I*H)+N*(T*j-I*V),m[8]=z*(G*_e-K*re)-N*(O*_e-j*re)+se*(O*K-j*G),m[9]=-(E*(G*_e-K*re)-N*(v*_e-I*re)+se*(v*K-I*G)),m[10]=E*(O*_e-j*re)-z*(v*_e-I*re)+se*(v*j-I*O),m[11]=-(E*(O*K-j*G)-z*(v*K-I*G)+N*(v*j-I*O)),m[12]=-(z*(G*ie-H*re)-N*(O*ie-V*re)+se*(O*H-V*G)),m[13]=E*(G*ie-H*re)-N*(v*ie-T*re)+se*(v*H-T*G),m[14]=-(E*(O*ie-V*re)-z*(v*ie-T*re)+se*(v*V-T*O)),m[15]=E*(O*H-V*G)-z*(v*H-T*G)+N*(v*V-T*O),m},dt.determinant=function(m){var w=m[0],E=m[1],v=m[2],T=m[3],I=m[4],z=m[5],O=m[6],V=m[7],j=m[8],N=m[9],G=m[10],H=m[11],K=m[12],se=m[13],re=m[14],ie=m[15];return(w*z-E*I)*(G*ie-H*re)-(w*O-v*I)*(N*ie-H*se)+(w*V-T*I)*(N*re-G*se)+(E*O-v*z)*(j*ie-H*K)-(E*V-T*z)*(j*re-G*K)+(v*V-T*O)*(j*se-N*K)},dt.multiply=h,dt.translate=function(m,w,E){var v,T,I,z,O,V,j,N,G,H,K,se,re=E[0],ie=E[1],_e=E[2];return w===m?(m[12]=w[0]*re+w[4]*ie+w[8]*_e+w[12],m[13]=w[1]*re+w[5]*ie+w[9]*_e+w[13],m[14]=w[2]*re+w[6]*ie+w[10]*_e+w[14],m[15]=w[3]*re+w[7]*ie+w[11]*_e+w[15]):(T=w[1],I=w[2],z=w[3],O=w[4],V=w[5],j=w[6],N=w[7],G=w[8],H=w[9],K=w[10],se=w[11],m[0]=v=w[0],m[1]=T,m[2]=I,m[3]=z,m[4]=O,m[5]=V,m[6]=j,m[7]=N,m[8]=G,m[9]=H,m[10]=K,m[11]=se,m[12]=v*re+O*ie+G*_e+w[12],m[13]=T*re+V*ie+H*_e+w[13],m[14]=I*re+j*ie+K*_e+w[14],m[15]=z*re+N*ie+se*_e+w[15]),m},dt.scale=function(m,w,E){var v=E[0],T=E[1],I=E[2];return m[0]=w[0]*v,m[1]=w[1]*v,m[2]=w[2]*v,m[3]=w[3]*v,m[4]=w[4]*T,m[5]=w[5]*T,m[6]=w[6]*T,m[7]=w[7]*T,m[8]=w[8]*I,m[9]=w[9]*I,m[10]=w[10]*I,m[11]=w[11]*I,m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15],m},dt.rotate=function(m,w,E,v){var T,I,z,O,V,j,N,G,H,K,se,re,ie,_e,oe,ye,be,ve,Ee,Ie,De,Ae,Ye,rt,Xe=v[0],It=v[1],Et=v[2],pt=Math.hypot(Xe,It,Et);return pt<e.EPSILON?null:(Xe*=pt=1/pt,It*=pt,Et*=pt,T=Math.sin(E),I=Math.cos(E),V=w[1],j=w[2],N=w[3],H=w[5],K=w[6],se=w[7],ie=w[9],_e=w[10],oe=w[11],ye=Xe*Xe*(z=1-I)+I,Ee=Xe*It*z-Et*T,Ie=It*It*z+I,De=Et*It*z+Xe*T,Ae=Xe*Et*z+It*T,Ye=It*Et*z-Xe*T,rt=Et*Et*z+I,m[0]=(O=w[0])*ye+(G=w[4])*(be=It*Xe*z+Et*T)+(re=w[8])*(ve=Et*Xe*z-It*T),m[1]=V*ye+H*be+ie*ve,m[2]=j*ye+K*be+_e*ve,m[3]=N*ye+se*be+oe*ve,m[4]=O*Ee+G*Ie+re*De,m[5]=V*Ee+H*Ie+ie*De,m[6]=j*Ee+K*Ie+_e*De,m[7]=N*Ee+se*Ie+oe*De,m[8]=O*Ae+G*Ye+re*rt,m[9]=V*Ae+H*Ye+ie*rt,m[10]=j*Ae+K*Ye+_e*rt,m[11]=N*Ae+se*Ye+oe*rt,w!==m&&(m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15]),m)},dt.rotateX=function(m,w,E){var v=Math.sin(E),T=Math.cos(E),I=w[4],z=w[5],O=w[6],V=w[7],j=w[8],N=w[9],G=w[10],H=w[11];return w!==m&&(m[0]=w[0],m[1]=w[1],m[2]=w[2],m[3]=w[3],m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15]),m[4]=I*T+j*v,m[5]=z*T+N*v,m[6]=O*T+G*v,m[7]=V*T+H*v,m[8]=j*T-I*v,m[9]=N*T-z*v,m[10]=G*T-O*v,m[11]=H*T-V*v,m},dt.rotateY=function(m,w,E){var v=Math.sin(E),T=Math.cos(E),I=w[0],z=w[1],O=w[2],V=w[3],j=w[8],N=w[9],G=w[10],H=w[11];return w!==m&&(m[4]=w[4],m[5]=w[5],m[6]=w[6],m[7]=w[7],m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15]),m[0]=I*T-j*v,m[1]=z*T-N*v,m[2]=O*T-G*v,m[3]=V*T-H*v,m[8]=I*v+j*T,m[9]=z*v+N*T,m[10]=O*v+G*T,m[11]=V*v+H*T,m},dt.rotateZ=function(m,w,E){var v=Math.sin(E),T=Math.cos(E),I=w[0],z=w[1],O=w[2],V=w[3],j=w[4],N=w[5],G=w[6],H=w[7];return w!==m&&(m[8]=w[8],m[9]=w[9],m[10]=w[10],m[11]=w[11],m[12]=w[12],m[13]=w[13],m[14]=w[14],m[15]=w[15]),m[0]=I*T+j*v,m[1]=z*T+N*v,m[2]=O*T+G*v,m[3]=V*T+H*v,m[4]=j*T-I*v,m[5]=N*T-z*v,m[6]=G*T-O*v,m[7]=H*T-V*v,m},dt.fromTranslation=function(m,w){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=w[0],m[13]=w[1],m[14]=w[2],m[15]=1,m},dt.fromScaling=function(m,w){return m[0]=w[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=w[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=w[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},dt.fromRotation=function(m,w,E){var v,T,I,z=E[0],O=E[1],V=E[2],j=Math.hypot(z,O,V);return j<e.EPSILON?null:(z*=j=1/j,O*=j,V*=j,v=Math.sin(w),T=Math.cos(w),m[0]=z*z*(I=1-T)+T,m[1]=O*z*I+V*v,m[2]=V*z*I-O*v,m[3]=0,m[4]=z*O*I-V*v,m[5]=O*O*I+T,m[6]=V*O*I+z*v,m[7]=0,m[8]=z*V*I+O*v,m[9]=O*V*I-z*v,m[10]=V*V*I+T,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m)},dt.fromXRotation=function(m,w){var E=Math.sin(w),v=Math.cos(w);return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=v,m[6]=E,m[7]=0,m[8]=0,m[9]=-E,m[10]=v,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},dt.fromYRotation=function(m,w){var E=Math.sin(w),v=Math.cos(w);return m[0]=v,m[1]=0,m[2]=-E,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=E,m[9]=0,m[10]=v,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},dt.fromZRotation=function(m,w){var E=Math.sin(w),v=Math.cos(w);return m[0]=v,m[1]=E,m[2]=0,m[3]=0,m[4]=-E,m[5]=v,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},dt.fromRotationTranslation=l,dt.fromQuat2=function(m,w){var E=new e.ARRAY_TYPE(3),v=-w[0],T=-w[1],I=-w[2],z=w[3],O=w[4],V=w[5],j=w[6],N=w[7],G=v*v+T*T+I*I+z*z;return G>0?(E[0]=2*(O*z+N*v+V*I-j*T)/G,E[1]=2*(V*z+N*T+j*v-O*I)/G,E[2]=2*(j*z+N*I+O*T-V*v)/G):(E[0]=2*(O*z+N*v+V*I-j*T),E[1]=2*(V*z+N*T+j*v-O*I),E[2]=2*(j*z+N*I+O*T-V*v)),l(m,w,E),m},dt.getTranslation=function(m,w){return m[0]=w[12],m[1]=w[13],m[2]=w[14],m},dt.getScaling=f,dt.getRotation=function(m,w){var E=new e.ARRAY_TYPE(3);f(E,w);var v=1/E[0],T=1/E[1],I=1/E[2],z=w[0]*v,O=w[1]*T,V=w[2]*I,j=w[4]*v,N=w[5]*T,G=w[6]*I,H=w[8]*v,K=w[9]*T,se=w[10]*I,re=z+N+se,ie=0;return re>0?(ie=2*Math.sqrt(re+1),m[3]=.25*ie,m[0]=(G-K)/ie,m[1]=(H-V)/ie,m[2]=(O-j)/ie):z>N&&z>se?(ie=2*Math.sqrt(1+z-N-se),m[3]=(G-K)/ie,m[0]=.25*ie,m[1]=(O+j)/ie,m[2]=(H+V)/ie):N>se?(ie=2*Math.sqrt(1+N-z-se),m[3]=(H-V)/ie,m[0]=(O+j)/ie,m[1]=.25*ie,m[2]=(G+K)/ie):(ie=2*Math.sqrt(1+se-z-N),m[3]=(O-j)/ie,m[0]=(H+V)/ie,m[1]=(G+K)/ie,m[2]=.25*ie),m},dt.fromRotationTranslationScale=function(m,w,E,v){var T=w[0],I=w[1],z=w[2],O=w[3],V=T+T,j=I+I,N=z+z,G=T*V,H=T*j,K=T*N,se=I*j,re=I*N,ie=z*N,_e=O*V,oe=O*j,ye=O*N,be=v[0],ve=v[1],Ee=v[2];return m[0]=(1-(se+ie))*be,m[1]=(H+ye)*be,m[2]=(K-oe)*be,m[3]=0,m[4]=(H-ye)*ve,m[5]=(1-(G+ie))*ve,m[6]=(re+_e)*ve,m[7]=0,m[8]=(K+oe)*Ee,m[9]=(re-_e)*Ee,m[10]=(1-(G+se))*Ee,m[11]=0,m[12]=E[0],m[13]=E[1],m[14]=E[2],m[15]=1,m},dt.fromRotationTranslationScaleOrigin=function(m,w,E,v,T){var I=w[0],z=w[1],O=w[2],V=w[3],j=I+I,N=z+z,G=O+O,H=I*j,K=I*N,se=I*G,re=z*N,ie=z*G,_e=O*G,oe=V*j,ye=V*N,be=V*G,ve=v[0],Ee=v[1],Ie=v[2],De=T[0],Ae=T[1],Ye=T[2],rt=(1-(re+_e))*ve,Xe=(K+be)*ve,It=(se-ye)*ve,Et=(K-be)*Ee,pt=(1-(H+_e))*Ee,ot=(ie+oe)*Ee,jt=(se+ye)*Ie,Ct=(ie-oe)*Ie,Lt=(1-(H+re))*Ie;return m[0]=rt,m[1]=Xe,m[2]=It,m[3]=0,m[4]=Et,m[5]=pt,m[6]=ot,m[7]=0,m[8]=jt,m[9]=Ct,m[10]=Lt,m[11]=0,m[12]=E[0]+De-(rt*De+Et*Ae+jt*Ye),m[13]=E[1]+Ae-(Xe*De+pt*Ae+Ct*Ye),m[14]=E[2]+Ye-(It*De+ot*Ae+Lt*Ye),m[15]=1,m},dt.fromQuat=function(m,w){var E=w[0],v=w[1],T=w[2],I=w[3],z=E+E,O=v+v,V=T+T,j=E*z,N=v*z,G=v*O,H=T*z,K=T*O,se=T*V,re=I*z,ie=I*O,_e=I*V;return m[0]=1-G-se,m[1]=N+_e,m[2]=H-ie,m[3]=0,m[4]=N-_e,m[5]=1-j-se,m[6]=K+re,m[7]=0,m[8]=H+ie,m[9]=K-re,m[10]=1-j-G,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},dt.frustum=function(m,w,E,v,T,I,z){var O=1/(E-w),V=1/(T-v),j=1/(I-z);return m[0]=2*I*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*I*V,m[6]=0,m[7]=0,m[8]=(E+w)*O,m[9]=(T+v)*V,m[10]=(z+I)*j,m[11]=-1,m[12]=0,m[13]=0,m[14]=z*I*2*j,m[15]=0,m},dt.perspectiveNO=g,dt.perspectiveZO=function(m,w,E,v,T){var I,z=1/Math.tan(w/2);return m[0]=z/E,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=z,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,T!=null&&T!==1/0?(m[10]=T*(I=1/(v-T)),m[14]=T*v*I):(m[10]=-1,m[14]=-v),m},dt.perspectiveFromFieldOfView=function(m,w,E,v){var T=Math.tan(w.upDegrees*Math.PI/180),I=Math.tan(w.downDegrees*Math.PI/180),z=Math.tan(w.leftDegrees*Math.PI/180),O=Math.tan(w.rightDegrees*Math.PI/180),V=2/(z+O),j=2/(T+I);return m[0]=V,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=j,m[6]=0,m[7]=0,m[8]=-(z-O)*V*.5,m[9]=(T-I)*j*.5,m[10]=v/(E-v),m[11]=-1,m[12]=0,m[13]=0,m[14]=v*E/(E-v),m[15]=0,m},dt.orthoNO=b,dt.orthoZO=function(m,w,E,v,T,I,z){var O=1/(w-E),V=1/(v-T),j=1/(I-z);return m[0]=-2*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*V,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=j,m[11]=0,m[12]=(w+E)*O,m[13]=(T+v)*V,m[14]=I*j,m[15]=1,m},dt.lookAt=function(m,w,E,v){var T,I,z,O,V,j,N,G,H,K,se=w[0],re=w[1],ie=w[2],_e=v[0],oe=v[1],ye=v[2],be=E[0],ve=E[1],Ee=E[2];return Math.abs(se-be)<e.EPSILON&&Math.abs(re-ve)<e.EPSILON&&Math.abs(ie-Ee)<e.EPSILON?o(m):(N=se-be,G=re-ve,H=ie-Ee,T=oe*(H*=K=1/Math.hypot(N,G,H))-ye*(G*=K),I=ye*(N*=K)-_e*H,z=_e*G-oe*N,(K=Math.hypot(T,I,z))?(T*=K=1/K,I*=K,z*=K):(T=0,I=0,z=0),O=G*z-H*I,V=H*T-N*z,j=N*I-G*T,(K=Math.hypot(O,V,j))?(O*=K=1/K,V*=K,j*=K):(O=0,V=0,j=0),m[0]=T,m[1]=O,m[2]=N,m[3]=0,m[4]=I,m[5]=V,m[6]=G,m[7]=0,m[8]=z,m[9]=j,m[10]=H,m[11]=0,m[12]=-(T*se+I*re+z*ie),m[13]=-(O*se+V*re+j*ie),m[14]=-(N*se+G*re+H*ie),m[15]=1,m)},dt.targetTo=function(m,w,E,v){var T=w[0],I=w[1],z=w[2],O=v[0],V=v[1],j=v[2],N=T-E[0],G=I-E[1],H=z-E[2],K=N*N+G*G+H*H;K>0&&(N*=K=1/Math.sqrt(K),G*=K,H*=K);var se=V*H-j*G,re=j*N-O*H,ie=O*G-V*N;return(K=se*se+re*re+ie*ie)>0&&(se*=K=1/Math.sqrt(K),re*=K,ie*=K),m[0]=se,m[1]=re,m[2]=ie,m[3]=0,m[4]=G*ie-H*re,m[5]=H*se-N*ie,m[6]=N*re-G*se,m[7]=0,m[8]=N,m[9]=G,m[10]=H,m[11]=0,m[12]=T,m[13]=I,m[14]=z,m[15]=1,m},dt.str=function(m){return"mat4("+m[0]+", "+m[1]+", "+m[2]+", "+m[3]+", "+m[4]+", "+m[5]+", "+m[6]+", "+m[7]+", "+m[8]+", "+m[9]+", "+m[10]+", "+m[11]+", "+m[12]+", "+m[13]+", "+m[14]+", "+m[15]+")"},dt.frob=function(m){return Math.hypot(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])},dt.add=function(m,w,E){return m[0]=w[0]+E[0],m[1]=w[1]+E[1],m[2]=w[2]+E[2],m[3]=w[3]+E[3],m[4]=w[4]+E[4],m[5]=w[5]+E[5],m[6]=w[6]+E[6],m[7]=w[7]+E[7],m[8]=w[8]+E[8],m[9]=w[9]+E[9],m[10]=w[10]+E[10],m[11]=w[11]+E[11],m[12]=w[12]+E[12],m[13]=w[13]+E[13],m[14]=w[14]+E[14],m[15]=w[15]+E[15],m},dt.subtract=M,dt.multiplyScalar=function(m,w,E){return m[0]=w[0]*E,m[1]=w[1]*E,m[2]=w[2]*E,m[3]=w[3]*E,m[4]=w[4]*E,m[5]=w[5]*E,m[6]=w[6]*E,m[7]=w[7]*E,m[8]=w[8]*E,m[9]=w[9]*E,m[10]=w[10]*E,m[11]=w[11]*E,m[12]=w[12]*E,m[13]=w[13]*E,m[14]=w[14]*E,m[15]=w[15]*E,m},dt.multiplyScalarAndAdd=function(m,w,E,v){return m[0]=w[0]+E[0]*v,m[1]=w[1]+E[1]*v,m[2]=w[2]+E[2]*v,m[3]=w[3]+E[3]*v,m[4]=w[4]+E[4]*v,m[5]=w[5]+E[5]*v,m[6]=w[6]+E[6]*v,m[7]=w[7]+E[7]*v,m[8]=w[8]+E[8]*v,m[9]=w[9]+E[9]*v,m[10]=w[10]+E[10]*v,m[11]=w[11]+E[11]*v,m[12]=w[12]+E[12]*v,m[13]=w[13]+E[13]*v,m[14]=w[14]+E[14]*v,m[15]=w[15]+E[15]*v,m},dt.exactEquals=function(m,w){return m[0]===w[0]&&m[1]===w[1]&&m[2]===w[2]&&m[3]===w[3]&&m[4]===w[4]&&m[5]===w[5]&&m[6]===w[6]&&m[7]===w[7]&&m[8]===w[8]&&m[9]===w[9]&&m[10]===w[10]&&m[11]===w[11]&&m[12]===w[12]&&m[13]===w[13]&&m[14]===w[14]&&m[15]===w[15]},dt.equals=function(m,w){var E=m[0],v=m[1],T=m[2],I=m[3],z=m[4],O=m[5],V=m[6],j=m[7],N=m[8],G=m[9],H=m[10],K=m[11],se=m[12],re=m[13],ie=m[14],_e=m[15],oe=w[0],ye=w[1],be=w[2],ve=w[3],Ee=w[4],Ie=w[5],De=w[6],Ae=w[7],Ye=w[8],rt=w[9],Xe=w[10],It=w[11],Et=w[12],pt=w[13],ot=w[14],jt=w[15];return Math.abs(E-oe)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(oe))&&Math.abs(v-ye)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(ye))&&Math.abs(T-be)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(be))&&Math.abs(I-ve)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(z-Ee)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ee))&&Math.abs(O-Ie)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ie))&&Math.abs(V-De)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(De))&&Math.abs(j-Ae)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ae))&&Math.abs(N-Ye)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ye))&&Math.abs(G-rt)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(rt))&&Math.abs(H-Xe)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Xe))&&Math.abs(K-It)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(It))&&Math.abs(se-Et)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(Et))&&Math.abs(re-pt)<=e.EPSILON*Math.max(1,Math.abs(re),Math.abs(pt))&&Math.abs(ie-ot)<=e.EPSILON*Math.max(1,Math.abs(ie),Math.abs(ot))&&Math.abs(_e-jt)<=e.EPSILON*Math.max(1,Math.abs(_e),Math.abs(jt))},dt.sub=dt.mul=dt.ortho=dt.perspective=void 0;var e=function(m,w){if(m&&m.__esModule)return m;if(m===null||s(m)!=="object"&&typeof m!="function")return{default:m};var E=i(void 0);if(E&&E.has(m))return E.get(m);var v={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in m)if(I!=="default"&&Object.prototype.hasOwnProperty.call(m,I)){var z=T?Object.getOwnPropertyDescriptor(m,I):null;z&&(z.get||z.set)?Object.defineProperty(v,I,z):v[I]=m[I]}return v.default=m,E&&E.set(m,v),v}(ze());function i(m){if(typeof WeakMap!="function")return null;var w=new WeakMap,E=new WeakMap;return(i=function(v){return v?E:w})(m)}function o(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function h(m,w,E){var v=w[0],T=w[1],I=w[2],z=w[3],O=w[4],V=w[5],j=w[6],N=w[7],G=w[8],H=w[9],K=w[10],se=w[11],re=w[12],ie=w[13],_e=w[14],oe=w[15],ye=E[0],be=E[1],ve=E[2],Ee=E[3];return m[0]=ye*v+be*O+ve*G+Ee*re,m[1]=ye*T+be*V+ve*H+Ee*ie,m[2]=ye*I+be*j+ve*K+Ee*_e,m[3]=ye*z+be*N+ve*se+Ee*oe,m[4]=(ye=E[4])*v+(be=E[5])*O+(ve=E[6])*G+(Ee=E[7])*re,m[5]=ye*T+be*V+ve*H+Ee*ie,m[6]=ye*I+be*j+ve*K+Ee*_e,m[7]=ye*z+be*N+ve*se+Ee*oe,m[8]=(ye=E[8])*v+(be=E[9])*O+(ve=E[10])*G+(Ee=E[11])*re,m[9]=ye*T+be*V+ve*H+Ee*ie,m[10]=ye*I+be*j+ve*K+Ee*_e,m[11]=ye*z+be*N+ve*se+Ee*oe,m[12]=(ye=E[12])*v+(be=E[13])*O+(ve=E[14])*G+(Ee=E[15])*re,m[13]=ye*T+be*V+ve*H+Ee*ie,m[14]=ye*I+be*j+ve*K+Ee*_e,m[15]=ye*z+be*N+ve*se+Ee*oe,m}function l(m,w,E){var v=w[0],T=w[1],I=w[2],z=w[3],O=v+v,V=T+T,j=I+I,N=v*O,G=v*V,H=v*j,K=T*V,se=T*j,re=I*j,ie=z*O,_e=z*V,oe=z*j;return m[0]=1-(K+re),m[1]=G+oe,m[2]=H-_e,m[3]=0,m[4]=G-oe,m[5]=1-(N+re),m[6]=se+ie,m[7]=0,m[8]=H+_e,m[9]=se-ie,m[10]=1-(N+K),m[11]=0,m[12]=E[0],m[13]=E[1],m[14]=E[2],m[15]=1,m}function f(m,w){var E=w[4],v=w[5],T=w[6],I=w[8],z=w[9],O=w[10];return m[0]=Math.hypot(w[0],w[1],w[2]),m[1]=Math.hypot(E,v,T),m[2]=Math.hypot(I,z,O),m}function g(m,w,E,v,T){var I,z=1/Math.tan(w/2);return m[0]=z/E,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=z,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,T!=null&&T!==1/0?(m[10]=(T+v)*(I=1/(v-T)),m[14]=2*T*v*I):(m[10]=-1,m[14]=-2*v),m}function b(m,w,E,v,T,I,z){var O=1/(w-E),V=1/(v-T),j=1/(I-z);return m[0]=-2*O,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*V,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2*j,m[11]=0,m[12]=(w+E)*O,m[13]=(T+v)*V,m[14]=(z+I)*j,m[15]=1,m}function M(m,w,E){return m[0]=w[0]-E[0],m[1]=w[1]-E[1],m[2]=w[2]-E[2],m[3]=w[3]-E[3],m[4]=w[4]-E[4],m[5]=w[5]-E[5],m[6]=w[6]-E[6],m[7]=w[7]-E[7],m[8]=w[8]-E[8],m[9]=w[9]-E[9],m[10]=w[10]-E[10],m[11]=w[11]-E[11],m[12]=w[12]-E[12],m[13]=w[13]-E[13],m[14]=w[14]-E[14],m[15]=w[15]-E[15],m}return dt.perspective=g,dt.ortho=b,dt.mul=h,dt.sub=M,dt}var ut,Je={},ht={};function vt(){if(ut)return ht;function s(T){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},s(T)}ut=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=o,ht.clone=function(T){var I=new e.ARRAY_TYPE(3);return I[0]=T[0],I[1]=T[1],I[2]=T[2],I},ht.length=h,ht.fromValues=function(T,I,z){var O=new e.ARRAY_TYPE(3);return O[0]=T,O[1]=I,O[2]=z,O},ht.copy=function(T,I){return T[0]=I[0],T[1]=I[1],T[2]=I[2],T},ht.set=function(T,I,z,O){return T[0]=I,T[1]=z,T[2]=O,T},ht.add=function(T,I,z){return T[0]=I[0]+z[0],T[1]=I[1]+z[1],T[2]=I[2]+z[2],T},ht.subtract=l,ht.multiply=f,ht.divide=g,ht.ceil=function(T,I){return T[0]=Math.ceil(I[0]),T[1]=Math.ceil(I[1]),T[2]=Math.ceil(I[2]),T},ht.floor=function(T,I){return T[0]=Math.floor(I[0]),T[1]=Math.floor(I[1]),T[2]=Math.floor(I[2]),T},ht.min=function(T,I,z){return T[0]=Math.min(I[0],z[0]),T[1]=Math.min(I[1],z[1]),T[2]=Math.min(I[2],z[2]),T},ht.max=function(T,I,z){return T[0]=Math.max(I[0],z[0]),T[1]=Math.max(I[1],z[1]),T[2]=Math.max(I[2],z[2]),T},ht.round=function(T,I){return T[0]=Math.round(I[0]),T[1]=Math.round(I[1]),T[2]=Math.round(I[2]),T},ht.scale=function(T,I,z){return T[0]=I[0]*z,T[1]=I[1]*z,T[2]=I[2]*z,T},ht.scaleAndAdd=function(T,I,z,O){return T[0]=I[0]+z[0]*O,T[1]=I[1]+z[1]*O,T[2]=I[2]+z[2]*O,T},ht.distance=b,ht.squaredDistance=M,ht.squaredLength=m,ht.negate=function(T,I){return T[0]=-I[0],T[1]=-I[1],T[2]=-I[2],T},ht.inverse=function(T,I){return T[0]=1/I[0],T[1]=1/I[1],T[2]=1/I[2],T},ht.normalize=function(T,I){var z=I[0],O=I[1],V=I[2],j=z*z+O*O+V*V;return j>0&&(j=1/Math.sqrt(j)),T[0]=I[0]*j,T[1]=I[1]*j,T[2]=I[2]*j,T},ht.dot=w,ht.cross=function(T,I,z){var O=I[0],V=I[1],j=I[2],N=z[0],G=z[1],H=z[2];return T[0]=V*H-j*G,T[1]=j*N-O*H,T[2]=O*G-V*N,T},ht.lerp=function(T,I,z,O){var V=I[0],j=I[1],N=I[2];return T[0]=V+O*(z[0]-V),T[1]=j+O*(z[1]-j),T[2]=N+O*(z[2]-N),T},ht.hermite=function(T,I,z,O,V,j){var N=j*j,G=N*(2*j-3)+1,H=N*(j-2)+j,K=N*(j-1),se=N*(3-2*j);return T[0]=I[0]*G+z[0]*H+O[0]*K+V[0]*se,T[1]=I[1]*G+z[1]*H+O[1]*K+V[1]*se,T[2]=I[2]*G+z[2]*H+O[2]*K+V[2]*se,T},ht.bezier=function(T,I,z,O,V,j){var N=1-j,G=N*N,H=j*j,K=G*N,se=3*j*G,re=3*H*N,ie=H*j;return T[0]=I[0]*K+z[0]*se+O[0]*re+V[0]*ie,T[1]=I[1]*K+z[1]*se+O[1]*re+V[1]*ie,T[2]=I[2]*K+z[2]*se+O[2]*re+V[2]*ie,T},ht.random=function(T,I){I=I||1;var z=2*e.RANDOM()*Math.PI,O=2*e.RANDOM()-1,V=Math.sqrt(1-O*O)*I;return T[0]=Math.cos(z)*V,T[1]=Math.sin(z)*V,T[2]=O*I,T},ht.transformMat4=function(T,I,z){var O=I[0],V=I[1],j=I[2],N=z[3]*O+z[7]*V+z[11]*j+z[15];return T[0]=(z[0]*O+z[4]*V+z[8]*j+z[12])/(N=N||1),T[1]=(z[1]*O+z[5]*V+z[9]*j+z[13])/N,T[2]=(z[2]*O+z[6]*V+z[10]*j+z[14])/N,T},ht.transformMat3=function(T,I,z){var O=I[0],V=I[1],j=I[2];return T[0]=O*z[0]+V*z[3]+j*z[6],T[1]=O*z[1]+V*z[4]+j*z[7],T[2]=O*z[2]+V*z[5]+j*z[8],T},ht.transformQuat=function(T,I,z){var O=z[0],V=z[1],j=z[2],N=I[0],G=I[1],H=I[2],K=V*H-j*G,se=j*N-O*H,re=O*G-V*N,ie=V*re-j*se,_e=j*K-O*re,oe=O*se-V*K,ye=2*z[3];return se*=ye,re*=ye,_e*=2,oe*=2,T[0]=N+(K*=ye)+(ie*=2),T[1]=G+se+_e,T[2]=H+re+oe,T},ht.rotateX=function(T,I,z,O){var V=[],j=[];return V[0]=I[0]-z[0],V[1]=I[1]-z[1],V[2]=I[2]-z[2],j[0]=V[0],j[1]=V[1]*Math.cos(O)-V[2]*Math.sin(O),j[2]=V[1]*Math.sin(O)+V[2]*Math.cos(O),T[0]=j[0]+z[0],T[1]=j[1]+z[1],T[2]=j[2]+z[2],T},ht.rotateY=function(T,I,z,O){var V=[],j=[];return V[0]=I[0]-z[0],V[1]=I[1]-z[1],V[2]=I[2]-z[2],j[0]=V[2]*Math.sin(O)+V[0]*Math.cos(O),j[1]=V[1],j[2]=V[2]*Math.cos(O)-V[0]*Math.sin(O),T[0]=j[0]+z[0],T[1]=j[1]+z[1],T[2]=j[2]+z[2],T},ht.rotateZ=function(T,I,z,O){var V=[],j=[];return V[0]=I[0]-z[0],V[1]=I[1]-z[1],V[2]=I[2]-z[2],j[0]=V[0]*Math.cos(O)-V[1]*Math.sin(O),j[1]=V[0]*Math.sin(O)+V[1]*Math.cos(O),j[2]=V[2],T[0]=j[0]+z[0],T[1]=j[1]+z[1],T[2]=j[2]+z[2],T},ht.angle=function(T,I){var z=T[0],O=T[1],V=T[2],j=I[0],N=I[1],G=I[2],H=Math.sqrt(z*z+O*O+V*V)*Math.sqrt(j*j+N*N+G*G),K=H&&w(T,I)/H;return Math.acos(Math.min(Math.max(K,-1),1))},ht.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T},ht.str=function(T){return"vec3("+T[0]+", "+T[1]+", "+T[2]+")"},ht.exactEquals=function(T,I){return T[0]===I[0]&&T[1]===I[1]&&T[2]===I[2]},ht.equals=function(T,I){var z=T[0],O=T[1],V=T[2],j=I[0],N=I[1],G=I[2];return Math.abs(z-j)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(j))&&Math.abs(O-N)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(N))&&Math.abs(V-G)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(G))},ht.forEach=ht.sqrLen=ht.len=ht.sqrDist=ht.dist=ht.div=ht.mul=ht.sub=void 0;var e=function(T,I){if(T&&T.__esModule)return T;if(T===null||s(T)!=="object"&&typeof T!="function")return{default:T};var z=i(void 0);if(z&&z.has(T))return z.get(T);var O={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in T)if(j!=="default"&&Object.prototype.hasOwnProperty.call(T,j)){var N=V?Object.getOwnPropertyDescriptor(T,j):null;N&&(N.get||N.set)?Object.defineProperty(O,j,N):O[j]=T[j]}return O.default=T,z&&z.set(T,O),O}(ze());function i(T){if(typeof WeakMap!="function")return null;var I=new WeakMap,z=new WeakMap;return(i=function(O){return O?z:I})(T)}function o(){var T=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0),T}function h(T){return Math.hypot(T[0],T[1],T[2])}function l(T,I,z){return T[0]=I[0]-z[0],T[1]=I[1]-z[1],T[2]=I[2]-z[2],T}function f(T,I,z){return T[0]=I[0]*z[0],T[1]=I[1]*z[1],T[2]=I[2]*z[2],T}function g(T,I,z){return T[0]=I[0]/z[0],T[1]=I[1]/z[1],T[2]=I[2]/z[2],T}function b(T,I){return Math.hypot(I[0]-T[0],I[1]-T[1],I[2]-T[2])}function M(T,I){var z=I[0]-T[0],O=I[1]-T[1],V=I[2]-T[2];return z*z+O*O+V*V}function m(T){var I=T[0],z=T[1],O=T[2];return I*I+z*z+O*O}function w(T,I){return T[0]*I[0]+T[1]*I[1]+T[2]*I[2]}ht.sub=l,ht.mul=f,ht.div=g,ht.dist=b,ht.sqrDist=M,ht.len=h,ht.sqrLen=m;var E,v=(E=o(),function(T,I,z,O,V,j){var N,G;for(I||(I=3),z||(z=0),G=O?Math.min(O*I+z,T.length):T.length,N=z;N<G;N+=I)E[0]=T[N],E[1]=T[N+1],E[2]=T[N+2],V(E,E,j),T[N]=E[0],T[N+1]=E[1],T[N+2]=E[2];return T});return ht.forEach=v,ht}var Wt,vi,Ft={};function Qt(){if(Wt)return Ft;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},s(v)}Wt=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=o,Ft.clone=function(v){var T=new e.ARRAY_TYPE(4);return T[0]=v[0],T[1]=v[1],T[2]=v[2],T[3]=v[3],T},Ft.fromValues=function(v,T,I,z){var O=new e.ARRAY_TYPE(4);return O[0]=v,O[1]=T,O[2]=I,O[3]=z,O},Ft.copy=function(v,T){return v[0]=T[0],v[1]=T[1],v[2]=T[2],v[3]=T[3],v},Ft.set=function(v,T,I,z,O){return v[0]=T,v[1]=I,v[2]=z,v[3]=O,v},Ft.add=function(v,T,I){return v[0]=T[0]+I[0],v[1]=T[1]+I[1],v[2]=T[2]+I[2],v[3]=T[3]+I[3],v},Ft.subtract=h,Ft.multiply=l,Ft.divide=f,Ft.ceil=function(v,T){return v[0]=Math.ceil(T[0]),v[1]=Math.ceil(T[1]),v[2]=Math.ceil(T[2]),v[3]=Math.ceil(T[3]),v},Ft.floor=function(v,T){return v[0]=Math.floor(T[0]),v[1]=Math.floor(T[1]),v[2]=Math.floor(T[2]),v[3]=Math.floor(T[3]),v},Ft.min=function(v,T,I){return v[0]=Math.min(T[0],I[0]),v[1]=Math.min(T[1],I[1]),v[2]=Math.min(T[2],I[2]),v[3]=Math.min(T[3],I[3]),v},Ft.max=function(v,T,I){return v[0]=Math.max(T[0],I[0]),v[1]=Math.max(T[1],I[1]),v[2]=Math.max(T[2],I[2]),v[3]=Math.max(T[3],I[3]),v},Ft.round=function(v,T){return v[0]=Math.round(T[0]),v[1]=Math.round(T[1]),v[2]=Math.round(T[2]),v[3]=Math.round(T[3]),v},Ft.scale=function(v,T,I){return v[0]=T[0]*I,v[1]=T[1]*I,v[2]=T[2]*I,v[3]=T[3]*I,v},Ft.scaleAndAdd=function(v,T,I,z){return v[0]=T[0]+I[0]*z,v[1]=T[1]+I[1]*z,v[2]=T[2]+I[2]*z,v[3]=T[3]+I[3]*z,v},Ft.distance=g,Ft.squaredDistance=b,Ft.length=M,Ft.squaredLength=m,Ft.negate=function(v,T){return v[0]=-T[0],v[1]=-T[1],v[2]=-T[2],v[3]=-T[3],v},Ft.inverse=function(v,T){return v[0]=1/T[0],v[1]=1/T[1],v[2]=1/T[2],v[3]=1/T[3],v},Ft.normalize=function(v,T){var I=T[0],z=T[1],O=T[2],V=T[3],j=I*I+z*z+O*O+V*V;return j>0&&(j=1/Math.sqrt(j)),v[0]=I*j,v[1]=z*j,v[2]=O*j,v[3]=V*j,v},Ft.dot=function(v,T){return v[0]*T[0]+v[1]*T[1]+v[2]*T[2]+v[3]*T[3]},Ft.cross=function(v,T,I,z){var O=I[0]*z[1]-I[1]*z[0],V=I[0]*z[2]-I[2]*z[0],j=I[0]*z[3]-I[3]*z[0],N=I[1]*z[2]-I[2]*z[1],G=I[1]*z[3]-I[3]*z[1],H=I[2]*z[3]-I[3]*z[2],K=T[0],se=T[1],re=T[2],ie=T[3];return v[0]=se*H-re*G+ie*N,v[1]=-K*H+re*j-ie*V,v[2]=K*G-se*j+ie*O,v[3]=-K*N+se*V-re*O,v},Ft.lerp=function(v,T,I,z){var O=T[0],V=T[1],j=T[2],N=T[3];return v[0]=O+z*(I[0]-O),v[1]=V+z*(I[1]-V),v[2]=j+z*(I[2]-j),v[3]=N+z*(I[3]-N),v},Ft.random=function(v,T){var I,z,O,V,j,N;T=T||1;do j=(I=2*e.RANDOM()-1)*I+(z=2*e.RANDOM()-1)*z;while(j>=1);do N=(O=2*e.RANDOM()-1)*O+(V=2*e.RANDOM()-1)*V;while(N>=1);var G=Math.sqrt((1-j)/N);return v[0]=T*I,v[1]=T*z,v[2]=T*O*G,v[3]=T*V*G,v},Ft.transformMat4=function(v,T,I){var z=T[0],O=T[1],V=T[2],j=T[3];return v[0]=I[0]*z+I[4]*O+I[8]*V+I[12]*j,v[1]=I[1]*z+I[5]*O+I[9]*V+I[13]*j,v[2]=I[2]*z+I[6]*O+I[10]*V+I[14]*j,v[3]=I[3]*z+I[7]*O+I[11]*V+I[15]*j,v},Ft.transformQuat=function(v,T,I){var z=T[0],O=T[1],V=T[2],j=I[0],N=I[1],G=I[2],H=I[3],K=H*z+N*V-G*O,se=H*O+G*z-j*V,re=H*V+j*O-N*z,ie=-j*z-N*O-G*V;return v[0]=K*H+ie*-j+se*-G-re*-N,v[1]=se*H+ie*-N+re*-j-K*-G,v[2]=re*H+ie*-G+K*-N-se*-j,v[3]=T[3],v},Ft.zero=function(v){return v[0]=0,v[1]=0,v[2]=0,v[3]=0,v},Ft.str=function(v){return"vec4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+")"},Ft.exactEquals=function(v,T){return v[0]===T[0]&&v[1]===T[1]&&v[2]===T[2]&&v[3]===T[3]},Ft.equals=function(v,T){var I=v[0],z=v[1],O=v[2],V=v[3],j=T[0],N=T[1],G=T[2],H=T[3];return Math.abs(I-j)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(j))&&Math.abs(z-N)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(N))&&Math.abs(O-G)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(G))&&Math.abs(V-H)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))},Ft.forEach=Ft.sqrLen=Ft.len=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=void 0;var e=function(v,T){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var I=i(void 0);if(I&&I.has(v))return I.get(v);var z={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in v)if(V!=="default"&&Object.prototype.hasOwnProperty.call(v,V)){var j=O?Object.getOwnPropertyDescriptor(v,V):null;j&&(j.get||j.set)?Object.defineProperty(z,V,j):z[V]=v[V]}return z.default=v,I&&I.set(v,z),z}(ze());function i(v){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(i=function(z){return z?I:T})(v)}function o(){var v=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0,v[3]=0),v}function h(v,T,I){return v[0]=T[0]-I[0],v[1]=T[1]-I[1],v[2]=T[2]-I[2],v[3]=T[3]-I[3],v}function l(v,T,I){return v[0]=T[0]*I[0],v[1]=T[1]*I[1],v[2]=T[2]*I[2],v[3]=T[3]*I[3],v}function f(v,T,I){return v[0]=T[0]/I[0],v[1]=T[1]/I[1],v[2]=T[2]/I[2],v[3]=T[3]/I[3],v}function g(v,T){return Math.hypot(T[0]-v[0],T[1]-v[1],T[2]-v[2],T[3]-v[3])}function b(v,T){var I=T[0]-v[0],z=T[1]-v[1],O=T[2]-v[2],V=T[3]-v[3];return I*I+z*z+O*O+V*V}function M(v){return Math.hypot(v[0],v[1],v[2],v[3])}function m(v){var T=v[0],I=v[1],z=v[2],O=v[3];return T*T+I*I+z*z+O*O}Ft.sub=h,Ft.mul=l,Ft.div=f,Ft.dist=g,Ft.sqrDist=b,Ft.len=M,Ft.sqrLen=m;var w,E=(w=o(),function(v,T,I,z,O,V){var j,N;for(T||(T=4),I||(I=0),N=z?Math.min(z*T+I,v.length):v.length,j=I;j<N;j+=T)w[0]=v[j],w[1]=v[j+1],w[2]=v[j+2],w[3]=v[j+3],O(w,w,V),v[j]=w[0],v[j+1]=w[1],v[j+2]=w[2],v[j+3]=w[3];return v});return Ft.forEach=E,Ft}function Ti(){if(vi)return Je;function s(oe){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ye){return typeof ye}:function(ye){return ye&&typeof Symbol=="function"&&ye.constructor===Symbol&&ye!==Symbol.prototype?"symbol":typeof ye},s(oe)}vi=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=g,Je.identity=function(oe){return oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe},Je.setAxisAngle=b,Je.getAxisAngle=function(oe,ye){var be=2*Math.acos(ye[3]),ve=Math.sin(be/2);return ve>e.EPSILON?(oe[0]=ye[0]/ve,oe[1]=ye[1]/ve,oe[2]=ye[2]/ve):(oe[0]=1,oe[1]=0,oe[2]=0),be},Je.getAngle=function(oe,ye){var be=I(oe,ye);return Math.acos(2*be*be-1)},Je.multiply=M,Je.rotateX=function(oe,ye,be){be*=.5;var ve=ye[0],Ee=ye[1],Ie=ye[2],De=ye[3],Ae=Math.sin(be),Ye=Math.cos(be);return oe[0]=ve*Ye+De*Ae,oe[1]=Ee*Ye+Ie*Ae,oe[2]=Ie*Ye-Ee*Ae,oe[3]=De*Ye-ve*Ae,oe},Je.rotateY=function(oe,ye,be){be*=.5;var ve=ye[0],Ee=ye[1],Ie=ye[2],De=ye[3],Ae=Math.sin(be),Ye=Math.cos(be);return oe[0]=ve*Ye-Ie*Ae,oe[1]=Ee*Ye+De*Ae,oe[2]=Ie*Ye+ve*Ae,oe[3]=De*Ye-Ee*Ae,oe},Je.rotateZ=function(oe,ye,be){be*=.5;var ve=ye[0],Ee=ye[1],Ie=ye[2],De=ye[3],Ae=Math.sin(be),Ye=Math.cos(be);return oe[0]=ve*Ye+Ee*Ae,oe[1]=Ee*Ye-ve*Ae,oe[2]=Ie*Ye+De*Ae,oe[3]=De*Ye-Ie*Ae,oe},Je.calculateW=function(oe,ye){var be=ye[0],ve=ye[1],Ee=ye[2];return oe[0]=be,oe[1]=ve,oe[2]=Ee,oe[3]=Math.sqrt(Math.abs(1-be*be-ve*ve-Ee*Ee)),oe},Je.exp=m,Je.ln=w,Je.pow=function(oe,ye,be){return w(oe,ye),T(oe,oe,be),m(oe,oe),oe},Je.slerp=E,Je.random=function(oe){var ye=e.RANDOM(),be=e.RANDOM(),ve=e.RANDOM(),Ee=Math.sqrt(1-ye),Ie=Math.sqrt(ye);return oe[0]=Ee*Math.sin(2*Math.PI*be),oe[1]=Ee*Math.cos(2*Math.PI*be),oe[2]=Ie*Math.sin(2*Math.PI*ve),oe[3]=Ie*Math.cos(2*Math.PI*ve),oe},Je.invert=function(oe,ye){var be=ye[0],ve=ye[1],Ee=ye[2],Ie=ye[3],De=be*be+ve*ve+Ee*Ee+Ie*Ie,Ae=De?1/De:0;return oe[0]=-be*Ae,oe[1]=-ve*Ae,oe[2]=-Ee*Ae,oe[3]=Ie*Ae,oe},Je.conjugate=function(oe,ye){return oe[0]=-ye[0],oe[1]=-ye[1],oe[2]=-ye[2],oe[3]=ye[3],oe},Je.fromMat3=v,Je.fromEuler=function(oe,ye,be,ve){var Ee=.5*Math.PI/180;ye*=Ee,be*=Ee,ve*=Ee;var Ie=Math.sin(ye),De=Math.cos(ye),Ae=Math.sin(be),Ye=Math.cos(be),rt=Math.sin(ve),Xe=Math.cos(ve);return oe[0]=Ie*Ye*Xe-De*Ae*rt,oe[1]=De*Ae*Xe+Ie*Ye*rt,oe[2]=De*Ye*rt-Ie*Ae*Xe,oe[3]=De*Ye*Xe+Ie*Ae*rt,oe},Je.str=function(oe){return"quat("+oe[0]+", "+oe[1]+", "+oe[2]+", "+oe[3]+")"},Je.setAxes=Je.sqlerp=Je.rotationTo=Je.equals=Je.exactEquals=Je.normalize=Je.sqrLen=Je.squaredLength=Je.len=Je.length=Je.lerp=Je.dot=Je.scale=Je.mul=Je.add=Je.set=Je.copy=Je.fromValues=Je.clone=void 0;var e=f(ze()),i=f(at()),o=f(vt()),h=f(Qt());function l(oe){if(typeof WeakMap!="function")return null;var ye=new WeakMap,be=new WeakMap;return(l=function(ve){return ve?be:ye})(oe)}function f(oe,ye){if(oe&&oe.__esModule)return oe;if(oe===null||s(oe)!=="object"&&typeof oe!="function")return{default:oe};var be=l(ye);if(be&&be.has(oe))return be.get(oe);var ve={},Ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in oe)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(oe,Ie)){var De=Ee?Object.getOwnPropertyDescriptor(oe,Ie):null;De&&(De.get||De.set)?Object.defineProperty(ve,Ie,De):ve[Ie]=oe[Ie]}return ve.default=oe,be&&be.set(oe,ve),ve}function g(){var oe=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0),oe[3]=1,oe}function b(oe,ye,be){be*=.5;var ve=Math.sin(be);return oe[0]=ve*ye[0],oe[1]=ve*ye[1],oe[2]=ve*ye[2],oe[3]=Math.cos(be),oe}function M(oe,ye,be){var ve=ye[0],Ee=ye[1],Ie=ye[2],De=ye[3],Ae=be[0],Ye=be[1],rt=be[2],Xe=be[3];return oe[0]=ve*Xe+De*Ae+Ee*rt-Ie*Ye,oe[1]=Ee*Xe+De*Ye+Ie*Ae-ve*rt,oe[2]=Ie*Xe+De*rt+ve*Ye-Ee*Ae,oe[3]=De*Xe-ve*Ae-Ee*Ye-Ie*rt,oe}function m(oe,ye){var be=ye[0],ve=ye[1],Ee=ye[2],Ie=ye[3],De=Math.sqrt(be*be+ve*ve+Ee*Ee),Ae=Math.exp(Ie),Ye=De>0?Ae*Math.sin(De)/De:0;return oe[0]=be*Ye,oe[1]=ve*Ye,oe[2]=Ee*Ye,oe[3]=Ae*Math.cos(De),oe}function w(oe,ye){var be=ye[0],ve=ye[1],Ee=ye[2],Ie=ye[3],De=Math.sqrt(be*be+ve*ve+Ee*Ee),Ae=De>0?Math.atan2(De,Ie)/De:0;return oe[0]=be*Ae,oe[1]=ve*Ae,oe[2]=Ee*Ae,oe[3]=.5*Math.log(be*be+ve*ve+Ee*Ee+Ie*Ie),oe}function E(oe,ye,be,ve){var Ee,Ie,De,Ae,Ye,rt=ye[0],Xe=ye[1],It=ye[2],Et=ye[3],pt=be[0],ot=be[1],jt=be[2],Ct=be[3];return(Ie=rt*pt+Xe*ot+It*jt+Et*Ct)<0&&(Ie=-Ie,pt=-pt,ot=-ot,jt=-jt,Ct=-Ct),1-Ie>e.EPSILON?(Ee=Math.acos(Ie),De=Math.sin(Ee),Ae=Math.sin((1-ve)*Ee)/De,Ye=Math.sin(ve*Ee)/De):(Ae=1-ve,Ye=ve),oe[0]=Ae*rt+Ye*pt,oe[1]=Ae*Xe+Ye*ot,oe[2]=Ae*It+Ye*jt,oe[3]=Ae*Et+Ye*Ct,oe}function v(oe,ye){var be,ve=ye[0]+ye[4]+ye[8];if(ve>0)be=Math.sqrt(ve+1),oe[3]=.5*be,oe[0]=(ye[5]-ye[7])*(be=.5/be),oe[1]=(ye[6]-ye[2])*be,oe[2]=(ye[1]-ye[3])*be;else{var Ee=0;ye[4]>ye[0]&&(Ee=1),ye[8]>ye[3*Ee+Ee]&&(Ee=2);var Ie=(Ee+1)%3,De=(Ee+2)%3;be=Math.sqrt(ye[3*Ee+Ee]-ye[3*Ie+Ie]-ye[3*De+De]+1),oe[Ee]=.5*be,oe[3]=(ye[3*Ie+De]-ye[3*De+Ie])*(be=.5/be),oe[Ie]=(ye[3*Ie+Ee]+ye[3*Ee+Ie])*be,oe[De]=(ye[3*De+Ee]+ye[3*Ee+De])*be}return oe}Je.clone=h.clone,Je.fromValues=h.fromValues,Je.copy=h.copy,Je.set=h.set,Je.add=h.add,Je.mul=M;var T=h.scale;Je.scale=T;var I=h.dot;Je.dot=I,Je.lerp=h.lerp;var z=h.length;Je.length=z,Je.len=z;var O=h.squaredLength;Je.squaredLength=O,Je.sqrLen=O;var V=h.normalize;Je.normalize=V,Je.exactEquals=h.exactEquals,Je.equals=h.equals;var j,N,G,H=(j=o.create(),N=o.fromValues(1,0,0),G=o.fromValues(0,1,0),function(oe,ye,be){var ve=o.dot(ye,be);return ve<-.999999?(o.cross(j,N,ye),o.len(j)<1e-6&&o.cross(j,G,ye),o.normalize(j,j),b(oe,j,Math.PI),oe):ve>.999999?(oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe):(o.cross(j,ye,be),oe[0]=j[0],oe[1]=j[1],oe[2]=j[2],oe[3]=1+ve,V(oe,oe))});Je.rotationTo=H;var K,se,re=(K=g(),se=g(),function(oe,ye,be,ve,Ee,Ie){return E(K,ye,Ee,Ie),E(se,be,ve,Ie),E(oe,K,se,2*Ie*(1-Ie)),oe});Je.sqlerp=re;var ie,_e=(ie=i.create(),function(oe,ye,be,ve){return ie[0]=be[0],ie[3]=be[1],ie[6]=be[2],ie[1]=ve[0],ie[4]=ve[1],ie[7]=ve[2],ie[2]=-ye[0],ie[5]=-ye[1],ie[8]=-ye[2],V(oe,v(oe,ie))});return Je.setAxes=_e,Je}var hi,ri={};function rr(){if(hi)return ri;function s(E){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},s(E)}hi=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.create=function(){var E=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[4]=0,E[5]=0,E[6]=0,E[7]=0),E[3]=1,E},ri.clone=function(E){var v=new e.ARRAY_TYPE(8);return v[0]=E[0],v[1]=E[1],v[2]=E[2],v[3]=E[3],v[4]=E[4],v[5]=E[5],v[6]=E[6],v[7]=E[7],v},ri.fromValues=function(E,v,T,I,z,O,V,j){var N=new e.ARRAY_TYPE(8);return N[0]=E,N[1]=v,N[2]=T,N[3]=I,N[4]=z,N[5]=O,N[6]=V,N[7]=j,N},ri.fromRotationTranslationValues=function(E,v,T,I,z,O,V){var j=new e.ARRAY_TYPE(8);j[0]=E,j[1]=v,j[2]=T,j[3]=I;var N=.5*z,G=.5*O,H=.5*V;return j[4]=N*I+G*T-H*v,j[5]=G*I+H*E-N*T,j[6]=H*I+N*v-G*E,j[7]=-N*E-G*v-H*T,j},ri.fromRotationTranslation=f,ri.fromTranslation=function(E,v){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=.5*v[0],E[5]=.5*v[1],E[6]=.5*v[2],E[7]=0,E},ri.fromRotation=function(E,v){return E[0]=v[0],E[1]=v[1],E[2]=v[2],E[3]=v[3],E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},ri.fromMat4=function(E,v){var T=i.create();o.getRotation(T,v);var I=new e.ARRAY_TYPE(3);return o.getTranslation(I,v),f(E,T,I),E},ri.copy=g,ri.identity=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=1,E[4]=0,E[5]=0,E[6]=0,E[7]=0,E},ri.set=function(E,v,T,I,z,O,V,j,N){return E[0]=v,E[1]=T,E[2]=I,E[3]=z,E[4]=O,E[5]=V,E[6]=j,E[7]=N,E},ri.getDual=function(E,v){return E[0]=v[4],E[1]=v[5],E[2]=v[6],E[3]=v[7],E},ri.setDual=function(E,v){return E[4]=v[0],E[5]=v[1],E[6]=v[2],E[7]=v[3],E},ri.getTranslation=function(E,v){var T=v[4],I=v[5],z=v[6],O=v[7],V=-v[0],j=-v[1],N=-v[2],G=v[3];return E[0]=2*(T*G+O*V+I*N-z*j),E[1]=2*(I*G+O*j+z*V-T*N),E[2]=2*(z*G+O*N+T*j-I*V),E},ri.translate=function(E,v,T){var I=v[0],z=v[1],O=v[2],V=v[3],j=.5*T[0],N=.5*T[1],G=.5*T[2],H=v[4],K=v[5],se=v[6],re=v[7];return E[0]=I,E[1]=z,E[2]=O,E[3]=V,E[4]=V*j+z*G-O*N+H,E[5]=V*N+O*j-I*G+K,E[6]=V*G+I*N-z*j+se,E[7]=-I*j-z*N-O*G+re,E},ri.rotateX=function(E,v,T){var I=-v[0],z=-v[1],O=-v[2],V=v[3],j=v[4],N=v[5],G=v[6],H=v[7],K=j*V+H*I+N*O-G*z,se=N*V+H*z+G*I-j*O,re=G*V+H*O+j*z-N*I,ie=H*V-j*I-N*z-G*O;return i.rotateX(E,v,T),E[4]=K*(V=E[3])+ie*(I=E[0])+se*(O=E[2])-re*(z=E[1]),E[5]=se*V+ie*z+re*I-K*O,E[6]=re*V+ie*O+K*z-se*I,E[7]=ie*V-K*I-se*z-re*O,E},ri.rotateY=function(E,v,T){var I=-v[0],z=-v[1],O=-v[2],V=v[3],j=v[4],N=v[5],G=v[6],H=v[7],K=j*V+H*I+N*O-G*z,se=N*V+H*z+G*I-j*O,re=G*V+H*O+j*z-N*I,ie=H*V-j*I-N*z-G*O;return i.rotateY(E,v,T),E[4]=K*(V=E[3])+ie*(I=E[0])+se*(O=E[2])-re*(z=E[1]),E[5]=se*V+ie*z+re*I-K*O,E[6]=re*V+ie*O+K*z-se*I,E[7]=ie*V-K*I-se*z-re*O,E},ri.rotateZ=function(E,v,T){var I=-v[0],z=-v[1],O=-v[2],V=v[3],j=v[4],N=v[5],G=v[6],H=v[7],K=j*V+H*I+N*O-G*z,se=N*V+H*z+G*I-j*O,re=G*V+H*O+j*z-N*I,ie=H*V-j*I-N*z-G*O;return i.rotateZ(E,v,T),E[4]=K*(V=E[3])+ie*(I=E[0])+se*(O=E[2])-re*(z=E[1]),E[5]=se*V+ie*z+re*I-K*O,E[6]=re*V+ie*O+K*z-se*I,E[7]=ie*V-K*I-se*z-re*O,E},ri.rotateByQuatAppend=function(E,v,T){var I=T[0],z=T[1],O=T[2],V=T[3],j=v[0],N=v[1],G=v[2],H=v[3];return E[0]=j*V+H*I+N*O-G*z,E[1]=N*V+H*z+G*I-j*O,E[2]=G*V+H*O+j*z-N*I,E[3]=H*V-j*I-N*z-G*O,E[4]=(j=v[4])*V+(H=v[7])*I+(N=v[5])*O-(G=v[6])*z,E[5]=N*V+H*z+G*I-j*O,E[6]=G*V+H*O+j*z-N*I,E[7]=H*V-j*I-N*z-G*O,E},ri.rotateByQuatPrepend=function(E,v,T){var I=v[0],z=v[1],O=v[2],V=v[3],j=T[0],N=T[1],G=T[2],H=T[3];return E[0]=I*H+V*j+z*G-O*N,E[1]=z*H+V*N+O*j-I*G,E[2]=O*H+V*G+I*N-z*j,E[3]=V*H-I*j-z*N-O*G,E[4]=I*(H=T[7])+V*(j=T[4])+z*(G=T[6])-O*(N=T[5]),E[5]=z*H+V*N+O*j-I*G,E[6]=O*H+V*G+I*N-z*j,E[7]=V*H-I*j-z*N-O*G,E},ri.rotateAroundAxis=function(E,v,T,I){if(Math.abs(I)<e.EPSILON)return g(E,v);var z=Math.hypot(T[0],T[1],T[2]);I*=.5;var O=Math.sin(I),V=O*T[0]/z,j=O*T[1]/z,N=O*T[2]/z,G=Math.cos(I),H=v[0],K=v[1],se=v[2],re=v[3];E[0]=H*G+re*V+K*N-se*j,E[1]=K*G+re*j+se*V-H*N,E[2]=se*G+re*N+H*j-K*V,E[3]=re*G-H*V-K*j-se*N;var ie=v[4],_e=v[5],oe=v[6],ye=v[7];return E[4]=ie*G+ye*V+_e*N-oe*j,E[5]=_e*G+ye*j+oe*V-ie*N,E[6]=oe*G+ye*N+ie*j-_e*V,E[7]=ye*G-ie*V-_e*j-oe*N,E},ri.add=function(E,v,T){return E[0]=v[0]+T[0],E[1]=v[1]+T[1],E[2]=v[2]+T[2],E[3]=v[3]+T[3],E[4]=v[4]+T[4],E[5]=v[5]+T[5],E[6]=v[6]+T[6],E[7]=v[7]+T[7],E},ri.multiply=b,ri.scale=function(E,v,T){return E[0]=v[0]*T,E[1]=v[1]*T,E[2]=v[2]*T,E[3]=v[3]*T,E[4]=v[4]*T,E[5]=v[5]*T,E[6]=v[6]*T,E[7]=v[7]*T,E},ri.lerp=function(E,v,T,I){var z=1-I;return M(v,T)<0&&(I=-I),E[0]=v[0]*z+T[0]*I,E[1]=v[1]*z+T[1]*I,E[2]=v[2]*z+T[2]*I,E[3]=v[3]*z+T[3]*I,E[4]=v[4]*z+T[4]*I,E[5]=v[5]*z+T[5]*I,E[6]=v[6]*z+T[6]*I,E[7]=v[7]*z+T[7]*I,E},ri.invert=function(E,v){var T=w(v);return E[0]=-v[0]/T,E[1]=-v[1]/T,E[2]=-v[2]/T,E[3]=v[3]/T,E[4]=-v[4]/T,E[5]=-v[5]/T,E[6]=-v[6]/T,E[7]=v[7]/T,E},ri.conjugate=function(E,v){return E[0]=-v[0],E[1]=-v[1],E[2]=-v[2],E[3]=v[3],E[4]=-v[4],E[5]=-v[5],E[6]=-v[6],E[7]=v[7],E},ri.normalize=function(E,v){var T=w(v);if(T>0){T=Math.sqrt(T);var I=v[0]/T,z=v[1]/T,O=v[2]/T,V=v[3]/T,j=v[4],N=v[5],G=v[6],H=v[7],K=I*j+z*N+O*G+V*H;E[0]=I,E[1]=z,E[2]=O,E[3]=V,E[4]=(j-I*K)/T,E[5]=(N-z*K)/T,E[6]=(G-O*K)/T,E[7]=(H-V*K)/T}return E},ri.str=function(E){return"quat2("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+")"},ri.exactEquals=function(E,v){return E[0]===v[0]&&E[1]===v[1]&&E[2]===v[2]&&E[3]===v[3]&&E[4]===v[4]&&E[5]===v[5]&&E[6]===v[6]&&E[7]===v[7]},ri.equals=function(E,v){var T=E[0],I=E[1],z=E[2],O=E[3],V=E[4],j=E[5],N=E[6],G=E[7],H=v[0],K=v[1],se=v[2],re=v[3],ie=v[4],_e=v[5],oe=v[6],ye=v[7];return Math.abs(T-H)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(H))&&Math.abs(I-K)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(K))&&Math.abs(z-se)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(se))&&Math.abs(O-re)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(V-ie)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ie))&&Math.abs(j-_e)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(_e))&&Math.abs(N-oe)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(oe))&&Math.abs(G-ye)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(ye))},ri.sqrLen=ri.squaredLength=ri.len=ri.length=ri.dot=ri.mul=ri.setReal=ri.getReal=void 0;var e=l(ze()),i=l(Ti()),o=l(zt());function h(E){if(typeof WeakMap!="function")return null;var v=new WeakMap,T=new WeakMap;return(h=function(I){return I?T:v})(E)}function l(E,v){if(E&&E.__esModule)return E;if(E===null||s(E)!=="object"&&typeof E!="function")return{default:E};var T=h(v);if(T&&T.has(E))return T.get(E);var I={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in E)if(O!=="default"&&Object.prototype.hasOwnProperty.call(E,O)){var V=z?Object.getOwnPropertyDescriptor(E,O):null;V&&(V.get||V.set)?Object.defineProperty(I,O,V):I[O]=E[O]}return I.default=E,T&&T.set(E,I),I}function f(E,v,T){var I=.5*T[0],z=.5*T[1],O=.5*T[2],V=v[0],j=v[1],N=v[2],G=v[3];return E[0]=V,E[1]=j,E[2]=N,E[3]=G,E[4]=I*G+z*N-O*j,E[5]=z*G+O*V-I*N,E[6]=O*G+I*j-z*V,E[7]=-I*V-z*j-O*N,E}function g(E,v){return E[0]=v[0],E[1]=v[1],E[2]=v[2],E[3]=v[3],E[4]=v[4],E[5]=v[5],E[6]=v[6],E[7]=v[7],E}function b(E,v,T){var I=v[0],z=v[1],O=v[2],V=v[3],j=T[4],N=T[5],G=T[6],H=T[7],K=v[4],se=v[5],re=v[6],ie=v[7],_e=T[0],oe=T[1],ye=T[2],be=T[3];return E[0]=I*be+V*_e+z*ye-O*oe,E[1]=z*be+V*oe+O*_e-I*ye,E[2]=O*be+V*ye+I*oe-z*_e,E[3]=V*be-I*_e-z*oe-O*ye,E[4]=I*H+V*j+z*G-O*N+K*be+ie*_e+se*ye-re*oe,E[5]=z*H+V*N+O*j-I*G+se*be+ie*oe+re*_e-K*ye,E[6]=O*H+V*G+I*N-z*j+re*be+ie*ye+K*oe-se*_e,E[7]=V*H-I*j-z*N-O*G+ie*be-K*_e-se*oe-re*ye,E}ri.getReal=i.copy,ri.setReal=i.copy,ri.mul=b;var M=i.dot;ri.dot=M;var m=i.length;ri.length=m,ri.len=m;var w=i.squaredLength;return ri.squaredLength=w,ri.sqrLen=w,ri}var mr,ar,mi={};function nc(){if(mr)return mi;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},s(v)}mr=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=o,mi.clone=function(v){var T=new e.ARRAY_TYPE(2);return T[0]=v[0],T[1]=v[1],T},mi.fromValues=function(v,T){var I=new e.ARRAY_TYPE(2);return I[0]=v,I[1]=T,I},mi.copy=function(v,T){return v[0]=T[0],v[1]=T[1],v},mi.set=function(v,T,I){return v[0]=T,v[1]=I,v},mi.add=function(v,T,I){return v[0]=T[0]+I[0],v[1]=T[1]+I[1],v},mi.subtract=h,mi.multiply=l,mi.divide=f,mi.ceil=function(v,T){return v[0]=Math.ceil(T[0]),v[1]=Math.ceil(T[1]),v},mi.floor=function(v,T){return v[0]=Math.floor(T[0]),v[1]=Math.floor(T[1]),v},mi.min=function(v,T,I){return v[0]=Math.min(T[0],I[0]),v[1]=Math.min(T[1],I[1]),v},mi.max=function(v,T,I){return v[0]=Math.max(T[0],I[0]),v[1]=Math.max(T[1],I[1]),v},mi.round=function(v,T){return v[0]=Math.round(T[0]),v[1]=Math.round(T[1]),v},mi.scale=function(v,T,I){return v[0]=T[0]*I,v[1]=T[1]*I,v},mi.scaleAndAdd=function(v,T,I,z){return v[0]=T[0]+I[0]*z,v[1]=T[1]+I[1]*z,v},mi.distance=g,mi.squaredDistance=b,mi.length=M,mi.squaredLength=m,mi.negate=function(v,T){return v[0]=-T[0],v[1]=-T[1],v},mi.inverse=function(v,T){return v[0]=1/T[0],v[1]=1/T[1],v},mi.normalize=function(v,T){var I=T[0],z=T[1],O=I*I+z*z;return O>0&&(O=1/Math.sqrt(O)),v[0]=T[0]*O,v[1]=T[1]*O,v},mi.dot=function(v,T){return v[0]*T[0]+v[1]*T[1]},mi.cross=function(v,T,I){var z=T[0]*I[1]-T[1]*I[0];return v[0]=v[1]=0,v[2]=z,v},mi.lerp=function(v,T,I,z){var O=T[0],V=T[1];return v[0]=O+z*(I[0]-O),v[1]=V+z*(I[1]-V),v},mi.random=function(v,T){T=T||1;var I=2*e.RANDOM()*Math.PI;return v[0]=Math.cos(I)*T,v[1]=Math.sin(I)*T,v},mi.transformMat2=function(v,T,I){var z=T[0],O=T[1];return v[0]=I[0]*z+I[2]*O,v[1]=I[1]*z+I[3]*O,v},mi.transformMat2d=function(v,T,I){var z=T[0],O=T[1];return v[0]=I[0]*z+I[2]*O+I[4],v[1]=I[1]*z+I[3]*O+I[5],v},mi.transformMat3=function(v,T,I){var z=T[0],O=T[1];return v[0]=I[0]*z+I[3]*O+I[6],v[1]=I[1]*z+I[4]*O+I[7],v},mi.transformMat4=function(v,T,I){var z=T[0],O=T[1];return v[0]=I[0]*z+I[4]*O+I[12],v[1]=I[1]*z+I[5]*O+I[13],v},mi.rotate=function(v,T,I,z){var O=T[0]-I[0],V=T[1]-I[1],j=Math.sin(z),N=Math.cos(z);return v[0]=O*N-V*j+I[0],v[1]=O*j+V*N+I[1],v},mi.angle=function(v,T){var I=v[0],z=v[1],O=T[0],V=T[1],j=Math.sqrt(I*I+z*z)*Math.sqrt(O*O+V*V);return Math.acos(Math.min(Math.max(j&&(I*O+z*V)/j,-1),1))},mi.zero=function(v){return v[0]=0,v[1]=0,v},mi.str=function(v){return"vec2("+v[0]+", "+v[1]+")"},mi.exactEquals=function(v,T){return v[0]===T[0]&&v[1]===T[1]},mi.equals=function(v,T){var I=v[0],z=v[1],O=T[0],V=T[1];return Math.abs(I-O)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(O))&&Math.abs(z-V)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(V))},mi.forEach=mi.sqrLen=mi.sqrDist=mi.dist=mi.div=mi.mul=mi.sub=mi.len=void 0;var e=function(v,T){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var I=i(void 0);if(I&&I.has(v))return I.get(v);var z={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in v)if(V!=="default"&&Object.prototype.hasOwnProperty.call(v,V)){var j=O?Object.getOwnPropertyDescriptor(v,V):null;j&&(j.get||j.set)?Object.defineProperty(z,V,j):z[V]=v[V]}return z.default=v,I&&I.set(v,z),z}(ze());function i(v){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(i=function(z){return z?I:T})(v)}function o(){var v=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(v[0]=0,v[1]=0),v}function h(v,T,I){return v[0]=T[0]-I[0],v[1]=T[1]-I[1],v}function l(v,T,I){return v[0]=T[0]*I[0],v[1]=T[1]*I[1],v}function f(v,T,I){return v[0]=T[0]/I[0],v[1]=T[1]/I[1],v}function g(v,T){return Math.hypot(T[0]-v[0],T[1]-v[1])}function b(v,T){var I=T[0]-v[0],z=T[1]-v[1];return I*I+z*z}function M(v){return Math.hypot(v[0],v[1])}function m(v){var T=v[0],I=v[1];return T*T+I*I}mi.len=M,mi.sub=h,mi.mul=l,mi.div=f,mi.dist=g,mi.sqrDist=b,mi.sqrLen=m;var w,E=(w=o(),function(v,T,I,z,O,V){var j,N;for(T||(T=2),I||(I=0),N=z?Math.min(z*T+I,v.length):v.length,j=I;j<N;j+=T)w[0]=v[j],w[1]=v[j+1],O(w,w,V),v[j]=w[0],v[j+1]=w[1];return v});return mi.forEach=E,mi}function Xo(){if(ar)return Q;function s(v){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},s(v)}ar=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.vec4=Q.vec3=Q.vec2=Q.quat2=Q.quat=Q.mat4=Q.mat3=Q.mat2d=Q.mat2=Q.glMatrix=void 0;var e=E(ze());Q.glMatrix=e;var i=E(Le());Q.mat2=i;var o=E(gt());Q.mat2d=o;var h=E(at());Q.mat3=h;var l=E(zt());Q.mat4=l;var f=E(Ti());Q.quat=f;var g=E(rr());Q.quat2=g;var b=E(nc());Q.vec2=b;var M=E(vt());Q.vec3=M;var m=E(Qt());function w(v){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(w=function(z){return z?I:T})(v)}function E(v,T){if(v&&v.__esModule)return v;if(v===null||s(v)!=="object"&&typeof v!="function")return{default:v};var I=w(T);if(I&&I.has(v))return I.get(v);var z={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in v)if(V!=="default"&&Object.prototype.hasOwnProperty.call(v,V)){var j=O?Object.getOwnPropertyDescriptor(v,V):null;j&&(j.get||j.set)?Object.defineProperty(z,V,j):z[V]=v[V]}return z.default=v,I&&I.set(v,z),z}return Q.vec4=m,Q}var vs,Os,Zr,So,Te=Xo(),Ks=function(){if(Os)return vs;function s(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return Os=1,vs=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var l=this.sampleCurveX(o)-e;if(Math.abs(l)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=l/f}var g=0,b=1;for(o=e,h=0;h<20&&(l=this.sampleCurveX(o),!(Math.abs(l-e)<i));h++)e>l?g=o:b=o,o=.5*(b-g)+g;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},vs}(),Js=W(Ks);function Be(){if(So)return Zr;function s(e,i){this.x=e,this.y=i}return So=1,Zr=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),h=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=h,this},_rotateAround:function(e,i){var o=Math.cos(e),h=Math.sin(e),l=i.y+h*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-h*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},Zr}var ge=W(Be());function _t(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!_t(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!_t(s[i],e[i]))return!1;return!0}return s===e}const Ot=Math.PI/180,kt=180/Math.PI;function mt(s){return s*Ot}function Gt(s){return s*kt}const $t=[[0,0],[1,0],[1,1],[0,1]];function Zt(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function Ut(s,e,i,o){const h=new Js(s,e,i,o);return function(l){return h.solve(l)}}const bi=Ut(.25,.1,.25,1);function Mt(s,e,i){return Math.min(i,Math.max(e,s))}function di(s,e,i){return(i=Mt((i-s)/(e-s),0,1))*i*(3-2*i)}function wi(s,e,i){const o=i-e,h=((s-e)%o+o)%o+e;return h===e?i:h}function Gi(s,e,i){if(!s.length)return i(null,[]);let o=s.length;const h=new Array(s.length);let l=null;s.forEach((f,g)=>{e(f,(b,M)=>{b&&(l=b),h[g]=M,--o==0&&i(l,h)})})}function qi(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}let tn=1;function Qn(){return tn++}function Un(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function _r(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function xn(s,e){return s.indexOf(e,s.length-e.length)!==-1}function bs(s,e,i){const o={};for(const h in s)o[h]=e.call(this,s[h],h,s);return o}function Eo(s,e,i){const o={};for(const h in s)e.call(this,s[h],h,s)&&(o[h]=s[h]);return o}function Mn(s){return Array.isArray(s)?s.map(Mn):typeof s=="object"&&s?bs(s,Mn):s}const gr={};function _i(s){gr[s]||(typeof console<"u"&&console.warn(s),gr[s]=!0)}function Qs(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function Mu(s){let e=0;for(let i,o,h=0,l=s.length,f=l-1;h<l;f=h++)i=s[h],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Wr([s,e,i]){const o=mt(e+90),h=mt(i);return{x:s*Math.cos(o)*Math.sin(h),y:s*Math.sin(o)*Math.sin(h),z:s*Math.cos(h),azimuthal:e,polar:i}}function Mo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function el(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,h,l)=>{const f=h||l;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let tl=null;function il(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Au(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<o?e=h+1:i=h}return e}function nl(s,e,i,o){for(;e<i;){const h=e+i>>1;s[h]<=o?e=h+1:i=h}return e}function Iu(s){return s>0?1/(1.001-s):1+s}function Cu(s){return s>0?1-1/(1.001-s):-s}const Wn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Wn.API_URL)return null;try{const s=new URL(Wn.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function rc(s){return Wn.API_URL_REGEX.test(s)}function Pu(s){return Wn.API_SPRITE_REGEX.test(s)}let sc,yr,eo,qe,$,J;function ee(){return sc==null&&(sc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sc}const de={now:()=>qe!==void 0?qe:performance.now(),setNow(s){qe=s},restoreNow(){qe=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:o}=s;$||($=document.createElement("canvas"));const h=$.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>$.width||o>$.height)&&($.width=i,$.height=o),h.clearRect(-e,-e,i+2*e,o+2*e),h.drawImage(s,0,0,i,o),h.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:s=>(yr||(yr=document.createElement("a")),yr.href=s,yr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(eo==null&&(eo=window.matchMedia("(prefers-reduced-motion: reduce)")),eo.matches)},hasCanvasFingerprintNoise(){if(J!==void 0)return J;if(!ee())return J=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<s.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const o=e.getImageData(0,0,s.width,s.height);i=0;for(let h=0;h<o.data.length;++h)if(h%4!=3&&i++!==o.data[h])return J=!0,!0;return J=!1,!1}};function pe(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(s.slice(i));for(const h in e)o.set(h,e[h]);return`${s.slice(0,i)}?${o.toString()}`}function we(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const o=new URLSearchParams,h=new URLSearchParams(s.slice(i));for(const f of e.persistentParams){const g=h.get(f);g&&o.set(f,g)}const l=o.toString();return`${s.slice(0,i)}${l.length>0?`?${l}`:""}`}const Re="mapbox-tiles";let Se=500,Ue=50;const Ne=["language","worldview","jobid"];let Ge,it;function Tt(){try{return caches}catch{}}function St(){const s=Tt();s&&Ge==null&&(Ge=s.open(Re))}let Yt=1/0;const ti={supported:!1,testSupport:function(s){!Pi&&ei&&(Oi?Bi(s):ii=s)}};let ii,ei,Pi=!1,Oi=!1;const Si=typeof self<"u"?self:{};function Bi(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ei),s.isContextLost())return;ti.supported=!0}catch{}s.deleteTexture(e),Pi=!0}Si.document&&(ei=Si.document.createElement("img"),ei.onload=function(){ii&&Bi(ii),ii=null,Oi=!0},ei.onerror=function(){Pi=!0,ii=null},ei.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ui={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ui);class Fn extends Error{constructor(e,i,o){i===401&&rc(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const to=Mo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Xn=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(to())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,h){const l=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:to(),referrerPolicy:o.referrerPolicy,signal:l.signal});let g=!1,b=!1;const M=(m=f.url).indexOf("sku=")>0&&rc(m);var m;o.type==="json"&&f.headers.set("Accept","application/json");const w=(v,T,I)=>{if(b)return;if(v&&v.message!=="SecurityError"&&_i(v.toString()),T&&I)return E(T);const z=Date.now();fetch(f).then(O=>{if(O.ok){const V=M?O.clone():null;return E(O,V,z)}return h(new Fn(O.statusText,O.status,o.url))}).catch(O=>{O.name!=="AbortError"&&h(new Error(`${O.message} ${o.url}`))})},E=(v,T,I)=>{(o.type==="arrayBuffer"?v.arrayBuffer():o.type==="json"?v.json():v.text()).then(z=>{b||(T&&I&&function(O,V,j){if(St(),Ge==null)return;const N=el(V.headers.get("Cache-Control")||"");if(N["no-store"])return;const G={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((se,re)=>G.headers.set(re,se)),N["max-age"]&&G.headers.set("Expires",new Date(j+1e3*N["max-age"]).toUTCString());const H=G.headers.get("Expires");if(!H||new Date(H).getTime()-j<42e4)return;let K=we(O.url,{persistentParams:Ne});if(V.status===206){const se=O.headers.get("Range");if(!se)return;G.status=200,K=pe(K,{range:se})}(function(se,re){if(it===void 0)try{new Response(new ReadableStream),it=!0}catch{it=!1}it?re(se.body):se.blob().then(re)})(V,se=>{const re=new Response((ie=V.status)!==200&&ie!==404&&[101,103,204,205,304].includes(ie)?null:se,G);var ie;St(),Ge!=null&&Ge.then(_e=>_e.put(K,re)).catch(_e=>_i(_e.message))})}(f,T,I),g=!0,h(null,z,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(z=>{b||h(new Error(z.message))})};return M?function(v,T){if(St(),Ge==null)return T(null);Ge.then(I=>{let z=we(v.url,{persistentParams:Ne});const O=v.headers.get("Range");O&&(z=pe(z,{range:O})),I.match(z).then(V=>{const j=function(N){if(!N)return!1;const G=new Date(N.headers.get("Expires")||0),H=el(N.headers.get("Cache-Control")||"");return G>Date.now()&&!H["no-cache"]}(V);I.delete(z),j&&I.put(z,V.clone()),T(null,V,j)}).catch(T)}).catch(T)}(f,w):w(null,null),{cancel:()=>{b=!0,g||l.abort()}}}(s,e);if(Mo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(o,h){const l=new XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const f in o.headers)l.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{h(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let f=l.response;if(o.type==="json")try{f=JSON.parse(l.response)}catch(g){return h(g)}h(null,f,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else h(new Fn(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(s,e)},er=function(s,e){return Xn(qi(s,{type:"arrayBuffer"}),e)};function Fr(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const oc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ao,ac;Ao=[],ac=0;const hd=function(s,e){if(ti.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),ac>=Wn.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ao.push(l),l}ac++;let i=!1;const o=()=>{if(!i)for(i=!0,ac--;Ao.length&&ac<Wn.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Ao.shift(),{requestParameters:f,callback:g,cancelled:b}=l;b||(l.cancel=hd(f,g).cancel)}},h=er(s,(l,f,g,b)=>{o(),l?e(l):f&&(self.createImageBitmap?function(M,m){const w=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(w).then(E=>{m(null,E)}).catch(E=>{m(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(M,m)=>e(M,m,g,b)):function(M,m){const w=new Image;w.onload=()=>{m(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=oc})},w.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const E=new Blob([new Uint8Array(M)],{type:"image/png"});w.src=M.byteLength?URL.createObjectURL(E):oc}(f,(M,m)=>e(M,m,g,b)))});return{cancel:()=>{h.cancel(),o()}}};var tm,dd,fd,Br={exports:{}},ks={exports:{}},Io={exports:{}},io=function(){if(fd)return Br.exports;fd=1;var s=(tm||(tm=1,ks.exports=function(i,o){var h,l,f,g,b,M,m,w;for(l=i.length-(h=3&i.length),f=o,b=3432918353,M=461845907,w=0;w<l;)m=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24,++w,f=27492+(65535&(g=5*(65535&(f=(f^=m=(65535&(m=(m=(65535&m)*b+(((m>>>16)*b&65535)<<16)&4294967295)<<15|m>>>17))*M+(((m>>>16)*M&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(m=0,h){case 3:m^=(255&i.charCodeAt(w+2))<<16;case 2:m^=(255&i.charCodeAt(w+1))<<8;case 1:f^=m=(65535&(m=(m=(65535&(m^=255&i.charCodeAt(w)))*b+(((m>>>16)*b&65535)<<16)&4294967295)<<15|m>>>17))*M+(((m>>>16)*M&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),ks.exports),e=(dd||(dd=1,Io.exports=function(i,o){for(var h,l=i.length,f=o^l,g=0;l>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(h>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:f^=(255&i.charCodeAt(g+2))<<16;case 2:f^=(255&i.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Io.exports);return Br.exports=s,Br.exports.murmur3=s,Br.exports.murmur2=e,Br.exports}(),Fs=W(io);class no{constructor(e,...i){qi(this,i[0]||{}),this.type=e}}class Ru extends no{constructor(e,i={}){super("error",qi({error:e},i))}}function pd(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function Yo(s,e,i){if(i&&i[s]){const o=i[s].indexOf(e);o!==-1&&i[s].splice(o,1)}}class Ko{on(e,i){return this._listeners=this._listeners||{},pd(e,i,this._listeners),this}off(e,i){return Yo(e,i,this._listeners),Yo(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},pd(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new no(e,i):e,h=o.type;if(this.listens(h)){o.target=this;const l=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const b of l)b.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const b of f)Yo(h,b,this._oneTimeListeners),b.call(this,o);const g=this._eventedParent;g&&(qi(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof Ru&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var im,md={},ws=function(){if(im)return md;im=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function o(l){return(f=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:f>1?1:f;var f}function h(l,f,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?l+(f-l)*g*6:2*g<1?f:3*g<2?l+(f-l)*(2/3-g)*6:l}try{md.parseCSSColor=function(l){var f,g=l.replace(/ /g,"").toLowerCase();if(g in s)return s[g].slice();if(g[0]==="#")return g.length===4?(f=parseInt(g.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:g.length===7&&(f=parseInt(g.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var b=g.indexOf("("),M=g.indexOf(")");if(b!==-1&&M+1===g.length){var m=g.substr(0,b),w=g.substr(b+1,M-(b+1)).split(","),E=1;switch(m){case"rgba":if(w.length!==4)return null;E=o(w.pop());case"rgb":return w.length!==3?null:[i(w[0]),i(w[1]),i(w[2]),E];case"hsla":if(w.length!==4)return null;E=o(w.pop());case"hsl":if(w.length!==3)return null;var v=(parseFloat(w[0])%360+360)%360/360,T=o(w[1]),I=o(w[2]),z=I<=.5?I*(T+1):I+T-I*T,O=2*I-z;return[e(255*h(O,z,v+1/3)),e(255*h(O,z,v)),e(255*h(O,z,v-1/3)),E];default:return null}}return null}}catch{}return md}();class Hi{constructor(e,i,o,h=1){this.r=e,this.g=i,this.b=o,this.a=h}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;const i=ws.parseCSSColor(e);return i?new Hi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${h})`}toString(){const[e,i,o,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${h})`}toRenderColor(e){const{r:i,g:o,b:h,a:l}=this;return new _d(e,i,o,h,l)}clone(){return new Hi(this.r,this.g,this.b,this.a)}}class _d{constructor(e,i,o,h,l){if(e){const f=e.image.height,g=f*f;i=l===0?0:i/l*(f-1),o=l===0?0:o/l*(f-1),h=l===0?0:h/l*(f-1);const b=Math.floor(i),M=Math.floor(o),m=Math.floor(h),w=Math.ceil(i),E=Math.ceil(o),v=Math.ceil(h),T=i-b,I=o-M,z=h-m,O=e.image.data,V=4*(b+M*g+m*f),j=4*(b+M*g+v*f),N=4*(b+E*g+m*f),G=4*(b+E*g+v*f),H=4*(w+M*g+m*f),K=4*(w+M*g+v*f),se=4*(w+E*g+m*f),re=4*(w+E*g+v*f);if(V<0||re>=O.length)throw new Error("out of range");this.r=ni(ni(ni(O[V],O[j],z),ni(O[N],O[G],z),I),ni(ni(O[H],O[K],z),ni(O[se],O[re],z),I),T)/255*l,this.g=ni(ni(ni(O[V+1],O[j+1],z),ni(O[N+1],O[G+1],z),I),ni(ni(O[H+1],O[K+1],z),ni(O[se+1],O[re+1],z),I),T)/255*l,this.b=ni(ni(ni(O[V+2],O[j+2],z),ni(O[N+2],O[G+2],z),I),ni(ni(O[H+2],O[K+2],z),ni(O[se+2],O[re+2],z),I),T)/255*l,this.a=l}else this.r=i,this.g=o,this.b=h,this.a=l}toArray(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*o/h,h]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:h}=this,l=Math.min(Math.max(e/h,0),1),f=Math.min(Math.max(i/h,0),1),g=Math.min(Math.max(o/h,0),1),b=Math.min(l,f,g),M=Math.max(l,f,g),m=(b+M)/2;if(b===M)return[0,0,100*m,h];const w=M-b,E=m>.5?w/(2-M-b):w/(M+b);let v=0;return M===l?v=(f-g)/w+(f<g?6:0):M===f?v=(g-l)/w+2:M===g&&(v=(l-f)/w+4),v*=60,[Math.min(Math.max(v,0),360),Math.min(Math.max(100*E,0),100),Math.min(Math.max(100*m,0),100),h]}toArray01(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,o/h,h]}toArray01Scaled(e){const{r:i,g:o,b:h,a:l}=this;return l===0?[0,0,0]:[i/l*e,o/l*e,h/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:h}=this;return[e,i,o,h]}toArray01Linear(){const{r:e,g:i,b:o,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(i/h,2.2),Math.pow(o/h,2.2),h]}}function ni(s,e,i){return s*(1-i)+e*i}function nm(s,e,i){return s.map((o,h)=>ni(o,e[h],i))}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var Du=Object.freeze({__proto__:null,array:nm,color:function(s,e,i){return new Hi(ni(s.r,e.r,i),ni(s.g,e.g,i),ni(s.b,e.b,i),ni(s.a,e.a,i))},number:ni});function zu(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}class Mi extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Lu{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,h]of i)this.bindings[o]=h}concat(e){return new Lu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ya={kind:"null"},Vt={kind:"number"},Xi={kind:"string"},ki={kind:"boolean"},Er={kind:"color"},Co={kind:"object"},Vi={kind:"value"},lc={kind:"collator"},ro={kind:"formatted"},cc={kind:"resolvedImage"};function lr(s,e){return{kind:"array",itemType:s,N:e}}function Pn(s){if(s.kind==="array"){const e=Pn(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const gd=[ya,Vt,Xi,ki,Er,ro,Co,lr(Vi),cc];function jr(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!jr(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of gd)if(!jr(i,e))return null}}return`Expected ${Pn(s)} but found ${Pn(e)} instead.`}function Ou(s,e){return e.some(i=>i.kind===s.kind)}function uc(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}class ku{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hc{constructor(e,i,o,h,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=h,this.textColor=l}}class Mr{constructor(e){this.sections=e}static fromString(e){return new Mr([new hc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Mr?e:Mr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class so{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:o,b:h,c:l,d:f,e:g,f:b}=this.options.transform;this.options.transform=new DOMMatrix([o,h,l,f,g,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:o,b:h,c:l,d:f,e:g,f:b}=i.options.transform;return new DOMMatrix([o,h,l,f,g,b]),new so(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:o,c:h,d:l,e:f,f:g}=this.options.transform;return e.options.transform={a:i,b:o,c:h,d:l,e:f,f:g},JSON.stringify(e)}}class xr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new so(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new so(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?xr.build(e):e}static build(e,i,o,h){return e?new xr({namePrimary:e,nameSecondary:i,optionsPrimary:o,optionsSecondary:h,available:!1}):null}}function yd(s,e,i,o){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[s,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[s,e,i,o]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Po(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Hi||s instanceof ku||s instanceof Mr||s instanceof xr)return!0;if(Array.isArray(s)){for(const e of s)if(!Po(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Po(s[e]))return!1;return!0}return!1}function An(s){if(s===null)return ya;if(typeof s=="string")return Xi;if(typeof s=="boolean")return ki;if(typeof s=="number")return Vt;if(s instanceof Hi)return Er;if(s instanceof ku)return lc;if(s instanceof Mr)return ro;if(s instanceof xr)return cc;if(Array.isArray(s)){const e=s.length;let i;for(const o of s){const h=An(o);if(i){if(i===h)continue;i=Vi;break}i=h}return lr(i||Vi,e)}return Co}function Ts(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Hi?s.toStringPremultipliedAlpha():s instanceof Mr||s instanceof xr?s.toString():JSON.stringify(s)}class cr{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Po(e[1]))return i.error("invalid value");const o=e[1];let h=An(o);const l=i.expectedType;return h.kind!=="array"||h.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(h=l),new cr(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Mr?this.value.serialize():this.value}}class Bn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const dc={string:Xi,number:Vt,boolean:ki,object:Co};class Bs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,h=1;const l=e[0];if(l==="array"){let g,b;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in dc)||M==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=dc[M],h++}else g=Vi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}o=lr(g,b)}else o=dc[l];const f=[];for(;h<e.length;h++){const g=i.parse(e[h],h,Vi);if(!g)return null;f.push(g)}return new Bs(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!jr(this.type,An(o)))return o;if(i===this.args.length-1)throw new Bn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Pn(An(o))} but was expected to be of type ${Pn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(o=>o.serialize()))}}class xa{constructor(e){this.type=ro,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const h=[];let l=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(l&&typeof g=="object"&&!Array.isArray(g)){l=!1;let b=null;if(g["font-scale"]&&(b=i.parseObjectValue(g["font-scale"],f,"font-scale",Vt),!b))return null;let M=null;if(g["text-font"]&&(M=i.parseObjectValue(g["text-font"],f,"text-font",lr(Xi)),!M))return null;let m=null;if(g["text-color"]&&(m=i.parseObjectValue(g["text-color"],f,"text-color",Er),!m))return null;const w=h[h.length-1];w.scale=b,w.font=M,w.textColor=m}else{const b=i.parse(e[f],f,Vi);if(!b)return null;const M=b.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new xa(h)}evaluate(e){return new Mr(this.sections.map(i=>{const o=i.content.evaluate(e);return An(o)===cc?new hc("",o,null,null,null):new hc(Ts(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class fc{constructor(e,i,o,h){this._imageWarnHistory={},this.type=cc,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=o,this.inputSecondaryParams=h}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const h=[];function l(){if(o<e.length){const g=i.parse(e[o],o++,Xi);return g?(h.push({image:g,options:void 0}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){if((g=e[o])===null||typeof g!="object"||Array.isArray(g))return!0;const b=e[o].params,M=i.concat(o);if(!b)return o++,!0;if(typeof b!="object"||b.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const m={},w=M.concat(void 0,"params");for(const E in b){if(!E)return w.error("Image parameter name should be non-empty"),!1;const v=w.concat(void 0,E).parse(b[E],void 0,Er,void 0,{typeAnnotation:"coerce"});if(!v)return!1;m[E]=v}return h[h.length-1].options=m,o++,!0}var g;return!0}for(let g=0;g<2;g++)if(!l()||!f())return;return new fc(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const h in i)if(i[h])try{const l=i[h].evaluate(e),f=`Ignoring image parameter "${h}" with semi-transparent color ${l.toString()}`;if(l.a!==1){this._imageWarnHistory[f]||(console.warn(f),this._imageWarnHistory[f]=!0);continue}o[h]=l}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i=xr.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const o in e)e[o]&&(i[o]=e[o].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Ns(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const xd={"to-boolean":ki,"to-color":Er,"to-number":Vt,"to-string":Xi};class Ro{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],h=[];let l=ya;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=lr(i.expectedType.itemType,f)}else{if(!(f>0&&Po(e[1][0])))return null;l=lr(An(e[1][0]),f)}for(let g=0;g<f;g++){const b=e[1][g];let M;if(Ns(b)==="array")M=i.parse(b,void 0,l.itemType);else{const m=Ns(b);if(m!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${m}.`);M=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!M)return null;h.push(M)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=xd[o];for(let f=1;f<e.length;f++){const g=i.parse(e[f],f,Vi);if(!g)return null;h.push(g)}}return new Ro(l,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const h of this.args){if(i=h.evaluate(e),o=null,i instanceof Hi)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:yd(i[0],i[1],i[2],i[3]),!o))return new Hi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Bn(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Bn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Mr.fromString(Ts(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?xr.build(Ts(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Ts(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new fc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const dy=["Unknown","Point","LineString","Polygon"];class vd{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Hi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Gr{constructor(e,i,o,h,l){this.name=e,this.type=i,this._evaluate=o,this.args=h,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=Gr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],h=Gr.definitions[o];if(!h)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(h)?h[0]:h.type,f=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,g=[];let b=null,M=-1;for(const[m,w]of f){if(Array.isArray(m)&&m.length!==e.length-1)continue;g.push(m),M++,b=new Tc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const E=[];let v=!1;for(let T=1;T<e.length;T++){const I=e[T],z=Array.isArray(m)?m[T-1]:m.type,O=b.parse(I,1+E.length,z);if(!O){v=!0;break}E.push(O)}if(!v)if(Array.isArray(m)&&m.length!==E.length)b.error(`Expected ${m.length} arguments, but found ${E.length} instead.`);else{for(let T=0;T<E.length;T++){const I=Array.isArray(m)?m[T]:m.type,z=E[T];b.concat(T+1).checkSubtype(I,z.type)}if(b.errors.length===0)return new Gr(o,l,w,E,M)}}if(g.length===1)i.errors.push(...b.errors);else{const m=(g.length?g:f.map(([E])=>E)).map(bd).join(" | "),w=[];for(let E=1;E<e.length;E++){const v=i.parse(e[E],1+w.length);if(!v)return null;w.push(Pn(v.type))}i.error(`Expected arguments of type ${m}, but found (${w.join(", ")}) instead.`)}return null}static register(e,i){Gr.definitions=i;for(const o in i)e[o]=Gr}}function bd(s){return Array.isArray(s)?`(${s.map(Pn).join(", ")})`:`(${Pn(s.type)}...)`}class Fu{constructor(e,i,o){this.type=lc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const h=o["case-sensitive"]===void 0?i.parse(!1,1,ki):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",ki);if(!h)return null;const l=o["diacritic-sensitive"]===void 0?i.parse(!1,1,ki):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",ki);if(!l)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",Xi),!f)?null:new Fu(h,l,f)}evaluate(e){return new ku(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function pc(s,e,i=0,o=s.length-1,h=fy){for(;o>i;){if(o-i>600){const b=o-i+1,M=e-i+1,m=Math.log(b),w=.5*Math.exp(2*m/3),E=.5*Math.sqrt(m*w*(b-w)/b)*(M-b/2<0?-1:1);pc(s,e,Math.max(i,Math.floor(e-M*w/b+E)),Math.min(o,Math.floor(e+(b-M)*w/b+E)),h)}const l=s[e];let f=i,g=o;for(mc(s,i,e),h(s[o],l)>0&&mc(s,i,o);f<g;){for(mc(s,f,g),f++,g--;h(s[f],l)<0;)f++;for(;h(s[g],l)>0;)g--}h(s[i],l)===0?mc(s,i,g):(g++,mc(s,g,o)),g<=e&&(i=g+1),e<=g&&(o=g-1)}}function mc(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function fy(s,e){return s<e?-1:s>e?1:0}function py(s){let e=0;for(let i,o,h=0,l=s.length,f=l-1;h<l;f=h++)i=s[h],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function _c(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function gc(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function my(s,e,i){const o=s[0]-e[0],h=s[1]-e[1],l=s[0]-i[0],f=s[1]-i[1];return o*f-l*h==0&&o*l<=0&&h*f<=0}function rl(s,e,i=!1){let o=!1;for(let g=0,b=e.length;g<b;g++){const M=e[g];for(let m=0,w=M.length,E=w-1;m<w;E=m++){const v=M[E],T=M[m];if(my(s,v,T))return i;(l=v)[1]>(h=s)[1]!=(f=T)[1]>h[1]&&h[0]<(f[0]-l[0])*(h[1]-l[1])/(f[1]-l[1])+l[0]&&(o=!o)}}var h,l,f;return o}function wd(s,e,i,o){const h=o[0]-i[0],l=o[1]-i[1],f=(s[0]-i[0])*l-h*(s[1]-i[1]),g=(e[0]-i[0])*l-h*(e[1]-i[1]);return f>0&&g<0||f<0&&g>0}function Do(s,e,i,o){return(h=[o[0]-i[0],o[1]-i[1]])[0]*(l=[e[0]-s[0],e[1]-s[1]])[1]-h[1]*l[0]!=0&&!(!wd(s,e,i,o)||!wd(i,o,s,e));var h,l}const Jo=8192;function _y(s,e){const i=(180+s[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Jo),Math.round(o*h*Jo)]}function Td(s,e){for(let i=0;i<e.length;i++)if(rl(s,e[i]))return!0;return!1}function gy(s,e,i){for(const o of i)for(let h=0,l=o.length,f=l-1;h<l;f=h++)if(Do(s,e,o[f],o[h]))return!0;return!1}function rm(s,e){for(let i=0;i<s.length;++i)if(!rl(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(gy(s[i],s[i+1],e))return!1;return!0}function yy(s,e){for(let i=0;i<e.length;i++)if(rm(s,e[i]))return!0;return!1}function Sd(s,e,i){const o=[];for(let h=0;h<s.length;h++){const l=[];for(let f=0;f<s[h].length;f++){const g=_y(s[h][f],i);_c(e,g),l.push(g)}o.push(l)}return o}function va(s,e,i){const o=[];for(let h=0;h<s.length;h++){const l=Sd(s[h],e,i);o.push(l)}return o}function Ei(s,e,i,o){if(s[0]<i[0]||s[0]>i[2]){const h=.5*o;let l=s[0]-i[0]>h?-o:i[0]-s[0]>h?o:0;l===0&&(l=s[0]-i[2]>h?-o:i[2]-s[0]>h?o:0),s[0]+=l}_c(e,s)}function Kt(s,e,i,o){const h=Math.pow(2,o.z)*Jo,l=[o.x*Jo,o.y*Jo],f=[];if(!s)return f;for(const g of s)for(const b of g){const M=[b.x+l[0],b.y+l[1]];Ei(M,e,i,h),f.push(M)}return f}function Bu(s,e,i,o){const h=Math.pow(2,o.z)*Jo,l=[o.x*Jo,o.y*Jo],f=[];if(!s)return f;for(const b of s){const M=[];for(const m of b){const w=[m.x+l[0],m.y+l[1]];_c(e,w),M.push(w)}f.push(M)}if(e[2]-e[0]<=h/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const b of f)for(const M of b)Ei(M,e,i,h)}var g;return f}class oi{constructor(e,i){this.type=ki,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Po(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let h=0;h<o.features.length;++h){const l=o.features[h].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new oi(o,o.features[h].geometry)}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new oi(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new oi(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=Sd(o.coordinates,l,f),b=Kt(i.geometry(),h,l,f);if(!gc(h,l))return!1;for(const M of b)if(!rl(M,g))return!1}if(o.type==="MultiPolygon"){const g=va(o.coordinates,l,f),b=Kt(i.geometry(),h,l,f);if(!gc(h,l))return!1;for(const M of b)if(!Td(M,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const h=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=Sd(o.coordinates,l,f),b=Bu(i.geometry(),h,l,f);if(!gc(h,l))return!1;for(const M of b)if(!rm(M,g))return!1}if(o.type==="MultiPolygon"){const g=va(o.coordinates,l,f),b=Bu(i.geometry(),h,l,f);if(!gc(h,l))return!1;for(const M of b)if(!yy(M,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const sl={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Nu=1/298.257223563,li=Nu*(2-Nu),ol=Math.PI/180;class ba{static fromTile(e,i,o){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/ol;return new ba(l,o)}static get units(){return sl}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!sl[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(sl).join(", ")}`);const o=6378.137*ol*(i?sl[i]:1),h=Math.cos(e*ol),l=1/(1-li*(1-h*h)),f=Math.sqrt(l);this.kx=o*f*h,this.ky=o*f*l*(1-li)}distance(e,i){const o=qr(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+h*h)}bearing(e,i){const o=qr(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/ol}destination(e,i,o){const h=o*ol;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const h=e[o];for(let l=0,f=h.length,g=f-1;l<f;g=l++)i+=qr(h[l][0]-h[g][0])*(h[l][1]+h[g][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const l=e[h],f=e[h+1],g=this.distance(l,f);if(o+=g,o>i)return Vu(l,f,(i-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[h,l]=i,f=qr(o[0]-h)*this.kx,g=(o[1]-l)*this.ky;if(f!==0||g!==0){const b=(qr(e[0]-h)*this.kx*f+(e[1]-l)*this.ky*g)/(f*f+g*g);b>1?(h=o[0],l=o[1]):b>0&&(h+=f/this.kx*b,l+=g/this.ky*b)}return f=qr(e[0]-h)*this.kx,g=(e[1]-l)*this.ky,Math.sqrt(f*f+g*g)}pointOnLine(e,i){let o=1/0,h=e[0][0],l=e[0][1],f=0,g=0;for(let b=0;b<e.length-1;b++){let M=e[b][0],m=e[b][1],w=qr(e[b+1][0]-M)*this.kx,E=(e[b+1][1]-m)*this.ky,v=0;w===0&&E===0||(v=(qr(i[0]-M)*this.kx*w+(i[1]-m)*this.ky*E)/(w*w+E*E),v>1?(M=e[b+1][0],m=e[b+1][1]):v>0&&(M+=w/this.kx*v,m+=E/this.ky*v)),w=qr(i[0]-M)*this.kx,E=(i[1]-m)*this.ky;const T=w*w+E*E;T<o&&(o=T,h=M,l=m,f=b,g=v)}return{point:[h,l],index:f,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,o){let h=this.pointOnLine(o,e),l=this.pointOnLine(o,i);if(h.index>l.index||h.index===l.index&&h.t>l.t){const M=h;h=l,l=M}const f=[h.point],g=h.index+1,b=l.index;!Ed(o[g],f[0])&&g<=b&&f.push(o[g]);for(let M=g+1;M<=b;M++)f.push(o[M]);return Ed(o[b],l.point)||f.push(l.point),f}lineSliceAlong(e,i,o){let h=0;const l=[];for(let f=0;f<o.length-1;f++){const g=o[f],b=o[f+1],M=this.distance(g,b);if(h+=M,h>e&&l.length===0&&l.push(Vu(g,b,(e-(h-M))/M)),h>=i)return l.push(Vu(g,b,(i-(h-M))/M)),l;h>e&&l.push(b)}return l}bufferPoint(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[0]+h,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-o,e[2]+h,e[3]+o]}insideBBox(e,i){return qr(e[0]-i[0])>=0&&qr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Ed(s,e){return s[0]===e[0]&&s[1]===e[1]}function Vu(s,e,i){const o=qr(e[0]-s[0]);return[s[0]+o*i,s[1]+(e[1]-s[1])*i]}function qr(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class vr{constructor(e=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,h=i[e];for(;e>0;){const l=e-1>>1,f=i[l];if(o(h,f)>=0)break;i[e]=f,e=l}i[e]=h}_down(e){const{data:i,compare:o}=this,h=this.length>>1,l=i[e];for(;e<h;){let f=1+(e<<1);const g=f+1;if(g<this.length&&o(i[g],i[f])<0&&(f=g),o(i[f],l)>=0)break;i[e]=i[f],e=f}i[e]=l}}var At=8192;function Md(s,e){return e.dist-s.dist}const Uu=100,yc=50;function Qo(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function ur(s){return s[1]-s[0]+1}function zo(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Ad(s,e){if(s[0]>s[1])return[null,null];const i=ur(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}{if(i===1)return[s,null];const o=Math.floor(i/2)-1;return[[s[0],s[0]+o],[s[0]+o+1,s[1]]]}}function wa(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!zo(e,s.length))return i;for(let o=e[0];o<=e[1];++o)_c(i,s[o]);return i}function Ta(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let o=0;o<s[i].length;++o)_c(e,s[i][o]);return e}function Sa(s,e,i){if(Qo(s)||Qo(e))return NaN;let o=0,h=0;return s[2]<e[0]&&(o=e[0]-s[2]),s[0]>e[2]&&(o=s[0]-e[2]),s[1]>e[3]&&(h=s[1]-e[3]),s[3]<e[1]&&(h=e[1]-s[3]),i.distance([0,0],[o,h])}function Id(s){return 360*s-180}function xy(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Cd(s,e){const i=Math.pow(2,e.z),o=(s.y/At+e.y)/i;return[Id((s.x/At+e.x)/i),xy(o)]}function vy(s,e){const i=[];for(let o=0;o<s.length;++o)i.push(Cd(s[o],e));return i}function sm(s,e,i){const o=i.pointOnLine(e,s).point;return i.distance(s,o)}function Pd(s,e,i,o,h){const l=i.slice(o[0],o[1]+1);let f=1/0;for(let g=e[0];g<=e[1];++g)if((f=Math.min(f,sm(s[g],l,h)))===0)return 0;return f}function Rd(s,e,i,o,h){const l=Math.min(h.pointToSegmentDistance(s,i,o),h.pointToSegmentDistance(e,i,o)),f=Math.min(h.pointToSegmentDistance(i,s,e),h.pointToSegmentDistance(o,s,e));return Math.min(l,f)}function by(s,e,i,o,h){if(!zo(e,s.length)||!zo(o,i.length))return NaN;let l=1/0;for(let f=e[0];f<e[1];++f)for(let g=o[0];g<o[1];++g){if(Do(s[f],s[f+1],i[g],i[g+1]))return 0;l=Math.min(l,Rd(s[f],s[f+1],i[g],i[g+1],h))}return l}function om(s,e,i,o,h){if(!zo(e,s.length)||!zo(o,i.length))return NaN;let l=1/0;for(let f=e[0];f<=e[1];++f)for(let g=o[0];g<=o[1];++g)if((l=Math.min(l,h.distance(s[f],i[g])))===0)return l;return l}function Ea(s,e,i){if(rl(s,e,!0))return 0;let o=1/0;for(const h of e){const l=h.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[l-1]&&(o=Math.min(o,i.pointToSegmentDistance(s,h[l-1],h[0])))===0||(o=Math.min(o,sm(s,h,i)))===0)return o}return o}function wy(s,e,i,o){if(!zo(e,s.length))return NaN;for(let l=e[0];l<=e[1];++l)if(rl(s[l],i,!0))return 0;let h=1/0;for(let l=e[0];l<e[1];++l)for(const f of i)for(let g=0,b=f.length,M=b-1;g<b;M=g++){if(Do(s[l],s[l+1],f[M],f[g]))return 0;h=Math.min(h,Rd(s[l],s[l+1],f[M],f[g],o))}return h}function am(s,e){for(const i of s)for(let o=0;o<=i.length-1;++o)if(rl(i[o],e,!0))return!0;return!1}function Dd(s,e,i,o=1/0){const h=Ta(s),l=Ta(e);if(o!==1/0&&Sa(h,l,i)>=o)return o;if(gc(h,l)){if(am(s,e))return 0}else if(am(e,s))return 0;let f=o;for(const g of s)for(let b=0,M=g.length,m=M-1;b<M;m=b++)for(const w of e)for(let E=0,v=w.length,T=v-1;E<v;T=E++){if(Do(g[m],g[b],w[T],w[E]))return 0;f=Math.min(f,Rd(g[m],g[b],w[T],w[E],i))}return f}function xc(s,e,i,o,h,l,f){if(l===null||f===null)return;const g=Sa(wa(o,l),wa(h,f),i);g<e&&s.push({dist:g,range1:l,range2:f})}function lm(s,e,i,o,h=1/0){let l=Math.min(o.distance(s[0],i[0][0]),h);if(l===0)return l;const f=new vr([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Md),g=e?yc:Uu,b=Ta(i);for(;f.length;){const M=f.pop();if(M.dist>=l)continue;const m=M.range1;if(ur(m)<=g){if(!zo(m,s.length))return NaN;if(e){const w=wy(s,m,i,o);if((l=Math.min(l,w))===0)return l}else for(let w=m[0];w<=m[1];++w){const E=Ea(s[w],i,o);if((l=Math.min(l,E))===0)return l}}else{const w=Ad(m,e);if(w[0]!==null){const E=Sa(wa(s,w[0]),b,o);E<l&&f.push({dist:E,range1:w[0],range2:[0,0]})}if(w[1]!==null){const E=Sa(wa(s,w[1]),b,o);E<l&&f.push({dist:E,range1:w[1],range2:[0,0]})}}}return l}function Ss(s,e,i,o,h,l=1/0){let f=Math.min(l,h.distance(s[0],i[0]));if(f===0)return f;const g=new vr([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],Md),b=e?yc:Uu,M=o?yc:Uu;for(;g.length;){const m=g.pop();if(m.dist>=f)continue;const w=m.range1,E=m.range2;if(ur(w)<=b&&ur(E)<=M){if(!zo(w,s.length)||!zo(E,i.length))return NaN;if(e&&o?f=Math.min(f,by(s,w,i,E,h)):e||o?e&&!o?f=Math.min(f,Pd(i,E,s,w,h)):!e&&o&&(f=Math.min(f,Pd(s,w,i,E,h))):f=Math.min(f,om(s,w,i,E,h)),f===0)return f}else{const v=Ad(w,e),T=Ad(E,o);xc(g,f,h,s,i,v[0],T[0]),xc(g,f,h,s,i,v[0],T[1]),xc(g,f,h,s,i,v[1],T[0]),xc(g,f,h,s,i,v[1],T[1])}}return f}function ju(s,e,i,o,h=1/0){let l=h;const f=wa(s,[0,s.length-1]);for(const g of i)if(!(l!==1/0&&Sa(f,wa(g,[0,g.length-1]),o)>=l)&&(l=Math.min(l,Ss(s,e,g,!0,o,l)),l===0))return l;return l}function vc(s,e,i,o,h=1/0){let l=h;const f=wa(s,[0,s.length-1]);for(const g of i){if(l!==1/0&&Sa(f,Ta(g),o)>=l)continue;const b=lm(s,e,g,o,l);if(isNaN(b))return b;if((l=Math.min(l,b))===0)return l}return l}function Gu(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class ea{constructor(e,i){this.type=Vt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Po(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let h=0;h<o.features.length;++h)if(Gu(o.features[h].geometry.type))return new ea(o,o.features[h].geometry)}else if(o.type==="Feature"){if(Gu(o.geometry.type))return new ea(o,o.geometry)}else if(Gu(o.type))return new ea(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(h,l,f){const g=[];for(const M of h)for(const m of M)g.push(Cd(m,l));const b=new ba(g[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Ss(g,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",b):f.type==="MultiLineString"?ju(g,!1,f.coordinates,b):f.type==="Polygon"||f.type==="MultiPolygon"?vc(g,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,b):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(h,l,f){const g=[];for(const M of h){const m=[];for(const w of M)m.push(Cd(w,l));g.push(m)}const b=new ba(g[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ju(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,b);if(f.type==="MultiLineString"){let M=1/0;for(let m=0;m<f.coordinates.length;m++){const w=ju(f.coordinates[m],!0,g,b,M);if(isNaN(w))return w;if((M=Math.min(M,w))===0)return M}return M}if(f.type==="Polygon"||f.type==="MultiPolygon"){let M=1/0;for(let m=0;m<g.length;m++){const w=vc(g[m],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,b,M);if(isNaN(w))return w;if((M=Math.min(M,w))===0)return M}return M}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(h,l,f){const g=[];for(const M of function(m,w){const E=m.length;if(E<=1)return[m];const v=[];let T,I;for(let z=0;z<E;z++){const O=py(m[z]);O!==0&&(m[z].area=Math.abs(O),I===void 0&&(I=O<0),I===O<0?(T&&v.push(T),T=[m[z]]):T.push(m[z]))}return T&&v.push(T),v}(h)){const m=[];for(let w=0;w<M.length;++w)m.push(vy(M[w],l));g.push(m)}const b=new ba(g[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return vc(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,b);if(f.type==="MultiLineString"){let M=1/0;for(let m=0;m<f.coordinates.length;m++){const w=vc(f.coordinates[m],!0,g,b,M);if(isNaN(w))return w;if((M=Math.min(M,w))===0)return M}return M}return f.type==="Polygon"||f.type==="MultiPolygon"?function(M,m,w){let E=1/0;for(const v of M)for(const T of m){const I=Dd(v,T,w,E);if(isNaN(I))return I;if((E=Math.min(E,I))===0)return E}return E}(f.type==="Polygon"?[f.coordinates]:f.coordinates,g,b):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function qu(s,e){switch(s){case"string":return Ts(e);case"number":return+e;case"boolean":return!!e;case"color":return Hi.parse(e);case"formatted":return Mr.fromString(Ts(e));case"resolvedImage":return xr.build(Ts(e))}return e}function zd(s,e,i,o){return o!==void 0&&(s=o*Math.round(s/o)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class Ma{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Vi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof cr))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof cr?new Ma(o,Ts(h.value),Ts(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Ma(o,Ts(h.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:h,value:l,values:f,minValue:g,maxValue:b,stepValue:M}=o,m=o.default.evaluate(e);let w=m;if(l){const E=e.scope;e.scope=(E||"").split("").slice(1).join(""),w=l.evaluate(e),e.scope=E}return h&&(w=qu(h,w)),w===void 0||g===void 0&&b===void 0&&M===void 0||(typeof w=="number"?w=zd(w,g,b,M):Array.isArray(w)&&(w=w.map(E=>typeof E=="number"?zd(E,g,b,M):E))),l!==void 0&&w!==void 0&&f&&!f.includes(w)&&(w=m,h&&(w=qu(h,w))),(h&&h!==this.type||w!==void 0&&An(w)!==this.type)&&(w=qu(this.type.kind,w)),w}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function al(s){if(s instanceof Gr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof oi||s instanceof ea)return!1;let e=!0;return s.eachChild(i=>{e&&!al(i)&&(e=!1)}),e}function bc(s){if(s instanceof Gr&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!bc(i)&&(e=!1)}),e}function wc(s){if(s instanceof Ma)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...wc(i)])}),e}function Aa(s,e){if(s instanceof Gr&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(o=>{i&&!Aa(o,e)&&(i=!1)}),i}class Ia{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Ia(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ll{constructor(e,i=[],o,h=new Lu,l=[],f,g){this.registry=e,this.path=i,this.key=i.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=h,this.errors=l,this.expectedType=o,this._scope=f,this.options=g}parse(e,i,o,h,l={}){return i||o?this.concat(i,null,o,h)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,o,h,l,f={}){return this.concat(i,o,h,l)._parse(e,f)}_parse(e,i){function o(h,l,f){return f==="assert"?new Bs(l,[h]):f==="coerce"?new Ro(l,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let l=h.parse(e,this);if(!l)return null;if(this.expectedType){const f=this.expectedType,g=l.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else l=o(l,f,i.typeAnnotation||"coerce");else l=o(l,f,i.typeAnnotation||"assert")}if(!(l instanceof cr)&&l.type.kind!=="resolvedImage"&&Hu(l)){const f=new vd(this._scope,this.options);try{l=new cr(l.type,l.evaluate(f))}catch(g){return this.error(g.message),null}}return l}return Ro.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,h){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const f=h?this.scope.concat(h):this.scope;return new ll(this.registry,l,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Mi(o,e))}checkSubtype(e,i){const o=jr(e,i);return o&&this.error(o),o}}var Tc=ll;function Hu(s){if(s instanceof Ia)return Hu(s.boundExpression);if(s instanceof Gr&&s.name==="error"||s instanceof Fu||s instanceof oi||s instanceof ea||s instanceof Ma)return!1;const e=s instanceof Ro||s instanceof Bs;let i=!0;return s.eachChild(o=>{i=e?i&&Hu(o):i&&o instanceof cr}),!!i&&al(s)&&Aa(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Sc(s,e){const i=s.length-1;let o,h,l=0,f=i,g=0;for(;l<=f;)if(g=Math.floor((l+f)/2),o=s[g],h=s[g+1],o<=e){if(g===i||e<h)return g;l=g+1}else{if(!(o>e))throw new Bn("Input is not a number.");f=g-1}return 0}class cl{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,l]of o)this.labels.push(h),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Vt);if(!o)return null;const h=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],b=e[f+1],M=f,m=f+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const w=i.parse(b,m,l);if(!w)return null;l=l||w.type,h.push([g,w])}return new cl(l,o,h)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const l=i.length;return h>=i[l-1]?o[l-1].evaluate(e):o[Sc(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Ca=.95047,Di=1.08883,cm=4/29,ul=6/29,um=3*ul*ul,hm=ul*ul*ul,Ty=Math.PI/180,pn=180/Math.PI;function Ld(s){return s>hm?Math.pow(s,1/3):s/um+cm}function Od(s){return s>ul?s*s*s:um*(s-cm)}function kd(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Fd(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function dm(s){const e=Fd(s.r),i=Fd(s.g),o=Fd(s.b),h=Ld((.4124564*e+.3575761*i+.1804375*o)/Ca),l=Ld((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*l-16,a:500*(h-l),b:200*(l-Ld((.0193339*e+.119192*i+.9503041*o)/Di)),alpha:s.a}}function fm(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,o=isNaN(s.b)?e:e-s.b/200;return e=1*Od(e),i=Ca*Od(i),o=Di*Od(o),new Hi(kd(3.2404542*i-1.5371385*e-.4985314*o),kd(-.969266*i+1.8760108*e+.041556*o),kd(.0556434*i-.2040259*e+1.0572252*o),s.alpha)}function Sy(s,e,i){const o=e-s;return s+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ec={forward:dm,reverse:fm,interpolate:function(s,e,i){return{l:ni(s.l,e.l,i),a:ni(s.a,e.a,i),b:ni(s.b,e.b,i),alpha:ni(s.alpha,e.alpha,i)}}},Mc={forward:function(s){const{l:e,a:i,b:o}=dm(s),h=Math.atan2(o,i)*pn;return{h:h<0?h+360:h,c:Math.sqrt(i*i+o*o),l:e,alpha:s.a}},reverse:function(s){const e=s.h*Ty,i=s.c;return fm({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:Sy(s.h,e.h,i),c:ni(s.c,e.c,i),l:ni(s.l,e.l,i),alpha:ni(s.alpha,e.alpha,i)}}};var pm=Object.freeze({__proto__:null,hcl:Mc,lab:Ec});class Xr{constructor(e,i,o,h,l,f){this.type=e,this.operator=i,this.interpolation=o,this.input=h,this.dynamicStops=l,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,i,o,h){let l=0;if(e.name==="exponential")l=Bd(i,e.base,o,h);else if(e.name==="linear")l=Bd(i,1,o,h);else if(e.name==="cubic-bezier"){const f=e.controlPoints;l=new Js(f[0],f[1],f[2],f[3]).solve(Bd(i,1,o,h))}return l}static parse(e,i){let[o,h,l,...f]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const M=h[1];if(typeof M!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(M.length!==4||M.some(m=>typeof m!="number"||m<0||m>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,Vt),!l)return null;const g=[];let b=null;if(o==="interpolate-hcl"||o==="interpolate-lab"?b=Er:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType),e.length-1==3){const M=i.parse(f[0],3,Vi);return M?new Xr(b,o,h,l,M,g):null}for(let M=0;M<f.length;M+=2){const m=f[M],w=f[M+1],E=M+3,v=M+4;if(typeof m!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(g.length&&g[g.length-1][0]>=m)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);const T=i.parse(w,v,b);if(!T)return null;b=b||T.type,g.push([m,T])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Xr(b,o,h,l,null,g):i.error(`Type ${Pn(b)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(this.dynamicStops){const m=this.dynamicStops.evaluate(e);if(m.length%2!=0)throw new Bn("Expected an even number of arguments.");i=[],o=[];for(let w=0;w<m.length;w+=2){const E=m[w],v=new cr(Vt,m[w+1]);if(typeof E!="number")throw new Bn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=E)throw new Bn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(E),o.push(v)}if(i.length===0)throw new Bn("Expected at least one input/output pair.")}if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const l=i.length;if(h>=i[l-1])return o[l-1].evaluate(e);const f=Sc(i,h),g=Xr.interpolationFactor(this.interpolation,h,i[f],i[f+1]),b=o[f].evaluate(e),M=o[f+1].evaluate(e);return this.operator==="interpolate"?Du[this.type.kind.toLowerCase()](b,M,g):this.operator==="interpolate-hcl"?Mc.reverse(Mc.interpolate(Mc.forward(b),Mc.forward(M),g)):Ec.reverse(Ec.interpolate(Ec.forward(b),Ec.forward(M),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Bd(s,e,i,o){const h=o-i,l=s-i;return h===0?0:e===1?l/h:(Math.pow(e,l)-1)/(Math.pow(e,h)-1)}class $u{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const h=i.expectedType;h&&h.kind!=="value"&&(o=h);const l=[];for(const g of e.slice(1)){const b=i.parse(g,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,l.push(b)}const f=h&&l.some(g=>jr(h,g.type));return new $u(f?Vi:o,l)}evaluate(e){let i,o=null,h=0;for(const l of this.args){if(h++,o=l.evaluate(e),o&&o instanceof xr&&!o.available&&(i||(i=o),o=null,h===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Zu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let l=1;l<e.length-1;l+=2){const f=e[l];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,l);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const g=i.parse(e[l+1],l+1);if(!g)return null;o.push([f,g])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return h?new Zu(o,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Nd{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vt),h=i.parse(e[2],2,lr(i.expectedType||Vi));return o&&h?new Nd(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Bn(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new Bn(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const h=Math.floor(i),l=Math.ceil(i),f=o[h],g=o[l];if(typeof f!="number"||typeof g!="number")throw new Bn(`Cannot interpolate between non-number values at index ${i}.`);const b=i-h;return f*(1-b)+g*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vd{constructor(e,i){this.type=ki,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vi),h=i.parse(e[2],2,Vi);return o&&h?Ou(o.type,[ki,Xi,Vt,ya,Vi])?new Vd(o,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!uc(i,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(An(i))} instead.`);if(!uc(o,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${Pn(An(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Wu{constructor(e,i,o){this.type=Vt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vi),h=i.parse(e[2],2,Vi);if(!o||!h)return null;if(!Ou(o.type,[ki,Xi,Vt,ya,Vi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Vt);return l?new Wu(o,h,l):null}return new Wu(o,h)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!uc(i,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(An(i))} instead.`);if(!uc(o,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${Pn(An(o))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return o.indexOf(i,h)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ud{constructor(e,i,o,h,l,f){this.inputType=e,this.type=i,this.input=o,this.cases=h,this.outputs=l,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const l={},f=[];for(let M=2;M<e.length-1;M+=2){let m=e[M];const w=e[M+1];Array.isArray(m)||(m=[m]);const E=i.concat(M);if(m.length===0)return E.error("Expected at least one branch label.");for(const T of m){if(typeof T!="number"&&typeof T!="string")return E.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof T=="number"&&Math.floor(T)!==T)return E.error("Numeric branch labels must be integer values.");if(o){if(E.checkSubtype(o,An(T)))return null}else o=An(T);if(l[String(T)]!==void 0)return E.error("Branch labels must be unique.");l[String(T)]=f.length}const v=i.parse(w,M,h);if(!v)return null;h=h||v.type,f.push(v)}const g=i.parse(e[1],1,Vi);if(!g)return null;const b=i.parse(e[e.length-1],e.length-1,h);return b?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new Ud(o,h,g,l,f,b):null}evaluate(e){const i=this.input.evaluate(e);return(An(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],h={};for(const f of i){const g=h[this.cases[f]];g===void 0?(h[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[g][1].push(f)}const l=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of o)e.push(g.length===1?l(g[0]):g.map(l)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class jd{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const h=[];for(let f=1;f<e.length-1;f+=2){const g=i.parse(e[f],f,ki);if(!g)return null;const b=i.parse(e[f+1],f+1,o);if(!b)return null;h.push([g,b]),o=o||b.type}const l=i.parse(e[e.length-1],e.length-1,o);return l?new jd(o,h,l):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Xu{constructor(e,i,o,h){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vi),h=i.parse(e[2],2,Vt);if(!o||!h)return null;if(!Ou(o.type,[lr(Vi),Xi,Vi]))return i.error(`Expected first argument to be of type array or string, but found ${Pn(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Vt);return l?new Xu(o.type,o,h,l):null}return new Xu(o.type,o,h)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!uc(i,["string","array"]))throw new Bn(`Expected first argument to be of type array or string, but found ${Pn(An(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(o,h)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function mm(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _m(s,e,i,o){return o.compare(e,i)===0}function hl(s,e,i){const o=s!=="=="&&s!=="!=";return class gA{constructor(l,f,g){this.type=ki,this.lhs=l,this.rhs=f,this.collator=g,this.hasUntypedArgument=l.type.kind==="value"||f.type.kind==="value"}static parse(l,f){if(l.length!==3&&l.length!==4)return f.error("Expected two or three arguments.");const g=l[0];let b=f.parse(l[1],1,Vi);if(!b)return null;if(!mm(g,b.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Pn(b.type)}'.`);let M=f.parse(l[2],2,Vi);if(!M)return null;if(!mm(g,M.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Pn(M.type)}'.`);if(b.type.kind!==M.type.kind&&b.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${Pn(b.type)}' and '${Pn(M.type)}'.`);o&&(b.type.kind==="value"&&M.type.kind!=="value"?b=new Bs(M.type,[b]):b.type.kind!=="value"&&M.type.kind==="value"&&(M=new Bs(b.type,[M])));let m=null;if(l.length===4){if(b.type.kind!=="string"&&M.type.kind!=="string"&&b.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(m=f.parse(l[3],3,lc),!m)return null}return new gA(b,M,m)}evaluate(l){const f=this.lhs.evaluate(l),g=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){const b=An(f),M=An(g);if(b.kind!==M.kind||b.kind!=="string"&&b.kind!=="number")throw new Bn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=An(f),M=An(g);if(b.kind!=="string"||M.kind!=="string")return e(l,f,g)}return this.collator?i(l,f,g,this.collator.evaluate(l)):e(l,f,g)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[s];return this.eachChild(f=>{l.push(f.serialize())}),l}}}const Ey=hl("==",function(s,e,i){return e===i},_m),My=hl("!=",function(s,e,i){return e!==i},function(s,e,i,o){return!_m(0,e,i,o)}),Ay=hl("<",function(s,e,i){return e<i},function(s,e,i,o){return o.compare(e,i)<0}),Iy=hl(">",function(s,e,i){return e>i},function(s,e,i,o){return o.compare(e,i)>0}),Cy=hl("<=",function(s,e,i){return e<=i},function(s,e,i,o){return o.compare(e,i)<=0}),Py=hl(">=",function(s,e,i){return e>=i},function(s,e,i,o){return o.compare(e,i)>=0});class Gd{constructor(e,i,o,h,l,f){this.type=Xi,this.number=e,this.locale=i,this.currency=o,this.unit=h,this.minFractionDigits=l,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Vt);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let l=null;if(h.locale&&(l=i.parseObjectValue(h.locale,2,"locale",Xi),!l))return null;let f=null;if(h.currency&&(f=i.parseObjectValue(h.currency,2,"currency",Xi),!f))return null;let g=null;if(h.unit&&(g=i.parseObjectValue(h.unit,2,"unit",Xi),!g))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Vt),!b))return null;let M=null;return h["max-fraction-digits"]&&(M=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Vt),!M)?null:new Gd(o,l,f,g,b,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class qd{constructor(e){this.type=Vt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Pn(o.type)} instead.`):new qd(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Bn(`Expected value to be of type string or array, but found ${Pn(An(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Yu(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const dl={"==":Ey,"!=":My,">":Iy,"<":Ay,">=":Py,"<=":Cy,array:Bs,at:Nd,boolean:Bs,case:jd,coalesce:$u,collator:Fu,format:xa,image:fc,in:Vd,"index-of":Wu,interpolate:Xr,"interpolate-hcl":Xr,"interpolate-lab":Xr,length:qd,let:Zu,literal:cr,match:Ud,number:Bs,"number-format":Gd,object:Bs,slice:Xu,step:cl,string:Bs,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:Ia,within:oi,distance:ea,config:Ma};function Hd(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=h?h.evaluate(s):1,f=yd(e,i,o,l);if(f)throw new Bn(f);return new Hi(e/255*l,i/255*l,o/255*l,l)}function gm(s,[e,i,o,h]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=h?h.evaluate(s):1,f=function(M,m,w,E){return typeof M=="number"&&M>=0&&M<=360?typeof m=="number"&&m>=0&&m<=100&&typeof w=="number"&&w>=0&&w<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[M,m,w,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[M,m,w,E]:[M,m,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[M,m,w,E]:[M,m,w]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,l);if(f)throw new Bn(f);const g=`hsla(${e}, ${i}%, ${o}%, ${l})`,b=Hi.parse(g);if(!b)throw new Bn(`Failed to parse HSLA color: ${g}`);return b}function ym(s,e){return s in e}function $d(s,e){const i=e[s];return i===void 0?null:i}function ta(s){return{type:s}}function Zd(s){return{result:"success",value:s}}function ls(s){return{result:"error",value:s}}function Ku(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function Ac(s){return s["property-type"]==="data-driven"}function xm(s){return Ku(s.expression,"measure-light")}function Ju(s){return Ku(s.expression,"zoom")}function Ic(s){return!!s.expression&&s.expression.interpolated}function Wd(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Ry(s){return s}function Xd(s,e){const i=e.type==="color",o=s.stops&&typeof s.stops[0][0]=="object",h=o||!(o||s.property!==void 0),l=s.type||(Ic(e)?"exponential":"interval");if(i&&((s=zu({},s)).stops&&(s.stops=s.stops.map(M=>[M[0],Hi.parse(M[1])])),s.default=Hi.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!pm[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let f,g,b;if(l==="exponential")f=vm;else if(l==="interval")f=zy;else if(l==="categorical"){f=Dy,g=Object.create(null);for(const M of s.stops)g[M[0]]=M[1];b=typeof s.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);f=bm}if(o){const M={},m=[];for(let v=0;v<s.stops.length;v++){const T=s.stops[v],I=T[0].zoom;M[I]===void 0&&(M[I]={zoom:I,type:s.type,property:s.property,default:s.default,stops:[]},m.push(I)),M[I].stops.push([T[0].value,T[1]])}const w=[];for(const v of m)w.push([M[v].zoom,Xd(M[v],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Xr.interpolationFactor.bind(void 0,E),zoomStops:w.map(v=>v[0]),evaluate:({zoom:v},T)=>vm({stops:w,base:s.base},e,v).evaluate(v,T)}}if(h){const M=l==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Xr.interpolationFactor.bind(void 0,M),zoomStops:s.stops.map(m=>m[0]),evaluate:({zoom:m})=>f(s,e,m,g,b)}}return{kind:"source",evaluate(M,m){const w=m&&m.properties?m.properties[s.property]:void 0;return w===void 0?fl(s.default,e.default):f(s,e,w,g,b)}}}function fl(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function Dy(s,e,i,o,h){return fl(typeof i===h?o[i]:void 0,s.default,e.default)}function zy(s,e,i){if(Ns(i)!=="number")return fl(s.default,e.default);const o=s.stops.length;if(o===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[o-1][0])return s.stops[o-1][1];const h=Sc(s.stops.map(l=>l[0]),i);return s.stops[h][1]}function vm(s,e,i){const o=s.base!==void 0?s.base:1;if(Ns(i)!=="number")return fl(s.default,e.default);const h=s.stops.length;if(h===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[h-1][0])return s.stops[h-1][1];const l=Sc(s.stops.map(m=>m[0]),i),f=function(m,w,E,v){const T=v-E,I=m-E;return T===0?0:w===1?I/T:(Math.pow(w,I)-1)/(Math.pow(w,T)-1)}(i,o,s.stops[l][0],s.stops[l+1][0]),g=s.stops[l][1],b=s.stops[l+1][1];let M=Du[e.type]||Ry;if(s.colorSpace&&s.colorSpace!=="rgb"){const m=pm[s.colorSpace];M=(w,E)=>m.reverse(m.interpolate(m.forward(w),m.forward(E),f))}return typeof g.evaluate=="function"?{evaluate(...m){const w=g.evaluate.apply(void 0,m),E=b.evaluate.apply(void 0,m);if(w!==void 0&&E!==void 0)return M(w,E,f)}}:M(g,b,f)}function bm(s,e,i){return e.type==="color"?i=Hi.parse(i):e.type==="formatted"?i=Mr.fromString(i.toString()):e.type==="resolvedImage"?i=xr.build(i.toString()):Ns(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),fl(i,s.default,e.default)}Gr.register(dl,{error:[{kind:"error"},[Xi],(s,[e])=>{throw new Bn(e.evaluate(s))}],typeof:[Xi,[Vi],(s,[e])=>Pn(An(e.evaluate(s)))],"to-rgba":[lr(Vt,4),[Er],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[lr(Vt,4),[Er],(s,[e])=>e.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[Er,[Vt,Vt,Vt],Hd],rgba:[Er,[Vt,Vt,Vt,Vt],Hd],hsl:[Er,[Vt,Vt,Vt],gm],hsla:[Er,[Vt,Vt,Vt,Vt],gm],has:{type:ki,overloads:[[[Xi],(s,[e])=>ym(e.evaluate(s),s.properties())],[[Xi,Co],(s,[e,i])=>ym(e.evaluate(s),i.evaluate(s))]]},get:{type:Vi,overloads:[[[Xi],(s,[e])=>$d(e.evaluate(s),s.properties())],[[Xi,Co],(s,[e,i])=>$d(e.evaluate(s),i.evaluate(s))]]},"feature-state":[Vi,[Xi],(s,[e])=>$d(e.evaluate(s),s.featureState||{})],properties:[Co,[],s=>s.properties()],"geometry-type":[Xi,[],s=>s.geometryType()],id:[Vi,[],s=>s.id()],zoom:[Vt,[],s=>s.globals.zoom],pitch:[Vt,[],s=>s.globals.pitch||0],"distance-from-center":[Vt,[],s=>s.distanceFromCenter()],"measure-light":[Vt,[Xi],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Vt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Vt,[],s=>s.globals.lineProgress||0],"raster-value":[Vt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Vt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Vt,[],s=>s.globals.skyRadialProgress||0],accumulated:[Vi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Vt,ta(Vt),(s,e)=>{let i=0;for(const o of e)i+=o.evaluate(s);return i}],"*":[Vt,ta(Vt),(s,e)=>{let i=1;for(const o of e)i*=o.evaluate(s);return i}],"-":{type:Vt,overloads:[[[Vt,Vt],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[Vt],(s,[e])=>-e.evaluate(s)]]},"/":[Vt,[Vt,Vt],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[Vt,[Vt,Vt],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[Vt,[],()=>Math.LN2],pi:[Vt,[],()=>Math.PI],e:[Vt,[],()=>Math.E],"^":[Vt,[Vt,Vt],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[Vt,[Vt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Vt,[Vt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Vt,[Vt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Vt,[Vt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[Vt,[Vt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Vt,[Vt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Vt,[Vt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Vt,[Vt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Vt,[Vt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Vt,[Vt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Vt,ta(Vt),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[Vt,ta(Vt),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[Vt,[Vt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Vt,[Vt],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[Vt,[Vt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Vt,[Vt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ki,[Xi,Vi],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[ki,[Vi],(s,[e])=>s.id()===e.value],"filter-type-==":[ki,[Xi],(s,[e])=>s.geometryType()===e.value],"filter-<":[ki,[Xi,Vi],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<h}],"filter-id-<":[ki,[Vi],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[ki,[Xi,Vi],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>h}],"filter-id->":[ki,[Vi],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[ki,[Xi,Vi],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[ki,[Vi],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[ki,[Xi,Vi],(s,[e,i])=>{const o=s.properties()[e.value],h=i.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[ki,[Vi],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[ki,[Vi],(s,[e])=>e.value in s.properties()],"filter-has-id":[ki,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ki,[lr(Xi)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ki,[lr(Vi)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ki,[Xi,lr(Vi)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ki,[Xi,lr(Vi)],(s,[e,i])=>function(o,h,l,f){for(;l<=f;){const g=l+f>>1;if(h[g]===o)return!0;h[g]>o?f=g-1:l=g+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ki,overloads:[[[ki,ki],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[ta(ki),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:ki,overloads:[[[ki,ki],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[ta(ki),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[ki,[ki],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ki,[Xi],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[Xi,[Xi],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Xi,[Xi],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Xi,ta(Vi),(s,e)=>e.map(i=>Ts(i.evaluate(s))).join("")],"resolved-locale":[Xi,[lc],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Vt,[Vt,Vt,Vi],(s,e)=>{const[i,o,h]=e.map(f=>f.evaluate(s));if(i>o||i===o)return i;let l;if(typeof h=="string")l=function(f){let g=0;if(f.length===0)return g;for(let b=0;b<f.length;b++)g=(g<<5)-g+f.charCodeAt(b),g|=0;return g}(h);else{if(typeof h!="number")throw new Bn(`Invalid seed input: ${h}`);l=h}return i+Yu(l)()*(o-i)}]});class Qu{constructor(e,i,o,h){this.expression=e,this._warningHistory={},this._evaluator=new vd(o,h),this._defaultValue=i?function(l){return l.type==="color"&&(Wd(l.default)||Array.isArray(l.default))?new Hi(0,0,0,0):l.type==="color"?Hi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=wc(e)}evaluateWithoutErrorHandling(e,i,o,h,l,f,g,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,h,l,f,g,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=b||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Bn(`Expected value to be one of ${Object.keys(this._enumValues).map(m=>JSON.stringify(m)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function pl(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in dl}function ml(s,e,i,o){const h=new Tc(dl,[],e?function(f){const g={color:Er,string:Xi,number:Vt,enum:Xi,boolean:ki,formatted:ro,resolvedImage:cc};return f.type==="array"?lr(g[f.value]||Vi,f.length):g[f.type]}(e):void 0,void 0,void 0,i,o),l=h.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Zd(new Qu(l,e,i,o)):ls(h.errors)}class eh{constructor(e,i,o,h){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!bc(i.expression),this.configDependencies=wc(i.expression)}evaluateWithoutErrorHandling(e,i,o,h,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,l,f)}evaluate(e,i,o,h,l,f){return this._styleExpression.evaluate(e,i,o,h,l,f)}}class Cc{constructor(e,i,o,h,l,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!bc(i.expression),this.isLightConstant=l,this.isLineProgressConstant=f,this.configDependencies=wc(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,o,h,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,l,f)}evaluate(e,i,o,h,l,f){return this._styleExpression.evaluate(e,i,o,h,l,f)}interpolationFactor(e,i,o){return this.interpolationType?Xr.interpolationFactor(this.interpolationType,e,i,o):0}}function wm(s,e,i,o){if((s=ml(s,e,i,o)).result==="error")return s;const h=s.value.expression,l=al(h);if(!l&&!Ac(e))return ls([new Mi("","data expressions not supported")]);const f=Aa(h,["zoom","pitch","distance-from-center"]);if(!f&&!Ju(e))return ls([new Mi("","zoom expressions not supported")]);const g=Aa(h,["measure-light"]);if(!g&&!xm(e))return ls([new Mi("","measure-light expression not supported")]);const b=Aa(h,["line-progress"]);if(!b&&!function(w){return Ku(w.expression,"line-progress")}(e))return ls([new Mi("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,m=Rc(h);return m||f||M?m instanceof Mi?ls([m]):m instanceof Xr&&!Ic(e)?ls([new Mi("",'"interpolate" expressions cannot be used with this property')]):Zd(m?new Cc(l&&b?"camera":"composite",s.value,m.labels,m instanceof Xr?m.interpolation:void 0,g,b):new eh(l&&b?"constant":"source",s.value,g,b)):ls([new Mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Pc{constructor(e,i){this._parameters=e,this._specification=i,zu(this,Xd(this._parameters,this._specification))}static deserialize(e){return new Pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Rc(s){let e=null;if(s instanceof Zu)e=Rc(s.result);else if(s instanceof $u){for(const i of s.args)if(e=Rc(i),e)break}else(s instanceof cl||s instanceof Xr)&&s.input instanceof Gr&&s.input.name==="zoom"&&(e=s);return e instanceof Mi||s.eachChild(i=>{const o=Rc(i);o instanceof Mi?e=o:e&&o&&e!==o&&(e=new Mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Yd,Tm,Ly=function(){if(Tm)return Yd;Tm=1,Yd=e;var s=3;function e(i,o,h){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(h=f[2]);for(var g=0;g<this.d*this.d;g++){var b=f[s+g],M=f[s+g+1];l.push(b===M?null:f.subarray(b,M))}var m=f[s+l.length+1];this.keys=f.subarray(f[s+l.length],m),this.bboxes=f.subarray(m),this.insert=this._insertReadonly}else{this.d=o+2*h;for(var w=0;w<this.d*this.d;w++)l.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=h,this.scale=o/i,this.uid=0;var E=h/o*i;this.min=-E,this.max=i+E}return e.prototype.insert=function(i,o,h,l,f){this._forEachCell(o,h,l,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(l),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,h,l,f,g){this.cells[f].push(g)},e.prototype.query=function(i,o,h,l,f){var g=this.min,b=this.max;if(i<=g&&o<=g&&b<=h&&b<=l&&!f)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(i,o,h,l,this._queryCell,M,{},f),M},e.prototype._queryCell=function(i,o,h,l,f,g,b,M){var m=this.cells[f];if(m!==null)for(var w=this.keys,E=this.bboxes,v=0;v<m.length;v++){var T=m[v];if(b[T]===void 0){var I=4*T;(M?M(E[I+0],E[I+1],E[I+2],E[I+3]):i<=E[I+2]&&o<=E[I+3]&&h>=E[I+0]&&l>=E[I+1])?(b[T]=!0,g.push(w[T])):b[T]=!1}}},e.prototype._forEachCell=function(i,o,h,l,f,g,b,M){for(var m=this._convertToCellCoord(i),w=this._convertToCellCoord(o),E=this._convertToCellCoord(h),v=this._convertToCellCoord(l),T=m;T<=E;T++)for(var I=w;I<=v;I++){var z=this.d*I+T;if((!M||M(this._convertFromCellCoord(T),this._convertFromCellCoord(I),this._convertFromCellCoord(T+1),this._convertFromCellCoord(I+1)))&&f.call(this,i,o,h,l,z,g,b,M))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=s+this.cells.length+1+1,h=0,l=0;l<this.cells.length;l++)h+=this.cells[l].length;var f=new Int32Array(o+h+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=o,b=0;b<i.length;b++){var M=i[b];f[s+b]=g,f.set(M,g),g+=M.length}return f[s+i.length]=g,f.set(this.keys,g),f[s+i.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer},Yd}(),Pa=W(Ly);const th={};function Nt(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),th[e]={klass:s,omit:i.omit||[]}}Nt(Object,"Object"),Pa.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},Pa.deserialize=function(s){return new Pa(s.buffer)},Object.defineProperty(Pa,"name",{value:"Grid"}),Nt(Pa,"Grid"),typeof DOMMatrix<"u"&&Nt(DOMMatrix,"DOMMatrix"),Nt(Hi,"Color"),Nt(Error,"Error"),Nt(Mr,"Formatted"),Nt(hc,"FormattedSection"),Nt(Fn,"AJAXError"),Nt(xr,"ResolvedImage"),Nt(Pc,"StylePropertyFunction"),Nt(Qu,"StyleExpression",{omit:["_evaluator"]}),Nt(so,"ImageIdWithOptions"),Nt(Cc,"ZoomDependentExpression"),Nt(eh,"ZoomConstantExpression"),Nt(Gr,"CompoundExpression",{omit:["_evaluate"]});for(const s in dl)th[dl[s]._classRegistryKey]||Nt(dl[s],`Expression${s}`);function Kd(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Jd(s){return self.ImageBitmap&&s instanceof ImageBitmap}function ia(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Kd(s)||Jd(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const o of s)i.push(ia(o,e));return i}if(s instanceof Map){const i={$name:"Map"};for(const[o,h]of s.entries())i[o]=ia(h);return i}if(s instanceof Set){const i={$name:"Set"};let o=0;for(const h of s.values())i[++o]=ia(h);return i}if(typeof s=="object"){const i=s.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${o}".`);const h=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const l in s)s.hasOwnProperty(l)&&(th[o].omit.indexOf(l)>=0||(h[l]=ia(s[l],e)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(h.$name=o),h}throw new Error("can't serialize object of type "+typeof s)}function Ra(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Kd(s)||Jd(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Ra);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const h=new Map;for(const l of Object.keys(s))l!=="$name"&&h.set(l,Ra(s[l]));return h}if(e==="Set"){const h=new Set;for(const l of Object.keys(s))l!=="$name"&&h.add(Ra(s[l]));return h}const{klass:i}=th[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(s);const o=Object.create(i.prototype);for(const h of Object.keys(s))h!=="$name"&&(o[h]=Ra(s[h]));return o}throw new Error("can't deserialize object of type "+typeof s)}const qt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Qd(s){for(const e of s)if(ih(e.charCodeAt(0)))return!0;return!1}function Oy(s){for(const e of s)if(!ky(e.charCodeAt(0)))return!1;return!0}function ky(s){return!(qt.Arabic(s)||qt["Arabic Supplement"](s)||qt["Arabic Extended-A"](s)||qt["Arabic Presentation Forms-A"](s)||qt["Arabic Presentation Forms-B"](s))}function ih(s){return!(s!==746&&s!==747&&(s<4352||!(qt["Bopomofo Extended"](s)||qt.Bopomofo(s)||qt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||qt["CJK Compatibility Ideographs"](s)||qt["CJK Compatibility"](s)||qt["CJK Radicals Supplement"](s)||qt["CJK Strokes"](s)||!(!qt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||qt["CJK Unified Ideographs Extension A"](s)||qt["CJK Unified Ideographs"](s)||qt["Enclosed CJK Letters and Months"](s)||qt["Hangul Compatibility Jamo"](s)||qt["Hangul Jamo Extended-A"](s)||qt["Hangul Jamo Extended-B"](s)||qt["Hangul Jamo"](s)||qt["Hangul Syllables"](s)||qt.Hiragana(s)||qt["Ideographic Description Characters"](s)||qt.Kanbun(s)||qt["Kangxi Radicals"](s)||qt["Katakana Phonetic Extensions"](s)||qt.Katakana(s)&&s!==12540||!(!qt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!qt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||qt["Unified Canadian Aboriginal Syllabics"](s)||qt["Unified Canadian Aboriginal Syllabics Extended"](s)||qt["Vertical Forms"](s)||qt["Yijing Hexagram Symbols"](s)||qt["Yi Syllables"](s)||qt["Yi Radicals"](s))))}function ef(s){return!(ih(s)||function(e){return!!(qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||qt["Letterlike Symbols"](e)||qt["Number Forms"](e)||qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||qt["Control Pictures"](e)&&e!==9251||qt["Optical Character Recognition"](e)||qt["Enclosed Alphanumerics"](e)||qt["Geometric Shapes"](e)||qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||qt["CJK Symbols and Punctuation"](e)||qt.Katakana(e)||qt["Private Use Area"](e)||qt["CJK Compatibility Forms"](e)||qt["Small Form Variants"](e)||qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function tf(s){return s>=1424&&s<=2303||qt["Arabic Presentation Forms-A"](s)||qt["Arabic Presentation Forms-B"](s)}function Sm(s,e){return!(!e&&tf(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||qt.Khmer(s))}function nf(s){for(const e of s)if(tf(e.charCodeAt(0)))return!0;return!1}const Dc="deferred",nh="loading",rf="loaded";let oo=null,Yr="unavailable",na=null;const sf=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Yr="error"),oo&&oo(s)};function of(){_l.fire(new no("pluginStateChange",{pluginStatus:Yr,pluginURL:na}))}const _l=new Ko,rh=function(){return Yr},zc=function(){if(Yr!==Dc||!na)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yr=nh,of(),na&&er({url:na},s=>{s?sf(s):(Yr=rf,of())})},cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yr===rf||cs.applyArabicShaping!=null,isLoading:()=>Yr===nh,setState(s){Yr=s.pluginStatus,na=s.pluginURL},isParsed:()=>cs.applyArabicShaping!=null&&cs.processBidirectionalText!=null&&cs.processStyledBidirectionalText!=null,getPluginURL:()=>na};class un{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const h of i)if(!Sm(h.charCodeAt(0),o))return!1;return!0}(e,cs.isLoaded())}}class sh{constructor(e,i,o,h){this.property=e,this.value=i,this.expression=function(l,f,g,b){if(Wd(l))return new Pc(l,f);if(pl(l)||Array.isArray(l)&&l.length>0){const M=wm(l,f,g,b);if(M.result==="error")throw new Error(M.value.map(m=>`${m.key}: ${m.message}`).join(", "));return M.value}{let M=l;return typeof l=="string"&&f.type==="color"&&(M=Hi.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(i===void 0?e.specification.default:i,e.specification,o,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Lc{constructor(e,i,o){this.property=e,this.value=new sh(e,void 0,i,o)}transitioned(e,i){return new af(this.property,this.value,i,qi({},e.transition,this.transition),e.now)}untransitioned(){return new af(this.property,this.value,null,{},0)}}class oh{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Mn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Lc(this._values[e].property,this._scope,this._options)),this._values[e].value=new sh(this._values[e].property,i===null?void 0:Mn(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const h in e){const l=e[h];if(xn(h,"-transition")){const f=h.slice(0,-11);o[f]&&this.setTransition(f,l)}else o.hasOwnProperty(h)&&this.setValue(h,l)}}getTransition(e){return Mn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Lc(this._values[e].property)),this._values[e].transition=Mn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const o=new Oc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,i._values[h]);return o}untransitioned(){const e=new Oc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class af{constructor(e,i,o,h,l){const f=h.delay||0,g=h.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+f,this.end=this.begin+g,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const h=e.now||0,l=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(h>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(h<this.begin)return f.possiblyEvaluate(e,i,o);{const g=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),l,Zt(g))}}return l}}class Oc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const h=new xl(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class gl{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Mn(this._values[e].value)}setValue(e,i){this._values[e]=new sh(this._values[e].property,i===null?void 0:Mn(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const h=new xl(this._properties);for(const l of Object.keys(this._values))h._values[l]=this._values[l].possiblyEvaluate(e,i,o);return h}}class yl{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,h){return this.property.evaluate(this.value,this.parameters,e,i,o,h)}}class xl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class yt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const h=Du[this.specification.type];return h?h(e,i,o):e}}class Dt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,h){return new yl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,h)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new yl(this,{kind:"constant",value:void 0},e.parameters);const h=Du[this.specification.type];return h?new yl(this,{kind:"constant",value:h(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,h,l,f){return e.kind==="constant"?e.value:e.evaluate(i,o,h,l,f)}}class vl{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){return!!e.expression.evaluate(i,null,{},o,h)}interpolate(){return!1}}class vn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new un(0,{});for(const o in e){const h=e[o];h.specification.overridable&&this.overridableProperties.push(o);const l=this.defaultPropertyValues[o]=new sh(h,void 0),f=this.defaultTransitionablePropertyValues[o]=new Lc(h);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(i)}}}Nt(Dt,"DataDrivenProperty"),Nt(yt,"DataConstantProperty"),Nt(vl,"ColorRampProperty");var Fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Em(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ah(s){if(Array.isArray(s))return s.map(ah);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=ah(s[i]);return e}return Em(s)}function lf(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!lf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Mm(s,e="",i=null,o="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};lf(s)||(s=lh(s));const h=s;let l=!0;try{l=function(m){if(!bl(m))return m;let w=ah(m);return Im(w),w=Am(w),w}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let f=null,g=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){g=Fe[`filter_${o}`];const m=ml(l,g,e,i);if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,E,v)=>m.value.evaluate(w,E,{},v)}let b=null,M=null;if(l!==h){const m=ml(h,g,e,i);if(m.result==="error")throw new Error(m.value.map(w=>`${w.key}: ${w.message}`).join(", "));b=(w,E,v,T,I)=>m.value.evaluate(w,E,{},v,void 0,void 0,T,I),M=!al(m.value.expression)}return{filter:f,dynamicFilter:b||void 0,needGeometry:Cm(l),needFeature:!!M}}function Am(s){if(!Array.isArray(s))return s;const e=function(i){if(Fy.has(i[0])){for(let o=1;o<i.length;o++)if(bl(i[o]))return!0}return i}(s);return e===!0?e:e.map(i=>Am(i))}function Im(s){let e=!1;const i=[];if(s[0]==="case"){for(let o=1;o<s.length-1;o+=2)e=e||bl(s[o]),i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||bl(s[1]);for(let o=2;o<s.length-1;o+=2)i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||bl(s[1]);for(let o=1;o<s.length-1;o+=2)i.push(s[o+1])}e&&(s.length=0,s.push("any",...i));for(let o=1;o<s.length;o++)Im(s[o])}function bl(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(bl(s[i]))return!0;return!1}const Fy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function By(s,e){return s<e?-1:s>e?1:0}function Cm(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Cm(s[e]))return!0;return!1}function lh(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?ra(s[1],s[2],"=="):e==="!="?Da(ra(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ra(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(lh))):e==="all"?["all"].concat(s.slice(1).map(lh)):e==="none"?["all"].concat(s.slice(1).map(lh).map(Da)):e==="in"?cf(s[1],s.slice(2)):e==="!in"?Da(cf(s[1],s.slice(2))):e==="has"?uf(s[1]):e!=="!has"||Da(uf(s[1]));var i}function ra(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function cf(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort(By)]]:["filter-in-small",s,["literal",e]]}}function uf(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Da(s){return["!",s]}const ch="";function ao(s,e){return e?`${s}${ch}${e}`:s}const Lo="-transition",Pm=new Set(["fill","line","background","hillshade","raster"]);class sr extends Ko{constructor(e,i,o,h,l){if(super(),this.id=e.id,this.fqid=ao(this.id,o),this.type=e.type,this.scope=o,this.lut=h,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=ml(this.filter,Fe[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new gl(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new oh(i.paint,this.scope,l);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xl(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Pm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return xn(e,Lo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,h=o._properties.properties;if(xn(e,Lo)){const w=e.slice(0,-11);return h[w]&&o.setTransition(w,i||void 0),!1}if(!h[e])return!1;const l=o._values[e],f=l.value.isDataDriven(),g=l.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=o._values[e].value,M=b.isDataDriven(),m=xn(e,"pattern")||e==="line-dasharray";return M||f||m||this._handleOverridablePaintPropertyUpdate(e,g,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Eo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof yl&&Ac(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Mm(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,h,l,f,g,b,M){}}const Ny={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $i(s,e=1){let i=0,o=0;return{members:s.map(h=>{const l=Ny[h.type].BYTES_PER_ELEMENT,f=i=Rm(i,Math.max(e,l)),g=h.components||1;return o=Math.max(o,l),i+=l*g,{name:h.name,type:h.type,components:g,offset:f}}),size:Rm(i,Math.max(o,e)),alignment:e}}function Rm(s,e){return Math.ceil(s/e)*e}class Oo extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,e}}Oo.prototype.bytesPerElement=4,Nt(Oo,"StructArrayLayout2i4");class wl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=o,this.int16[l+2]=h,e}}wl.prototype.bytesPerElement=6,Nt(wl,"StructArrayLayout3i6");class ko extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=h,this.int16[f+3]=l,e}}ko.prototype.bytesPerElement=8,Nt(ko,"StructArrayLayout4i8");class uh extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h,l)}emplace(e,i,o,h,l,f){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=l,this.int16[g+4]=f,e}}uh.prototype.bytesPerElement=10,Nt(uh,"StructArrayLayout5i10");class Fc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,f,g)}emplace(e,i,o,h,l,f,g,b){const M=6*e,m=12*e,w=3*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.uint8[m+4]=h,this.uint8[m+5]=l,this.uint8[m+6]=f,this.uint8[m+7]=g,this.float32[w+2]=b,e}}Fc.prototype.bytesPerElement=12,Nt(Fc,"StructArrayLayout2i4ub1f12");class lo extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=o,this.float32[l+2]=h,e}}lo.prototype.bytesPerElement=12,Nt(lo,"StructArrayLayout3f12");class Ar extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h,l)}emplace(e,i,o,h,l,f){const g=6*e,b=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=h,this.uint16[g+3]=l,this.float32[b+2]=f,e}}Ar.prototype.bytesPerElement=12,Nt(Ar,"StructArrayLayout4ui1f12");class hh extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=h,this.uint16[f+3]=l,e}}hh.prototype.bytesPerElement=8,Nt(hh,"StructArrayLayout4ui8");class Bc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,f)}emplace(e,i,o,h,l,f,g){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=h,this.int16[b+3]=l,this.int16[b+4]=f,this.int16[b+5]=g,e}}Bc.prototype.bytesPerElement=12,Nt(Bc,"StructArrayLayout6i12");class hf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w,E){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,h,l,f,g,b,M,m,w,E)}emplace(e,i,o,h,l,f,g,b,M,m,w,E,v){const T=12*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=h,this.int16[T+3]=l,this.uint16[T+4]=f,this.uint16[T+5]=g,this.uint16[T+6]=b,this.uint16[T+7]=M,this.int16[T+8]=m,this.int16[T+9]=w,this.int16[T+10]=E,this.int16[T+11]=v,e}}hf.prototype.bytesPerElement=24,Nt(hf,"StructArrayLayout4i4ui4i24");class df extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,f)}emplace(e,i,o,h,l,f,g){const b=10*e,M=5*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=h,this.float32[M+2]=l,this.float32[M+3]=f,this.float32[M+4]=g,e}}df.prototype.bytesPerElement=20,Nt(df,"StructArrayLayout3i3f20");class za extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=h,this.float32[f+3]=l,e}}za.prototype.bytesPerElement=16,Nt(za,"StructArrayLayout4f16");class ff extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ff.prototype.bytesPerElement=4,Nt(ff,"StructArrayLayout1ul4");class sa extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,e}}sa.prototype.bytesPerElement=4,Nt(sa,"StructArrayLayout2ui4");class pf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w,E,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,h,l,f,g,b,M,m,w,E,v)}emplace(e,i,o,h,l,f,g,b,M,m,w,E,v,T){const I=20*e,z=10*e;return this.int16[I+0]=i,this.int16[I+1]=o,this.int16[I+2]=h,this.int16[I+3]=l,this.int16[I+4]=f,this.float32[z+3]=g,this.float32[z+4]=b,this.float32[z+5]=M,this.float32[z+6]=m,this.int16[I+14]=w,this.uint32[z+8]=E,this.uint16[I+18]=v,this.uint16[I+19]=T,e}}pf.prototype.bytesPerElement=40,Nt(pf,"StructArrayLayout5i4f1i1ul2ui40");class dh extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,f,g)}emplace(e,i,o,h,l,f,g,b){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+4]=l,this.int16[M+5]=f,this.int16[M+6]=g,this.int16[M+7]=b,e}}dh.prototype.bytesPerElement=16,Nt(dh,"StructArrayLayout3i2i2i16");class mf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h,l)}emplace(e,i,o,h,l,f){const g=4*e,b=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.int16[b+6]=l,this.int16[b+7]=f,e}}mf.prototype.bytesPerElement=16,Nt(mf,"StructArrayLayout2f1f2i16");class _f extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,l,f)}emplace(e,i,o,h,l,f,g){const b=20*e,M=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=o,this.float32[M+1]=h,this.float32[M+2]=l,this.float32[M+3]=f,this.float32[M+4]=g,e}}_f.prototype.bytesPerElement=20,Nt(_f,"StructArrayLayout2ub4f20");class hr extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,this.uint16[l+2]=h,e}}hr.prototype.bytesPerElement=6,Nt(hr,"StructArrayLayout3ui6");class gf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G)}emplace(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G,H){const K=30*e,se=15*e,re=60*e;return this.int16[K+0]=i,this.int16[K+1]=o,this.int16[K+2]=h,this.float32[se+2]=l,this.float32[se+3]=f,this.uint16[K+8]=g,this.uint16[K+9]=b,this.uint32[se+5]=M,this.uint32[se+6]=m,this.uint32[se+7]=w,this.uint16[K+16]=E,this.uint16[K+17]=v,this.uint16[K+18]=T,this.float32[se+10]=I,this.float32[se+11]=z,this.uint8[re+48]=O,this.uint8[re+49]=V,this.uint8[re+50]=j,this.uint32[se+13]=N,this.int16[K+28]=G,this.uint8[re+58]=H,e}}gf.prototype.bytesPerElement=60,Nt(gf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class yf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G,H,K,se,re,ie,_e,oe,ye,be,ve,Ee){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G,H,K,se,re,ie,_e,oe,ye,be,ve,Ee)}emplace(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O,V,j,N,G,H,K,se,re,ie,_e,oe,ye,be,ve,Ee,Ie){const De=20*e,Ae=40*e,Ye=80*e;return this.float32[De+0]=i,this.float32[De+1]=o,this.int16[Ae+4]=h,this.int16[Ae+5]=l,this.int16[Ae+6]=f,this.int16[Ae+7]=g,this.int16[Ae+8]=b,this.int16[Ae+9]=M,this.int16[Ae+10]=m,this.int16[Ae+11]=w,this.int16[Ae+12]=E,this.uint16[Ae+13]=v,this.uint16[Ae+14]=T,this.uint16[Ae+15]=I,this.uint16[Ae+16]=z,this.uint16[Ae+17]=O,this.uint16[Ae+18]=V,this.uint16[Ae+19]=j,this.uint16[Ae+20]=N,this.uint16[Ae+21]=G,this.uint16[Ae+22]=H,this.uint16[Ae+23]=K,this.uint16[Ae+24]=se,this.uint16[Ae+25]=re,this.uint16[Ae+26]=ie,this.uint16[Ae+27]=_e,this.uint32[De+14]=oe,this.float32[De+15]=ye,this.float32[De+16]=be,this.float32[De+17]=ve,this.float32[De+18]=Ee,this.uint8[Ye+76]=Ie,e}}yf.prototype.bytesPerElement=80,Nt(yf,"StructArrayLayout2f9i15ui1ul4f1ub80");class Nc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Nc.prototype.bytesPerElement=4,Nt(Nc,"StructArrayLayout1f4");class oa extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,h,l)}emplace(e,i,o,h,l,f){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=l,this.float32[g+4]=f,e}}oa.prototype.bytesPerElement=20,Nt(oa,"StructArrayLayout5f20");class fh extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,f,g)}emplace(e,i,o,h,l,f,g,b){const M=7*e;return this.float32[M+0]=i,this.float32[M+1]=o,this.float32[M+2]=h,this.float32[M+3]=l,this.float32[M+4]=f,this.float32[M+5]=g,this.float32[M+6]=b,e}}fh.prototype.bytesPerElement=28,Nt(fh,"StructArrayLayout7f28");class co extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,h,l,f,g,b,M,m,w)}emplace(e,i,o,h,l,f,g,b,M,m,w,E){const v=11*e;return this.float32[v+0]=i,this.float32[v+1]=o,this.float32[v+2]=h,this.float32[v+3]=l,this.float32[v+4]=f,this.float32[v+5]=g,this.float32[v+6]=b,this.float32[v+7]=M,this.float32[v+8]=m,this.float32[v+9]=w,this.float32[v+10]=E,e}}co.prototype.bytesPerElement=44,Nt(co,"StructArrayLayout11f44");class ph extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,h,l,f,g,b,M)}emplace(e,i,o,h,l,f,g,b,M,m){const w=9*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=h,this.float32[w+3]=l,this.float32[w+4]=f,this.float32[w+5]=g,this.float32[w+6]=b,this.float32[w+7]=M,this.float32[w+8]=m,e}}ph.prototype.bytesPerElement=36,Nt(ph,"StructArrayLayout9f36");class Tl extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=o,e}}Tl.prototype.bytesPerElement=8,Nt(Tl,"StructArrayLayout2f8");class xf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,h)}emplace(e,i,o,h,l){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=h,this.uint16[f+4]=l,e}}xf.prototype.bytesPerElement=12,Nt(xf,"StructArrayLayout1ul3ui12");class vf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}vf.prototype.bytesPerElement=2,Nt(vf,"StructArrayLayout1ui2");class Vc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z)}emplace(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O){const V=16*e;return this.float32[V+0]=i,this.float32[V+1]=o,this.float32[V+2]=h,this.float32[V+3]=l,this.float32[V+4]=f,this.float32[V+5]=g,this.float32[V+6]=b,this.float32[V+7]=M,this.float32[V+8]=m,this.float32[V+9]=w,this.float32[V+10]=E,this.float32[V+11]=v,this.float32[V+12]=T,this.float32[V+13]=I,this.float32[V+14]=z,this.float32[V+15]=O,e}}Vc.prototype.bytesPerElement=64,Nt(Vc,"StructArrayLayout16f64");class Uc extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,l,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,h,l,f,g)}emplace(e,i,o,h,l,f,g,b){const M=10*e,m=5*e;return this.uint16[M+0]=i,this.uint16[M+1]=o,this.uint16[M+2]=h,this.uint16[M+3]=l,this.float32[m+2]=f,this.float32[m+3]=g,this.float32[m+4]=b,e}}Uc.prototype.bytesPerElement=20,Nt(Uc,"StructArrayLayout4ui3f20");class bf extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}bf.prototype.bytesPerElement=2,Nt(bf,"StructArrayLayout1i2");class mh extends hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}mh.prototype.bytesPerElement=1,Nt(mh,"StructArrayLayout1ub1");class Dm extends kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Dm.prototype.size=40;class wf extends pf{get(e){return new Dm(this,e)}}Nt(wf,"CollisionBoxArray");class jc extends kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}jc.prototype.size=60;class zm extends gf{get(e){return new jc(this,e)}}Nt(zm,"PlacedSymbolArray");class Lm extends kc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Lm.prototype.size=80;class Om extends yf{get(e){return new Lm(this,e)}}Nt(Om,"SymbolInstanceArray");class km extends Nc{getoffsetX(e){return this.float32[1*e+0]}}Nt(km,"GlyphOffsetArray");class Fm extends Oo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Nt(Fm,"SymbolLineVertexArray");class Gc extends kc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Gc.prototype.size=12;class qc extends xf{get(e){return new Gc(this,e)}}Nt(qc,"FeatureIndexArray");class Kr extends sa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Nt(Kr,"FillExtrusionCentroidArray");class Hc extends kc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Hc.prototype.size=6;class Bm extends wl{get(e){return new Hc(this,e)}}Nt(Bm,"FillExtrusionWallArray");const Vy=$i([{name:"a_pos",components:2,type:"Int16"}],4),Uy=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,h){let l=this.segments[this.segments.length-1];return e>Rn.MAX_VERTEX_ARRAY_LENGTH&&_i(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Rn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==h)&&(l={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},h!==void 0&&(l.sortKey=h),this.segments.push(l)),l}prepareSegment(e,i,o,h){return this._prepareSegment(e,i.length,o.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,h){return new Rn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function _h(s,e){return 256*(s=Mt(Math.floor(s),0,255))+Mt(Math.floor(e),0,255)}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nt(Rn,"SegmentVector");const jy=$i([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Tf=$i([{name:"a_dash",components:4,type:"Uint16"}]);class $c{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,h){this.ids.push(Nm(e)),this.positions.push(i,o,h)}eachPosition(e,i){const o=Nm(e);let h=0,l=this.ids.length-1;for(;h<l;){const f=h+l>>1;this.ids[f]>=o?l=f:h=f+1}for(;this.ids[h]===o;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Zc(o,h,0,o.length-1),i&&(i.add(o.buffer),i.add(h.buffer)),{ids:o,positions:h}}static deserialize(e){const i=new $c;let o;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==o&&i.uniqueIds.push(h),o=h;return i.indexed=!0,i}}function Nm(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Fs(String(s))}function Zc(s,e,i,o){for(;i<o;){const h=s[i+o>>1];let l=i-1,f=o+1;for(;;){do l++;while(s[l]<h);do f--;while(s[f]>h);if(l>=f)break;gh(s,l,f),gh(e,3*l,3*f),gh(e,3*l+1,3*f+1),gh(e,3*l+2,3*f+2)}f-i<o-f?(Zc(s,e,i,f),i=f+1):(Zc(s,e,f+1,o),o=f)}}function gh(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}Nt($c,"FeaturePositionMap");class uo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Wc extends uo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class zn extends uo{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Es extends uo{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Sl extends uo{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Xc extends uo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Vm extends uo{constructor(e){super(e),this.current=Hi.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Um=new Float32Array(16);class Yc extends uo{constructor(e){super(e),this.current=Um}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let h=1;h<16;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Sf=new Float32Array(9),Gy=new Float32Array(4);class Ef extends uo{constructor(e){super(e),this.current=Gy}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(o[h]!==this.current[h]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Mf(s){return[_h(255*s.r,255*s.g),_h(255*s.b,255*s.a)]}class La{constructor(e,i,o,h){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=o,this.context=h}setUniform(e,i,o,h,l){const f=h.constantOr(this.value);i.set(e,l,f instanceof Hi?f.toRenderColor(this.ignoreLut?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Vm(e):new zn(e)}}class Oa{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,h,l){const f=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;f&&i.set(e,l,f)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Xc(e):new zn(e)}}class Fo{constructor(e,i,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,o,h,l,f,g){const b=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new un(0,{brightness:f}),i,{},l,h,g):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new un(0,{brightness:f}),i,{},l,h,g)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(b,e,M,this.context)}updatePaintArray(e,i,o,h,l,f,g){const b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g},o,h,void 0,l):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:g},o,h,void 0,l)==="none"),this._setPaintValue(e,i,b,this.context)}_setPaintValue(e,i,o,h){if(this.type==="color"){const l=Mf(o.toRenderColor(this.ignoreLut?null:h.lut));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vs{constructor(e,i,o,h,l,f){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=h,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,h,l,f,g){const b=this.expression.evaluate(new un(this.context.zoom,{brightness:f}),i,{},l,h,g),M=this.expression.evaluate(new un(this.context.zoom+1,{brightness:f}),i,{},l,h,g);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new un(this.context.zoom,{brightness:f}),i,{},l,h,g)==="none");const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,b,M,this.context)}updatePaintArray(e,i,o,h,l,f,g){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,h,void 0,l),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,h,void 0,l);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:g},o,h,void 0,l)==="none"),this._setPaintValue(e,i,b,M,this.context)}_setPaintValue(e,i,o,h,l){if(this.type==="color"){const f=Mf(o.toRenderColor(this.ignoreLut?null:l.lut)),g=Mf(o.toRenderColor(this.ignoreLut?null:l.lut));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,h,l){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=Mt(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,g)}getBinding(e,i){return new zn(e)}}class aa{constructor(e,i,o,h,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?Tf:jy).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new h}populatePaintArray(e,i,o,h){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,h,l,f,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,h){if(!h||!o)return;const l=h[o];if(!l)return;const{tl:f,br:g,pixelRatio:b}=l;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,f[0],f[1],g[0],g[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ka{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const l in e.paint._values){const f=e.paint.get(l),g=e.paint.get(`${l}-use-theme`);if(l.endsWith("-use-theme")||!o(l)||!(f instanceof yl&&Ac(f.property.specification)))continue;const b=Hy(l,e.type),M=f.value,m=f.property.specification.type,w=!!f.property.useIntegerZoom,E=l==="line-dasharray"||l.endsWith("pattern"),v=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||g&&g.value.kind!=="constant";if(M.kind!=="constant"||v)if(M.kind==="source"||v||E){const T=jm(l,m,"source");this.binders[l]=E?new aa(M,b,m,T,e.id):new Fo(M,b,m,T),h.push(`/a_${l}`)}else{const T=jm(l,m,"composite");this.binders[l]=new Vs(M,b,m,w,i,T),h.push(`/z_${l}`)}else this.binders[l]=E?new Oa(M.value,b):new La(M.value,b,m,i),h.push(`/u_${l}`);g&&(this.binders[l].ignoreLut=g.constantOr("default")==="none",this.binders[l].lutExpression=g.value,this.binders[l].checkUseTheme=!0)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Fo||i instanceof Vs?i.maxValue:0}populatePaintArrays(e,i,o,h,l,f,g){for(const b in this.binders){const M=this.binders[b];M.context=this.context,M instanceof Fo||M instanceof Vs||M instanceof aa?M.populatePaintArray(e,i,o,h,l,f,g):M.lutExpression&&M instanceof La&&M.lutExpression&&(M.lutExpression.kind==="composite"||M.lutExpression.kind==="source")&&(M.ignoreLut=M.lutExpression.evaluate(new un(0,{brightness:f}),i,{},l,h,g)==="none")}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof Oa&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,h,l,f,g,b,M){let m=!1;const w=Object.keys(e),E=w.length!==0&&!b,v=E?w:i.uniqueIds;this.context.lut=l.lut;for(const T in this.binders){const I=this.binders[T];if(I.context=this.context,(I instanceof Fo||I instanceof Vs||I instanceof aa)&&I.expression&&I.expression.kind&&I.expression.kind!=="constant"&&(I.expression.isStateDependent===!0||I.expression.isLightConstant===!1)){const z=l.paint.get(T);I.expression=z.value;for(const O of v){const V=e[O.toString()];i.eachPosition(O,(j,N,G)=>{const H=h.feature(j);I.updatePaintArray(N,G,H,V,f,g,M)})}if(!E)for(const O of o.uniqueIds){const V=e[O.toString()];o.eachPosition(O,(j,N,G)=>{const H=h.feature(j);I.updatePaintArray(N,G,H,V,f,g,M)})}m=!0}}return m}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof La||o instanceof Oa)&&e.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Fo||o instanceof Vs||o instanceof aa)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof La||o instanceof Oa||o instanceof Vs)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof La||h instanceof Oa||h instanceof Vs)for(const l of h.uniformNames)i.push({name:l,property:o,binding:h.getBinding(e,l)})}return i}setUniforms(e,i,o,h,l){for(const{name:f,property:g,binding:b}of o){if(this.binders[g].checkUseTheme&&this.binders[g]instanceof La){const M=h.get(`${g}-use-theme`);M.isConstant()&&(this.binders[g].ignoreLut=M.constantOr("default")==="none")}this.binders[g].setUniform(e,b,l,h.get(g),f)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Fo||i instanceof Vs||i instanceof aa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Fo||o instanceof Vs||o instanceof aa)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Fo||i instanceof Vs||i instanceof aa)&&i.destroy()}}}class la{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new ka(h,i,o);this.needsUpload=!1,this._featureMap=new $c,this._featureMapWithoutIds=new $c,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,h,l,f,g,b){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,h,l,f,g,b);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,h,l,f,g){for(const b of o)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,b,h,l,f,g||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qy={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Hy(s,e){return qy[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const $y={"line-pattern":{source:Ar,composite:Ar},"fill-pattern":{source:Ar,composite:Ar},"fill-extrusion-pattern":{source:Ar,composite:Ar},"line-dasharray":{source:hh,composite:hh}},yh={color:{source:Tl,composite:za},number:{source:Nc,composite:Tl}};function jm(s,e,i){const o=$y[s];return o&&o[i]||yh[e][i]}Nt(La,"ConstantBinder"),Nt(Oa,"PatternConstantBinder"),Nt(Fo,"SourceExpressionBinder"),Nt(aa,"PatternCompositeBinder"),Nt(Vs,"CompositeExpressionBinder"),Nt(ka,"ProgramConfiguration",{omit:["_buffers"]}),Nt(la,"ProgramConfigurationSet");const Nr=At/Math.PI/2,El=5,Gm=6,qm=16383,Ml=64,xh=[Ml,32,16],us=-Nr,hs=Nr;function Al(s,e,i,o=Nr){return i=mt(i),[s*Math.sin(i)*o,-e*o,s*Math.cos(i)*o]}function Fa(s,e,i){return Al(Math.cos(mt(s)),Math.sin(mt(s)),e,i)}const Ba=63710088e-1,Af=2*Math.PI*Ba;class Ni{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ni(wi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,h=e.lat*i,l=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Ba*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new ca({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Fa(this.lat,this.lng,Nr+e*Nr/Ba)}static convert(e){if(e instanceof Ni)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ni(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ni(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ca{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof Ni?new Ni(e.lng,e.lat):Ni.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ni?new Ni(e.lng,e.lat):Ni.convert(e),this}extend(e){const i=this._sw,o=this._ne;let h,l;if(e instanceof Ni)h=e,l=e;else{if(!(e instanceof ca))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ca.convert(e)):this.extend(Ni.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ni.convert(e)):this;if(h=e._sw,l=e._ne,!h||!l)return this}return i||o?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new Ni(h.lng,h.lat),this._ne=new Ni(l.lng,l.lat)),this}getCenter(){return new Ni((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ni(this.getWest(),this.getNorth())}getSouthEast(){return new Ni(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Ni.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&h}static convert(e){if(e)return e instanceof ca?e:new ca(e)}}const Zy=0,Wy=25.5;function vh(s){return Af*Math.cos(s*Math.PI/180)}function ho(s){return(180+s)/360}function Us(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Vr(s,e){return s/vh(e)}function Jr(s){return 360*s-180}function dr(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Hm(s,e){return s*vh(dr(e))}const Dn=85.051129;function If(s){return Math.cos(mt(Mt(s,-Dn,Dn)))}function Il(s,e){const i=Mt(e,Zy,Wy),o=Math.pow(2,i);return If(s)*Af/(512*o)}function c(s){return 1/Math.cos(s*Math.PI/180)}function t(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/At)/(1<<s.z)*2));return 80150034*i/(i*i+1)/At/(1<<s.z)}class n{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Ni.convert(e);return new n(ho(o.lng),Us(o.lat),Vr(i,o.lat))}toLngLat(){return new Ni(Jr(this.x),dr(this.y))}toAltitude(){return Hm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Af*c(dr(this.y))}}function u(s,e,i,o,h,l,f,g,b){const M=(e+o)/2,m=(i+h)/2,w=new ge(M,m);g(w),function(E,v,T,I,z,O){const V=T-z,j=I-O;return Math.abs((I-v)*V-(T-E)*j)/Math.hypot(V,j)}(w.x,w.y,l.x,l.y,f.x,f.y)>=b?(u(s,e,i,M,m,l,w,g,b),u(s,M,m,o,h,w,f,g,b)):s.push(f)}function p(s,e,i){let o=s[0],h=o.x,l=o.y;e(o);const f=[o];for(let g=1;g<s.length;g++){const b=s[g],{x:M,y:m}=b;e(b),u(f,h,l,M,m,o,b,e,i),h=M,l=m,o=b}return f}function _(s,e,i,o){if(o(e,i)){const h=e.add(i)._mult(.5);_(s,e,h,o),_(s,h,i,o)}else s.push(i)}function x(s,e){let i=s[0];const o=[i];for(let h=1;h<s.length;h++){const l=s[h];_(o,i,l,e),i=l}return o}const S=Math.pow(2,14)-1,C=-S-1;function R(s,e){const i=Math.round(s.x*e),o=Math.round(s.y*e);return s.x=Mt(i,C,S),s.y=Mt(o,C,S),(i<s.x||i>s.x+1||o<s.y||o>s.y+1)&&_i("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function D(s,e,i){const o=s.loadGeometry(),h=s.extent,l=At/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x:b,y:M,projection:m}=i,w=E=>{const v=Jr((e.x+E.x/h)/f),T=dr((e.y+E.y/h)/f),I=m.project(v,T);E.x=(I.x*g-b)*h,E.y=(I.y*g-M)*h};for(let E=0;E<o.length;E++)if(s.type!==1)o[E]=p(o[E],w,1);else{const v=[];for(const T of o[E])T.x<0||T.x>=h||T.y<0||T.y>=h||(w(T),v.push(T));o[E]=v}}for(const f of o)for(const g of f)R(g,l);return o}function k(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?D(s):[]}}function B(s,e,i,o,h){s.emplaceBack(2*e+(o+1)/2,2*i+(h+1)/2)}function U(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Z{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Oo,this.indexArray=new hr,this.segments=new Rn,this.programConfigurations=new la(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,h){const l=this.layers[0],f=[];let g=null;l.type==="circle"&&(g=l.layout.get("circle-sort-key"));for(const{feature:M,id:m,index:w,sourceLayerIndex:E}of e){const v=this.layers[0]._featureFilter.needGeometry,T=k(M,v);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),T,o))continue;const I=g?g.evaluate(T,{},o):void 0,z={id:m,properties:M.properties,type:M.type,sourceLayerIndex:E,index:w,geometry:v?T.geometry:D(M,o,h),patterns:{},sortKey:I};f.push(z)}g&&f.sort((M,m)=>M.sortKey-m.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Bc,b=h.projection);for(const M of f){const{geometry:m,index:w,sourceLayerIndex:E}=M,v=e[w].feature;this.addFeature(M,m,w,i.availableImages,o,b,i.brightness),i.featureIndex.insert(v,m,w,E,this.index)}}update(e,i,o,h,l,f,g){this.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Uy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,h,l,f,g){for(const b of i)for(const M of b){const m=M.x,w=M.y;if(m<0||m>=At||w<0||w>=At)continue;if(f){const T=f.projectTilePoint(m,w,l),I=f.upVector(l,m,w),z=this.globeExtVertexArray;U(z,T,I),U(z,T,I),U(z,T,I),U(z,T,I)}const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=E.vertexLength;B(this.layoutVertexArray,m,w,-1,-1),B(this.layoutVertexArray,m,w,1,-1),B(this.layoutVertexArray,m,w,1,1),B(this.layoutVertexArray,m,w,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},h,l,g)}}function q(s,e){for(let i=0;i<s.length;i++)if(ue(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(ue(s,e[i]))return!0;return!!le(s,e)}function Y(s,e,i){return!!ue(s,e)||!!me(e,s,i)}function X(s,e){if(s.length===1)return fe(e,s[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let h=0;h<o.length;h++)if(ue(s,o[h]))return!0}for(let i=0;i<s.length;i++)if(fe(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(le(s,e[i]))return!0;return!1}function te(s,e,i){if(s.length>1){if(le(s,e))return!0;for(let o=0;o<e.length;o++)if(me(e[o],s,i))return!0}for(let o=0;o<s.length;o++)if(me(s[o],e,i))return!0;return!1}function le(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const o=s[i],h=s[i+1];for(let l=0;l<e.length-1;l++)if(ae(o,h,e[l],e[l+1]))return!0}return!1}function ae(s,e,i,o){return Qs(s,i,o)!==Qs(e,i,o)&&Qs(s,e,i)!==Qs(s,e,o)}function me(s,e,i){const o=i*i;if(e.length===1)return s.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(he(s,e[h-1],e[h])<o)return!0;return!1}function he(s,e,i){const o=e.distSqr(i);if(o===0)return s.distSqr(e);const h=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/o;return s.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function fe(s,e){let i,o,h,l=!1;for(let f=0;f<s.length;f++){i=s[f];for(let g=0,b=i.length-1;g<i.length;b=g++)o=i[g],h=i[b],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(l=!l)}return l}function ue(s,e){let i=!1;for(let o=0,h=s.length-1;o<s.length;h=o++){const l=s[o],f=s[h];l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(i=!i)}return i}function xe(s,e,i,o,h){for(const f of s)if(e<=f.x&&i<=f.y&&o>=f.x&&h>=f.y)return!0;const l=[new ge(e,i),new ge(e,h),new ge(o,h),new ge(o,i)];if(s.length>2){for(const f of l)if(ue(s,f))return!0}for(let f=0;f<s.length-1;f++)if(Me(s[f],s[f+1],l))return!0;return!1}function Me(s,e,i){const o=i[0],h=i[2];if(s.x<o.x&&e.x<o.x||s.x>h.x&&e.x>h.x||s.y<o.y&&e.y<o.y||s.y>h.y&&e.y>h.y)return!1;const l=Qs(s,e,i[0]);return l!==Qs(s,e,i[1])||l!==Qs(s,e,i[2])||l!==Qs(s,e,i[3])}function $e(s,e,i,o,h,l){let f=e.y-s.y,g=s.x-e.x;if(l=l||0){const b=f*f+g*g;if(b===0)return!0;const M=Math.sqrt(b);f/=M,g/=M}return!((i.x-s.x)*f+(i.y-s.y)*g-l<0||(o.x-s.x)*f+(o.y-s.y)*g-l<0||(h.x-s.x)*f+(h.y-s.y)*g-l<0)}function ke(s,e,i,o,h,l,f){return!($e(s,e,o,h,l,f)||$e(e,i,o,h,l,f)||$e(i,s,o,h,l,f)||$e(o,h,s,e,i,f)||$e(h,l,s,e,i,f)||$e(l,o,s,e,i,f))}function Qe(s,e,i){const o=e.paint.get(s).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(s)}function Ke(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Pe(s,e,i,o,h){if(!e[0]&&!e[1])return s;const l=ge.convert(e)._mult(h);i==="viewport"&&l._rotate(-o);const f=[];for(let g=0;g<s.length;g++)f.push(s[g].sub(l));return f}function Ze(s,e,i,o){const h=ge.convert(s)._mult(o);return e==="viewport"&&h._rotate(-i),h}let lt,Ce;Nt(Z,"CircleBucket",{omit:["layers"]});var tt,We={exports:{}},bt=(tt||(tt=1,function(s,e){(function(i){function o(l,f,g){var b=h(256*l,256*(f=Math.pow(2,g)-f-1),g),M=h(256*(l+1),256*(f+1),g);return b[0]+","+b[1]+","+M[0]+","+M[1]}function h(l,f,g){var b=2*Math.PI*6378137/256/Math.pow(2,g);return[l*b-2*Math.PI*6378137/2,f*b-2*Math.PI*6378137/2]}i.getURL=function(l,f,g,b,M,m){return m=m||{},l+"?"+["bbox="+o(g,b,M),"format="+(m.format||"image/png"),"service="+(m.service||"WMS"),"version="+(m.version||"1.1.1"),"request="+(m.request||"GetMap"),"srs="+(m.srs||"EPSG:3857"),"width="+(m.width||256),"height="+(m.height||256),"layers="+f].join("&")},i.getTileBBox=o,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,We.exports)),We.exports);class nt{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=xt(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=bt.getTileBBox(this.x,this.y,this.z),h=function(l,f,g){let b,M="";for(let m=l;m>0;m--)b=1<<m-1,M+=(f&b?1:0)+(g&b?2:0);return M}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class et{constructor(e,i){this.wrap=e,this.canonical=i,this.key=xt(e,i.z,i.z,i.x,i.y)}}class ft{constructor(e,i,o,h,l){this.overscaledZ=e,this.wrap=i,this.canonical=new nt(o,+h,+l),this.key=i===0&&e===o?this.canonical.key:xt(i,e,o,h,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ft(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ft(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return xt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return xt(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ft(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new ft(i,this.wrap,i,o,h),new ft(i,this.wrap,i,o+1,h),new ft(i,this.wrap,i,o,h+1),new ft(i,this.wrap,i,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ft(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ft(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new et(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xt(s,e,i,o,h){const l=1<<Math.min(i,22);let f=l*(h%l)+o%l;return s&&i<22&&(f+=l*l*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const Rt=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new ft(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new ft(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new ft(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new ft(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];Nt(nt,"CanonicalTileID"),Nt(ft,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Bt=$i([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:si}=Bt,Xt=$i([{name:"a_pos_3",components:3,type:"Int16"}]);var Jt=$i([{name:"a_pos",type:"Int16",components:2}]);class ui{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const h=Te.vec3.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,o){if(Te.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[h,l,f]=this.dir,g=this.pos[0]-e[0],b=this.pos[1]-e[1],M=this.pos[2]-e[2],m=h*h+l*l+f*f,w=2*(g*h+b*l+M*f),E=w*w-4*m*(g*g+b*b+M*M-i*i);if(E<0){const v=Math.max(-w/2,0),T=g+h*v,I=b+l*v,z=M+f*v,O=Math.hypot(T,I,z);return o[0]=T*i/O,o[1]=I*i/O,o[2]=z*i/O,!1}{const v=(-w-Math.sqrt(E))/(2*m);if(v<0){const T=Math.hypot(g,b,M);return o[0]=g*i/T,o[1]=b*i/T,o[2]=M*i/T,!1}return o[0]=g+h*v,o[1]=b+l*v,o[2]=M+f*v,!0}}}class Ri{constructor(e,i,o,h,l){this.TL=e,this.TR=i,this.BR=o,this.BL=h,this.horizon=l}static fromInvProjectionMatrix(e,i,o){const h=[-1,1,1],l=[1,1,1],f=[1,-1,1],g=[-1,-1,1],b=Te.vec3.transformMat4(h,h,e),M=Te.vec3.transformMat4(l,l,e),m=Te.vec3.transformMat4(f,f,e),w=Te.vec3.transformMat4(g,g,e);return new Ri(b,M,m,w,i/o)}}function Ki(s,e,i){let o=1/0,h=-1/0;const l=[];for(const f of s){Te.vec3.sub(l,f,e);const g=Te.vec3.dot(l,i);o=Math.min(o,g),h=Math.max(h,g)}return[o,h]}function En(s,e){let i=!0;for(let o=0;o<s.planes.length;o++){const h=s.planes[o];let l=0;for(let f=0;f<e.length;f++)l+=Te.vec3.dot(h,e[f])+h[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function dn(s,e){for(const i of s.projections){const o=Ki(e,s.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function pi(s,e){let i=0;const o=[0,0,0,0];for(let h=0;h<s.length;h++)o[0]=s[h][0],o[1]=s[h][1],o[2]=s[h][2],o[3]=1,Te.vec4.dot(o,e)>=0&&i++;return i}class Fi{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ht.fromPoints(this.points),this.projections=[],this.frustumEdges=[Te.vec3.sub([],this.points[2],this.points[3]),Te.vec3.sub([],this.points[0],this.points[3]),Te.vec3.sub([],this.points[4],this.points[0]),Te.vec3.sub([],this.points[5],this.points[1]),Te.vec3.sub([],this.points[6],this.points[2]),Te.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const h=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:h,projection:Ki(this.points,this.points[0],h)}),this.projections.push({axis:l,projection:Ki(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,o,h){const l=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const m=Te.vec4.transformMat4([],M,e),w=1/m[3]/i*l;return Te.vec4.mul(m,m,[w,w,h?1/m[3]:w,w])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const m=Te.vec3.sub([],f[M[0]],f[M[1]]),w=Te.vec3.sub([],f[M[2]],f[M[1]]),E=Te.vec3.normalize([],Te.vec3.cross([],m,w)),v=-Te.vec3.dot(E,f[M[1]]);return E.concat(v)}),b=[];for(let M=0;M<f.length;M++)b.push([f[M][0],f[M][1],f[M][2]]);return new Fi(b,g)}intersectsPrecise(e,i,o){for(let h=0;h<i.length;h++)if(!pi(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!pi(e,this.planes[h]))return 0;for(const h of o)for(const l of this.frustumEdges){const f=Te.vec3.cross([],h,l),g=Te.vec3.length(f);if(g===0)continue;Te.vec3.scale(f,f,1/g);const b=Ki(this.points,this.points[0],f),M=Ki(e,this.points[0],f);if(b[0]>M[1]||M[0]>b[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Te.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class Ht{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const h of e)Te.vec3.min(i,i,h),Te.vec3.max(o,o,h);return new Ht(i,o)}static fromTileIdAndHeight(e,i,o){const h=1<<e.canonical.z,l=e.canonical.x,f=e.canonical.y;return new Ht([l/h,f/h,i],[(l+1)/h,(f+1)/h,o])}static applyTransform(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)Te.vec3.transformMat4(o[h],o[h],i);return Ht.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],h=[...o];for(let l=0;l<3;l++)for(let f=0;f<3;f++){const g=i[4*f+l],b=g*e.min[f],M=g*e.max[f];o[l]+=Math.min(b,M),h[l]+=Math.max(b,M)}return new Ht(o,h)}static projectAabbCorners(e,i){const o=e.getCorners();for(let h=0;h<o.length;++h)Te.vec3.transformMat4(o[h],o[h],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Te.vec3.scale([],Te.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Te.vec3.clone(this.min),h=Te.vec3.clone(this.max);for(let l=0;l<i.length;l++)o[l]=i[l]?this.min[l]:this.center[l],h[l]=i[l]?this.center[l]:this.max[l];return h[2]=this.max[2],new Ht(o,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?En(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?En(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?dn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Ci(s){return s*Nr/Ba}Nt(Ht,"Aabb");const ji=[new Ht([us,us,us],[hs,hs,hs]),new Ht([us,us,us],[0,0,hs]),new Ht([0,us,us],[hs,0,hs]),new Ht([us,0,us],[0,hs,hs]),new Ht([0,0,us],[hs,hs,hs])];function Zi(s,e,i,o=!0){const h=Te.vec3.scale([],s._camera.position,s.worldSize),l=[e,i,1,1];Te.vec4.transformMat4(l,l,s.pixelMatrixInverse),Te.vec4.scale(l,l,1/l[3]);const f=Te.vec3.sub([],l,h),g=Te.vec3.normalize([],f),b=s.globeMatrix,M=[b[12],b[13],b[14]],m=Te.vec3.sub([],M,h),w=Te.vec3.length(m),E=Te.vec3.normalize([],m),v=s.worldSize/(2*Math.PI),T=Te.vec3.dot(E,g),I=Math.asin(v/w);if(I<Math.acos(T)){if(!o)return null;const _e=[],oe=[];Te.vec3.scale(_e,g,w/T),Te.vec3.normalize(oe,Te.vec3.sub(oe,_e,m)),Te.vec3.normalize(g,Te.vec3.add(g,m,Te.vec3.scale(g,oe,Math.tan(I)*w)))}const z=[];new ui(h,g).closestPointOnSphere(M,v,z);const O=Te.vec3.normalize([],il(b,0)),V=Te.vec3.normalize([],il(b,1)),j=Te.vec3.normalize([],il(b,2)),N=Te.vec3.dot(O,z),G=Te.vec3.dot(V,z),H=Te.vec3.dot(j,z),K=Gt(Math.asin(-G/v));let se=Gt(Math.atan2(N,H));se=s.center.lng+function(_e,oe){const ye=(oe-_e+180)%360-180;return ye<-180?ye+360:ye}(s.center.lng,se);const re=ho(se),ie=Mt(Us(K),0,1);return new n(re,ie)}class bn{constructor(e,i,o){this.a=Te.vec3.sub([],e,o),this.b=Te.vec3.sub([],i,o),this.center=o;const h=Te.vec3.normalize([],this.a),l=Te.vec3.normalize([],this.b);this.angle=Math.acos(Te.vec3.dot(h,l))}}function tr(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(o,h,l,f){const g=Math.sin(l);return o*(Math.sin((1-f)*l)/g)+h*(Math.sin(f*l)/g)}(s.a[e],s.b[e],s.angle,Mt(i,0,1))+s.center[e]}function jn(s){if(s.z<=1)return ji[s.z+2*s.y+s.x];const e=on(wn(s));return Ht.fromPoints(e)}function Gn(s,e,i){return Te.vec3.scale(s,s,1-i),Te.vec3.scaleAndAdd(s,s,e,i)}function ds(s,e,i){for(const o of s)Te.vec3.transformMat4(o,o,e),Te.vec3.scale(o,o,i)}function Ir(s,e,i,o){const h=e/s.worldSize,l=s.globeMatrix;if(i.z<=1){const re=jn(i).getCorners();return ds(re,l,h),Ht.fromPoints(re)}const f=wn(i,o),g=on(f,Nr+Ci(s._tileCoverLift));ds(g,l,h);const b=Number.MAX_VALUE,M=[-b,-b,-b],m=[b,b,b];if(f.contains(s.center)){for(const _e of g)Te.vec3.min(m,m,_e),Te.vec3.max(M,M,_e);M[2]=0;const re=s.point,ie=[re.x*h,re.y*h,0];return Te.vec3.min(m,m,ie),Te.vec3.max(M,M,ie),new Ht(m,M)}if(s._tileCoverLift>0){for(const re of g)Te.vec3.min(m,m,re),Te.vec3.max(M,M,re);return new Ht(m,M)}const w=[l[12]*h,l[13]*h,l[14]*h],E=f.getCenter(),v=Mt(s.center.lat,-Dn,Dn),T=Mt(E.lat,-Dn,Dn),I=ho(s.center.lng),z=Us(v);let O=I-ho(E.lng);const V=z-Us(T);O>.5?O-=1:O<-.5&&(O+=1);let j=0;if(Math.abs(O)>Math.abs(V))j=O>=0?1:3;else{j=V>=0?0:2;const re=[l[4]*h,l[5]*h,l[6]*h],ie=-Math.sin(mt(V>=0?f.getSouth():f.getNorth()))*Nr;Te.vec3.scaleAndAdd(w,w,re,ie)}const N=g[j],G=g[(j+1)%4],H=new bn(N,G,w),K=[tr(H,0)||N[0],tr(H,1)||N[1],tr(H,2)||N[2]],se=Hr(s.zoom);if(se>0){const re=function({x:_e,y:oe,z:ye},be,ve,Ee,Ie){const De=1/(1<<ye);let Ae=_e*De,Ye=Ae+De,rt=oe*De,Xe=rt+De,It=0;const Et=(Ae+Ye)/2-Ee;return Et>.5?It=-1:Et<-.5&&(It=1),Ae=((Ae+It)*be-(Ee*=be))*ve+Ee,Ye=((Ye+It)*be-Ee)*ve+Ee,rt=(rt*be-(Ie*=be))*ve+Ie,Xe=(Xe*be-Ie)*ve+Ie,[[Ae,Xe,0],[Ye,Xe,0],[Ye,rt,0],[Ae,rt,0]]}(i,e,s._pixelsPerMercatorPixel,I,z);for(let _e=0;_e<g.length;_e++)Gn(g[_e],re[_e],se);const ie=Te.vec3.add([],re[j],re[(j+1)%4]);Te.vec3.scale(ie,ie,.5),Gn(K,ie,se)}for(const re of g)Te.vec3.min(m,m,re),Te.vec3.max(M,M,re);return m[2]=Math.min(N[2],G[2]),Te.vec3.min(m,m,K),Te.vec3.max(M,M,K),new Ht(m,M)}function wn({x:s,y:e,z:i},o=!1){const h=1/(1<<i),l=new Ni(Jr(s*h),e===(1<<i)-1&&o?-90:dr((e+1)*h)),f=new Ni(Jr((s+1)*h),e===0&&o?90:dr(e*h));return new ca(l,f)}function on(s,e=Nr){const i=mt(s.getNorth()),o=mt(s.getSouth()),h=Math.cos(i),l=Math.cos(o),f=Math.sin(i),g=Math.sin(o),b=s.getWest(),M=s.getEast();return[Al(l,g,b,e),Al(l,g,M,e),Al(h,f,M,e),Al(h,f,b,e)]}function rn(s,e,i,o){const h=1<<i.z,l=(s/At+i.x)/h;return Fa(dr((e/At+i.y)/h),Jr(l),o)}function zi({min:s,max:e}){return qm/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const Ln=new Float64Array(16);function ir(s){const e=zi(s),i=Te.mat4.fromScaling(Ln,[e,e,e]);return Te.mat4.translate(i,i,Te.vec3.negate([],s.min))}function sn(s){const e=Te.mat4.fromTranslation(Ln,s.min),i=1/zi(s);return Te.mat4.scale(e,e,[i,i,i])}function Cr(s){const e=At/(2*Math.PI);return s/(2*Math.PI)/e}function Ms(s,e){return At/(512*Math.pow(2,s))*zi(jn(e))}function Qr(s,e,i,o,h){const l=Cr(i),f=[s,e,-i/(2*Math.PI)],g=Te.mat4.identity(new Float64Array(16));return Te.mat4.translate(g,g,f),Te.mat4.scale(g,g,[l,l,l]),Te.mat4.rotateX(g,g,mt(-h)),Te.mat4.rotateY(g,g,mt(-o)),g}function Hr(s){return di(El,Gm,s)}function fo(s,e){const i=Fa(e.lat,e.lng),o=function(l){const f=Fa(l._center.lat,l._center.lng),g=Te.vec3.fromValues(0,1,0);let b=Te.vec3.cross([],g,f);const M=Te.mat4.fromRotation([],-l.angle,f);b=Te.vec3.transformMat4(b,b,M),Te.mat4.fromRotation(M,-l._pitch,b);const m=Te.vec3.normalize([],f);return Te.vec3.scale(m,m,Ci(l.cameraToCenterDistance/l.pixelsPerMeter)),Te.vec3.transformMat4(m,m,M),Te.vec3.add([],f,m)}(s),h=Te.vec3.subtract([],o,i);return Te.vec3.angle(h,i)}function As(s,e){return fo(s,e)>Math.PI/2*1.01}const fs=mt(85),Na=Math.cos(fs),po=Math.sin(fs),Va=Te.mat4.create(),Cl=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function bh(s,e,i,o,h,l,f,g,b){if(l&&s.queryGeometry.isAboveHorizon)return!1;l&&(b*=s.pixelToTileUnitsFactor);const M=s.tileID.canonical,m=i.projection.upVectorScale(M,i.center.lat,i.worldSize).metersToTile;for(const w of e)for(const E of w){const v=E.add(g),T=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(v.x,v.y,!0):0,I=i.projection.projectTilePoint(v.x,v.y,M);if(T>0){const j=i.projection.upVector(M,v.x,v.y);I.x+=j[0]*m*T,I.y+=j[1]*m*T,I.z+=j[2]*m*T}const z=l?v:Cf(I.x,I.y,I.z,o),O=l?s.tilespaceRays.map(j=>xA(j,T)):s.queryGeometry.screenGeometry,V=Te.vec4.transformMat4([],[I.x,I.y,I.z,1],o);if(!f&&l?b*=V[3]/i.cameraToCenterDistance:f&&!l&&(b*=i.cameraToCenterDistance/V[3]),l){const j=dr((E.y/At+M.y)/(1<<M.z));b/=i.projection.pixelsPerMeter(j,1)/Vr(1,j)}if(Y(O,z,b))return!0}return!1}function Cf(s,e,i,o){const h=Te.vec4.transformMat4([],[s,e,i,1],o);return new ge(h[0]/h[3],h[1]/h[3])}const l1=Te.vec3.fromValues(0,0,0),yA=Te.vec3.fromValues(0,0,1);function xA(s,e){const i=Te.vec3.create();return l1[2]=e,s.intersectsPlane(l1,yA,i),new ge(i[0],i[1])}class c1 extends Z{}let u1,h1,d1,f1;function p1(s,{width:e,height:i},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*o)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*o);return s.width=e,s.height=i,s.data=h,s}function m1(s,e,i){const{width:o,height:h}=e;o===s.width&&h===s.height||(Xy(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,o),height:Math.min(s.height,h)},i,null),s.width=o,s.height=h,s.data=e.data)}function Xy(s,e,i,o,h,l,f,g){if(h.width===0||h.height===0)return e;if(h.width>s.width||h.height>s.height||i.x>s.width-h.width||i.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,M=e.data,m=l===4&&g;for(let w=0;w<h.height;w++){const E=((i.y+w)*s.width+i.x)*l,v=((o.y+w)*e.width+o.x)*l;if(m)for(let T=0;T<h.width;T++){const I=E+T*l+3,z=v+T*l;M[z+0]=255,M[z+1]=255,M[z+2]=255,M[z+3]=b[I]}else if(f)for(let T=0;T<h.width;T++){const I=E+T*l,z=v+T*l,O=b[I+3],V=new Hi(b[I+0]/255*O,b[I+1]/255*O,b[I+2]/255*O,O).toRenderColor(f).toArray();M[z+0]=V[0],M[z+1]=V[1],M[z+2]=V[2],M[z+3]=V[3]}else for(let T=0;T<h.width*l;T++)M[v+T]=b[E+T]}return e}Nt(c1,"HeatmapBucket",{omit:["layers"]});class Pl{constructor(e,i){p1(this,e,1,i)}resize(e){m1(this,new Pl(e),1)}clone(){return new Pl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,l){Xy(e,i,o,h,l,1,null)}}class br{constructor(e,i){p1(this,e,4,i)}resize(e){m1(this,new br(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,l,f,g){Xy(e,i,o,h,l,4,f,g)}}class _1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Pf(s){const e={},i=s.resolution||256,o=s.clips?s.clips.length:1,h=s.image||new br({width:i,height:o}),l=(f,g,b)=>{e[s.evaluationKey]=b;const M=s.expression.evaluate(e);M&&(h.data[f+g+0]=Math.floor(255*M.r/M.a),h.data[f+g+1]=Math.floor(255*M.g/M.a),h.data[f+g+2]=Math.floor(255*M.b/M.a),h.data[f+g+3]=Math.floor(255*M.a))};if(s.clips)for(let f=0,g=0;f<o;++f,g+=4*i)for(let b=0,M=0;b<i;b++,M+=4){const m=b/(i-1),{start:w,end:E}=s.clips[f];l(g,M,w*(1-m)+E*m)}else for(let f=0,g=0;f<i;f++,g+=4)l(0,g,f/(i-1));return h}Nt(Pl,"AlphaImage"),Nt(br,"RGBAImage");const vA=$i([{name:"a_pos",components:2,type:"Int16"}],4),{members:bA}=vA;function Rf(s,e,i=2){const o=e&&e.length,h=o?e[0]*i:s.length;let l=g1(s,0,h,i,!0);const f=[];if(!l||l.next===l.prev)return f;let g,b,M;if(o&&(l=function(m,w,E,v){const T=[];for(let I=0,z=w.length;I<z;I++){const O=g1(m,w[I]*v,I<z-1?w[I+1]*v:m.length,v,!1);O===O.next&&(O.steiner=!0),T.push(CA(O))}T.sort(MA);for(let I=0;I<T.length;I++)E=AA(T[I],E);return E}(s,e,l,i)),s.length>80*i){g=1/0,b=1/0;let m=-1/0,w=-1/0;for(let E=i;E<h;E+=i){const v=s[E],T=s[E+1];v<g&&(g=v),T<b&&(b=T),v>m&&(m=v),T>w&&(w=T)}M=Math.max(m-g,w-b),M=M!==0?32767/M:0}return Df(l,f,i,g,b,M,0),f}function g1(s,e,i,o,h){let l;if(h===function(f,g,b,M){let m=0;for(let w=g,E=b-M;w<b;w+=M)m+=(f[E]-f[w])*(f[w+1]+f[E+1]),E=w;return m}(s,e,i,o)>0)for(let f=e;f<i;f+=o)l=v1(f/o|0,s[f],s[f+1],l);else for(let f=i-o;f>=e;f-=o)l=v1(f/o|0,s[f],s[f+1],l);return l&&$m(l,l.next)&&(Lf(l),l=l.next),l}function Kc(s,e){if(!s)return s;e||(e=s);let i,o=s;do if(i=!1,o.steiner||!$m(o,o.next)&&nr(o.prev,o,o.next)!==0)o=o.next;else{if(Lf(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Df(s,e,i,o,h,l,f){if(!s)return;!f&&l&&function(b,M,m,w){let E=b;do E.z===0&&(E.z=Yy(E.x,E.y,M,m,w)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==b);E.prevZ.nextZ=null,E.prevZ=null,function(v){let T,I=1;do{let z,O=v;v=null;let V=null;for(T=0;O;){T++;let j=O,N=0;for(let H=0;H<I&&(N++,j=j.nextZ,j);H++);let G=I;for(;N>0||G>0&&j;)N!==0&&(G===0||!j||O.z<=j.z)?(z=O,O=O.nextZ,N--):(z=j,j=j.nextZ,G--),V?V.nextZ=z:v=z,z.prevZ=V,V=z;O=j}V.nextZ=null,I*=2}while(T>1)}(E)}(s,o,h,l);let g=s;for(;s.prev!==s.next;){const b=s.prev,M=s.next;if(l?TA(s,o,h,l):wA(s))e.push(b.i,s.i,M.i),Lf(s),s=M.next,g=M.next;else if((s=M)===g){f?f===1?Df(s=SA(Kc(s),e),e,i,o,h,l,2):f===2&&EA(s,e,i,o,h,l):Df(Kc(s),e,i,o,h,l,1);break}}}function wA(s){const e=s.prev,i=s,o=s.next;if(nr(e,i,o)>=0)return!1;const h=e.x,l=i.x,f=o.x,g=e.y,b=i.y,M=o.y,m=h<l?h<f?h:f:l<f?l:f,w=g<b?g<M?g:M:b<M?b:M,E=h>l?h>f?h:f:l>f?l:f,v=g>b?g>M?g:M:b>M?b:M;let T=o.next;for(;T!==e;){if(T.x>=m&&T.x<=E&&T.y>=w&&T.y<=v&&wh(h,g,l,b,f,M,T.x,T.y)&&nr(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function TA(s,e,i,o){const h=s.prev,l=s,f=s.next;if(nr(h,l,f)>=0)return!1;const g=h.x,b=l.x,M=f.x,m=h.y,w=l.y,E=f.y,v=g<b?g<M?g:M:b<M?b:M,T=m<w?m<E?m:E:w<E?w:E,I=g>b?g>M?g:M:b>M?b:M,z=m>w?m>E?m:E:w>E?w:E,O=Yy(v,T,e,i,o),V=Yy(I,z,e,i,o);let j=s.prevZ,N=s.nextZ;for(;j&&j.z>=O&&N&&N.z<=V;){if(j.x>=v&&j.x<=I&&j.y>=T&&j.y<=z&&j!==h&&j!==f&&wh(g,m,b,w,M,E,j.x,j.y)&&nr(j.prev,j,j.next)>=0||(j=j.prevZ,N.x>=v&&N.x<=I&&N.y>=T&&N.y<=z&&N!==h&&N!==f&&wh(g,m,b,w,M,E,N.x,N.y)&&nr(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;j&&j.z>=O;){if(j.x>=v&&j.x<=I&&j.y>=T&&j.y<=z&&j!==h&&j!==f&&wh(g,m,b,w,M,E,j.x,j.y)&&nr(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;N&&N.z<=V;){if(N.x>=v&&N.x<=I&&N.y>=T&&N.y<=z&&N!==h&&N!==f&&wh(g,m,b,w,M,E,N.x,N.y)&&nr(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function SA(s,e){let i=s;do{const o=i.prev,h=i.next.next;!$m(o,h)&&y1(o,i,i.next,h)&&zf(o,h)&&zf(h,o)&&(e.push(o.i,i.i,h.i),Lf(i),Lf(i.next),i=s=h),i=i.next}while(i!==s);return Kc(i)}function EA(s,e,i,o,h,l){let f=s;do{let g=f.next.next;for(;g!==f.prev;){if(f.i!==g.i&&PA(f,g)){let b=x1(f,g);return f=Kc(f,f.next),b=Kc(b,b.next),Df(f,e,i,o,h,l,0),void Df(b,e,i,o,h,l,0)}g=g.next}f=f.next}while(f!==s)}function MA(s,e){return s.x-e.x}function AA(s,e){const i=function(h,l){let f=l;const g=h.x,b=h.y;let M,m=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const I=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(I<=g&&I>m&&(m=I,M=f.x<f.next.x?f:f.next,I===g))return M}f=f.next}while(f!==l);if(!M)return null;const w=M,E=M.x,v=M.y;let T=1/0;f=M;do{if(g>=f.x&&f.x>=E&&g!==f.x&&wh(b<v?g:m,b,E,v,b<v?m:g,b,f.x,f.y)){const I=Math.abs(b-f.y)/(g-f.x);zf(f,h)&&(I<T||I===T&&(f.x>M.x||f.x===M.x&&IA(M,f)))&&(M=f,T=I)}f=f.next}while(f!==w);return M}(s,e);if(!i)return e;const o=x1(i,s);return Kc(o,o.next),Kc(i,i.next)}function IA(s,e){return nr(s.prev,s,e.prev)<0&&nr(e.next,s,s.next)<0}function Yy(s,e,i,o,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function CA(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function wh(s,e,i,o,h,l,f,g){return(h-f)*(e-g)>=(s-f)*(l-g)&&(s-f)*(o-g)>=(i-f)*(e-g)&&(i-f)*(l-g)>=(h-f)*(o-g)}function PA(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,o){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==o.i&&h.next.i!==o.i&&y1(h,h.next,i,o))return!0;h=h.next}while(h!==i);return!1}(s,e)&&(zf(s,e)&&zf(e,s)&&function(i,o){let h=i,l=!1;const f=(i.x+o.x)/2,g=(i.y+o.y)/2;do h.y>g!=h.next.y>g&&h.next.y!==h.y&&f<(h.next.x-h.x)*(g-h.y)/(h.next.y-h.y)+h.x&&(l=!l),h=h.next;while(h!==i);return l}(s,e)&&(nr(s.prev,s,e.prev)||nr(s,e.prev,e))||$m(s,e)&&nr(s.prev,s,s.next)>0&&nr(e.prev,e,e.next)>0)}function nr(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function $m(s,e){return s.x===e.x&&s.y===e.y}function y1(s,e,i,o){const h=Wm(nr(s,e,i)),l=Wm(nr(s,e,o)),f=Wm(nr(i,o,s)),g=Wm(nr(i,o,e));return h!==l&&f!==g||!(h!==0||!Zm(s,i,e))||!(l!==0||!Zm(s,o,e))||!(f!==0||!Zm(i,s,o))||!(g!==0||!Zm(i,e,o))}function Zm(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function Wm(s){return s>0?1:s<0?-1:0}function zf(s,e){return nr(s.prev,s,s.next)<0?nr(s,e,s.next)>=0&&nr(s,s.prev,e)>=0:nr(s,e,s.prev)<0||nr(s,s.next,e)<0}function x1(s,e){const i=Ky(s.i,s.x,s.y),o=Ky(e.i,e.x,e.y),h=s.next,l=e.prev;return s.next=e,e.prev=s,i.next=h,h.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function v1(s,e,i,o){const h=Ky(s,e,i);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function Lf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ky(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Xm(s,e){const i=s.length;if(i<=1)return[s];const o=[];let h,l;for(let f=0;f<i;f++){const g=Mu(s[f]);g!==0&&(s[f].area=Math.abs(g),l===void 0&&(l=g<0),l===g<0?(h&&o.push(h),h=[s[f]]):h.push(s[f]))}if(h&&o.push(h),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(pc(o[f],e,1,o[f].length-1,RA),o[f]=o[f].slice(0,e));return o}function RA(s,e){return e.area-s.area}function b1(s,e,i=1){if(!s)return null;const o=typeof s=="string"?s:s.getPrimary().id;e[o]||(e[o]=[]);const h=xr.from(o).getPrimary().scaleSelf(i);return e[o].push(h),h.serialize()}function Jy(s,e,i,o){const h=o.patternDependencies;let l=!1;for(const f of e){const g=f.paint.get(`${s}-pattern`);g.isConstant()||(l=!0),b1(g.constantOr(null),h,i)&&(l=!0)}return l}function Qy(s,e,i,o,h,l){const f=l.patternDependencies;for(const g of e){const b=g.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let M=b.evaluate({zoom:o},i,{},l.availableImages);M=M&&M.name?M.name:M;const m=b1(M,f,h);m&&(i.patterns[g.id]=m)}}return i}class e0{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Oo,this.indexArray=new hr,this.indexArray2=new sa,this.programConfigurations=new la(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Rn,this.segments2=new Rn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Jy("fill",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:b,index:M,sourceLayerIndex:m}of e){const w=this.layers[0]._featureFilter.needGeometry,E=k(g,w);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),E,o))continue;const v=l?l.evaluate(E,{},o,i.availableImages):void 0,T={id:b,properties:g.properties,type:g.type,sourceLayerIndex:m,index:M,geometry:w?E.geometry:D(g,o,h),patterns:{},sortKey:v};f.push(T)}l&&f.sort((g,b)=>g.sortKey-b.sortKey);for(const g of f){const{geometry:b,index:M,sourceLayerIndex:m}=g;if(this.hasPattern){const w=Qy("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(w)}else this.addFeature(g,b,M,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[M].feature,b,M,m,this.index)}}update(e,i,o,h,l,f,g){this.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g)}addFeatures(e,i,o,h,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,h,f,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,h,l,f=[],g,b){for(const M of Xm(i,500)){let m=0;for(const z of M)m+=z.length;const w=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),E=w.vertexLength,v=[],T=[];for(const z of M){if(z.length===0)continue;z!==M[0]&&T.push(v.length/2);const O=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),V=O.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(V+z.length-1,V),v.push(z[0].x),v.push(z[0].y);for(let j=1;j<z.length;j++)this.layoutVertexArray.emplaceBack(z[j].x,z[j].y),this.indexArray2.emplaceBack(V+j-1,V+j),v.push(z[j].x),v.push(z[j].y);O.vertexLength+=z.length,O.primitiveLength+=z.length}const I=Rf(v,T);for(let z=0;z<I.length;z+=3)this.indexArray.emplaceBack(E+I[z],E+I[z+1],E+I[z+2]);w.vertexLength+=m,w.primitiveLength+=I.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,h,g)}}let w1,T1,S1,E1;Nt(e0,"FillBucket",{omit:["layers","patternFeatures"]});class t0{constructor(e,i,o,h){if(this.triangleCount=i.length/3,this.min=new ge(0,0),this.max=new ge(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,f]=[e[0].clone(),e[0].clone()];for(let w=1;w<e.length;++w){const E=e[w];l.x=Math.min(l.x,E.x),l.y=Math.min(l.y,E.y),f.x=Math.max(f.x,E.x),f.y=Math.max(f.y,E.y)}if(h){const w=Math.ceil(Math.max(f.x-l.x,f.y-l.y)/h);o=Math.max(o,w)}if(o===0)return;this.min=l,this.max=f;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const b=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/b)),this.cellsY=Math.max(1,Math.ceil(g.y/b)),this.xScale=1/b,this.yScale=1/b;const M=[];for(let w=0;w<this.triangleCount;w++){const E=e[i[3*w+0]].sub(this.min),v=e[i[3*w+1]].sub(this.min),T=e[i[3*w+2]].sub(this.min),I=ua(Math.floor(Math.min(E.x,v.x,T.x)),this.xScale,this.cellsX),z=ua(Math.floor(Math.max(E.x,v.x,T.x)),this.xScale,this.cellsX),O=ua(Math.floor(Math.min(E.y,v.y,T.y)),this.yScale,this.cellsY),V=ua(Math.floor(Math.max(E.y,v.y,T.y)),this.yScale,this.cellsY),j=new ge(0,0),N=new ge(0,0),G=new ge(0,0),H=new ge(0,0);for(let K=O;K<=V;++K){j.y=N.y=K*b,G.y=H.y=(K+1)*b;for(let se=I;se<=z;++se)j.x=G.x=se*b,N.x=H.x=(se+1)*b,(ke(E,v,T,j,N,H)||ke(E,v,T,j,H,G))&&M.push({cellIdx:K*this.cellsX+se,triIdx:w})}}if(M.length===0)return;M.sort((w,E)=>w.cellIdx-E.cellIdx||w.triIdx-E.triIdx);let m=0;for(;m<M.length;){const w=M[m].cellIdx,E={start:this.payload.length,len:0};for(;m<M.length&&M[m].cellIdx===w;)++E.len,this.payload.push(M[m++].triIdx);this.cells[w]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=ua(e.x-this.min.x,this.xScale,this.cellsX),h=ua(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[h*this.cellsX+o];if(l){this._lazyInitLookup();for(let f=0;f<l.len;f++){const g=this.payload[l.start+f],b=Math.floor(g/8),M=1<<g%8;if(!(this.lookup[b]&M)&&(this.lookup[b]|=M,i.push(g),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=ua(e.x-this.min.x,this.xScale,this.cellsX),l=ua(i.x-this.min.x,this.xScale,this.cellsX),f=ua(e.y-this.min.y,this.yScale,this.cellsY),g=ua(i.y-this.min.y,this.yScale,this.cellsY);for(let b=f;b<=g;b++)for(let M=h;M<=l;M++){const m=this.cells[b*this.cellsX+M];if(m)for(let w=0;w<m.len;w++){const E=this.payload[m.start+w],v=Math.floor(E/8),T=1<<E%8;if(!(this.lookup[v]&T)&&(this.lookup[v]|=T,o.push(E),o.length===this.triangleCount))return}}}}function ua(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}Nt(t0,"TriangleGridIndex");class M1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,h){const l=[];for(const{feature:f,id:g,index:b,sourceLayerIndex:M}of e){const m=this.layers[0]._featureFilter.needGeometry,w=k(f,m);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),w,o))continue;const E={id:g,properties:f.properties,type:f.type,sourceLayerIndex:M,index:b,geometry:m?w.geometry:D(f,o,h),patterns:{}};l.push(E)}for(const f of l){const{geometry:g,index:b,sourceLayerIndex:M}=f;this.addFeature(f,g,b,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,g,b,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,h,l,f,g){}destroy(){}addFeature(e,i,o,h,l,f=[],g){for(const b of Xm(i,2)){const M=[],m=[],w=[],E=new ge(1/0,1/0),v=new ge(-1/0,-1/0);for(const z of b)if(z.length!==0){z!==b[0]&&w.push(m.length/2);for(let O=0;O<z.length;O++)m.push(z[O].x),m.push(z[O].y),M.push(z[O]),E.x=Math.min(E.x,z[O].x),E.y=Math.min(E.y,z[O].y),v.x=Math.max(v.x,z[O].x),v.y=Math.max(v.y,z[O].y)}const T=Rf(m,w),I=new t0(M,T,8,256);this.footprints.push({vertices:M,indices:T,grid:I,min:E,max:v})}}}Nt(M1,"ClipBucket",{omit:["layers"]});const DA=$i([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zA=$i([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),LA=$i([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OA=$i([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kA=$i([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),FA=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:BA}=DA;var i0,A1,n0,I1,r0,C1,P1,Ym={};function R1(){if(A1)return i0;A1=1;var s=Be();function e(h,l,f,g,b){this.properties={},this.extent=f,this.type=0,this._pbf=h,this._geometry=-1,this._keys=g,this._values=b,h.readFields(i,this,l)}function i(h,l,f){h==1?l.id=f.readVarint():h==2?function(g,b){for(var M=g.readVarint()+g.pos;g.pos<M;){var m=b._keys[g.readVarint()],w=b._values[g.readVarint()];b.properties[m]=w}}(f,l):h==3?l.type=f.readVarint():h==4&&(l._geometry=f.pos)}function o(h){for(var l,f,g=0,b=0,M=h.length,m=M-1;b<M;m=b++)g+=((f=h[m]).x-(l=h[b]).x)*(l.y+f.y);return g}return i0=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var l,f=h.readVarint()+h.pos,g=1,b=0,M=0,m=0,w=[];h.pos<f;){if(b<=0){var E=h.readVarint();g=7&E,b=E>>3}if(b--,g===1||g===2)M+=h.readSVarint(),m+=h.readSVarint(),g===1&&(l&&w.push(l),l=[]),l.push(new s(M,m));else{if(g!==7)throw new Error("unknown command "+g);l&&l.push(l[0].clone())}}return l&&w.push(l),w},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var l=h.readVarint()+h.pos,f=1,g=0,b=0,M=0,m=1/0,w=-1/0,E=1/0,v=-1/0;h.pos<l;){if(g<=0){var T=h.readVarint();f=7&T,g=T>>3}if(g--,f===1||f===2)(b+=h.readSVarint())<m&&(m=b),b>w&&(w=b),(M+=h.readSVarint())<E&&(E=M),M>v&&(v=M);else if(f!==7)throw new Error("unknown command "+f)}return[m,E,w,v]},e.prototype.toGeoJSON=function(h,l,f){var g,b,M=this.extent*Math.pow(2,f),m=this.extent*h,w=this.extent*l,E=this.loadGeometry(),v=e.types[this.type];function T(O){for(var V=0;V<O.length;V++){var j=O[V];O[V]=[360*(j.x+m)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+w)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(g=0;g<E.length;g++)I[g]=E[g][0];T(E=I);break;case 2:for(g=0;g<E.length;g++)T(E[g]);break;case 3:for(E=function(O){var V=O.length;if(V<=1)return[O];for(var j,N,G=[],H=0;H<V;H++){var K=o(O[H]);K!==0&&(N===void 0&&(N=K<0),N===K<0?(j&&G.push(j),j=[O[H]]):j.push(O[H]))}return j&&G.push(j),G}(E),g=0;g<E.length;g++)for(b=0;b<E[g].length;b++)T(E[g][b])}E.length===1?E=E[0]:v="Multi"+v;var z={type:"Feature",geometry:{type:v,coordinates:E},properties:this.properties};return"id"in this&&(z.id=this.id),z},i0}function D1(){if(I1)return n0;I1=1;var s=R1();function e(o,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,h),this.length=this._features.length}function i(o,h,l){o===15?h.version=l.readVarint():o===1?h.name=l.readString():o===5?h.extent=l.readVarint():o===2?h._features.push(l.pos):o===3?h._keys.push(l.readString()):o===4&&h._values.push(function(f){for(var g=null,b=f.readVarint()+f.pos;f.pos<b;){var M=f.readVarint()>>3;g=M===1?f.readString():M===2?f.readFloat():M===3?f.readDouble():M===4?f.readVarint64():M===5?f.readVarint():M===6?f.readSVarint():M===7?f.readBoolean():null}return g}(l))}return n0=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var h=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,h,this.extent,this._keys,this._values)},n0}function z1(){return P1||(P1=1,Ym.VectorTile=function(){if(C1)return r0;C1=1;var s=D1();function e(i,o,h){if(i===3){var l=new s(h,h.readVarint()+h.pos);l.length&&(o[l.name]=l)}}return r0=function(i,o){this.layers=i.readFields(e,{},o)},r0}(),Ym.VectorTileFeature=R1(),Ym.VectorTileLayer=D1()),Ym}var Th=z1();class Jc extends ge{constructor(e,i,o){super(e,i),this.z=o}}class L1 extends Jc{constructor(e,i,o,h){super(e,i,o),this.w=h}}function Km(s,e,i,o){const h=[],l=o===0?(f,g,b,M,m,w)=>{f.push(new ge(w,b+(w-g)/(M-g)*(m-b)))}:(f,g,b,M,m,w)=>{f.push(new ge(g+(w-b)/(m-b)*(M-g),w))};for(const f of s){const g=[];for(const b of f){if(b.length<=2)continue;const M=[];for(let E=0;E<b.length-1;E++){const v=b[E].x,T=b[E].y,I=b[E+1].x,z=b[E+1].y,O=o===0?v:T,V=o===0?I:z;O<e?V>e&&l(M,v,T,I,z,e):O>i?V<i&&l(M,v,T,I,z,i):M.push(b[E]),V<e&&O>=e&&l(M,v,T,I,z,e),V>i&&O<=i&&l(M,v,T,I,z,i)}let m=b[b.length-1];const w=o===0?m.x:m.y;w>=e&&w<=i&&M.push(m),M.length&&(m=M[M.length-1],M[0].x===m.x&&M[0].y===m.y||M.push(M[0]),g.push(M))}g.length&&h.push(g)}return h}function O1(s,e,i,o){const h=i==="x"?"y":"x",l=(o-s[i])/(e[i]-s[i]);s[h]=s[h]+(e[h]-s[h])*l,s[i]=o,s.hasOwnProperty("z")&&(s.z=ni(s.z,e.z,l)),s.hasOwnProperty("w")&&(s.w=ni(s.w,e.w,l))}function k1(s,e,i,o){const h=i,l=o;for(const f of["x","y"]){let g=s,b=e;g[f]>=b[f]&&(g=e,b=s),g[f]<h&&b[f]>h&&O1(g,b,f,h),g[f]<l&&b[f]>l&&O1(b,g,f,l)}}const Jm=Number.MAX_SAFE_INTEGER;function F1(s,e,i,o){return s.order<e||s.order===Jm||!(s.clipMask&i)||function(h,l){return l.length!==0&&l.find(f=>f===h)===void 0}(o,s.clipScope)}function Qm(s,e){return s.x-e.x||s.y-e.y}function B1(s,e){return Qm(s.min,e.min)===0&&Qm(s.max,e.max)===0}function s0(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function o0(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!B1(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!_t(s[i].clipScope,e[i].clipScope))return!1;return!0}function N1(s,e,i){const o=1/At,h=1/(1<<i.canonical.z),l=(e.x*o+i.canonical.x)*h+i.wrap,f=(e.y*o+i.canonical.y)*h;return{min:new ge((s.x*o+i.canonical.x)*h+i.wrap,(s.y*o+i.canonical.y)*h),max:new ge(l,f)}}function NA(s,e,i){const o=1<<i.canonical.z,h=((e.x-i.wrap)*o-i.canonical.x)*At,l=(e.y*o-i.canonical.y)*At;return{min:new ge(((s.x-i.wrap)*o-i.canonical.x)*At,(s.y*o-i.canonical.y)*At),max:new ge(h,l)}}function V1(s,e,i,o,h,l,f){const g=s.indices,b=s.vertices,M=[];for(let m=o;m<o+h;m+=3){const w=e[i[m+0]+l],E=e[i[m+1]+l],v=e[i[m+2]+l],T=Math.min(w.x,E.x,v.x),I=Math.max(w.x,E.x,v.x),z=Math.min(w.y,E.y,v.y),O=Math.max(w.y,E.y,v.y);M.length=0,s.grid.query(new ge(T,z),new ge(I,O),M);for(let V=0;V<M.length;V++){const j=M[V];if(ke(b[g[3*j+0]],b[g[3*j+1]],b[g[3*j+2]],w,E,v,f))return!0}}return!1}function U1(s,e,i,o){if(!s||!i)return!1;let h=s.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<s.vertices.length)return U1(i,o,s,e);const l=e.canonical,f=o.canonical,g=Math.pow(2,f.z-l.z);h=s.vertices.map(b=>new ge((b.x+l.x*At)*g-f.x*At,(b.y+l.y*At)*g-f.y*At))}return V1(i,h,s.indices,0,s.indices.length,0,0)}function j1(s,e,i,o){const h=Math.pow(2,o.z-i.z);return new ge((s+i.x*At)*h-o.x*At,(e+i.y*At)*h-o.y*At)}function G1(s,e){const i=[];e.grid.queryPoint(s,i);const o=e.indices,h=e.vertices;for(let l=0;l<i.length;l++){const f=i[l];if(ue([h[o[3*f+0]],h[o[3*f+1]],h[o[3*f+2]]],s))return!0}return!1}const a0=[new ge(0,0),new ge(At,0),new ge(At,At),new ge(0,At)];function q1(s,e){const i=[];let o=[];if(!e||s.length<2)return[s];if(s.length===2)return Me(s[0],s[1],a0)?[s]:[];for(let h=0;h<s.length+2;h++){const l=s[h%s.length],f=s[(h+1)%s.length],g=Me(h===0?s[s.length-1]:s[(h-1)%s.length],l,a0),b=Me(l,f,a0),M=g||b;M&&o.push(l),M&&b||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const l0=Th.VectorTileFeature.types,VA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],UA=["fill-extrusion-flood-light-ground-radius"],jA=Math.pow(2,13),GA=Math.pow(2,15)-1,H1=new ge(0,1),Rl=2147483648;function Of(s,e,i,o,h,l,f,g){s.emplaceBack((e<<1)+f,(i<<1)+l,(Math.floor(o*jA)<<1)+h,Math.round(g))}function kf(s,e,i){s.emplaceBack(e.x*At,e.y*At,i?1:0)}function e_(s,e,i,o,h,l){s.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+h,l)}function Ff(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Z1{constructor(){this.centroidXY=new ge(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ge(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ge(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ge(this.max.x-this.min.x,this.max.y-this.min.y)}}class W1{constructor(){this.acc=new ge(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===At)&&i.x===o.x)!=((i.y===0||i.y===At)&&i.y===o.y)&&this.processBorderOverlap(i,o),h&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ni(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>At!=e.x>At&&this.addBorderIntersection(1,ni(i.y,e.y,(At-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ni(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>At!=e.y>At&&this.addBorderIntersection(3,ni(i.x,e.x,(At-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new ge(0,0):new ge(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function X1(s,e){const i=s.add(e)._unit(),o=Mt(s.x*i.x+s.y*i.y,-1,1);var h,l,f;return f=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(f)))/4*GA*((h=s).x*(l=e).y-h.y*l.x<0?-1:1)}const qA=[s=>s.x<0,s=>s.x>At,s=>s.y<0,s=>s.y>At];function HA(s,e,i,o){const h=[4];if(o===0)return h;i._mult(o);const l=s.sub(i),f=e.sub(i),g=[s,e,l,f];for(let b=0;b<4;b++)for(const M of g)if(qA[b](M)){h.push(b);break}return h}class Y1{constructor(e){this.vertexArray=new uh,this.indexArray=new hr,this.programConfigurations=new la(e.layers,{zoom:e.zoom,lut:e.lut},i=>UA.includes(i)),this._segments=new Rn,this.hiddenByLandmarkVertexArray=new mh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,h=!1){const l=e.length;if(l>2){let f=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let b;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const M=e[0],m=e[1];b=X1(M.sub(e[l-1])._perp()._unit(),m.sub(M)._perp()._unit())}for(let M=0;M<l;M++){const m=M===l-1?0:M+1,w=e[M],E=e[m],v=e[m===l-1?0:m+1],T=E.sub(w)._perp()._unit(),I=X1(T,v.sub(E)._perp()._unit()),z=b,O=I;if(c0(w,E,i)||h&&Q1(w,i)&&Q1(E,i)){b=I;continue}const V=g.vertexLength;e_(this.vertexArray,w,E,1,1,z),e_(this.vertexArray,w,E,1,0,z),e_(this.vertexArray,w,E,0,1,O),e_(this.vertexArray,w,E,0,0,O),g.vertexLength+=4;const j=HA(w,E,T,o);for(const N of j)this._segmentToGroundQuads[f].push({id:V,region:N}),this._segmentToRegionTriCounts[f][N]+=2,g.primitiveLength+=2;b=I}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((h,l)=>h.region-l.region);for(let o=0;o<i;o++){const h=this._segmentToGroundQuads[o],l=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((b,M)=>b+M,0);let g=0;for(let b=0;b<=4;b++){const M=f[b];if(M!==0){let m=this.regionSegments[b];m||(m=this.regionSegments[b]=new Rn);const w={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+g,vertexLength:l.vertexLength,primitiveLength:M};m.get().push(w)}g+=M}for(let b=0;b<h.length;b++){const M=h[b].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,h,l,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,h,l,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,h,l,f,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,h,l,f,g)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Rl?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,kA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class t_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new hr,this.footprintVertices=new Oo,this.footprintSegments=[],this.layoutVertexArray=new ko,this.centroidVertexArray=new Kr,this.wallVertexArray=new Bm,this.indexArray=new hr,this.programConfigurations=new la(e.layers,{zoom:e.zoom,lut:e.lut},i=>VA.includes(i)),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Y1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,h){this.features=[],this.hasPattern=Jy("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:f,index:g,sourceLayerIndex:b}of e){const M=this.layers[0]._featureFilter.needGeometry,m=k(l,M);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),m,o))continue;const w={id:f,sourceLayerIndex:b,index:g,geometry:M?m.geometry:D(l,o,h),properties:l.properties,type:l.type,patterns:{}},E=this.layoutVertexArray.length,v=l0[w.type]==="Polygon";if(this.hasPattern)this.features.push(Qy("fill-extrusion",this.layers,w,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const T of w.geometry)for(const I of q1(T,v))this.addFeature(w,[I],g,o,{},i.availableImages,h,i.brightness);else this.addFeature(w,w.geometry,g,o,{},i.availableImages,h,i.brightness);i.featureIndex.insert(l,w.geometry,g,b,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,h,l,f){for(const g of this.features){const b=l0[g.type]==="Polygon",{geometry:M}=g;if(this.wallMode)for(const m of M)for(const w of q1(m,b))this.addFeature(g,[w],g.index,i,o,h,l,f);else this.addFeature(g,M,g.index,i,o,h,l,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,h,l,f,g){this.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g),this.groundEffect.update(e,i,l,o,h,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,OA.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,FA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,LA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,h,l,f,g,b){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,m=[new ge(0,0),new ge(At,At)],w=g.projection,E=w.name==="globe",v=this.wallMode||l0[e.type]==="Polygon",T=new W1;T.centroidDataIndex=this.centroidData.length;const I=new Z1,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,O=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let V;if(I.height=O,I.vertexArrayOffset=this.layoutVertexArray.length,I.groundVertexArrayOffset=this.groundEffect.vertexArray.length,E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bc),this.wallMode){if(E)return void _i("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;V=function(ie){const _e=ie[0].x===ie[ie.length-1].x&&ie[0].y===ie[ie.length-1].y;(function(pt){let ot=0;const jt=pt.length;for(let Ct=0;Ct<jt;Ct++)ot+=(pt[(Ct+1)%jt].x-pt[Ct].x)*(pt[(Ct+1)%jt].y+pt[Ct].y);return ot>=0})(ie)||(ie=ie.reverse());const ye={geometry:[],joinNormals:[],indices:[]},be=[],ve=[],Ee=[];let Ie=ie.length;for(;Ie>=2&&ie[Ie-1].equals(ie[Ie-2]);)Ie--;if(Ie<(_e?3:2))return ye;let De,Ae,Ye,rt,Xe,It=0;for(;It<Ie-1&&ie[It].equals(ie[It+1]);)It++;_e&&(De=ie[Ie-2],Xe=ie[It].sub(De)._unit()._perp());for(let pt=It;pt<Ie;pt++){if(Ye=pt===Ie-1?_e?ie[It+1]:void 0:ie[pt+1],Ye&&ie[pt].equals(Ye))continue;Xe&&(rt=Xe),De&&(Ae=De),De=ie[pt],Xe=Ye?Ye.sub(De)._unit()._perp():rt,rt=rt||Xe;let ot=rt.add(Xe);ot.x===0&&ot.y===0||ot._unit();const jt=ot.x*Xe.x+ot.y*Xe.y,Ct=jt!==0?1/jt:1/0,Lt=rt.x*Xe.y-rt.y*Xe.x>0;let ai="miter";const gi=2;ai==="miter"&&Ct>gi&&(ai="bevel"),ai==="bevel"&&(Ct>100&&(ai="flipbevel"),Ct<gi&&(ai="miter"));const yi=(xi,Ai,Ii,an)=>{const nn=new ge(xi.x,xi.y),fi=new ge(xi.x,xi.y);nn.x+=Ai.x*an,nn.y+=Ai.y*an,fi.x-=Ai.x*Math.max(Ii,1),fi.y-=Ai.y*Math.max(Ii,1),Ee.push(Ai),be.push(nn),ve.push(fi)};if(ai==="miter")ot._mult(Ct),yi(De,ot,0,0);else if(ai==="flipbevel")ot=Xe.mult(-1),yi(De,ot,0,0),yi(De,ot.mult(-1),0,0);else{const xi=-Math.sqrt(Ct*Ct-1),Ai=Lt?xi:0,Ii=Lt?0:xi;Ae&&yi(De,rt,Ai,Ii),Ye&&yi(De,Xe,Ai,Ii)}}ye.geometry=[...be,...ve.reverse(),be[0]],ye.joinNormals=[...Ee,...Ee.reverse(),Ee[Ee.length-1]];const Et=ye.geometry.length-1;for(let pt=0;pt<Et/2;pt++)if(pt+1<Et/2){let ot=pt,jt=pt+1,Ct=Et-1-pt,Lt=Et-2-pt;ot=ot===0?Et-1:ot-1,jt=jt===0?Et-1:jt-1,Ct=Ct===0?Et-1:Ct-1,Lt=Lt===0?Et-1:Lt-1,ye.indices.push(Ct),ye.indices.push(jt),ye.indices.push(ot),ye.indices.push(Ct),ye.indices.push(Lt),ye.indices.push(jt)}return ye}(i[0]),i=[V.geometry]}const j=(ie,_e)=>ie<(_e.length-1)/2||ie===_e.length-1,N=this.wallMode?[i]:Xm(i,500);for(let ie=N.length-1;ie>=0;ie--){const _e=N[ie];(_e.length===0||(G=_e[0]).every(oe=>oe.x<=0)||G.every(oe=>oe.x>=At)||G.every(oe=>oe.y<=0)||G.every(oe=>oe.y>=At))&&N.splice(ie,1)}var G;let H;if(E)H=nb(N,m,h);else{H=[];for(const ie of N)H.push({polygon:ie,bounds:m})}const K=v?this.edgeRadius:0,se=K>0&&this.zoom<17,re=(ie,_e)=>{if(ie.length===0)return!1;const oe=ie[ie.length-1];return _e.x===oe.x&&_e.y===oe.y};for(const{polygon:ie,bounds:_e}of H){let oe=0,ye=0;for(const Ie of ie)v&&!Ie[0].equals(Ie[Ie.length-1])&&Ie.push(Ie[0]),ye+=v?Ie.length-1:Ie.length;const be=this.segments.prepareSegment((v?5:4)*ye,this.layoutVertexArray,this.indexArray);I.footprintSegIdx<0&&(I.footprintSegIdx=this.footprintSegments.length),I.polygonSegIdx<0&&(I.polygonSegIdx=this.polygonSegments.length);const ve={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ee=new $1;if(Ee.vertexOffset=this.footprintVertices.length,Ee.indexOffset=3*this.footprintIndices.length,Ee.ringIndices=[],v){const Ie=[],De=[];oe=be.vertexLength;for(let Ye=0;Ye<ie.length;Ye++){const rt=ie[Ye];rt.length&&Ye!==0&&De.push(Ie.length/2);const Xe=[];let It,Et;It=rt[1].sub(rt[0])._perp()._unit(),Ee.ringIndices.push(rt.length-1);for(let pt=1;pt<rt.length;pt++){const ot=rt[pt],jt=rt[pt===rt.length-1?1:pt+1],Ct=ot.clone();if(K){Et=jt.sub(ot)._perp()._unit();const Lt=It.add(Et)._unit(),ai=K*Math.min(4,1/(It.x*Lt.x+It.y*Lt.y));Ct.x+=ai*Lt.x,Ct.y+=ai*Lt.y,Ct.x=Math.round(Ct.x),Ct.y=Math.round(Ct.y),It=Et}if(!z||K!==0&&!se||re(Xe,Ct)||Xe.push(Ct),Of(this.layoutVertexArray,Ct.x,Ct.y,0,0,1,1,0),this.wallMode){const Lt=j(pt,rt);kf(this.wallVertexArray,V.joinNormals[pt],!Lt)}be.vertexLength++,this.footprintVertices.emplaceBack(ot.x,ot.y),Ie.push(ot.x,ot.y),E&&Ff(this.layoutVertexExtArray,w.projectTilePoint(Ct.x,Ct.y,h),w.upVector(h,Ct.x,Ct.y))}z&&(K===0||se)&&(Xe.length!==0&&re(Xe,Xe[0])&&Xe.pop(),this.groundEffect.addData(Xe,_e,M))}const Ae=this.wallMode?V.indices:Rf(Ie,De);for(let Ye=0;Ye<Ae.length;Ye+=3)this.footprintIndices.emplaceBack(Ee.vertexOffset+Ae[Ye+0],Ee.vertexOffset+Ae[Ye+1],Ee.vertexOffset+Ae[Ye+2]),this.indexArray.emplaceBack(oe+Ae[Ye],oe+Ae[Ye+2],oe+Ae[Ye+1]),be.primitiveLength++;Ee.indexCount+=Ae.length,Ee.vertexCount+=this.footprintVertices.length-Ee.vertexOffset}for(let Ie=0;Ie<ie.length;Ie++){const De=ie[Ie];T.startRing(I,De[0]);let Ae=De.length>4&&eb(De[De.length-2],De[0],De[1]),Ye=K?$A(De[De.length-2],De[0],De[1],K):0;const rt=[];let Xe,It,Et;It=De[1].sub(De[0])._perp()._unit();let pt=!0;for(let ot=1,jt=0;ot<De.length;ot++){let Ct=De[ot-1],Lt=De[ot];const ai=De[ot===De.length-1?1:ot+1];if(T.appendEdge(I,Lt,Ct),c0(Lt,Ct,_e)){K&&(It=ai.sub(Lt)._perp()._unit(),pt=!pt);continue}const gi=Lt.sub(Ct)._perp(),yi=gi.x/(Math.abs(gi.x)+Math.abs(gi.y)),xi=gi.y>0?1:0,Ai=Ct.dist(Lt);if(jt+Ai>32768&&(jt=0),K){Et=ai.sub(Lt)._perp()._unit();let fi=J1(Ct,Lt,ai,K1(It,Et),K);isNaN(fi)&&(fi=0);const Yi=Lt.sub(Ct)._unit();Ct=Ct.add(Yi.mult(Ye))._round(),Lt=Lt.add(Yi.mult(-fi))._round(),Ye=fi,It=Et,z&&this.zoom>=17&&(re(rt,Ct)||rt.push(Ct),re(rt,Lt)||rt.push(Lt))}const Ii=be.vertexLength,an=De.length>4&&eb(Ct,Lt,ai);let nn=tb(jt,Ae,pt);if(Of(this.layoutVertexArray,Ct.x,Ct.y,yi,xi,0,0,nn),Of(this.layoutVertexArray,Ct.x,Ct.y,yi,xi,0,1,nn),this.wallMode){const fi=j(ot-1,De),Yi=V.joinNormals[ot-1];kf(this.wallVertexArray,Yi,fi),kf(this.wallVertexArray,Yi,fi)}if(jt+=Ai,nn=tb(jt,an,!pt),Ae=an,Of(this.layoutVertexArray,Lt.x,Lt.y,yi,xi,0,0,nn),Of(this.layoutVertexArray,Lt.x,Lt.y,yi,xi,0,1,nn),this.wallMode){const fi=j(ot,De),Yi=V.joinNormals[ot];kf(this.wallVertexArray,Yi,fi),kf(this.wallVertexArray,Yi,fi)}if(be.vertexLength+=4,this.indexArray.emplaceBack(Ii+0,Ii+1,Ii+2),this.indexArray.emplaceBack(Ii+1,Ii+3,Ii+2),be.primitiveLength+=2,K){const fi=oe+(ot===1?De.length-2:ot-2),Yi=ot===1?oe:fi+1;if(this.indexArray.emplaceBack(Ii+1,fi,Ii+3),this.indexArray.emplaceBack(fi,Yi,Ii+3),be.primitiveLength+=2,Xe===void 0&&(Xe=Ii),!c0(ai,De[ot],_e)){const Ji=ot===De.length-1?Xe:be.vertexLength;this.indexArray.emplaceBack(Ii+2,Ii+3,Ji),this.indexArray.emplaceBack(Ii+3,Ji+1,Ji),this.indexArray.emplaceBack(Ii+3,Yi,Ji+1),be.primitiveLength+=3}pt=!pt}if(E){const fi=this.layoutVertexExtArray,Yi=w.projectTilePoint(Ct.x,Ct.y,h),Ji=w.projectTilePoint(Lt.x,Lt.y,h),mn=w.upVector(h,Ct.x,Ct.y),On=w.upVector(h,Lt.x,Lt.y);Ff(fi,Yi,mn),Ff(fi,Yi,mn),Ff(fi,Ji,On),Ff(fi,Ji,On)}}v&&(oe+=De.length-1),z&&K&&this.zoom>=17&&(rt.length!==0&&re(rt,rt[0])&&rt.pop(),this.groundEffect.addData(rt,_e,M,K>0))}this.footprintSegments.push(Ee),ve.triangleCount=this.indexArray.length-ve.triangleArrayOffset,this.polygonSegments.push(ve),++I.footprintSegLen,++I.polygonSegLen}if(I.vertexCount=this.layoutVertexArray.length-I.vertexArrayOffset,I.groundVertexCount=this.groundEffect.vertexArray.length-I.groundVertexArrayOffset,I.vertexCount!==0){if(I.centroidXY=T.borders?H1:this.encodeCentroid(T,I),this.centroidData.push(I),T.borders){this.featuresOnBorder.push(T);const ie=this.featuresOnBorder.length-1;for(let _e=0;_e<T.borders.length;_e++)T.borders[_e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[_e].push(ie)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,h,b),this.groundEffect.addPaintPropertiesData(e,o,l,f,h,b),this.maxHeight=Math.max(this.maxHeight,O)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const b=this.centroidData[g],M=+(b.min.y+b.max.y>At),m=2*M+(+(b.min.x+b.max.x>At)^M);for(let w=0;w<b.polygonSegLen;w++){const E=b.polygonSegIdx+w;e.push({centroidIdx:g,subtile:m,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}const i=new hr;e.sort((g,b)=>g.triangleSegmentIdx===b.triangleSegmentIdx?g.subtile-b.subtile:g.triangleSegmentIdx-b.triangleSegmentIdx);let o=0,h=0,l=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;l++}const f=e.length;for(;h!==e.length;){o=e[h].triangleSegmentIdx;let g=0,b=h,M=h;for(let m=b;m<l&&e[m].subtile===g;m++)M++;for(;b!==l;){const m=e[b];g=m.subtile;const w=this.centroidData[m.centroidIdx].min.clone(),E=this.centroidData[m.centroidIdx].max.clone(),v={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let T=b;T<M;T++){const I=e[T],z=this.polygonSegments[I.polygonSegmentIdx],O=this.centroidData[I.centroidIdx].min,V=this.centroidData[I.centroidIdx].max,j=this.indexArray.uint16;for(let N=z.triangleArrayOffset;N<z.triangleArrayOffset+z.triangleCount;N++)i.emplaceBack(j[3*N],j[3*N+1],j[3*N+2]);v.primitiveLength+=z.triangleCount,w.x=Math.min(w.x,O.x),w.y=Math.min(w.y,O.y),E.x=Math.max(E.x,V.x),E.y=Math.max(E.y,V.y)}v.primitiveLength>0&&this.triangleSubSegments.push({segment:v,min:w,max:E}),b=M;for(let T=b;T<l&&e[T].subtile===e[b].subtile;T++)M++}h=l;for(let m=h;m<f&&e[m].triangleSegmentIdx===e[h].triangleSegmentIdx;m++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const h=new Rn;if(this.wallMode){for(const I of this.triangleSubSegments)h.segments.push(I.segment);return h}let l=0,f=0;const g=1<<e.canonical.z;if(i){const I=i.getMinMaxForTile(e);I&&(l=I.min,f=I.max)}f+=this.maxHeight;const b=e.toUnwrapped();let M;const m=[b.canonical.x/g+b.wrap,b.canonical.y/g],w=[(b.canonical.x+1)/g+b.wrap,(b.canonical.y+1)/g],E=(I,z,O)=>[I[0]*(1-O[0])+z[0]*O[0],I[1]*(1-O[1])+z[1]*O[1]],v=[],T=[];for(const I of this.triangleSubSegments){v[0]=I.min.x/At,v[1]=I.min.y/At,T[0]=I.max.x/At,T[1]=I.max.y/At;const z=E(m,w,v),O=E(m,w,T);if(new Ht([z[0],z[1],l],[O[0],O[1],f]).intersectsPrecise(o)===0){M&&(h.segments.push(M),M=void 0);continue}const V=I.segment;M&&M.vertexOffset!==V.vertexOffset&&(h.segments.push(M),M=void 0),M?(M.vertexLength+=V.vertexLength,M.primitiveLength+=V.primitiveLength):M={vertexOffset:V.vertexOffset,primitiveLength:V.primitiveLength,vertexLength:V.vertexLength,primitiveOffset:V.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&h.segments.push(M),h}encodeCentroid(e,i){const o=e.centroid(),h=i.span(),l=Math.min(7,Math.round(h.x*this.tileToMeter/10)),f=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new ge(Mt(o.x,1,At-1)<<3|l,Mt(o.y,1,At-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new ge(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const h=i[0][0]!==o?0:1;return new ge(6|(i[0][0]!==o?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==o?2:3;return new ge((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Rl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,h=e.flags&Rl?H1:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||l!==h.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(o0(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const l=[];for(const f of this.activeReplacements){if(f.order<o)continue;const g=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const b of this.centroidData)if(!(b.flags&Rl||f.min.x>b.max.x||b.min.x>f.max.x||f.min.y>b.max.y||b.min.y>f.max.y))for(let M=0;M<b.footprintSegLen;M++){const m=this.footprintSegments[b.footprintSegIdx+M];if(l.length=0,ZA(this.footprintVertices,m.vertexOffset,m.vertexCount,f.footprintTileId.canonical,e.canonical,l),V1(f.footprint,l,this.footprintIndices.uint16,m.indexOffset,m.indexCount,-m.vertexOffset,-g)){b.flags|=Rl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let h=!1;for(let l=0;l<o.footprintSegLen;l++){const f=this.footprintSegments[o.footprintSegIdx+l];let g=0;for(const b of f.ringIndices){for(let M=g,m=b+g-1;M<b+g;m=M++){const w=this.footprintVertices.int16[2*(M+f.vertexOffset)+0],E=this.footprintVertices.int16[2*(M+f.vertexOffset)+1],v=this.footprintVertices.int16[2*(m+f.vertexOffset)+1];E>i!=v>i&&e<(this.footprintVertices.int16[2*(m+f.vertexOffset)+0]-w)*(i-E)/(v-E)+w&&(h=!h)}g=b}}return h}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,h=!0;const l=4*(e+At)*At+(i+At);if(this.partLookup.hasOwnProperty(l)){const f=this.partLookup[l];return f?{height:f.height,hidden:!!(f.flags&Rl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[l]=f,h=!!(f.flags&Rl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:h};this.partLookup[l]=void 0}}function K1(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function $A(s,e,i,o){const h=e.sub(s)._perp()._unit(),l=i.sub(e)._perp()._unit();return J1(s,e,i,K1(h,l),o)}function J1(s,e,i,o,h){const l=Math.sqrt(1-o*o);return Math.min(s.dist(e)/3,e.dist(i)/3,h*l/o)}function c0(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function Q1(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function eb(s,e,i){if(s.x<0||s.x>=At||e.x<0||e.x>=At||i.x<0||i.x>=At)return!1;const o=i.sub(e),h=o.perp(),l=s.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&h.x*l.x+h.y*l.y<0}function tb(s,e,i){const o=e?2|s:-3&s;return i?1|o:-2&o}function ib(){const s=Math.PI/32,e=Math.tan(s),i=Ba;return i*Math.sqrt(1+2*e*e)-i}function nb(s,e,i){const o=1<<i.z,h=Jr(i.x/o),l=Jr((i.x+1)/o),f=dr(i.y/o),g=dr((i.y+1)/o);return function(b,M,m,w,E=0,v){const T=[];if(!b.length||!m||!w)return T;const I=(H,K)=>{for(const se of H)T.push({polygon:se,bounds:K})},z=Math.ceil(Math.log2(m)),O=Math.ceil(Math.log2(w)),V=z-O,j=[];for(let H=0;H<Math.abs(V);H++)j.push(V>0?0:1);for(let H=0;H<Math.min(z,O);H++)j.push(0),j.push(1);let N=b;if(N=Km(N,M[0].y-E,M[1].y+E,1),N=Km(N,M[0].x-E,M[1].x+E,0),!N.length)return T;const G=[];for(j.length?G.push({polygons:N,bounds:M,depth:0}):I(N,M);G.length;){const H=G.pop(),K=H.depth,se=j[K],re=H.bounds[0],ie=H.bounds[1],_e=se===0?re.x:re.y,oe=se===0?ie.x:ie.y,ye=v?v(se,_e,oe):.5*(_e+oe),be=Km(H.polygons,_e-E,ye+E,se),ve=Km(H.polygons,ye-E,oe+E,se);if(be.length){const Ee=[re,new ge(se===0?ye:ie.x,se===1?ye:ie.y)];j.length>K+1?G.push({polygons:be,bounds:Ee,depth:K+1}):I(be,Ee)}if(ve.length){const Ee=[new ge(se===0?ye:re.x,se===1?ye:re.y),ie];j.length>K+1?G.push({polygons:ve,bounds:Ee,depth:K+1}):I(ve,Ee)}}return T}(s,e,Math.ceil((l-h)/11.25),Math.ceil((f-g)/11.25),1,(b,M,m)=>{if(b===0)return .5*(M+m);{const w=dr((i.y+M/At)/o);return(Us(.5*(dr((i.y+m/At)/o)+w))*o-i.y)*At}})}function ZA(s,e,i,o,h,l){const f=Math.pow(2,o.z-h.z);for(let g=0;g<i;g++){let b=s.int16[2*(g+e)+0],M=s.int16[2*(g+e)+1];b=(b+h.x*At)*f-o.x*At,M=(M+h.y*At)*f-o.y*At,l.push(new ge(b,M))}}let rb,sb;function Bf(s,e){return s.x*e.x+s.y*e.y}function ob(s,e){if(s.length===1){let i=0;const o=e[i++];let h;for(;!h||o.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const l=e[i],f=s[0],g=h.sub(o),b=l.sub(o),M=f.sub(o),m=Bf(g,g),w=Bf(g,b),E=Bf(b,b),v=Bf(M,g),T=Bf(M,b),I=m*E-w*w,z=(E*v-w*T)/I,O=(m*T-w*v)/I,V=o.z*(1-z-O)+h.z*z+l.z*O;if(isFinite(V))return V}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function ab(s,e,i,o,h,l,f,g){const b=f*h.getElevationAt(s,e,!0,!0),M=l[0]!==0,m=M?l[1]===0?f*(l[0]/7-450):f*function(w,E,v){const T=Math.floor(E[0]/8),I=Math.floor(E[1]/8),z=10*(E[0]-8*T),O=10*(E[1]-8*I),V=w.getElevationAt(T,I,!0,!0),j=w.getMeterToDEM(v),N=Math.floor(.5*(z*j-1)),G=Math.floor(.5*(O*j-1)),H=w.tileCoordToPixel(T,I),K=2*N+1,se=2*G+1,re=function(ve,Ee,Ie,De,Ae){return[ve.getElevationAtPixel(Ee,Ie,!0),ve.getElevationAtPixel(Ee+Ae,Ie,!0),ve.getElevationAtPixel(Ee,Ie+Ae,!0),ve.getElevationAtPixel(Ee+De,Ie+Ae,!0)]}(w,H.x-N,H.y-G,K,se),ie=Math.abs(re[0]-re[1]),_e=Math.abs(re[2]-re[3]),oe=Math.abs(re[0]-re[2])+Math.abs(re[1]-re[3]),ye=Math.min(.25,.5*j*(ie+_e)/K),be=Math.min(.25,.5*j*oe/se);return V+Math.max(ye*z,be*O)}(h,l,g):b;return{base:b+(i===0?-1:i),top:M?Math.max(m+o,b+i+2):b+o}}Nt(t_,"FillExtrusionBucket",{omit:["layers","features"]}),Nt(Z1,"PartData"),Nt($1,"FootprintSegment"),Nt(W1,"BorderCentroidData"),Nt(Y1,"GroundEffect");const WA=$i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),XA=$i([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:YA}=WA,KA=$i([{name:"a_packed",components:3,type:"Float32"}]),{members:JA}=KA,QA=$i([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:eI}=QA;class lb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Pl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Un(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const h=[];let l=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,g=!0;h.push({left:l,right:f,isDash:g,zeroLength:e[0]===0});let b=e[0];for(let M=1;M<e.length;M++){g=!g;const m=e[M];l=b*o,b+=m,f=b*o,h.push({left:l,right:f,isDash:g,zeroLength:m===0})}return h}addRoundDash(e,i,o){const h=i/2;for(let l=-o;l<=o;l++){const f=this.width*(this.nextRow+o+l);let g=0,b=e[g];for(let M=0;M<this.width;M++){M/b.right>1&&(b=e[++g]);const m=Math.abs(M-b.left),w=Math.abs(M-b.right),E=Math.min(m,w);let v;const T=l/o*(h+1);if(b.isDash){const I=h-Math.abs(T);v=Math.sqrt(E*E+I*I)}else v=h-Math.sqrt(E*E+T*T);this.image.data[f+M]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const M=e[b],m=e[b+1];M.zeroLength?e.splice(b,1):m&&m.isDash===M.isDash&&(m.left=M.left,e.splice(b,1))}const o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const l=this.width*this.nextRow;let f=0,g=e[f];for(let b=0;b<this.width;b++){b/g.right>1&&(g=e[++f]);const M=Math.abs(b-g.left),m=Math.abs(b-g.right),w=Math.min(M,m);this.image.data[l+b]=Math.max(0,Math.min(255,(g.isDash?w:-w)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const h=i==="round",l=h?7:0,f=2*l+1;if(this.nextRow+f>this.height)return _i("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let m=0;m<e.length;m++)e[m]<0&&(_i("Negative value is found in line dasharray, replacing values with 0"),e[m]=0),g+=e[m];if(g!==0){const m=this.width/g,w=this.getDashRanges(e,this.width,m);h?this.addRoundDash(w,m,l):this.addRegularDash(w,i==="square"?.5*m:0)}const b=this.nextRow+l;this.nextRow+=f;const M={tl:[b,l],br:[g,0]};return this.positions[o]=M,M}}Nt(lb,"LineAtlas");const tI=Th.VectorTileFeature.types,iI=Math.cos(Math.PI/180*37.5),nI=Math.cos(Math.PI/180*5);class u0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Fc,this.layoutVertexArray2=new lo,this.patternVertexArray=new lo,this.indexArray=new hr,this.programConfigurations=new la(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Rn,this.maxLineLength=0,this.zOffsetVertexArray=new lo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:At/64}updateFootprints(e,i){}populate(e,i,o,h){this.hasPattern=Jy("line",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(o);const f=this.layers[0].layout.get("line-z-offset"),g=f.isConstant()&&!f.constantOr(0),b=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=b==="sea"||b==="ground"||!g&&b==="none",this.hasZOffset&&b==="none"&&_i(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&M!==void 0;const m=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:O}of e){const V=this.layers[0]._featureFilter.needGeometry,j=k(T,V);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),j,o))continue;const N=l?l.evaluate(j,{},o):void 0,G={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:z,geometry:V?j.geometry:D(T,o,h),patterns:{},sortKey:N};m.push(G)}l&&m.sort((T,I)=>T.sortKey-I.sortKey);const{lineAtlas:w,featureIndex:E}=i,v=this.addConstantDashes(w);for(const T of m){const{geometry:I,index:z,sourceLayerIndex:O}=T;if(v&&this.addFeatureDashes(T,w),this.hasPattern){const V=Qy("line",this.layers,T,this.zoom,this.pixelRatio,i);this.patternFeatures.push(V)}else this.addFeature(T,I,z,o,w.positions,i.availableImages,i.brightness);E.insert(e[z].feature,I,z,O,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const h=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(h.kind!=="constant"||l.kind!=="constant")i=!0;else{const f=l.value,g=h.value;if(!g)continue;e.addDash(g,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const h of this.layers){const l=h.paint.get("line-dasharray").value,f=h.layout.get("line-cap").value;if(l.kind==="constant"&&f.kind==="constant")continue;let g,b;if(l.kind==="constant"){if(g=l.value,!g)continue}else g=l.evaluate({zoom:o},e);b=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(g,b),e.patterns[h.id]=i.getKey(g,b)}}update(e,i,o,h,l,f,g){this.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g)}addFeatures(e,i,o,h,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,JA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,eI)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,XA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,h,l,f,g){const b=this.layers[0].layout,M=b.get("line-join").evaluate(e,{}),m=b.get("line-cap").evaluate(e,{}),w=b.get("line-miter-limit"),E=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const v=this.layers[0].paint.get("line-width").value;v.kind!=="constant"&&v.isLineProgressConstant===!1&&(this.variableWidthValue=v);for(const T of i)this.addLine(T,e,h,M,m,w,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,h,g)}addLine(e,i,o,h,l,f,g){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=h==="none";if(this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<e.length-1;j++)this.totalDistance+=e[j].dist(e[j+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=tI[i.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let w=0;for(;w<m-1&&e[w].equals(e[w+1]);)w++;if(m<(M?3:2))return;h==="bevel"&&(f=1.05);const E=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let v,T,I,z,O,V;this.e1=this.e2=-1,M&&(v=e[m-2],O=e[w].sub(v)._unit()._perp());for(let j=w;j<m;j++){if(I=j===m-1?M?e[w+1]:void 0:e[j+1],I&&e[j].equals(I))continue;O&&(z=O),v&&(T=v),v=e[j],V=this.evaluateLineProgressFeatures(T?T.dist(v):0),O=I?I.sub(v)._unit()._perp():z,z=z||O;const N=T&&I;let G=N?h:M||b?"butt":l;const H=z.x*O.x+z.y*O.y;if(b){const be=function(ve){if(ve.patternJoinNone){const Ee=ve.segmentPoints.length/2,Ie=ve.lineSoFar-ve.segmentStart;for(let De=0;De<Ee;++De){const Ae=ve.segmentPoints[2*De+1],Ye=Math.round(ve.segmentPoints[2*De])+.5+.25*Ae;ve.patternVertexArray.emplaceBack(Ye,Ie,ve.segmentStart),ve.patternVertexArray.emplaceBack(Ye,Ie,ve.segmentStart)}ve.segmentPoints.length=0}ve.e1=ve.e2=-1};if(N&&H<nI){this.updateDistance(T,v),this.addCurrentVertex(v,z,1,1,E,V),be(this),this.addCurrentVertex(v,O,-1,-1,E,V);continue}if(T){if(!I){this.updateDistance(T,v),this.addCurrentVertex(v,z,1,1,E,V),be(this);continue}G="miter"}}let K=z.add(O);K.x===0&&K.y===0||K._unit();const se=K.x*O.x+K.y*O.y,re=se!==0?1/se:1/0,ie=2*Math.sqrt(2-2*se),_e=se<iI&&T&&I,oe=z.x*O.y-z.y*O.x>0,ye=this.overscaling<=16?15*At/(512*this.overscaling):0;if(N&&G==="round"){if(re<g)G="miter";else if(re<=2){const be=h0(v,-10,At+10);G=this.hasZOffset&&(be||this.hasCrossSlope)?"miter":"fakeround"}}if(G==="miter"&&re>f&&(G="bevel"),G==="bevel"&&(re>2&&(G="flipbevel"),re<f&&(G="miter")),T&&!(G==="miter"&&_e)&&this.updateDistance(T,v),G==="miter")if(_e){const be=v.dist(T);if(be>2*ye){const Ee=v.sub(v.sub(T)._mult(ye/be)._round());this.updateDistance(T,Ee),this.addCurrentVertex(Ee,z,0,0,E,V),T=Ee}this.updateDistance(T,v),K._mult(re),this.addCurrentVertex(v,K,0,0,E,V);const ve=v.dist(I);if(ve>2*ye){const Ee=v.add(I.sub(v)._mult(ye/ve)._round());this.updateDistance(v,Ee),this.addCurrentVertex(Ee,O,0,0,E,V),v=Ee}}else K._mult(re),this.addCurrentVertex(v,K,0,0,E,V);else if(G==="flipbevel"){if(re>100)K=O.mult(-1);else{const be=re*z.add(O).mag()/z.sub(O).mag();K._perp()._mult(be*(oe?-1:1))}this.addCurrentVertex(v,K,0,0,E,V),this.addCurrentVertex(v,K.mult(-1),0,0,E,V)}else if(G==="bevel"||G==="fakeround"){V!=null&&T&&this.addCurrentVertex(v,z,-1,-1,E,V);const be=v.dist(T)<=2*ye&&G!=="bevel",ve=K.mult(oe?1:-1);ve._mult(re);const Ee=O.mult(oe?-1:1),Ie=z.mult(oe?-1:1),De=this.evaluateLineProgressFeatures(this.distance);if(V==null&&(this.addHalfVertex(v,ve.x,ve.y,!1,!oe,0,E,De),be||this.addHalfVertex(v,ve.x+2*Ie.x,ve.y+2*Ie.y,!1,oe,0,E,De)),G==="fakeround"){const Ae=Math.round(180*ie/Math.PI/20);this.addHalfVertex(v,Ie.x,Ie.y,!1,oe,0,E,De);for(let Ye=0;Ye<Ae;Ye++){let rt=Ye/Ae;if(rt!==.5){const It=rt-.5;rt+=rt*It*(rt-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*It*It+(.848013+H*(.215638*H-1.06021)))}const Xe=Ee.sub(Ie)._mult(rt)._add(Ie)._unit();this.addHalfVertex(v,Xe.x,Xe.y,!1,oe,0,E,De)}this.addHalfVertex(v,Ee.x,Ee.y,!1,oe,0,E,De)}be||V!=null||this.addHalfVertex(v,ve.x+2*Ee.x,ve.y+2*Ee.y,!1,oe,0,E,De),V!=null&&I&&this.addCurrentVertex(v,O,1,1,E,V)}else G==="butt"?this.addCurrentVertex(v,K,0,0,E,V):G==="square"?(T||this.addCurrentVertex(v,K,-1,-1,E,V),this.addCurrentVertex(v,K,0,0,E,V),T&&this.addCurrentVertex(v,K,1,1,E,V)):G==="round"&&(T&&(this.addCurrentVertex(v,z,0,0,E,V),this.addCurrentVertex(v,z,1,1,E,V,!0)),I&&(this.addCurrentVertex(v,O,-1,-1,E,V,!0),this.addCurrentVertex(v,O,0,0,E,V)))}}addVerticesTo(e,i,o,h,l,f,g,b,M,m){const w=(i.w-e.w)/this.tessellationStep|0;let E=0;const v=this.scaledDistance;if(w>1){this.lineSoFar=e.w;const I=(i.x-e.x)/w,z=(i.y-e.y)/w,O=(i.z-e.z)/w,V=(i.w-e.w)/w;for(let j=1;j<w;++j){e.x+=I,e.y+=z,e.z+=O,this.lineSoFar+=V,E+=V;const N=this.evaluateLineProgressFeatures(this.prevDistance+E);this.scaledDistance=(this.prevDistance+E)/this.totalDistance,this.addHalfVertex(e,o,h,m,!1,g,M,N),this.addHalfVertex(e,l,f,m,!0,-b,M,N)}}this.lineSoFar=i.w,this.scaledDistance=v;const T=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,h,m,!1,g,M,T),this.addHalfVertex(i,l,f,m,!0,-b,M,T)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):_i(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,o,h,l,f,g=!1){const b=i.x+i.y*o,M=i.y-i.x*o,m=i.y*h-i.x,w=-i.y-i.x*h;if(f!=null){const E=this.hasZOffset,v=-10,T=At+10,I=f.zOffset,z=new L1(e.x,e.y,I,this.lineSoFar),O=!!E&&h0(e,v,T),V=this.lineSoFar,j=this.distance;if(this.currentVertex)if(O){const N=this.currentVertexIsOutside,G=this.currentVertex,H=new L1(e.x,e.y,I,this.lineSoFar);if(k1(G,H,v,T),!h0(H,v,T)){if(N){this.e1=this.e2=-1,this.distance-=G.dist(z),this.lineSoFar=G.w;const K=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,b,M,g,!1,o,l,K),this.addHalfVertex(G,m,w,g,!0,-h,l,K),this.prevDistance=this.distance}this.distance=this.prevDistance+G.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(G,H,b,M,m,w,o,h,l,g),this.distance=j,this.scaledDistance=this.distance/this.totalDistance}}else{const N=this.currentVertex;if(this.currentVertexIsOutside){k1(N,z,v,T),this.e1=this.e2=-1,this.distance-=N.dist(z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=N.w;const G=this.evaluateLineProgressFeatures(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,b,M,g,!1,o,l,G),this.addHalfVertex(N,m,w,g,!0,-h,l,G),this.prevDistance=this.distance,this.distance=j,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(N,z,b,M,m,w,o,h,l,g)}else O||(this.addHalfVertex(e,b,M,g,!1,o,l,f),this.addHalfVertex(e,m,w,g,!0,-h,l,f));this.currentVertex=z,this.currentVertexIsOutside=O,this.lineSoFar=V}else this.addHalfVertex(e,b,M,g,!1,o,l,f),this.addHalfVertex(e,m,w,g,!0,-h,l,f)}addHalfVertex({x:e,y:i},o,h,l,f,g,b,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const w=ni(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,w)}const m=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,m),b.primitiveLength++),f?this.e2=m:this.e1=m,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function h0(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let cb,ub;function hb(s,e,i){return e*(At/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}Nt(u0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const db=(s,e,i)=>(1-i)*s+i*e;function fb(s,e){return 1/hb(s,1,e.tileZoom)}function pb(s,e,i,o){return s.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const mb=s=>{const e=[];_b(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=s.layout.get("line-join").constantOr("miter")==="none",h=!!s.paint.get("line-pattern").constantOr(1);return o&&h&&e.push("LINE_JOIN_NONE"),e};function _b(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let d0;const gb=()=>d0||(d0={layout:cb||(cb=new vn({"line-cap":new Dt(Fe.layout_line["line-cap"]),"line-join":new Dt(Fe.layout_line["line-join"]),"line-miter-limit":new yt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new yt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Dt(Fe.layout_line["line-sort-key"]),"line-z-offset":new Dt(Fe.layout_line["line-z-offset"]),"line-elevation-reference":new yt(Fe.layout_line["line-elevation-reference"]),"line-cross-slope":new yt(Fe.layout_line["line-cross-slope"]),visibility:new yt(Fe.layout_line.visibility),"line-width-unit":new yt(Fe.layout_line["line-width-unit"])})),paint:ub||(ub=new vn({"line-opacity":new Dt(Fe.paint_line["line-opacity"]),"line-color":new Dt(Fe.paint_line["line-color"]),"line-translate":new yt(Fe.paint_line["line-translate"]),"line-translate-anchor":new yt(Fe.paint_line["line-translate-anchor"]),"line-width":new Dt(Fe.paint_line["line-width"]),"line-gap-width":new Dt(Fe.paint_line["line-gap-width"]),"line-offset":new Dt(Fe.paint_line["line-offset"]),"line-blur":new Dt(Fe.paint_line["line-blur"]),"line-dasharray":new Dt(Fe.paint_line["line-dasharray"]),"line-pattern":new Dt(Fe.paint_line["line-pattern"]),"line-gradient":new vl(Fe.paint_line["line-gradient"]),"line-trim-offset":new yt(Fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new yt(Fe.paint_line["line-trim-fade-range"]),"line-trim-color":new yt(Fe.paint_line["line-trim-color"]),"line-emissive-strength":new yt(Fe.paint_line["line-emissive-strength"]),"line-border-width":new Dt(Fe.paint_line["line-border-width"]),"line-border-color":new Dt(Fe.paint_line["line-border-color"]),"line-occlusion-opacity":new yt(Fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},d0);class rI extends Dt{possiblyEvaluate(e,i){return i=new un(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,h){return i=qi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,h)}}let Nf;function yb(s,e){return e>0?e+2*s:s}const sI=$i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oI=$i([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aI=$i([{name:"a_projected_pos",components:4,type:"Float32"}],4);$i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lI=$i([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),cI=$i([{name:"a_texb",components:2,type:"Uint16"}]),uI=$i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),hI=$i([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const xb=$i([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dI=$i([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$i([{name:"triangle",components:3,type:"Uint16"}]),$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$i([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),$i([{type:"Float32",name:"offsetX"}]),$i([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Pr=24;const Bo=128;function f0(s,e,i,o,h){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const l=e.possiblyEvaluate(new un(s.maxZoom),i).evaluate(h,{},i),f=e.possiblyEvaluate(new un(s.minZoom),i).evaluate(h,{},i);return Math.max(l,f)}return e.possiblyEvaluate(new un(o)).evaluate(h,{},i)}function p0(s,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new un(s+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=i;let l=0;for(;l<o.length&&o[l]<=s;)l++;l=Math.max(0,l-1);let f=l;for(;f<o.length&&o[f]<s+1;)f++;f=Math.min(o.length-1,f);const g=o[l],b=o[f];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:g,maxZoom:b,minSize:i.evaluate(new un(g)),maxSize:i.evaluate(new un(b)),interpolationType:h}}}function i_(s,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:h}){return s.kind==="source"?o/Bo:s.kind==="composite"?ni(o/Bo,h/Bo,i):e}function Sh(s,e,i=1){let o=0,h=0;if(s.kind==="constant")h=s.layoutSize*i;else if(s.kind!=="source"){const{interpolationType:l,minZoom:f,maxZoom:g}=s,b=l?Mt(Xr.interpolationFactor(l,e,f,g),0,1):0;s.kind==="camera"?h=ni(s.minSize,s.maxSize,b)*i:o=b*i}return{uSizeT:o,uSize:h}}var fI=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Bo,evaluateSizeForFeature:i_,evaluateSizeForZoom:Sh,getRasterizedIconSize:f0,getSizeData:p0});function pI(s,e,i){return s.sections.forEach(o=>{o.text=function(h,l,f){const g=l.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?h=h.toLocaleUpperCase():g==="lowercase"&&(h=h.toLocaleLowerCase()),cs.applyArabicShaping&&(h=cs.applyArabicShaping(h)),h}(o.text,e,i)}),s}const Vf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function mI(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function _I(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}var vb,m0,bb,_0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function gI(){return vb||(vb=1,_0.read=function(s,e,i,o,h){var l,f,g=8*h-o-1,b=(1<<g)-1,M=b>>1,m=-7,w=i?h-1:0,E=i?-1:1,v=s[e+w];for(w+=E,l=v&(1<<-m)-1,v>>=-m,m+=g;m>0;l=256*l+s[e+w],w+=E,m-=8);for(f=l&(1<<-m)-1,l>>=-m,m+=o;m>0;f=256*f+s[e+w],w+=E,m-=8);if(l===0)l=1-M;else{if(l===b)return f?NaN:1/0*(v?-1:1);f+=Math.pow(2,o),l-=M}return(v?-1:1)*f*Math.pow(2,l-o)},_0.write=function(s,e,i,o,h,l){var f,g,b,M=8*l-h-1,m=(1<<M)-1,w=m>>1,E=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=o?0:l-1,T=o?1:-1,I=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=m):(f=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-f))<1&&(f--,b*=2),(e+=f+w>=1?E/b:E*Math.pow(2,1-w))*b>=2&&(f++,b/=2),f+w>=m?(g=0,f=m):f+w>=1?(g=(e*b-1)*Math.pow(2,h),f+=w):(g=e*Math.pow(2,w-1)*Math.pow(2,h),f=0));h>=8;s[i+v]=255&g,v+=T,g/=256,h-=8);for(f=f<<h|g,M+=h;M>0;s[i+v]=255&f,v+=T,f/=256,M-=8);s[i+v-T]|=128*I}),_0}function wb(){if(bb)return m0;bb=1,m0=e;var s=gI();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function f(N,G,H){return H?4294967296*G+(N>>>0):4294967296*(G>>>0)+(N>>>0)}function g(N,G,H){var K=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));H.realloc(K);for(var se=H.pos-1;se>=N;se--)H.buf[se+K]=H.buf[se]}function b(N,G){for(var H=0;H<N.length;H++)G.writeVarint(N[H])}function M(N,G){for(var H=0;H<N.length;H++)G.writeSVarint(N[H])}function m(N,G){for(var H=0;H<N.length;H++)G.writeFloat(N[H])}function w(N,G){for(var H=0;H<N.length;H++)G.writeDouble(N[H])}function E(N,G){for(var H=0;H<N.length;H++)G.writeBoolean(N[H])}function v(N,G){for(var H=0;H<N.length;H++)G.writeFixed32(N[H])}function T(N,G){for(var H=0;H<N.length;H++)G.writeSFixed32(N[H])}function I(N,G){for(var H=0;H<N.length;H++)G.writeFixed64(N[H])}function z(N,G){for(var H=0;H<N.length;H++)G.writeSFixed64(N[H])}function O(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+16777216*N[G+3]}function V(N,G,H){N[H]=G,N[H+1]=G>>>8,N[H+2]=G>>>16,N[H+3]=G>>>24}function j(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+(N[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,G,H){for(H=H||this.length;this.pos<H;){var K=this.readVarint(),se=K>>3,re=this.pos;this.type=7&K,N(se,G,this),this.pos===re&&this.skip(K)}return G},readMessage:function(N,G){return this.readFields(N,G,this.readVarint()+this.pos)},readFixed32:function(){var N=O(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=j(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=O(this.buf,this.pos)+O(this.buf,this.pos+4)*i;return this.pos+=8,N},readSFixed64:function(){var N=O(this.buf,this.pos)+j(this.buf,this.pos+4)*i;return this.pos+=8,N},readFloat:function(){var N=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var G,H,K=this.buf;return G=127&(H=K[this.pos++]),H<128?G:(G|=(127&(H=K[this.pos++]))<<7,H<128?G:(G|=(127&(H=K[this.pos++]))<<14,H<128?G:(G|=(127&(H=K[this.pos++]))<<21,H<128?G:function(se,re,ie){var _e,oe,ye=ie.buf;if(_e=(112&(oe=ye[ie.pos++]))>>4,oe<128||(_e|=(127&(oe=ye[ie.pos++]))<<3,oe<128)||(_e|=(127&(oe=ye[ie.pos++]))<<10,oe<128)||(_e|=(127&(oe=ye[ie.pos++]))<<17,oe<128)||(_e|=(127&(oe=ye[ie.pos++]))<<24,oe<128)||(_e|=(1&(oe=ye[ie.pos++]))<<31,oe<128))return f(se,_e,re);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&(H=K[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,G=this.pos;return this.pos=N,N-G>=12&&h?function(H,K,se){return h.decode(H.subarray(K,se))}(this.buf,G,N):function(H,K,se){for(var re="",ie=K;ie<se;){var _e,oe,ye,be=H[ie],ve=null,Ee=be>239?4:be>223?3:be>191?2:1;if(ie+Ee>se)break;Ee===1?be<128&&(ve=be):Ee===2?(192&(_e=H[ie+1]))==128&&(ve=(31&be)<<6|63&_e)<=127&&(ve=null):Ee===3?(oe=H[ie+2],(192&(_e=H[ie+1]))==128&&(192&oe)==128&&((ve=(15&be)<<12|(63&_e)<<6|63&oe)<=2047||ve>=55296&&ve<=57343)&&(ve=null)):Ee===4&&(oe=H[ie+2],ye=H[ie+3],(192&(_e=H[ie+1]))==128&&(192&oe)==128&&(192&ye)==128&&((ve=(15&be)<<18|(63&_e)<<12|(63&oe)<<6|63&ye)<=65535||ve>=1114112)&&(ve=null)),ve===null?(ve=65533,Ee=1):ve>65535&&(ve-=65536,re+=String.fromCharCode(ve>>>10&1023|55296),ve=56320|1023&ve),re+=String.fromCharCode(ve),ie+=Ee}return re}(this.buf,G,N)},readBytes:function(){var N=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,N);return this.pos=N,G},readPackedVarint:function(N,G){if(this.type!==e.Bytes)return N.push(this.readVarint(G));var H=l(this);for(N=N||[];this.pos<H;)N.push(this.readVarint(G));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var G=l(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed64());return N},skip:function(N){var G=7&N;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(N,G){this.writeVarint(N<<3|G)},realloc:function(N){for(var G=this.length||16;G<this.pos+N;)G*=2;if(G!==this.length){var H=new Uint8Array(G);H.set(this.buf),this.buf=H,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),V(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),V(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),V(this.buf,-1&N,this.pos),V(this.buf,Math.floor(N*o),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),V(this.buf,-1&N,this.pos),V(this.buf,Math.floor(N*o),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(G,H){var K,se;if(G>=0?(K=G%4294967296|0,se=G/4294967296|0):(se=~(-G/4294967296),4294967295^(K=~(-G%4294967296))?K=K+1|0:(K=0,se=se+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),function(re,ie,_e){_e.buf[_e.pos++]=127&re|128,re>>>=7,_e.buf[_e.pos++]=127&re|128,re>>>=7,_e.buf[_e.pos++]=127&re|128,re>>>=7,_e.buf[_e.pos++]=127&re|128,_e.buf[_e.pos]=127&(re>>>=7)}(K,0,H),function(re,ie){var _e=(7&re)<<4;ie.buf[ie.pos++]|=_e|((re>>>=3)?128:0),re&&(ie.buf[ie.pos++]=127&re|((re>>>=7)?128:0),re&&(ie.buf[ie.pos++]=127&re|((re>>>=7)?128:0),re&&(ie.buf[ie.pos++]=127&re|((re>>>=7)?128:0),re&&(ie.buf[ie.pos++]=127&re|((re>>>=7)?128:0),re&&(ie.buf[ie.pos++]=127&re)))))}(se,H)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var G=this.pos;this.pos=function(K,se,re){for(var ie,_e,oe=0;oe<se.length;oe++){if((ie=se.charCodeAt(oe))>55295&&ie<57344){if(!_e){ie>56319||oe+1===se.length?(K[re++]=239,K[re++]=191,K[re++]=189):_e=ie;continue}if(ie<56320){K[re++]=239,K[re++]=191,K[re++]=189,_e=ie;continue}ie=_e-55296<<10|ie-56320|65536,_e=null}else _e&&(K[re++]=239,K[re++]=191,K[re++]=189,_e=null);ie<128?K[re++]=ie:(ie<2048?K[re++]=ie>>6|192:(ie<65536?K[re++]=ie>>12|224:(K[re++]=ie>>18|240,K[re++]=ie>>12&63|128),K[re++]=ie>>6&63|128),K[re++]=63&ie|128)}return re}(this.buf,N,this.pos);var H=this.pos-G;H>=128&&g(G,H,this),this.pos=G-1,this.writeVarint(H),this.pos+=H},writeFloat:function(N){this.realloc(4),s.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),s.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var G=N.length;this.writeVarint(G),this.realloc(G);for(var H=0;H<G;H++)this.buf[this.pos++]=N[H]},writeRawMessage:function(N,G){this.pos++;var H=this.pos;N(G,this);var K=this.pos-H;K>=128&&g(H,K,this),this.pos=H-1,this.writeVarint(K),this.pos+=K},writeMessage:function(N,G,H){this.writeTag(N,e.Bytes),this.writeRawMessage(G,H)},writePackedVarint:function(N,G){G.length&&this.writeMessage(N,b,G)},writePackedSVarint:function(N,G){G.length&&this.writeMessage(N,M,G)},writePackedBoolean:function(N,G){G.length&&this.writeMessage(N,E,G)},writePackedFloat:function(N,G){G.length&&this.writeMessage(N,m,G)},writePackedDouble:function(N,G){G.length&&this.writeMessage(N,w,G)},writePackedFixed32:function(N,G){G.length&&this.writeMessage(N,v,G)},writePackedSFixed32:function(N,G){G.length&&this.writeMessage(N,T,G)},writePackedFixed64:function(N,G){G.length&&this.writeMessage(N,I,G)},writePackedSFixed64:function(N,G){G.length&&this.writeMessage(N,z,G)},writeBytesField:function(N,G){this.writeTag(N,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeVarint(G)},writeSVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeSVarint(G)},writeStringField:function(N,G){this.writeTag(N,e.Bytes),this.writeString(G)},writeFloatField:function(N,G){this.writeTag(N,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(N,G){this.writeTag(N,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(N,G){this.writeVarintField(N,!!G)}},m0}var n_=W(wb());const g0=3;function yI(s,e,i){e.glyphs=[],s===1&&i.readMessage(xI,e)}function xI(s,e,i){if(s===3){const{id:o,bitmap:h,width:l,height:f,left:g,top:b,advance:M}=i.readMessage(vI,{});e.glyphs.push({id:o,bitmap:new Pl({width:l+2*g0,height:f+2*g0},h),metrics:{width:l,height:f,left:g,top:b,advance:M}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function vI(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const Tb=g0,js={horizontal:1,vertical:2,horizontalOnly:3};class Uf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new Uf;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Uf;return i.image=e,i}}class Eh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new Eh;for(let h=0;h<e.sections.length;h++){const l=e.sections[h];l.image?o.addImageSection(l):o.addTextSection(l,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let h="";for(let l=0;l<i.length;l++){const f=i.charCodeAt(l+1)||null,g=i.charCodeAt(l-1)||null;h+=!o&&(f&&ef(f)&&!Vf[i[l+1]]||g&&ef(g)&&!Vf[i[l-1]])||!Vf[i[l]]?i[l]:Vf[i[l]]}return h}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&r_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&r_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Eh;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Uf.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(o)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void _i("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Uf.forImage(i)),this.sectionIndex.push(this.sections.length-1)):_i("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function y0(s,e,i,o,h,l,f,g,b,M,m,w,E,v,T){const I=Eh.fromFeature(s,h);w===js.vertical&&I.verticalizePunctuation(E);let z=[];const O=function(H,K,se,re,ie,_e){if(!H)return[];const oe=[],ye=function(Ie,De,Ae,Ye,rt,Xe){let It=0;for(let Et=0;Et<Ie.length();Et++){const pt=Ie.getSection(Et);It+=Sb(Ie.getCodePoint(Et),pt,Ye,rt,De,Xe)}return It/Math.max(1,Math.ceil(It/Ae))}(H,K,se,re,ie,_e),be=H.text.indexOf("​")>=0;let ve=0;for(let Ie=0;Ie<H.length();Ie++){const De=H.getSection(Ie),Ae=H.getCodePoint(Ie);if(r_[Ae]||(ve+=Sb(Ae,De,re,ie,K,_e)),Ie<H.length()-1){const Ye=!((Ee=Ae)<11904||!(qt["Bopomofo Extended"](Ee)||qt.Bopomofo(Ee)||qt["CJK Compatibility Forms"](Ee)||qt["CJK Compatibility Ideographs"](Ee)||qt["CJK Compatibility"](Ee)||qt["CJK Radicals Supplement"](Ee)||qt["CJK Strokes"](Ee)||qt["CJK Symbols and Punctuation"](Ee)||qt["CJK Unified Ideographs Extension A"](Ee)||qt["CJK Unified Ideographs"](Ee)||qt["Enclosed CJK Letters and Months"](Ee)||qt["Halfwidth and Fullwidth Forms"](Ee)||qt.Hiragana(Ee)||qt["Ideographic Description Characters"](Ee)||qt["Kangxi Radicals"](Ee)||qt["Katakana Phonetic Extensions"](Ee)||qt.Katakana(Ee)||qt["Vertical Forms"](Ee)||qt["Yi Radicals"](Ee)||qt["Yi Syllables"](Ee)));(bI[Ae]||Ye||De.image)&&oe.push(Mb(Ie+1,ve,ye,oe,wI(Ae,H.getCodePoint(Ie+1),Ye&&be),!1))}}var Ee;return Ab(Mb(H.length(),ve,ye,oe,0,!0))}(I,M,l,e,o,v),{processBidirectionalText:V,processStyledBidirectionalText:j}=cs;if(V&&I.sections.length===1){const H=V(I.toString(),O);for(const K of H){const se=new Eh;se.text=K,se.sections=I.sections;for(let re=0;re<K.length;re++)se.sectionIndex.push(0);z.push(se)}}else if(j){const H=j(I.text,I.sectionIndex,O);for(const K of H){const se=new Eh;se.text=K[0],se.sectionIndex=K[1],se.sections=I.sections,z.push(se)}}else z=function(H,K){const se=[],re=H.text;let ie=0;for(const _e of K)se.push(H.substring(ie,_e)),ie=_e;return ie<re.length&&se.push(H.substring(ie,re.length)),se}(I,O);const N=[],G={positionedLines:N,text:I.toString(),top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(H,K,se,re,ie,_e,oe,ye,be,ve,Ee,Ie){let De=0,Ae=0,Ye=0;const rt=ye==="right"?1:ye==="left"?0:.5;let Xe=!1;for(const Ct of ie){const Lt=Ct.getSections();for(const ai of Lt){if(ai.image)continue;const gi=K[ai.fontStack];if(gi&&(Xe=gi.ascender!==void 0&&gi.descender!==void 0,!Xe))break}if(!Xe)break}let It=0;for(const Ct of ie){Ct.trim();const Lt=Ct.getMaxScale(),ai=(Lt-1)*Pr,gi={positionedGlyphs:[],lineOffset:0};H.positionedLines[It]=gi;const yi=gi.positionedGlyphs;let xi=0;if(!Ct.length()){Ae+=_e,++It;continue}let Ai=0,Ii=0;for(let nn=0;nn<Ct.length();nn++){const fi=Ct.getSection(nn),Yi=Ct.getSectionIndex(nn),Ji=Ct.getCodePoint(nn);let mn=fi.scale,On=null,Hn=null,kn=null,In=Pr,Nn=0;const Yn=!(be===js.horizontal||!Ee&&!ih(Ji)||Ee&&(r_[Ji]||(Et=Ji,qt.Arabic(Et)||qt["Arabic Supplement"](Et)||qt["Arabic Extended-A"](Et)||qt["Arabic Presentation Forms-A"](Et)||qt["Arabic Presentation Forms-B"](Et))));if(fi.image){const Rr=re[fi.image.serialize()];if(!Rr)continue;kn=fi.image.id,H.iconsInText=H.iconsInText||!0,Hn=Rr.paddedRect;const fn=Rr.displaySize;mn=mn*Pr/Ie,On={width:fn[0],height:fn[1],left:0,top:-Tb,advance:Yn?fn[1]:fn[0],localGlyph:!1},Nn=Xe?-On.height*mn:Lt*Pr-17-fn[1]*mn,In=On.advance;const ps=(Yn?fn[0]:fn[1])*mn-Pr*Lt;ps>0&&ps>xi&&(xi=ps)}else{const Rr=se[fi.fontStack];if(!Rr)continue;Rr[Ji]&&(Hn=Rr[Ji]);const fn=K[fi.fontStack];if(!fn)continue;const ps=fn.glyphs[Ji];if(!ps)continue;if(On=ps.metrics,In=Ji!==8203?Pr:0,Xe){const Go=fn.ascender!==void 0?Math.abs(fn.ascender):0,_o=fn.descender!==void 0?Math.abs(fn.descender):0,go=(Go+_o)*mn;Ai<go&&(Ai=go,Ii=(Go-_o)/2*mn),Nn=-Go*mn}else Nn=(Lt-mn)*Pr-17}Yn?(H.verticalizable=!0,yi.push({glyph:Ji,imageName:kn,x:De,y:Ae+Nn,vertical:Yn,scale:mn,localGlyph:On.localGlyph,fontStack:fi.fontStack,sectionIndex:Yi,metrics:On,rect:Hn}),De+=In*mn+ve):(yi.push({glyph:Ji,imageName:kn,x:De,y:Ae+Nn,vertical:Yn,scale:mn,localGlyph:On.localGlyph,fontStack:fi.fontStack,sectionIndex:Yi,metrics:On,rect:Hn}),De+=On.advance*mn+ve)}yi.length!==0&&(Ye=Math.max(De-ve,Ye),Xe?Ib(yi,rt,xi,Ii,_e*Lt/2):Ib(yi,rt,xi,0,_e/2)),De=0;const an=_e*Lt+xi;gi.lineOffset=Math.max(xi,ai),Ae+=an,++It}var Et;const pt=Ae,{horizontalAlign:ot,verticalAlign:jt}=x0(oe);(function(Ct,Lt,ai,gi,yi,xi){const Ai=(Lt-ai)*yi,Ii=-xi*gi;for(const an of Ct)for(const nn of an.positionedGlyphs)nn.x+=Ai,nn.y+=Ii})(H.positionedLines,rt,ot,jt,Ye,pt),H.top+=-jt*pt,H.bottom=H.top+pt,H.left+=-ot*Ye,H.right=H.left+Ye,H.hasBaseline=Xe}(G,e,i,o,z,f,g,b,w,M,E,T),!function(H){for(const K of H)if(K.positionedGlyphs.length!==0)return!1;return!0}(N)&&G}const r_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sb(s,e,i,o,h,l){if(e.image){const f=o[e.image.serialize()];return f?f.displaySize[0]*e.scale*Pr/l+h:0}{const f=i[e.fontStack],g=f&&f.glyphs[s];return g?g.metrics.advance*e.scale+h:0}}function Eb(s,e,i,o){const h=Math.pow(s-e,2);return o?s<e?h/2:2*h:h+Math.abs(i)*i}function wI(s,e,i){let o=0;return s===10&&(o-=1e4),i&&(o+=150),s!==40&&s!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Mb(s,e,i,o,h,l){let f=null,g=Eb(e,i,h,l);for(const b of o){const M=Eb(e-b.x,i,h,l)+b.badness;M<=g&&(f=b,g=M)}return{index:s,x:e,priorBreak:f,badness:g}}function Ab(s){return s?Ab(s.priorBreak).concat(s.index):[]}function x0(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Ib(s,e,i,o,h){if(!(e||i||o||h))return;const l=s.length-1,f=s[l],g=(f.x+f.metrics.advance*f.scale)*e;for(let b=0;b<=l;b++)s[b].x-=g,s[b].y+=i+o+h}function TI(s,e,i,o){const{horizontalAlign:h,verticalAlign:l}=x0(o),f=i[0]-s.displaySize[0]*h,g=i[1]-s.displaySize[1]*l;return{imagePrimary:s,imageSecondary:e,top:g,bottom:g+s.displaySize[1],left:f,right:f+s.displaySize[0]}}function Cb(s,e,i,o,h,l){const f=s.imagePrimary;let g;if(f.content){const z=f.content,O=f.pixelRatio||1;g=[z[0]/O,z[1]/O,f.displaySize[0]-z[2]/O,f.displaySize[1]-z[3]/O]}const b=e.left*l,M=e.right*l;let m,w,E,v;i==="width"||i==="both"?(v=h[0]+b-o[3],w=h[0]+M+o[1]):(v=h[0]+(b+M-f.displaySize[0])/2,w=v+f.displaySize[0]);const T=e.top*l,I=e.bottom*l;return i==="height"||i==="both"?(m=h[1]+T-o[0],E=h[1]+I+o[2]):(m=h[1]+(T+I-f.displaySize[1])/2,E=m+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:m,right:w,bottom:E,left:v,collisionPadding:g}}class Ua extends ge{constructor(e,i,o,h,l){super(e,i),this.angle=h,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new Ua(this.x,this.y,this.z,this.angle,this.segment)}}function Pb(s,e,i,o,h){if(e.segment===void 0)return!0;let l=e,f=e.segment+1,g=0;for(;g>-i/2;){if(f--,f<0)return!1;g-=s[f].dist(l),l=s[f]}g+=s[f].dist(s[f+1]),f++;const b=[];let M=0;for(;g<i/2;){const m=s[f],w=s[f+1];if(!w)return!1;let E=s[f-1].angleTo(m)-m.angleTo(w);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:E}),M+=E;g-b[0].distance>o;)M-=b.shift().angleDelta;if(M>h)return!1;f++,g+=m.dist(w)}return!0}function Rb(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function Db(s,e,i){return s?.6*e*i:0}function zb(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function SI(s,e,i,o,h,l){const f=Db(i,h,l),g=zb(i,o)*l;let b=0;const M=Rb(s)/2;for(let m=0;m<s.length-1;m++){const w=s[m],E=s[m+1],v=w.dist(E);if(b+v>M){const T=(M-b)/v,I=ni(w.x,E.x,T),z=ni(w.y,E.y,T),O=new Ua(I,z,0,E.angleTo(w),m);return!f||Pb(s,O,g,f,e)?O:void 0}b+=v}}function EI(s,e,i,o,h,l,f,g,b){const M=Db(o,l,f),m=zb(o,h),w=m*f,E=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-w<e/4&&(e=w+e/4),Lb(s,E?e/2*g%e:(m/2+2*l)*f*g%e,e,M,i,w,E,!1,b)}function Lb(s,e,i,o,h,l,f,g,b){const M=l/2,m=Rb(s);let w=0,E=e-i,v=[];for(let T=0;T<s.length-1;T++){const I=s[T],z=s[T+1],O=I.dist(z),V=z.angleTo(I);for(;E+i<w+O;){E+=i;const j=(E-w)/O,N=ni(I.x,z.x,j),G=ni(I.y,z.y,j);if(N>=0&&N<b&&G>=0&&G<b&&E-M>=0&&E+M<=m){const H=new Ua(N,G,0,V,T);o&&!Pb(s,H,l,o,h)||v.push(H)}}w+=O}return g||v.length||f||(v=Lb(s,w/2,i,o,h,l,f,!0,b)),v}function Ob(s,e,i,o,h){const l=[];for(let f=0;f<s.length;f++){const g=s[f];let b;for(let M=0;M<g.length-1;M++){let m=g[M],w=g[M+1];m.x<e&&w.x<e||(m.x<e?m=new ge(e,m.y+(e-m.x)/(w.x-m.x)*(w.y-m.y))._round():w.x<e&&(w=new ge(e,m.y+(e-m.x)/(w.x-m.x)*(w.y-m.y))._round()),m.y<i&&w.y<i||(m.y<i?m=new ge(m.x+(i-m.y)/(w.y-m.y)*(w.x-m.x),i)._round():w.y<i&&(w=new ge(m.x+(i-m.y)/(w.y-m.y)*(w.x-m.x),i)._round()),m.x>=o&&w.x>=o||(m.x>=o?m=new ge(o,m.y+(o-m.x)/(w.x-m.x)*(w.y-m.y))._round():w.x>=o&&(w=new ge(o,m.y+(o-m.x)/(w.x-m.x)*(w.y-m.y))._round()),m.y>=h&&w.y>=h||(m.y>=h?m=new ge(m.x+(h-m.y)/(w.y-m.y)*(w.x-m.x),h)._round():w.y>=h&&(w=new ge(m.x+(h-m.y)/(w.y-m.y)*(w.x-m.x),h)._round()),b&&m.equals(b[b.length-1])||(b=[m],l.push(b)),b.push(w)))))}}return l}function kb(s){let e=0,i=0;for(const f of s)e+=f.w*f.h,i=Math.max(i,f.w);s.sort((f,g)=>g.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,l=0;for(const f of s)for(let g=o.length-1;g>=0;g--){const b=o[g];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,l=Math.max(l,f.y+f.h),h=Math.max(h,f.x+f.w),f.w===b.w&&f.h===b.h){const M=o.pop();g<o.length&&(o[g]=M)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(o.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:h,h:l,fill:e/(h*l)||0}}Nt(Ua,"Anchor");const jf=1;class Gf{static getImagePositionScale(e,i,o){return i&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:o,y:o}}constructor(e,{pixelRatio:i,version:o,stretchX:h,stretchY:l,content:f,sdf:g,usvg:b},M,m){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=l,this.content=f,this.version=o,this.padding=M,this.sdf=g,this.scale=Gf.getImagePositionScale(m,b,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class Fb{constructor(e,i,o){const h={},l={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,h,jf,f),this.addImages(i,l,2,f);const{w:g,h:b}=kb(f),M=new br({width:g||1,height:b||1});for(const m in e){const w=e[m],E=h[m].paddedRect;br.copy(w.data,M,{x:0,y:0},{x:E.x+jf,y:E.y+jf},w.data,o,w.sdf)}for(const m in i){const w=i[m],E=l[m].paddedRect;let v=l[m].padding;const T=E.x+v,I=E.y+v,z=w.data.width,O=w.data.height;v=v>1?v-1:v,br.copy(w.data,M,{x:0,y:0},{x:T,y:I},w.data,o),br.copy(w.data,M,{x:0,y:O-v},{x:T,y:I-v},{width:z,height:v},o),br.copy(w.data,M,{x:0,y:0},{x:T,y:I+O},{width:z,height:v},o),br.copy(w.data,M,{x:z-v,y:0},{x:T-v,y:I},{width:v,height:O},o),br.copy(w.data,M,{x:0,y:0},{x:T+z,y:I},{width:v,height:O},o),br.copy(w.data,M,{x:z-v,y:O-v},{x:T-v,y:I-v},{width:v,height:v},o),br.copy(w.data,M,{x:0,y:O-v},{x:T+z,y:I-v},{width:v,height:v},o),br.copy(w.data,M,{x:0,y:0},{x:T+z,y:I+O},{width:v,height:v},o),br.copy(w.data,M,{x:z-v,y:0},{x:T-v,y:I+O},{width:v,height:v},o)}this.lut=o,this.image=M,this.iconPositions=h,this.patternPositions=l}addImages(e,i,o,h){for(const l in e){const f=e[l],g={x:0,y:0,w:f.data.width+2*o,h:f.data.height+2*o};h.push(g);const b=so.deserializeFromString(l);i[l]=new Gf(g,f,o,b),f.hasRenderCallback&&this.haveRenderCallbacks.push(b.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const h in e.getUpdatedImages(o)){for(const l of Object.keys(this.iconPositions))so.deserializeId(l)===h&&this.patchUpdatedImage(this.iconPositions[l],e.getImage(h,o),i);for(const l of Object.keys(this.patternPositions))so.deserializeId(l)===h&&this.patchUpdatedImage(this.patternPositions[l],e.getImage(h,o),i)}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,l]=e.tl,f=e.sdf;if(this.lut||f){const g={width:i.data.width,height:i.data.height},b=new br(g);br.copy(i.data,b,{x:0,y:0},{x:0,y:0},g,this.lut,f),o.update(b,{position:{x:h,y:l}})}else o.update(i.data,{position:{x:h,y:l}})}}Nt(Gf,"ImagePosition"),Nt(Fb,"ImageAtlas");const qf=1e20;function Bb(s,e,i,o,h,l,f,g,b){for(let M=e;M<e+o;M++)Nb(s,i*l+M,l,h,f,g,b);for(let M=i;M<i+h;M++)Nb(s,M*l+e,1,o,f,g,b)}function Nb(s,e,i,o,h,l,f){l[0]=0,f[0]=-qf,f[1]=qf,h[0]=s[e];for(let g=1,b=0,M=0;g<o;g++){h[g]=s[e+g*i];const m=g*g;do{const w=l[b];M=(h[g]-h[w]+m-w*w)/(g-w)/2}while(M<=f[b]&&--b>-1);b++,l[b]=g,f[b]=M,f[b+1]=qf}for(let g=0,b=0;g<o;g++){for(;f[b+1]<g;)b++;const M=l[b],m=g-M;s[e+g*i]=h[M]+m*m}}const No=2,v0={none:0,ideographs:1,all:2};class Mh{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const h=[],l=this.urls[i]||Wn.GLYPHS_URL;for(const f in e)for(const g of e[f])h.push({stack:f,id:g});Gi(h,({stack:f,id:g},b)=>{let M=this.entries[f];M||(M=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=M.glyphs[g];if(m!==void 0)return void b(null,{stack:f,id:g,glyph:m});if(m=this._tinySDF(M,f,g),m)return M.glyphs[g]=m,void b(null,{stack:f,id:g,glyph:m});const w=Math.floor(g/256);if(256*w>65535)return _i("glyphs > 65535 not supported"),void b(null,{stack:f,id:g,glyph:m});if(M.ranges[w])return void b(null,{stack:f,id:g,glyph:m});let E=M.requests[w];E||(E=M.requests[w]=[],Mh.loadGlyphRange(f,w,l,this.requestManager,(v,T)=>{if(T){M.ascender=T.ascender,M.descender=T.descender;for(const I in T.glyphs)this._doesCharSupportLocalGlyph(+I)||(M.glyphs[+I]=T.glyphs[+I]);M.ranges[w]=!0}for(const I of E)I(v,T);delete M.requests[w]})),E.push((v,T)=>{v?b(v):T&&b(null,{stack:f,id:g,glyph:T.glyphs[g]||null})})},(f,g)=>{if(f)o(f);else if(g){const b={};for(const{stack:M,id:m,glyph:w}of g)b[M]===void 0&&(b[M]={}),b[M].glyphs===void 0&&(b[M].glyphs={}),b[M].glyphs[m]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},b[M].ascender=this.entries[M].ascender,b[M].descender=this.entries[M].descender;o(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==v0.none&&(this.localGlyphMode===v0.all?!!this.localFontFamily:!!this.localFontFamily&&(qt["CJK Unified Ideographs"](e)||qt["Hangul Syllables"](e)||qt.Hiragana(e)||qt.Katakana(e)||qt["CJK Symbols and Punctuation"](e)||qt["CJK Unified Ideographs Extension A"](e)||qt["CJK Unified Ideographs Extension B"](e)||qt.Osage(e)))}_tinySDF(e,i,o){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let I="400";/bold/i.test(i)?I="900":/medium/i.test(i)?I="500":/light/i.test(i)&&(I="200"),l=e.tinySDF=new Mh.TinySDF({fontFamily:h,fontWeight:I,fontSize:24*No,buffer:3*No,radius:8*No}),l.fontWeight=I}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];const f=String.fromCodePoint(o),{data:g,width:b,height:M,glyphWidth:m,glyphHeight:w,glyphLeft:E,glyphTop:v,glyphAdvance:T}=l.draw(f);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new Pl({width:b,height:M},g),metrics:{width:m/No,height:w/No,left:E/No,top:v/No-27,advance:T/No,localGlyph:!0}}}}Mh.loadGlyphRange=function(s,e,i,o,h){const l=256*e,f=l+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${l}-${f}`),Ui.Glyphs);er(g,(b,M)=>{if(b)h(b);else if(M){const m={},w=function(E){return new n_(E).readFields(yI,{})}(M);for(const E of w.glyphs)m[E.id]=E;h(null,{glyphs:m,ascender:w.ascender,descender:w.descender})}})},Mh.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:h="sans-serif",fontWeight:l="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const g=this.size=s+4*e,b=this._createCanvas(g),M=this.ctx=b.getContext("2d",{willReadFrequently:!0});M.font=`${f} ${l} ${s}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:h,actualBoundingBoxRight:l}=this.ctx.measureText(s),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-h))),b=Math.min(this.size-this.buffer,f+Math.ceil(o)),M=g+2*this.buffer,m=b+2*this.buffer,w=Math.max(M*m,0),E=new Uint8ClampedArray(w),v={data:E,width:M,height:m,glyphWidth:g,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||b===0)return v;const{ctx:T,buffer:I,gridInner:z,gridOuter:O}=this;T.clearRect(I,I,g,b),T.fillText(s,I,I+f);const V=T.getImageData(I,I,g,b);O.fill(qf,0,w),z.fill(0,0,w);for(let j=0;j<b;j++)for(let N=0;N<g;N++){const G=V.data[4*(j*g+N)+3]/255;if(G===0)continue;const H=(j+I)*M+N+I;if(G===1)O[H]=0,z[H]=qf;else{const K=.5-G;O[H]=K>0?K*K:0,z[H]=K<0?K*K:0}}Bb(O,0,0,M,m,M,this.f,this.v,this.z),Bb(z,I,I,g,b,M,this.f,this.v,this.z);for(let j=0;j<w;j++){const N=Math.sqrt(O[j])-Math.sqrt(z[j]);E[j]=Math.round(255-255*(N/this.radius+this.cutoff))}return v}};const Dl=jf;function Vb(s,e){return s+e[1]-e[0]}function Ub(s,e,i,o,h=1){const l=[],f=s.imagePrimary,g=f.pixelRatio,b=f.paddedRect.w-2*Dl,M=f.paddedRect.h-2*Dl,m=(s.right-s.left)*h,w=(s.bottom-s.top)*h,E=f.stretchX||[[0,b]],v=f.stretchY||[[0,M]],T=E.reduce(Vb,0),I=v.reduce(Vb,0),z=b-T,O=M-I;let V=0,j=T,N=0,G=I,H=0,K=z,se=0,re=O;if(f.content&&o){const _e=f.content;V=s_(E,0,_e[0]),N=s_(v,0,_e[1]),j=s_(E,_e[0],_e[2]),G=s_(v,_e[1],_e[3]),H=_e[0]-V,se=_e[1]-N,K=_e[2]-_e[0]-j,re=_e[3]-_e[1]-G}const ie=(_e,oe,ye,be)=>{const ve=o_(_e.stretch-V,j,m,s.left*h),Ee=a_(_e.fixed-H,K,_e.stretch,T),Ie=o_(oe.stretch-N,G,w,s.top*h),De=a_(oe.fixed-se,re,oe.stretch,I),Ae=o_(ye.stretch-V,j,m,s.left*h),Ye=a_(ye.fixed-H,K,ye.stretch,T),rt=o_(be.stretch-N,G,w,s.top*h),Xe=a_(be.fixed-se,re,be.stretch,I),It=new ge(ve,Ie),Et=new ge(Ae,Ie),pt=new ge(Ae,rt),ot=new ge(ve,rt),jt=new ge(Ee/g,De/g),Ct=new ge(Ye/g,Xe/g),Lt=e*Math.PI/180;if(Lt){const Ii=Math.sin(Lt),an=Math.cos(Lt),nn=[an,-Ii,Ii,an];It._matMult(nn),Et._matMult(nn),ot._matMult(nn),pt._matMult(nn)}const ai=_e.stretch+_e.fixed,gi=ye.stretch+ye.fixed,yi=oe.stretch+oe.fixed,xi=be.stretch+be.fixed,Ai=s.imageSecondary;return{tl:It,tr:Et,bl:ot,br:pt,texPrimary:{x:f.paddedRect.x+Dl+ai,y:f.paddedRect.y+Dl+yi,w:gi-ai,h:xi-yi},texSecondary:Ai?{x:Ai.paddedRect.x+Dl+ai,y:Ai.paddedRect.y+Dl+yi,w:gi-ai,h:xi-yi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jt,pixelOffsetBR:Ct,minFontScaleX:K/g/m,minFontScaleY:re/g/w,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const _e=jb(E,z,T),oe=jb(v,O,I);for(let ye=0;ye<_e.length-1;ye++){const be=_e[ye],ve=_e[ye+1];for(let Ee=0;Ee<oe.length-1;Ee++)l.push(ie(be,oe[Ee],ve,oe[Ee+1]))}}else l.push(ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return l}function s_(s,e,i){let o=0;for(const h of s)o+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return o}function jb(s,e,i){const o=[{fixed:-Dl,stretch:0}];for(const[h,l]of s){const f=o[o.length-1];o.push({fixed:h-f.stretch,stretch:f.stretch}),o.push({fixed:h-f.stretch,stretch:f.stretch+(l-h)})}return o.push({fixed:e+Dl,stretch:i}),o}function o_(s,e,i,o){return s/e*i+o}function a_(s,e,i,o){return s-e*i/o}function MI(s,e,i,o){const h=e+s.positionedLines[o].lineOffset;return o===0?i+h/2:i+(h+(e+s.positionedLines[o-1].lineOffset))/2}function AI(s,e=1,i=!1){let o=1/0,h=1/0,l=-1/0,f=-1/0;const g=s[0];for(let v=0;v<g.length;v++){const T=g[v];(!v||T.x<o)&&(o=T.x),(!v||T.y<h)&&(h=T.y),(!v||T.x>l)&&(l=T.x),(!v||T.y>f)&&(f=T.y)}const b=Math.min(l-o,f-h);let M=b/2;const m=new vr([],II);if(b===0)return new ge(o,h);for(let v=o;v<l;v+=b)for(let T=h;T<f;T+=b)m.push(new Ah(v+M,T+M,M,s));let w=function(v){let T=0,I=0,z=0;const O=v[0];for(let V=0,j=O.length,N=j-1;V<j;N=V++){const G=O[V],H=O[N],K=G.x*H.y-H.x*G.y;I+=(G.x+H.x)*K,z+=(G.y+H.y)*K,T+=3*K}return new Ah(I/T,z/T,0,v)}(s),E=m.length;for(;m.length;){const v=m.pop();(v.d>w.d||!w.d)&&(w=v,i&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,E)),v.max-w.d<=e||(M=v.h/2,m.push(new Ah(v.p.x-M,v.p.y-M,M,s)),m.push(new Ah(v.p.x+M,v.p.y-M,M,s)),m.push(new Ah(v.p.x-M,v.p.y+M,M,s)),m.push(new Ah(v.p.x+M,v.p.y+M,M,s)),E+=4)}return i&&(console.log(`num probes: ${E}`),console.log(`best distance: ${w.d}`)),w.p}function II(s,e){return e.max-s.max}class Ah{constructor(e,i,o,h){this.p=new ge(e,i),this.h=o,this.d=function(l,f){let g=!1,b=1/0;for(let M=0;M<f.length;M++){const m=f[M];for(let w=0,E=m.length,v=E-1;w<E;v=w++){const T=m[w],I=m[v];T.y>l.y!=I.y>l.y&&l.x<(I.x-T.x)*(l.y-T.y)/(I.y-T.y)+T.x&&(g=!g),b=Math.min(b,he(l,T,I))}}return(g?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const b0=Number.POSITIVE_INFINITY,CI=Math.sqrt(2);function Gb(s,[e,i]){let o=0,h=0;if(i===b0){e<0&&(e=0);const l=e/CI;switch(s){case"top-right":case"top-left":h=l-7;break;case"bottom-right":case"bottom-left":h=7-l;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(s){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(s){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,h]}function w0(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function PI(s,e,i,o,h,l,f,g,b,M,m,w,E,v,T){let I=l.textMaxSize.evaluate(e,{},w);I===void 0?I=f*l.textScaleFactor:I*=l.textScaleFactor;const z=s.layers[0].layout,O=z.get("icon-offset").evaluate(e,{},w),V=Hb(i.horizontal)||i.vertical,j=E.name==="globe",N=Pr,G=f*l.textScaleFactor/N,H=s.tilePixelRatio*I/N,K=(ve=s.overscaling,s.zoom>18&&ve>2&&(ve>>=1),Math.max(At/(512*ve),1)*z.get("symbol-spacing")),se=z.get("text-padding")*s.tilePixelRatio,re=z.get("icon-padding")*s.tilePixelRatio,ie=mt(z.get("text-max-angle")),_e=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",oe=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",ye=z.get("symbol-placement"),be=K/2;var ve;const Ee=z.get("icon-text-fit").evaluate(e,{},w),Ie=z.get("icon-text-fit-padding").evaluate(e,{},w),De=Ee!=="none";let Ae;s.hasAnyIconTextFit===!1&&De&&(s.hasAnyIconTextFit=!0),o&&De&&(s.allowVerticalPlacement&&i.vertical&&(Ae=Cb(o,i.vertical,Ee,Ie,O,G)),V&&(o=Cb(o,V,Ee,Ie,O,G)));const Ye=(rt,Xe,It)=>{if(Xe.x<0||Xe.x>=At||Xe.y<0||Xe.y>=At)return;let Et=null;if(j){const{x:pt,y:ot,z:jt}=E.projectTilePoint(Xe.x,Xe.y,It);Et={anchor:new Ua(pt,ot,jt,0,void 0),up:E.upVector(It,Xe.x,Xe.y)}}(function(pt,ot,jt,Ct,Lt,ai,gi,yi,xi,Ai,Ii,an,nn,fi,Yi,Ji,mn,On,Hn,kn,In,Nn,Yn,Rr,fn,ps,Go){const _o=pt.addToLineVertexArray(ot,Ct);let go,nu,Fl,ru,cp,ET,MT,AT=0,IT=0,CT=0,PT=0,nx=-1,rx=-1;const ha={};let RT=Fs("");const su=jt?jt.anchor:ot,sx=xi.layout.get("icon-text-fit").evaluate(In,{},fn)!=="none";let ox=0,ax=0;if(xi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ox,ax]=xi.layout.get("text-offset").evaluate(In,{},fn).map(qs=>qs*Pr):(ox=xi.layout.get("text-radial-offset").evaluate(In,{},fn)*Pr,ax=b0),pt.allowVerticalPlacement&&Lt.vertical){const qs=Lt.vertical;if(Yi)ET=T0(qs),yi&&(MT=T0(yi));else{const ms=xi.layout.get("text-rotate").evaluate(In,{},fn)+90;Fl=l_(Ai,su,ot,Ii,an,nn,qs,fi,ms,Ji),yi&&(ru=l_(Ai,su,ot,Ii,an,nn,yi,On,ms))}}if(ai){const qs=pt.iconSizeData,ms=xi.layout.get("icon-rotate").evaluate(In,{},fn),up=Ub(ai,ms,Yn,sx,Nn.iconScaleFactor),cx=yi?Ub(yi,ms,Yn,sx,Nn.iconScaleFactor):void 0;nu=l_(Ai,su,ot,Ii,an,nn,ai,On,ms,null),AT=4*up.length;let ou=null;qs.kind==="source"?(ou=[Bo*xi.layout.get("icon-size").evaluate(In,{},fn)*Nn.iconScaleFactor],ou[0]>zl&&_i(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Hf}. Reduce your "icon-size".`)):qs.kind==="composite"&&(ou=[Bo*Nn.compositeIconSizes[0].evaluate(In,{},fn)*Nn.iconScaleFactor,Bo*Nn.compositeIconSizes[1].evaluate(In,{},fn)*Nn.iconScaleFactor],(ou[0]>zl||ou[1]>zl)&&_i(`${pt.layerIds[0]}: Value for "icon-size" is >= ${Hf}. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,up,ou,kn,Hn,In,!1,jt,ot,_o.lineStartIndex,_o.lineLength,-1,Rr,fn,ps,Go),nx=pt.icon.placedSymbolArray.length-1,cx&&(IT=4*cx.length,pt.addSymbols(pt.icon,cx,ou,kn,Hn,In,js.vertical,jt,ot,_o.lineStartIndex,_o.lineLength,-1,Rr,fn,ps,Go),rx=pt.icon.placedSymbolArray.length-1)}for(const qs in Lt.horizontal){const ms=Lt.horizontal[qs];go||(RT=Fs(ms.text),Yi?cp=T0(ms):go=l_(Ai,su,ot,Ii,an,nn,ms,fi,xi.layout.get("text-rotate").evaluate(In,{},fn),Ji));const up=ms.positionedLines.length===1;if(CT+=qb(pt,jt,ot,ms,gi,xi,Yi,In,Ji,_o,Lt.vertical?js.horizontal:js.horizontalOnly,up?Object.keys(Lt.horizontal):[qs],ha,nx,Nn,Rr,fn,ps),up)break}Lt.vertical&&(PT+=qb(pt,jt,ot,Lt.vertical,gi,xi,Yi,In,Ji,_o,js.vertical,["vertical"],ha,rx,Nn,Rr,fn,ps));let Bl=-1;const lx=(qs,ms)=>qs?Math.max(qs,ms):ms;Bl=lx(cp,Bl),Bl=lx(ET,Bl),Bl=lx(MT,Bl);const cP=Bl>-1?1:0;pt.glyphOffsetArray.length>=65535&&_i("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),In.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,In.sortKey),pt.symbolInstances.emplaceBack(ot.x,ot.y,su.x,su.y,su.z,ha.right>=0?ha.right:-1,ha.center>=0?ha.center:-1,ha.left>=0?ha.left:-1,ha.vertical>=0?ha.vertical:-1,nx,rx,RT,go!==void 0?go:pt.collisionBoxArray.length,go!==void 0?go+1:pt.collisionBoxArray.length,Fl!==void 0?Fl:pt.collisionBoxArray.length,Fl!==void 0?Fl+1:pt.collisionBoxArray.length,nu!==void 0?nu:pt.collisionBoxArray.length,nu!==void 0?nu+1:pt.collisionBoxArray.length,ru||pt.collisionBoxArray.length,ru?ru+1:pt.collisionBoxArray.length,Ii,CT,PT,AT,IT,cP,0,ox,ax,Bl,0,sx?1:0)})(s,Xe,Et,rt,i,o,h,Ae,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,se,_e,b,0,re,oe,O,e,l,M,m,w,v,T)};if(ye==="line")for(const rt of Ob(e.geometry,0,0,At,At)){const Xe=EI(rt,K,ie,i.vertical||V,o,N,H,s.overscaling,At);for(const It of Xe)V&&RI(s,V.text,be,It)||Ye(rt,It,w)}else if(ye==="line-center"){for(const rt of e.geometry)if(rt.length>1){const Xe=SI(rt,ie,i.vertical||V,o,N,H);Xe&&Ye(rt,Xe,w)}}else if(e.type==="Polygon")for(const rt of Xm(e.geometry,0)){const Xe=AI(rt,16);Ye(rt[0],new Ua(Xe.x,Xe.y,0,0,void 0),w)}else if(e.type==="LineString")for(const rt of e.geometry)Ye(rt,new Ua(rt[0].x,rt[0].y,0,0,void 0),w);else if(e.type==="Point")for(const rt of e.geometry)for(const Xe of rt)Ye([Xe],new Ua(Xe.x,Xe.y,0,0,void 0),w)}const Hf=255,zl=Hf*Bo;function qb(s,e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z,O){const V=function(G,H,K,se,re,ie,_e,oe){const ye=[];if(H.positionedLines.length===0)return ye;const be=se.layout.get("text-rotate").evaluate(ie,{})*Math.PI/180,ve=function(Ye){const rt=Ye[0],Xe=Ye[1],It=rt*Xe;return It>0?[rt,-Xe]:It<0?[-rt,Xe]:rt===0?[Xe,rt]:[Xe,-rt]}(K);let Ee=Math.abs(H.top-H.bottom);for(const Ye of H.positionedLines)Ee-=Ye.lineOffset;const Ie=H.positionedLines.length,De=Ee/Ie;let Ae=H.top-K[1];for(let Ye=0;Ye<Ie;++Ye){const rt=H.positionedLines[Ye];Ae=MI(H,De,Ae,Ye);for(const Xe of rt.positionedGlyphs){if(!Xe.rect)continue;const It=Xe.rect||{};let Et=Tb+1,pt=!0,ot=1,jt=0;if(Xe.imageName){const kn=_e[xr.build(Xe.imageName).getSerializedPrimary()];if(!kn)continue;if(kn.sdf){_i("SDF images are not supported in formatted text and will be ignored.");continue}pt=!1,ot=kn.pixelRatio,Et=jf/ot}const Ct=(re||oe)&&Xe.vertical,Lt=Xe.metrics.advance*Xe.scale/2,ai=Xe.metrics,gi=Xe.rect;if(gi===null)continue;oe&&H.verticalizable&&(jt=Xe.imageName?Lt-Xe.metrics.width*Xe.scale/2:0);const yi=re?[Xe.x+Lt,Xe.y]:[0,0];let xi=[0,0],Ai=[0,0],Ii=!1;re||(Ct?(Ai=[Xe.x+Lt+ve[0],Xe.y+ve[1]-jt],Ii=!0):xi=[Xe.x+Lt+K[0],Xe.y+K[1]-jt]);const an=gi.w*Xe.scale/(ot*(Xe.localGlyph?No:1)),nn=gi.h*Xe.scale/(ot*(Xe.localGlyph?No:1));let fi,Yi,Ji,mn;if(Ct){const kn=Xe.y-Ae,In=new ge(-Lt,Lt-kn),Nn=-Math.PI/2,Yn=new ge(...Ai);fi=new ge(-Lt+xi[0],xi[1]),fi._rotateAround(Nn,In)._add(Yn),fi.x+=-kn+Lt,fi.y-=(ai.left-Et)*Xe.scale;const Rr=Xe.imageName?ai.advance*Xe.scale:Pr*Xe.scale,fn=String.fromCodePoint(Xe.glyph);mI(fn)?fi.x+=(1-Et)*Xe.scale:_I(fn)?fi.x+=Rr-ai.height*Xe.scale+(-Et-1)*Xe.scale:fi.x+=Xe.imageName||ai.width+2*Et===gi.w&&ai.height+2*Et===gi.h?(Rr-nn)/2:(Rr-(ai.height+2*Et)*Xe.scale)/2,Yi=new ge(fi.x,fi.y-an),Ji=new ge(fi.x+nn,fi.y),mn=new ge(fi.x+nn,fi.y-an)}else{const kn=(ai.left-Et)*Xe.scale-Lt+xi[0],In=(-ai.top-Et)*Xe.scale+xi[1],Nn=kn+an,Yn=In+nn;fi=new ge(kn,In),Yi=new ge(Nn,In),Ji=new ge(kn,Yn),mn=new ge(Nn,Yn)}if(be){let kn;kn=re?new ge(0,0):Ii?new ge(ve[0],ve[1]):new ge(K[0],K[1]),fi._rotateAround(be,kn),Yi._rotateAround(be,kn),Ji._rotateAround(be,kn),mn._rotateAround(be,kn)}const On=new ge(0,0),Hn=new ge(0,0);ye.push({tl:fi,tr:Yi,bl:Ji,br:mn,texPrimary:It,texSecondary:void 0,writingMode:H.writingMode,glyphOffset:yi,sectionIndex:Xe.sectionIndex,isSDF:pt,pixelOffsetTL:On,pixelOffsetBR:Hn,minFontScaleX:0,minFontScaleY:0})}}return ye}(0,o,b,l,f,g,h,s.allowVerticalPlacement),j=s.textSizeData;let N=null;j.kind==="source"?(N=[Bo*l.layout.get("text-size").evaluate(g,{},z)*T.textScaleFactor],N[0]>zl&&_i(`${s.layerIds[0]}: Value for "text-size" is >= ${Hf}. Reduce your "text-size".`)):j.kind==="composite"&&(N=[Bo*T.compositeTextSizes[0].evaluate(g,{},z)*T.textScaleFactor,Bo*T.compositeTextSizes[1].evaluate(g,{},z)*T.textScaleFactor],(N[0]>zl||N[1]>zl)&&_i(`${s.layerIds[0]}: Value for "text-size" is >= ${Hf}. Reduce your "text-size".`)),s.addSymbols(s.text,V,N,b,f,g,m,e,i,M.lineStartIndex,M.lineLength,v,I,z,O,!1);for(const G of w)E[G]=s.text.placedSymbolArray.length-1;return 4*V.length}function Hb(s){for(const e in s)return s[e];return null}function l_(s,e,i,o,h,l,f,g,b,M){let m=f.top,w=f.bottom,E=f.left,v=f.right;const T=f.collisionPadding;if(T&&(E-=T[0],m-=T[1],v+=T[2],w+=T[3]),b){const I=new ge(E,m),z=new ge(v,m),O=new ge(E,w),V=new ge(v,w),j=mt(b);let N=new ge(0,0);M&&(N=new ge(M[0],M[1])),I._rotateAround(j,N),z._rotateAround(j,N),O._rotateAround(j,N),V._rotateAround(j,N),E=Math.min(I.x,z.x,O.x,V.x),v=Math.max(I.x,z.x,O.x,V.x),m=Math.min(I.y,z.y,O.y,V.y),w=Math.max(I.y,z.y,O.y,V.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,E,m,v,w,g,o,h,l),s.length-1}function T0(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function RI(s,e,i,o){const h=s.compareText;if(e in h){const l=h[e];for(let f=l.length-1;f>=0;f--)if(o.dist(l[f])<i)return!0}else h[e]=[];return h[e].push(o),!1}function $b(s,e){const i=s.fovAboveCenter,o=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,h=(s._camera.position[2]*s.worldSize-o)/Math.cos(s._pitch),l=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let f=Math.sin(s._pitch)*l+h;const g=h*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let b=Math.max(s.zoom-17,0);s.isOrthographic&&(b/=10),f*=1+b}return Math.min(1.01*f,g)}function $f(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),o=s.x*i,h=(s.x+1)*i,l=s.y*i,f=(s.y+1)*i,g=Jr(o),b=Jr(h),M=dr(l),m=dr(f),w=e.project(g,M),E=e.project(b,M),v=e.project(b,m),T=e.project(g,m);let I=Math.min(w.x,E.x,v.x,T.x),z=Math.min(w.y,E.y,v.y,T.y),O=Math.max(w.x,E.x,v.x,T.x),V=Math.max(w.y,E.y,v.y,T.y);const j=i/16;function N(H,K,se,re,ie,_e){const oe=(se+ie)/2,ye=(re+_e)/2,be=e.project(Jr(oe),dr(ye)),ve=Math.max(0,I-be.x,z-be.y,be.x-O,be.y-V);I=Math.min(I,be.x),O=Math.max(O,be.x),z=Math.min(z,be.y),V=Math.max(V,be.y),ve>j&&(N(H,be,se,re,oe,ye),N(be,K,oe,ye,ie,_e))}N(w,E,o,l,h,l),N(E,v,h,l,h,f),N(v,T,h,f,o,f),N(T,w,o,f,o,l),I-=j,z-=j,O+=j,V+=j;const G=1/Math.max(O-I,V-z);return{scale:G,x:I*G,y:z*G,x2:O*G,y2:V*G,projection:e}}function Zb(s,{x:e,y:i},o=0){return new ge(((e-o)*s.scale-s.x)*At,(i*s.scale-s.y)*At)}const DI=Te.mat4.identity(new Float32Array(16));class Ll{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Ni(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return Vr(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return $b(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,h){const l=e.horizonLineFromTop(!1),f=new ge(i,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,h))}pointCoordinate3D(e,i,o){const h=new ge(i,o);if(e.elevation)return e.elevation.pointCoordinate(h);{const l=this.pointCoordinate(e,h.x,h.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return DI}createTileMatrix(e,i,o){let h,l,f;const g=o.canonical,b=Te.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=$f(g,this);h=1,l=M.x+o.wrap*M.scale,f=M.y,Te.mat4.scale(b,b,[h/M.scale,h/M.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(g.z),l=(g.x+Math.pow(2,g.z)*o.wrap)*h,f=g.y*h;return Te.mat4.translate(b,b,[l,f,0]),Te.mat4.scale(b,b,[h/At,h/At,1]),b}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class zI extends Ll{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(mt(i));this.n=(h+Math.sin(mt(o)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:h,r0:l}=this,f=mt(e-this.center[0]),g=mt(i),b=Math.sqrt(h-2*o*Math.sin(g))/o;return{x:b*Math.sin(f*o),y:b*Math.cos(f*o)-l,z:0}}unproject(e,i){const{n:o,c:h,r0:l}=this,f=l+i;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const b=mt(this.center[0])*o;g=wi(g,-Math.PI-b,Math.PI-b);const M=Mt(Gt(g/o)+this.center[0],-180,180),m=Math.asin(Mt((h-(e*e+f*f)*o*o)/(2*o),-1,1)),w=Mt(Gt(m),-Dn,Dn);return new Ni(M,w)}}const Zf=1.340264,Wf=-.081106,Xf=893e-6,Yf=.003796,c_=Math.sqrt(3)/2;class LI extends Ll{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(c_*Math.sin(i)),h=o*o,l=h*h*h;return{x:.5*(e*Math.cos(o)/(c_*(Zf+3*Wf*h+l*(7*Xf+9*Yf*h)))/Math.PI+.5),y:1-.5*(o*(Zf+Wf*h+l*(Xf+Yf*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=o*o,l=h*h*h;for(let m,w,E,v=0;v<12&&(w=o*(Zf+Wf*h+l*(Xf+Yf*h))-i,E=Zf+3*Wf*h+l*(7*Xf+9*Yf*h),m=w/E,o=Mt(o-m,-Math.PI/3,Math.PI/3),h=o*o,l=h*h*h,!(Math.abs(m)<1e-12));++v);const f=c_*e*(Zf+3*Wf*h+l*(7*Xf+9*Yf*h))/Math.cos(o),g=Math.asin(Math.sin(o)/c_),b=Mt(180*f/Math.PI,-180,180),M=Mt(180*g/Math.PI,-Dn,Dn);return new Ni(b,M)}}class OI extends Ll{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),h=Mt(360*(.5-i),-Dn,Dn);return new Ni(o,h)}}const Ih=Math.PI/2;function u_(s){return Math.tan((Ih+s)/2)}class kI extends Ll{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let h=mt(i),l=mt(o);this.southernCenter=h+l<0,this.southernCenter&&(h=-h,l=-l);const f=Math.cos(h),g=u_(h);this.n=h===l?Math.sin(h):Math.log(f/Math.cos(l))/Math.log(u_(l)/g),this.f=f*Math.pow(u_(h),this.n)/this.n}project(e,i){i=mt(i),this.southernCenter&&(i=-i),e=mt(e-this.center[0]);const o=1e-6,{n:h,f:l}=this;l>0?i<-Ih+o&&(i=-Ih+o):i>Ih-o&&(i=Ih-o);const f=l/Math.pow(u_(i),h);let g=f*Math.sin(h*e),b=l-f*Math.cos(h*e);return g=.5*(g/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:g,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:h}=this,l=h-i,f=Math.sign(l),g=Math.sign(o)*Math.sqrt(e*e+l*l);let b=Math.atan2(e,Math.abs(l))*f;l*o<0&&(b-=Math.PI*Math.sign(e)*f);const M=Mt(Gt(b/o)+this.center[0],-180,180),m=Mt(Gt(2*Math.atan(Math.pow(h/g,1/o))-Ih),-Dn,Dn);return new Ni(M,this.southernCenter?-m:m)}}class Wb extends Ll{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ho(e),y:Us(i),z:0}}unproject(e,i){const o=Jr(e),h=dr(i);return new Ni(o,h)}}const Xb=mt(Dn);class FI extends Ll{project(e,i){const o=(i=mt(i))*i,h=o*o;return{x:.5*((e=mt(e))*(.8707-.131979*o+h*(h*(.003971*o-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+h*(.028874*o-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,h=25,l=0,f=o*o;do{f=o*o;const M=f*f;l=(o*(1.007226+f*(.015085+M*(.028874*f-.044475-.005916*M)))-i)/(1.007226+f*(.045255+M*(.259866*f-.311325-.005916*11*M))),o=Mt(o-l,-Xb,Xb)}while(Math.abs(l)>1e-6&&--h>0);f=o*o;const g=Mt(Gt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=Gt(o);return new Ni(g,b)}}const Yb=mt(Dn);class BI extends Ll{project(e,i){i=mt(i),e=mt(e);const o=Math.cos(i),h=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),f=Math.sin(l)/l,g=.5*(e*h+2*o*Math.sin(e/2)/f)||0,b=.5*(i+Math.sin(i)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,l=25;const f=1e-6;let g=0,b=0;do{const M=Math.cos(h),m=Math.sin(h),w=2*m*M,E=m*m,v=M*M,T=Math.cos(o/2),I=Math.sin(o/2),z=2*T*I,O=I*I,V=1-v*T*T,j=V?1/V:0,N=V?Math.acos(M*T)*Math.sqrt(1/V):0,G=.5*(2*N*M*I+2*o/Math.PI)-e,H=.5*(N*m+h)-i,K=.5*j*(v*O+N*M*T*E)+1/Math.PI,se=j*(z*w/4-N*m*I),re=.125*j*(w*I-N*m*v*z),ie=.5*j*(E*T+N*O*M)+.5,_e=se*re-ie*K;g=(H*se-G*ie)/_e,b=(G*re-H*K)/_e,o=Mt(o-g,-Math.PI,Math.PI),h=Mt(h-b,-Yb,Yb)}while((Math.abs(g)>f||Math.abs(b)>f)&&--l>0);return new Ni(Gt(o),Gt(h))}}class Kb extends Ll{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:h}=this;return{x:mt(e)*h*o+.5,y:-Math.sin(mt(i))/h*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:h}=this,l=-(i-.5)/o,f=Mt(Gt((e-.5)/o)/h,-180,180),g=Math.asin(Mt(l*h,-1,1)),b=Mt(Gt(g),-Dn,Dn);return new Ni(f,b)}}class NI extends Wb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const h=rn(e,i,o),l=ir(jn(o));return Te.vec3.transformMat4(h,h,l),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const o=Fa(i.lat,i.lng),h=Te.vec3.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,f=Vr(1,0)*At*l;Te.vec3.scaleAndAdd(o,o,h,f);const g=Te.mat4.identity(new Float64Array(16));return Te.mat4.multiply(g,e.pixelMatrix,e.globeMatrix),Te.vec3.transformMat4(o,o,g),new ge(o[0],o[1])}pixelsPerMeter(e,i){return Vr(1,0)*i}pixelSpaceConversion(e,i,o){const h=Vr(1,e)*i,l=ni(Vr(1,45)*i,h,o);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,o){const h=sn(jn(o.canonical));return Te.mat4.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:o}=e,h=ir(jn(i));return Te.mat4.rotateY(h,h,mt(o.lng)),Te.mat4.rotateX(h,h,mt(o.lat)),Te.mat4.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,o,h){return Zi(e,i,o,!0)||new n(0,0)}pointCoordinate3D(e,i,o){const h=this.pointCoordinate(e,i,o,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!Zi(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,l){const f=h.cameraToCenterDistance,g=h._centerAltitude*l,b=h._camera,M=h._camera.forward(),m=Te.vec3.add([],Te.vec3.scale([],M,-f),[0,0,g]),w=h.worldSize/(2*Math.PI),E=[0,0,-w],v=h.width/h.height,T=Math.tan(h.fovAboveCenter),I=Te.vec3.scale([],b.up(),T),z=Te.vec3.scale([],b.right(),T*v),O=Te.vec3.normalize([],Te.vec3.add([],Te.vec3.add([],M,I),z)),V=[];let j;if(new ui(m,O).closestPointOnSphere(E,w,V)){const N=Te.vec3.add([],V,E),G=Te.vec3.sub([],N,m);j=Math.cos(h.fovAboveCenter)*Te.vec3.length(G)}else{const N=Te.vec3.sub([],m,E),G=Te.vec3.sub([],E,m);Te.vec3.normalize(G,G);const H=Te.vec3.length(N)-w;j=Math.sqrt(H*(H+2*w));const K=Math.acos(j/(w+H))-Math.acos(Te.vec3.dot(M,G));j*=Math.cos(K)}return 1.01*j}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Hr(e.zoom);if(o>0){const h=$b(e,Vr(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ni(i,h+l*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return rn(i,o,e,1)}upVectorScale(e){return{metersToTile:Ci(zi(jn(e)))}}}function Jb(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new Wb(s);case"equirectangular":return new OI(s);case"naturalEarth":return new FI(s);case"equalEarth":return new LI(s);case"winkelTripel":return new BI(s);case"albers":return i?new Kb(s):new zI(s);case"lambertConformalConic":return i?new Kb(s):new kI(s);case"globe":return new NI(s)}throw new Error(`Invalid projection name: ${s.name}`)}const VI=Th.VectorTileFeature.types,UI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function h_(s,e,i,o,h,l,f,g,b,M,m,w,E){const v=g?Math.min(zl,Math.round(g[0])):0,T=g?Math.min(zl,Math.round(g[1])):0;s.emplaceBack(e,i,Math.round(32*o),Math.round(32*h),l,f,(v<<1)+(b?1:0),T,16*M,16*m,256*w,256*E)}function d_(s,e,i){s.emplaceBack(e,i)}function f_(s,e,i,o,h,l,f){s.emplaceBack(e,i,o,h,l,f)}function p_(s,e,i,o,h){s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h),s.emplaceBack(e,i,o,h)}function jI(s){for(const e of s.sections)if(nf(e.text))return!0;return!1}class S0{constructor(e){this.layoutVertexArray=new hf,this.indexArray=new hr,this.programConfigurations=e,this.segments=new Rn,this.dynamicLayoutVertexArray=new za,this.opacityVertexArray=new ff,this.placedSymbolArray=new zm,this.iconTransitioningVertexArray=new sa,this.globeExtVertexArray=new df,this.zOffsetVertexArray=new Nc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,h,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sI.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,aI.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,UI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,cI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,oI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lI.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Nt(S0,"SymbolBuffers");class E0{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Rn,this.collisionVertexArray=new _f,this.collisionVertexArrayExt=new za}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,uI.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,hI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Nt(E0,"CollisionBuffers");class m_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Te.mat4.identity([]),this.placementViewportMatrix=Te.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=p0(this.zoom,i["text-size"]),this.iconSizeData=p0(this.zoom,i["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>js[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new S0(new la(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new S0(new la(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new km,this.lineVertexArray=new Fm,this.symbolInstances=new Om}calculateGlyphDependencies(e,i,o,h,l){for(const f of e){const g=f.codePointAt(0);if(g===void 0)break;if(i[g]=!0,h&&l&&g<=65535){const b=Vf[f];b&&(i[b.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!o0(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,h){const l=this.layers[0],f=l.layout,g=this.projection.name==="globe",b=f.get("text-font"),M=f.get("text-field"),m=f.get("icon-image"),[w,E]=f.get("icon-size-scale-range"),v=Mt(i.scaleFactor||1,w,E),T=(M.value.kind!=="constant"||M.value.value instanceof Mr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),I=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,z=f.get("symbol-sort-key");if(this.features=[],!T&&!I)return;const O=i.iconDependencies,V=i.glyphDependencies,j=i.availableImages,N=new un(this.zoom);for(const{feature:G,id:H,index:K,sourceLayerIndex:se}of e){const re=l._featureFilter.needGeometry,ie=k(G,re);if(!l._featureFilter.filter(N,ie,o))continue;if(re||(ie.geometry=D(G,o,h)),g&&G.type!==1&&o.z<=5){const ve=ie.geometry,Ee=.98078528056,Ie=(De,Ae)=>{const Ye=rn(De.x,De.y,o,1),rt=rn(Ae.x,Ae.y,o,1);return Te.vec3.dot(Ye,rt)<Ee};for(let De=0;De<ve.length;De++)ve[De]=x(ve[De],Ie)}let _e,oe;if(T){const ve=l.getValueAndResolveTokens("text-field",ie,o,j),Ee=Mr.factory(ve);jI(Ee)&&(this.hasRTLText=!0),(!this.hasRTLText||rh()==="unavailable"||this.hasRTLText&&cs.isParsed())&&(_e=pI(Ee,l,ie))}if(I){const ve=l.getValueAndResolveTokens("icon-image",ie,o,j);oe=ve instanceof xr?ve:xr.build(ve)}if(!_e&&!oe)continue;const ye=this.sortFeaturesByKey?z.evaluate(ie,{},o):void 0,be={id:H,text:_e,icon:oe,index:K,sourceLayerIndex:se,geometry:ie.geometry,properties:G.properties,type:VI[G.type],sortKey:ye};if(this.features.push(be),oe){const ve=f0(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],o,this.zoom,be)*v*this.pixelRatio,Ee=oe.getPrimary().scaleSelf(ve);if(O[Ee.id]=O[Ee.id]||[],O[Ee.id].push(Ee),oe.nameSecondary){const Ie=oe.getSecondary().scaleSelf(ve);O[Ie.id]=O[Ie.id]||[],O[Ie.id].push(Ie)}}if(_e){const ve=b.evaluate(ie,{},o).join(","),Ee=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(js.vertical)>=0;for(const Ie of _e.sections)if(Ie.image){const De=Ie.image.getPrimary().scaleSelf(this.pixelRatio);O[De.id]=O[De.id]||[],O[De.id].push(De)}else{const De=Qd(_e.toString()),Ae=Ie.fontStack||ve,Ye=V[Ae]=V[Ae]||{};this.calculateGlyphDependencies(Ie.text,Ye,Ee,this.allowVerticalPlacement,De)}}}f.get("symbol-placement")==="line"&&(this.features=function(G){const H={},K={},se=[];let re=0;function ie(be){se.push(G[be]),re++}function _e(be,ve,Ee){const Ie=K[be];return delete K[be],K[ve]=Ie,se[Ie].geometry[0].pop(),se[Ie].geometry[0]=se[Ie].geometry[0].concat(Ee[0]),Ie}function oe(be,ve,Ee){const Ie=H[ve];return delete H[ve],H[be]=Ie,se[Ie].geometry[0].shift(),se[Ie].geometry[0]=Ee[0].concat(se[Ie].geometry[0]),Ie}function ye(be,ve,Ee){const Ie=Ee?ve[0][ve[0].length-1]:ve[0][0];return`${be}:${Ie.x}:${Ie.y}`}for(let be=0;be<G.length;be++){const ve=G[be],Ee=ve.geometry,Ie=ve.text?ve.text.toString():null;if(!Ie){ie(be);continue}const De=ye(Ie,Ee),Ae=ye(Ie,Ee,!0);if(De in K&&Ae in H&&K[De]!==H[Ae]){const Ye=oe(De,Ae,Ee),rt=_e(De,Ae,se[Ye].geometry);delete H[De],delete K[Ae],K[ye(Ie,se[rt].geometry,!0)]=rt,se[Ye].geometry=null}else De in K?_e(De,Ae,Ee):Ae in H?oe(De,Ae,Ee):(ie(be),H[De]=re-1,K[Ae]=re-1)}return se.filter(be=>be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,H)=>G.sortKey-H.sortKey)}update(e,i,o,h,l,f,g){this.text.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g),this.icon.programConfigurations.updatePaintArrays(e,i,l,o,h,f,g)}updateZOffset(){const e=(l,f,g)=>{o+=f,o>l.length&&l.resize(o);for(let b=-f;b<0;b++)l.emplace(b+o,g)},i=(l,f,g)=>{h+=f,h>l.length&&l.resize(h);for(let b=-f;b<0;b++)l.emplace(b+h,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,h=0;for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:b,numIconVertices:M}=f,m=f.zOffset,w=M>0;if((g>0||b>0)&&(e(this.text.zOffsetVertexArray,g,m),e(this.text.zOffsetVertexArray,b,m)),w){const{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:v}=f;E>=0&&i(this.icon.zOffsetVertexArray,M,m),v>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,m)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Jb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:l}of i)this.lineVertexArray.emplaceBack(h,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,h,l,f,g,b,M,m,w,E,v,T,I,z){const O=e.indexArray,V=e.layoutVertexArray,j=e.globeExtVertexArray,N=e.segments.prepareSegment(4*i.length,V,O,this.canOverlap?f.sortKey:void 0),G=this.glyphOffsetArray.length,H=N.vertexLength,K=this.allowVerticalPlacement&&g===js.vertical?Math.PI/2:0,se=f.text&&f.text.sections;for(let ie=0;ie<i.length;ie++){const{tl:_e,tr:oe,bl:ye,br:be,texPrimary:ve,texSecondary:Ee,pixelOffsetTL:Ie,pixelOffsetBR:De,minFontScaleX:Ae,minFontScaleY:Ye,glyphOffset:rt,isSDF:Xe,sectionIndex:It}=i[ie],Et=N.vertexLength,pt=rt[1];if(h_(V,M.x,M.y,_e.x,pt+_e.y,ve.x,ve.y,o,Xe,Ie.x,Ie.y,Ae,Ye),h_(V,M.x,M.y,oe.x,pt+oe.y,ve.x+ve.w,ve.y,o,Xe,De.x,Ie.y,Ae,Ye),h_(V,M.x,M.y,ye.x,pt+ye.y,ve.x,ve.y+ve.h,o,Xe,Ie.x,De.y,Ae,Ye),h_(V,M.x,M.y,be.x,pt+be.y,ve.x+ve.w,ve.y+ve.h,o,Xe,De.x,De.y,Ae,Ye),b){const{x:ot,y:jt,z:Ct}=b.anchor,[Lt,ai,gi]=b.up;f_(j,ot,jt,Ct,Lt,ai,gi),f_(j,ot,jt,Ct,Lt,ai,gi),f_(j,ot,jt,Ct,Lt,ai,gi),f_(j,ot,jt,Ct,Lt,ai,gi),p_(e.dynamicLayoutVertexArray,ot,jt,Ct,K)}else p_(e.dynamicLayoutVertexArray,M.x,M.y,M.z,K);if(z){const ot=Ee||ve;d_(e.iconTransitioningVertexArray,ot.x,ot.y),d_(e.iconTransitioningVertexArray,ot.x+ot.w,ot.y),d_(e.iconTransitioningVertexArray,ot.x,ot.y+ot.h),d_(e.iconTransitioningVertexArray,ot.x+ot.w,ot.y+ot.h)}O.emplaceBack(Et,Et+1,Et+2),O.emplaceBack(Et+1,Et+2,Et+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rt[0]),ie!==i.length-1&&It===i[ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,f,f.index,{},v,T,I,se&&se[It])}const re=b?b.anchor:M;e.placedSymbolArray.emplaceBack(re.x,re.y,re.z,M.x,M.y,G,this.glyphOffsetArray.length-G,H,m,w,M.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],g,0,!1,0,E,0)}_commitLayoutVertex(e,i,o,h,l,f,g){e.emplaceBack(i,o,h,l,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,h,l,f,g){const b=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),M=b.vertexLength,m=g.tileAnchorX,w=g.tileAnchorY;for(let v=0;v<4;v++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,h,l,f,m,w,new ge(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,l,f,m,w,new ge(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,h,l,f,m,w,new ge(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,h,l,f,m,w,new ge(e.x1,e.y2)),b.vertexLength+=4;const E=o.indexArray;E.emplaceBack(M,M+1),E.emplaceBack(M+1,M+2),E.emplaceBack(M+2,M+3),E.emplaceBack(M+3,M),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,h,l,f){for(let g=h;g<l;g++){const b=o.get(g),M=this.getSymbolInstanceTextSize(e,f,i,g);this._addCollisionDebugVertices(b,M,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,h,l,f){for(let g=h;g<l;g++){const b=o.get(g),M=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(b,M,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E0(dh,xb.members,sa),this.iconCollisionBox=new E0(dh,xb.members,sa);const h=Sh(this.iconSizeData,e),l=Sh(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(l,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(l,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(h,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(h,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,o,h){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),f=i_(this.textSizeData,e,l)/Pr;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const h=this.icon.placedSymbolArray.get(o),l=i_(this.iconSizeData,e,h);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,o,h){e.emplaceBack(i,-o,-o,h),e.emplaceBack(i,o,-o,h),e.emplaceBack(i,o,o,h),e.emplaceBack(i,-o,o,h)}_updateTextDebugCollisionBoxes(e,i,o,h,l,f,g){for(let b=h;b<l;b++){const M=o.get(b),m=this.getSymbolInstanceTextSize(e,f,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,m,M.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,h,l,f,g){for(let b=h;b<l;b++){const M=o.get(b),m=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,M.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Sh(this.iconSizeData,e,h),f=Sh(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const b=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,i,b.textBoxStartIndex,b.textBoxEndIndex,b,o),this._updateTextDebugCollisionBoxes(f,e,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,o),this._updateIconDebugCollisionBoxes(l,e,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b,h),this._updateIconDebugCollisionBoxes(l,e,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,h,l,f,g,b,M){const m={};if(i<o){const{x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N,featureIndex:G}=e.get(i);m.textBox={x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N},m.textFeatureIndex=G}if(h<l){const{x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N,featureIndex:G}=e.get(h);m.verticalTextBox={x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N},m.verticalTextFeatureIndex=G}if(f<g){const{x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N,featureIndex:G}=e.get(f);m.iconBox={x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N},m.iconFeatureIndex=G}if(b<M){const{x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N,featureIndex:G}=e.get(b);m.verticalIconBox={x1:w,y1:E,x2:v,y2:T,padding:I,projectedAnchorX:z,projectedAnchorY:O,projectedAnchorZ:V,tileAnchorX:j,tileAnchorY:N},m.verticalIconFeatureIndex=G}return m}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),h=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<h;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),h=[],l=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const b=this.symbolInstances.get(g);h.push(0|Math.round(i*b.tileAnchorX+o*b.tileAnchorY)),l.push(b.featureIndex)}return f.sort((g,b)=>h[g]-h[b]||l[b]-l[g]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:M}=o;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),l>=0&&l!==h&&this.addIndicesForPlacedSymbol(this.text,l),f>=0&&f!==l&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Qb,ew,M0;Nt(m_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),m_.addDynamicAttributes=p_;class tw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ya,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Nt(tw,"FormatSectionOverride",{omit:["defaultValue"]});const A0=()=>M0||(M0={layout:Qb||(Qb=new vn({"symbol-placement":new yt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new yt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt(Fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new yt(Fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new yt(Fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new yt(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(Fe.layout_symbol["icon-size"]),"icon-size-scale-range":new yt(Fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Dt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new yt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new yt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Dt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(Fe.layout_symbol["text-field"]),"text-font":new Dt(Fe.layout_symbol["text-font"]),"text-size":new Dt(Fe.layout_symbol["text-size"]),"text-size-scale-range":new yt(Fe.layout_symbol["text-size-scale-range"]),"text-max-width":new Dt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Dt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Dt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Dt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new yt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new yt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(Fe.layout_symbol["text-rotate"]),"text-padding":new yt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new yt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Dt(Fe.layout_symbol["text-transform"]),"text-offset":new Dt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new yt(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new yt(Fe.layout_symbol["text-optional"]),visibility:new yt(Fe.layout_symbol.visibility)})),paint:ew||(ew=new vn({"icon-opacity":new Dt(Fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dt(Fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dt(Fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dt(Fe.paint_symbol["text-emissive-strength"]),"icon-color":new Dt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Dt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new yt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt(Fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Dt(Fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dt(Fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dt(Fe.paint_symbol["text-occlusion-opacity"]),"text-color":new Dt(Fe.paint_symbol["text-color"],{runtimeType:Er,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Dt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new yt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new yt(Fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new yt(Fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new yt(Fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new yt(Fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new yt(Fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dt(Fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},M0);class __ extends sr{constructor(e,i,o,h){super(e,A0(),i,o,h),this._colorAdjustmentMatrix=Te.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const l of o)h.indexOf(l)<0&&h.push(l);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(l,f,g,b){l=Cu(l),f=Iu(f);const M=Te.mat4.create(),m=l/3,w=1-2*m,E=[w,m,m,0,m,w,m,0,m,m,w,0,0,0,0,1],v=.5-.5*f,T=b-g;return Te.mat4.multiply(M,[T,0,0,0,0,T,0,0,0,0,T,0,g,g,g,1],[f,0,0,0,0,f,0,0,0,0,f,0,v,v,v,1]),Te.mat4.multiply(M,M,E),M}(e,i,o,h),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,h){const l=this.layout.get(e).evaluate(i,{},o,h),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||pl(f.value)||!l?l:function(g,b){return b.replace(/{([^{}]+)}/g,(M,m)=>m in g?String(g[m]):"")}(i.properties,l)}createBucket(e){return new m_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of A0().paint.overridableProperties){if(!__.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new tw(i),h=new Qu(o,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new eh("source",h):new Cc("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new yl(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&__.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),h=A0().paint.properties[i];let l=!1;const f=g=>{for(const b of g)if(h.overrides&&h.overrides.hasOverride(b))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Mr)f(o.value.value.sections);else if(o.value.kind==="source"){const g=M=>{l||(M instanceof cr&&An(M.value)===ro?f(M.value.sections):M instanceof xa?f(M.sections):M.eachChild(g))},b=o.value;b._styleExpression&&g(b._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new ka(this,{zoom:i,lut:o}),overrideFog:!1}}}let iw,nw,rw,sw;var I0=$i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function C0(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function P0(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class R0{constructor(e,i,o,h){this.context=e,this.format=o,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:f}=l,{x:g,y:b}=i&&i.position?i.position:{x:0,y:0},M=g+o,m=b+h;!this.size||this.size[0]===M&&this.size[1]===m||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const w=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&M>0&&m>0){const E=this.useMipmap?Math.floor(Math.log2(Math.max(M,m)))+1:1;f.texStorage2D(f.TEXTURE_2D,E,this.format,M,m),this.size=[M,m]}if(this.size)if(w)f.texSubImage2D(f.TEXTURE_2D,0,g,b,C0(this.format),P0(this.format),e);else{const E=e.data;E&&f.texSubImage2D(f.TEXTURE_2D,0,g,b,o,h,C0(this.format),P0(this.format),E)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:h}=this,{gl:l}=h;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,h){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),h!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class g_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function y_(s,e,i,o,h,l,f,g){const b=[s,e,1,i,o,1,h,l,1],M=[f,g,1],m=Te.mat3.adjoint([],b),[w,E,v]=Te.vec3.transformMat3(M,M,m);return Te.mat3.multiply(b,b,[w,0,0,0,E,0,0,0,v])}function ow(s,e,i,o,h,l,f,g){const b=function(M,m,w,E,v,T,I,z){const O=y_(0,0,1,0,1,1,0,1),V=y_(M,m,w,E,v,T,I,z),j=Te.mat3.adjoint([],O);return Te.mat3.multiply(V,V,j)}(s,e,i,o,h,l,f,g);return[b[2]/b[8]/At,b[5]/b[8]/At]}function x_(s){return[s[0],Math.min(Math.max(s[1],-Dn),Dn)]}class aw extends Ko{constructor(e,i,o,h){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new no("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=hd(this.map._requestManager.transformRequest(this.url,Ui.Image),(o,h)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Ru(o)):h&&(this.image=h instanceof HTMLImageElement?de.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new g_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new no("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof g_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const l of e)l[1]>o&&(o=l[1]),l[1]<i&&(i=l[1]);const h=(o+i)/2;if(h>Dn?this.onNorthPole=!0:h<-Dn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(n.fromLngLat);this.tileID=function(f){let g=1/0,b=1/0,M=-1/0,m=-1/0;for(const I of f)g=Math.min(g,I.x),b=Math.min(b,I.y),M=Math.max(M,I.x),m=Math.max(m,I.y);const w=Math.max(M-g,m-b),E=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),v=Math.pow(2,E);let T=Math.floor((g+M)/2*v);return T>1&&(T-=1),new nt(E,T,Math.floor((b+m)/2*v))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new no("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const O in this.tiles){const V=this.tiles[O];V.state!=="loaded"&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=$f(new nt(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(O){const V=O[1].x-O[0].x,j=O[1].y-O[0].y,N=O[2].x-O[1].x,G=O[2].y-O[1].y,H=O[3].x-O[2].x,K=O[3].y-O[2].y,se=O[0].x-O[3].x,re=O[0].y-O[3].y,ie=V*G-N*j,_e=N*K-H*G,oe=H*re-se*K,ye=se*j-V*re;return ie>0&&_e>0&&oe>0&&ye>0||ie<0&&_e<0&&oe<0&&ye<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=$f(this.tileID,this.map.transform.projection),[l,f,g,b]=this.coordinates.map(O=>{const V=h.projection.project(O[0],O[1]);return Zb(h,V)._round()});this.perspectiveTransform=ow(l.x,l.y,f.x,f.y,g.x,g.y,b.x,b.y);const M=this._boundsArray=new ko;M.emplaceBack(l.x,l.y,0,0),M.emplaceBack(f.x,f.y,At,0),M.emplaceBack(b.x,b.y,0,At),M.emplaceBack(g.x,g.y,At,At),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(M,I0.members),this.boundsSegments=Rn.simpleSegment(0,0,4,2);const m=[],w=[x_((E=this.coordinates)[0]),x_(E[1]),x_(E[2]),x_(E[3])];var E;const[v,T,I,z]=function(O){let V=O[0][0],j=V,N=O[0][1],G=N;for(let H=1;H<O.length;H++)O[H][0]<V?V=O[H][0]:O[H][0]>j&&(j=O[H][0]),O[H][1]<N?N=O[H][1]:O[H][1]>G&&(G=O[H][1]);return[V,N,j-V,G-N]}(w);{const O=new ko,[V,j,N,G]=function(Ie){let De=Ie[0].x,Ae=De,Ye=Ie[0].y,rt=Ye;for(let Xe=1;Xe<Ie.length;Xe++)Ie[Xe].x<De?De=Ie[Xe].x:Ie[Xe].x>Ae&&(Ae=Ie[Xe].x),Ie[Xe].y<Ye?Ye=Ie[Xe].y:Ie[Xe].y>rt&&(rt=Ie[Xe].y);return[De,Ye,Ae-De,rt-Ye]}(o),H=Ie=>[(Ie.x-V)/N,(Ie.y-j)/G],[K,se,re,ie]=o.map(H),_e=function(Ie,De,Ae,Ye,rt,Xe,It,Et){const pt=y_(0,0,1,0,1,1,0,1),ot=y_(Ie,De,Ae,Ye,rt,Xe,It,Et),jt=Te.mat3.adjoint([],ot);return Te.mat3.multiply(pt,pt,jt)}(K[0],K[1],se[0],se[1],re[0],re[1],ie[0],ie[1]);this.elevatedGlobePerspectiveTransform=ow(K[0],K[1],se[0],se[1],re[0],re[1],ie[0],ie[1]);const oe=(Ie,De)=>{m.push(Ie.lng);const Ae=Math.round((Ie.lng-v)/I*At),Ye=Math.round((Ie.lat-T)/z*At),rt=H(De),Xe=Te.vec3.transformMat3([],[rt[0],rt[1],1],_e),It=Math.round(Xe[0]/Xe[2]*At),Et=Math.round(Xe[1]/Xe[2]*At);O.emplaceBack(Ae,Ye,It,Et)},ye=o[3].x-o[0].x,be=o[3].y-o[0].y,ve=o[2].x-o[1].x,Ee=o[2].y-o[1].y;for(let Ie=0;Ie<65;Ie++){const De=Ie/64,Ae=[o[0].x+De*ye,o[0].y+De*be],Ye=[o[1].x+De*ve,o[1].y+De*Ee],rt=Ye[0]-Ae[0],Xe=Ye[1]-Ae[1];for(let It=0;It<65;It++){const Et=It/64,pt={x:Ae[0]+rt*Et,y:Ae[1]+Xe*Et,z:0};oe(i.projection.unproject(pt.x,pt.y),pt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(O,I0.members)}{this.maxLongitudeTriangleSize=0;let O=[],V=new hr;const j=(N,G,H)=>{V.emplaceBack(N,G,H);const K=m[N],se=m[G],re=m[H],ie=Math.min(Math.min(K,se),re),_e=Math.max(Math.max(K,se),re)-ie;_e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=_e),O.push(ie+_e/2)};for(let N=0;N<64;N++)for(let G=0;G<64;G++){const H=65*N+G,K=H+1,se=H+65,re=se+1;j(H,se,K),j(K,se,re)}[O,V]=function(N,G){const H=Array.from({length:N.length},(re,ie)=>ie);H.sort((re,ie)=>N[re]-N[ie]);const K=[],se=new hr;for(let re=0;re<H.length;re++){const ie=H[re];K.push(N[ie]);const _e=3*ie,oe=_e+1;se.emplaceBack(G.uint16[_e],G.uint16[oe],G.uint16[oe+1])}return[K,se]}(O,V),this.elevatedGlobeTrianglesCenterLongitudes=O,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(V)}this.elevatedGlobeSegments=Rn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,I/At,0,z/At,0,0,T,v,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof g_||(this.texture?this.texture.update(this.image):(this.texture=new R0(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let h=(l=e+180)+360*Math.round((o[0]-l)/360);var l;const f=new Rn,g=(w,E)=>{f.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-h)<=b){const w=nl(o,0,o.length,h+b);return w===o.length||g(w,Au(o,w+1,o.length,h+360-b)-w),f}h<o[0]&&(h+=360);const M=Au(o,0,o.length,h-b);if(M===o.length)return g(0,o.length),f;g(0,M-0);const m=nl(o,M+1,o.length,h+b);return m!==o.length&&g(m,o.length-m),f}}const GI=(Math.pow(256,2)-1)/16907520;class lw extends sr{constructor(e,i,o,h){super(e,{layout:rw||(rw=new vn({visibility:new yt(Fe.layout_raster.visibility)})),paint:sw||(sw=new vn({"raster-opacity":new yt(Fe.paint_raster["raster-opacity"]),"raster-color":new vl(Fe.paint_raster["raster-color"]),"raster-color-mix":new yt(Fe.paint_raster["raster-color-mix"]),"raster-color-range":new yt(Fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new yt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new yt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new yt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new yt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new yt(Fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new yt(Fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new yt(Fe.paint_raster["raster-array-band"]),"raster-elevation":new yt(Fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof aw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(h)||o===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Pf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,h])}}let cw,uw,hw,dw,fw;class pw extends sr{constructor(e,i,o,h){super(e,{layout:cw||(cw=new vn({visibility:new yt(Fe["layout_raster-particle"].visibility)})),paint:uw||(uw=new vn({"raster-particle-array-band":new yt(Fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new yt(Fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new vl(Fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new yt(Fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new yt(Fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new yt(Fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new yt(Fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new yt(Fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,h),this._updateColorRamp(),this.lastInvalidatedAt=de.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Pf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=de.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class qI extends sr{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function D0(s,e,i){const o=[0,0,1],h=Te.quat.identity([]);return Te.quat.rotateY(h,h,i?-mt(s)+Math.PI:mt(s)),Te.quat.rotateX(h,h,-mt(e)),Te.vec3.transformQuat(o,o,h),Te.vec3.normalize(o,o)}function mw(s,e){const i=v_(s.projection,s.zoom,s.width,s.height),o=function(l,f,g,b,M){const m=new Ni(g.lng-180*Ol,g.lat),w=new Ni(g.lng+180*Ol,g.lat),E=l.project(m.lng,m.lat),v=l.project(w.lng,w.lat),T=-Math.atan2(v.y-E.y,v.x-E.x),I=n.fromLngLat(g);I.y=Mt(I.y,-1+Ol,1-Ol);const z=I.toLngLat(),O=l.project(z.lng,z.lat),V=n.fromLngLat(z);V.x+=Ol;const j=V.toLngLat(),N=l.project(j.lng,j.lat),G=gw(N.x-O.x,N.y-O.y,T),H=n.fromLngLat(z);H.y+=Ol;const K=H.toLngLat(),se=l.project(K.lng,K.lat),re=gw(se.x-O.x,se.y-O.y,T),ie=Math.abs(G.x)/Math.abs(re.y),_e=Te.mat4.identity([]);Te.mat4.rotateZ(_e,_e,-T*(1-(M?0:b)));const oe=Te.mat4.identity([]);return Te.mat4.scale(oe,oe,[1,1-(1-ie)*b,1]),oe[4]=-re.x/re.y*b,Te.mat4.rotateZ(oe,oe,T),Te.mat4.multiply(oe,_e,oe),oe}(s.projection,0,s.center,i,e),h=_w(s);return Te.mat4.scale(o,o,[h,h,1]),o}function _w(s){const e=s.projection,i=v_(s.projection,s.zoom,s.width,s.height),o=z0(e,s.center),h=z0(e,Ni.convert(e.center));return Math.pow(2,o*i+(1-i)*h)}function v_(s,e,i,o,h=1/0){const l=s.range;if(!l)return 0;const f=Math.min(h,Math.max(i,o)),g=Math.log(f/1024)/Math.LN2;return di(l[0]+g,l[1]+g,e)}const Ol=1/4e4;function z0(s,e){const i=Mt(e.lat,-Dn,Dn),o=new Ni(e.lng-180*Ol,i),h=new Ni(e.lng+180*Ol,i),l=s.project(o.lng,i),f=s.project(h.lng,i),g=n.fromLngLat(o),b=n.fromLngLat(h),M=f.x-l.x,m=f.y-l.y,w=b.x-g.x,E=b.y-g.y,v=Math.sqrt((w*w+E*E)/(M*M+m*m));return Math.log(v)/Math.LN2}function gw(s,e,i){const o=Math.cos(i),h=Math.sin(i);return{x:s*o-e*h,y:s*h+e*o}}function yw(s,e,i){Te.mat4.identity(s),Te.mat4.rotateZ(s,s,mt(e[2])),Te.mat4.rotateX(s,s,mt(e[0])),Te.mat4.rotateY(s,s,mt(e[1])),Te.mat4.scale(s,s,i),Te.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function b_(s,e,i,o,h,l,f,g){const b=[i[0]-e[0],i[1]-e[1],0],M=[o[0]-e[0],o[1]-e[1],0];if(Te.vec3.length(b)<1e-12||Te.vec3.length(M)<1e-12)return Te.quat.identity(s);const m=Te.vec3.cross([],b,M);Te.vec3.normalize(m,m),Te.vec3.subtract(M,o,e),b[2]=(l-h)*g,M[2]=(f-h)*g;const w=b;return Te.vec3.cross(w,b,M),Te.vec3.normalize(w,w),Te.quat.rotationTo(s,m,w)}function L0(s,e,i=!1){const o=Hr(e.zoom),h=function(l,f,g){const b=f.worldSize,M=[l[12],l[13],l[14]],m=dr(M[1]/b),w=Jr(M[0]/b),E=Te.mat4.identity([]),v=Vr(1,m)*b,T=Vr(1,0)*b*Il(m,f.zoom),I=1/Cr(b);let z=T*I;if(g){const N=v_(f.projection,f.zoom,f.width,f.height,1024);z=I*f.projection.pixelSpaceConversion(f.center.lat,b,N)}const O=Fa(m,w);Te.vec3.add(O,O,Te.vec3.scale([],Te.vec3.normalize([],O),v*z*M[2]));const V=function(N){const G=[N[0],N[1],N[2]];let H=[0,1,0];const K=Te.vec3.cross([],H,G);return Te.vec3.cross(H,G,K),Te.vec3.squaredLength(H)===0&&(H=[0,1,0],Te.vec3.cross(K,G,H)),Te.vec3.normalize(K,K),Te.vec3.normalize(H,H),Te.vec3.normalize(G,G),[K[0],K[1],K[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,N[0],N[1],N[2],1]}(O);Te.mat4.scale(E,E,[z,z,z*v]),Te.mat4.translate(E,E,[-M[0],-M[1],-M[2]]);const j=Te.mat4.multiply([],f.globeMatrix,V);return Te.mat4.multiply(j,j,E),Te.mat4.multiply(j,j,l),j}(s,e,i);if(o>0){const l=function(f,g){const b=g.worldSize,M=Vr(1,0)*b*Il(g.center.lat,g.zoom)/Cr(b),m=Vr(1,g.center.lat)*b,w=Te.mat4.identity([]);return Te.mat4.rotateY(w,w,mt(g.center.lng)),Te.mat4.rotateX(w,w,mt(g.center.lat)),Te.mat4.translate(w,w,[0,0,Nr]),Te.mat4.scale(w,w,[M,M,M*m]),Te.mat4.translate(w,w,[g.point.x-.5*b,g.point.y-.5*b,0]),Te.mat4.multiply(w,w,f),Te.mat4.multiply(w,g.globeMatrix,w)}(s,e);return function(f,g,b){const M=(T,I,z)=>{const O=Te.vec3.length(T),V=Te.vec3.length(I),j=Gn(T,I,z);return Te.vec3.scale(j,j,1/Te.vec3.length(j)*ni(O,V,z))},m=M([f[0],f[1],f[2]],[g[0],g[1],g[2]],b),w=M([f[4],f[5],f[6]],[g[4],g[5],g[6]],b),E=M([f[8],f[9],f[10]],[g[8],g[9],g[10]],b),v=Gn([f[12],f[13],f[14]],[g[12],g[13],g[14]],b);return[m[0],m[1],m[2],0,w[0],w[1],w[2],0,E[0],E[1],E[2],0,v[0],v[1],v[2],1]}(h,l,o)}return h}function xw(s,e,i,o){const h=Ht.projectAabbCorners(o,i);let l=Number.MAX_VALUE,f=-1;for(let M=0;M<h.length;++M){const m=h[M];m[0]=(.5*m[0]+.5)*e.width,m[1]=(.5-.5*m[1])*e.height,m[2]<l&&(f=M,l=m[2])}const g=M=>new ge(h[M][0],h[M][1]);let b;switch(f){case 0:case 6:b=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:b=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:b=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:b=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(q(s,b))return l}const HI=$i([{name:"a_pos_3f",components:3,type:"Float32"}]),$I=$i([{name:"a_color_3f",components:3,type:"Float32"}]),ZI=$i([{name:"a_color_4f",components:4,type:"Float32"}]),WI=$i([{name:"a_uv_2f",components:2,type:"Float32"}]),XI=$i([{name:"a_normal_3f",components:3,type:"Float32"}]),YI=$i([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),KI=$i([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),vw={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class w_{constructor(e,i,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function bw(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class ww{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Tw{constructor(){this.instancedDataArray=new Vc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class O0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,h){this.tileToMeter=t(o);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:g,index:b,sourceLayerIndex:M}of e){const m=g??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),w=k(f,l);if(!this.layers[0]._featureFilter.filter(new un(this.zoom),w,o))continue;const E={id:m,sourceLayerIndex:M,index:b,geometry:l?w.geometry:D(f,o,h),properties:f.properties,type:f.type,patterns:{}},v=this.addFeature(E,E.geometry,w);v&&i.featureIndex.insert(f,E.geometry,b,M,this.index,this.instancesPerModel[v].instancedDataArray.length,At/32)}this.lookup=null}update(e,i,o,h){for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];for(const g in e)f.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(f.features[f.idToFeaturesIndex[g]],e[g],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const h of o.features){const l=this.layers[0],f=h.feature,g=this.canonical,b=l.paint.get("model-rotation").evaluate(f,{},g),M=l.paint.get("model-scale").evaluate(f,{},g),m=l.paint.get("model-translation").evaluate(f,{},g);Te.vec3.exactEquals(h.rotation,b)&&Te.vec3.exactEquals(h.scale,M)&&Te.vec3.exactEquals(h.translation,m)||(this.evaluate(h,h.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(o0(this.activeReplacements,l))return!1;this.activeReplacements=l;let f=!1;for(const g in this.instancesPerModel){const b=this.instancesPerModel[g],M=b.instancedDataArray;for(const m of b.features){const w=m.instancedDataOffset,E=m.instancedDataCount;for(let v=0;v<E;v++){const T=16*(v+w);let I=M.float32[T+0];const z=I>At;I=z?I-At:I;const O=Math.floor(I),V=M.float32[T+1];let j=!1;for(const N of this.activeReplacements)if(!F1(N,o,vw.Model,h)&&!(N.min.x>O||O>N.max.x||N.min.y>V||V>N.max.y)&&(j=G1(j1(O,V,e.canonical,N.footprintTileId.canonical),N.footprint),j))break;M.float32[T]=j?I+At:I,f=f||j!==z}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,YI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const h=this.layers[0],l=h.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return _i(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),l;bw(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new Tw);const f=this.instancesPerModel[l],g=f.instancedDataArray,b=new ww(o,g.length);for(const M of i)for(const m of M){if(m.x<0||m.x>=At||m.y<0||m.y>=At)continue;const w=(this.lookupDim-1)/At,E=this.lookupDim*(m.y*w|0)+m.x*w|0;if(this.lookup){if(this.lookup[E]!==0)continue;this.lookup[E]=1}this.instanceCount++;const v=g.length;g.resize(v+1),f.instancesEvaluatedElevation.push(0),g.float32[16*v]=m.x,g.float32[16*v+1]=m.y}return b.instancedDataCount=f.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(b),this.evaluate(b,{},f,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,o,h){const l=this.layers[0],f=e.feature,g=this.canonical,b=e.rotation=l.paint.get("model-rotation").evaluate(f,i,g),M=e.scale=l.paint.get("model-scale").evaluate(f,i,g),m=e.translation=l.paint.get("model-translation").evaluate(f,i,g),w=l.paint.get("model-color").evaluate(f,i,g);w.a=l.paint.get("model-color-mix-intensity").evaluate(f,i,g);const E=[];this.maxVerticalOffset<m[2]&&(this.maxVerticalOffset=m[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),yw(E,b,M);const v=Math.round(100*w.a)+w.b/1.05;for(let T=0;T<e.instancedDataCount;++T){const I=e.instancedDataOffset+T,z=16*I,O=o.instancedDataArray.float32;let V=0;h&&(V=O[z+6]-o.instancesEvaluatedElevation[I]);const j=0|O[z+1];O[z]=(0|O[z])+w.r/1.05,O[z+1]=j+w.g/1.05,O[z+2]=v,O[z+3]=1/(g.z>10?this.tileToMeter:t(g,j)),O[z+4]=m[0],O[z+5]=m[1],O[z+6]=m[2]+V,O[z+7]=E[0],O[z+8]=E[1],O[z+9]=E[2],O[z+10]=E[4],O[z+11]=E[5],O[z+12]=E[6],O[z+13]=E[8],O[z+14]=E[9],O[z+15]=E[10],o.instancesEvaluatedElevation[I]=m[2]}}}let Sw,Ew;Nt(O0,"ModelBucket",{omit:["layers"]}),Nt(Tw,"PerModelAttributes"),Nt(ww,"ModelFeature");const Qc=64,Ch={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Mw(s,e,i,o,h,l,f,g,b,M=!1){const m=i.zoom,w=i.project(o),E=Il(o.lat,m),v=1/E;Te.mat4.identity(s),Te.mat4.translate(s,s,[w.x+f[0]*v,w.y+f[1]*v,f[2]]);let T=1,I=1;const z=i.worldSize;if(M){if(i.projection.name==="mercator"){let N=0;i.elevation&&(N=i.elevation.getAtPointOrZero(new n(w.x/z,w.y/z),0));const G=Te.vec4.transformMat4([],[w.x,w.y,N,1],i.projMatrix)[3]/i.cameraToCenterDistance;T=G,I=G*Il(i.center.lat,m)}else if(i.projection.name==="globe"){const N=L0(s,i),G=Te.mat4.multiply([],i.projMatrix,N),H=[0,0,0,1];Te.vec4.transformMat4(H,H,G);const K=H[3]/i.cameraToCenterDistance,se=Hr(m),re=i.projection.pixelsPerMeter(o.lat,z)*Il(o.lat,m),ie=i.projection.pixelsPerMeter(i.center.lat,z)*Il(i.center.lat,m);T=K/ni(re,If(i.center.lat),se),I=K*E/re,T*=ie,I*=ie}}else T=v;Te.mat4.scale(s,s,[T,T,I]);const O=[...s],V=e.orientation,j=[];if(yw(j,[V[0]+h[0],V[1]+h[1],V[2]+h[2]],l),Te.mat4.multiply(s,O,j),g&&i.elevation){let N=0;const G=[];if(b&&i.elevation){N=function(se,re,ie,_e,oe){const ye=re.elevation;if(!ye)return 0;const be=Ht.projectAabbCorners(ie,_e),ve=Vr(1,oe.lat)*re.worldSize,Ee=function(jt,Ct){const Lt=[0,0,1],ai=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const gi of ai){const yi=jt[gi.corners[0]],xi=jt[gi.corners[1]],Ai=jt[gi.corners[2]],Ii=[xi[0]-yi[0],xi[1]-yi[1],Ct*(xi[2]-yi[2])],an=Te.vec3.cross(Ii,Ii,[Ai[0]-yi[0],Ai[1]-yi[1],Ct*(Ai[2]-yi[2])]);Te.vec3.normalize(an,an),gi.dotProductWithUp=Te.vec3.dot(an,Lt)}return ai.sort((gi,yi)=>gi.dotProductWithUp-yi.dotProductWithUp),ai[0].corners}(be,ve),Ie=be[Ee[0]],De=be[Ee[1]],Ae=be[Ee[2]],Ye=be[Ee[3]],rt=ye.getAtPointOrZero(new n(Ie[0]/re.worldSize,Ie[1]/re.worldSize),0),Xe=ye.getAtPointOrZero(new n(De[0]/re.worldSize,De[1]/re.worldSize),0),It=ye.getAtPointOrZero(new n(Ae[0]/re.worldSize,Ae[1]/re.worldSize),0),Et=ye.getAtPointOrZero(new n(Ye[0]/re.worldSize,Ye[1]/re.worldSize),0),pt=(rt+Et)/2,ot=(Xe+It)/2;return pt>ot?Xe<It?b_(se,De,Ye,Ie,Xe,Et,rt,ve):b_(se,Ae,Ie,Ye,It,rt,Et,ve):rt<Et?b_(se,Ie,De,Ae,rt,Xe,It,ve):b_(se,Ye,Ae,De,Et,It,Xe,ve),Math.max(pt,ot)}(G,i,e.aabb,s,o);const H=Te.mat4.fromQuat([],G),K=Te.mat4.multiply([],H,j);Te.mat4.multiply(s,O,K)}else N=i.elevation.getAtPointOrZero(new n(w.x/z,w.y/z),0);N!==0&&(s[14]+=N)}}function Kf(s,e,i=!1){s.uploaded||(s.gfxTexture=new R0(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function JI(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,HI.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,XI.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,WI.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?$I:ZI).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,KI.members,!0)),s.segments=Rn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const o=s.material;o.pbrMetallicRoughness.baseColorTexture&&Kf(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Kf(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Kf(o.normalTexture,e),o.occlusionTexture&&Kf(o.occlusionTexture,e,i),o.emissionTexture&&Kf(o.emissionTexture,e)}function k0(s,e,i){if(s.meshes)for(const o of s.meshes)JI(o,e,i);if(s.children)for(const o of s.children)k0(o,e,i)}function T_(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)T_(e)}function F0(s){if(s.meshes)for(const i of s.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const i of s.children)F0(i)}class Ph{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const h=o||e.findDEMTileFor(i);if(!h||!h.dem)return;const l=h.dem,f=h.tileID,g=1<<i.canonical.z-f.canonical.z;return new Ph(h,l.dim/At/g,[(i.canonical.x/g-f.canonical.x)*l.dim,(i.canonical.y/g-f.canonical.y)*l.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new ge(h,l)}getElevationAt(e,i,o,h){const l=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],g=Math.floor(l),b=Math.floor(f),M=this._dem;return h=!!h,o?ni(ni(M.get(g,b,h),M.get(g,b+1,h),f-b),ni(M.get(g+1,b,h),M.get(g+1,b+1,h),f-b),l-g):M.get(g,b,h)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Vr(1,e)*this._dem.stride}}const B0=new Float32Array(262144),eu=new Uint8Array(262144);function Aw(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,Aw(i));return e}function Iw(s,e,i){if(s.meshes)for(const o of s.meshes){if(o.aabb.min[0]===1/0)continue;const h=Ht.applyTransform(o.aabb,s.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(s.children)for(const o of s.children)Iw(o,e,i)}const Cw=["","wall","door","roof","window","lamp","logo"];class Pw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Aw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Ht.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class S_{constructor(e,i,o,h,l,f,g){this.id=o,this.layers=e,this.layerIds=this.layers.map(b=>b.fqid),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.modelTraits|=Ch.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Ch.HasMapboxMeshFeatures),l&&(this.modelTraits|=Ch.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of i)this.nodesInfo.push(new Pw(b)),Iw(b,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const h=o.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!_t(e,this.states))for(const h of o)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const h=o.node;this.uploaded?this.updatePbrBuffer(h):k0(h,e,!0)}for(const o of i)T_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const h=e.transform.projectionOptions,l=e.style.getBrightness(),f=this.brightness!==l;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Jf(o.paint.get("model-color").value,f)||Jf(o.paint.get("model-color-mix-intensity").value,f)||Jf(o.paint.get("model-roughness").value,f)||Jf(o.paint.get("model-emissive-strength").value,f)||Jf(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=h,this.brightness=l;const g=this.getNodesInfo();for(const b of g)b.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),h=this.id.canonical;for(const l of o){const f=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},h)}}evaluate(e,i){const o=this.getNodesInfo();for(const h of o){if(!h.node.meshes)continue;const l=h.feature,f=i&&i[l.id];if(_t(f,h.state))continue;h.state=structuredClone(f);const g=h.node.meshes&&h.node.meshes[0].featureData,b=h.evaluatedColor[2],M=h.evaluatedRMEA[2],m=this.id.canonical;if(h.hasTranslucentParts=!1,g){for(let w=0;w<Cw.length;w++){const E=Cw[w];E.length&&(l.properties.part=E);const v=e.paint.get("model-color").evaluate(l,f,m).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(l,f,m);h.evaluatedColor[w]=[v.r,v.g,v.b,T],h.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(l,f,m),h.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(l,f,m),h.evaluatedRMEA[w][3]=v.a,h.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,f,m),!h.hasTranslucentParts&&v.a<1&&(h.hasTranslucentParts=!0)}delete l.properties.part,eC(h,b!==h.evaluatedColor[2]||M!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,f,m);h.evaluatedScale=e.paint.get("model-scale").evaluate(l,f,m),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,h){const l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const f=Ph.create(e,o,l);if(!f)return;this.modelTraits&Ch.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,h);for(const g of this.getNodesInfo()){const b=g.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const M=b.footprint.vertices;let m=f.getElevationAt(M[0].x,M[0].y,!0,!0);for(let w=1;w<M.length;w++)m=Math.min(m,f.getElevationAt(M[w].x,M[w].y,!0,!0));b.elevation=m}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,h){let l=i._dem._modifiedForSources[h];if(l===void 0&&(i._dem._modifiedForSources[h]=[],l=i._dem._modifiedForSources[h]),l.includes(o.canonical))return;const f=i._dem.dim;l.push(o.canonical);let g=!1;for(const b of this.getNodesInfo()){const M=b.node;if(!M.footprint||!M.footprint.grid)continue;const m=M.footprint.grid,w=i.tileCoordToPixel(m.min.x,m.min.y),E=i.tileCoordToPixel(m.max.x,m.max.y),v=Math.min(Math.min(f-E.y,w.x),Math.min(w.y,f-E.x));if(v<0)continue;const T=Mt(v,2,5);let I=Math.max(0,w.x-T),z=Math.max(0,w.y-T),O=Math.min(E.x+T,f-1),V=Math.min(E.y+T,f-1);for(let H=z;H<=V;++H)for(let K=I;K<=O;++K)eu[H*f+K]=255;let j=0,N=0;for(let H=0;H<m.cellsY;++H)for(let K=0;K<m.cellsX;++K){if(!m.cells[H*m.cellsX+K])continue;const se=i.tileCoordToPixel(m.min.x+K/m.xScale,m.min.y+H/m.yScale),re=i.tileCoordToPixel(m.min.x+(K+1)/m.xScale,m.min.y+(H+1)/m.yScale);for(let ie=se.y;ie<=Math.min(re.y+1,f-1);++ie)for(let _e=se.x;_e<=Math.min(re.x+1,f-1);++_e)eu[ie*f+_e]===255&&(eu[ie*f+_e]=0,j+=i.getElevationAtPixel(_e,ie),N++)}const G=j/N;I=Math.max(1,w.x-T),z=Math.max(1,w.y-T),O=Math.min(E.x+T,f-2),V=Math.min(E.y+T,f-2),g=!0;for(let H=z;H<=V;++H)for(let K=I;K<=O;++K)eu[H*f+K]===0&&(B0[H*f+K]=i._dem.set(K,H,G));for(let H=1;H<T;++H){I=Math.max(1,w.x-H),z=Math.max(1,w.y-H),O=Math.min(E.x+H,f-2),V=Math.min(E.y+H,f-2);for(let K=z;K<=V;++K)for(let se=I;se<=O;++se){const re=K*f+se;if(eu[re]===255){let ie=0,_e=0,oe=-1,ye=-1;for(let be=-1;be<=1;++be)for(let ve=-1;ve<=1;++ve){const Ee=(K+be)*f+se+ve;if(eu[Ee]>=H)continue;const Ie=B0[Ee],De=Math.abs(Ie);De>_e&&(ie=Ie,_e=De,oe=ve,ye=be)}if(_e>.1){const be=1-(H+.5*Math.abs(oe*ye))/T;let ve=i._dem.get(se,K)+ie*be;const Ee=i._dem.get(se+oe,K+ye),Ie=i._dem.get(se-oe,K-ye,!0);(ve-Ee)*(ve-Ie)>0&&(ve=(Ee+Ie)/2),B0[re]=i._dem.set(se,K,ve),eu[re]=H}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=de.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)T_(i.node),F0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const f=h[l].node;h[l].hiddenByReplacement=!!f.footprint&&!o.find(g=>g.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),h=[],l=[0,0,0],f=Te.mat4.identity([]);for(let g=0;g<this.nodesInfo.length;g++){const b=o[g],M=b.node.meshes[0],m=M.transformedAabb;if(e<m.min[0]||i<m.min[1]||e>m.max[0]||i>m.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};Te.mat4.invert(f,b.node.matrix),l[0]=e,l[1]=i,Te.vec3.transformMat4(l,l,f);const w=(l[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Qc|0,E=Math.min(63,(l[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Qc|0)*Qc+Math.min(63,w),v=M.heightmap[E];if(!(v<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:v,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new ge(e,i),new ge(e,i),h),h.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Jf(s,e){return!s.isLightConstant&&e}function QI(s,e,i,o,h,l,f,g){let b=(61440&e|(61440&e)>>4)>>8,M=(3840&e|(3840&e)>>4)>>4,m=240&e|(240&e)>>4;i[3]>0&&(b=ni(b,255*i[0],i[3]),M=ni(M,255*i[1],i[3]),m=ni(m,255*i[2],i[3]));const w=b<<8|M,E=m<<8|Math.floor(255*o[3]),v=function(H){const K=Mt(H,0,2);return Math.min(Math.round(.5*K*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],T=Mt(h[0],0,1),I=Mt(h[1],0,1),z=Mt(h[2],0,1),O=Mt(h[3],0,1);let V,j,N,G;if(T!==I&&f!==l&&I!==T){const H=f-l;j=1/(H*(I-T)),N=-(l+H*T)/(H*(I-T));const K=Mt(h[4],-1,1);G=Math.pow(10,K),V=255*z<<8|255*O}else V=65535,j=0,N=1,G=1;if(s.emplaceBack(w,E,v,V,j,N,G),g){const H=g.length;g.clear();for(let K=0;K<H;K++)g.emplaceBack(w,E,v,V,j,N,G)}}function eC(s,e,i){const o=s.node;let h=0;const l=i&Ch.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===h||!f.featureData)continue;f.featureArray=new Uc,f.featureArray.reserve(f.featureData.length);let g=e;for(const b of f.featureData){const M=l?65535&b:b>>16&65535,m=l?b>>16&65535:65535&b,w=(15&m)<8?15&m:0,E=s.evaluatedRMEA[w],v=s.evaluatedColor[w],T=s.emissionHeightBasedParams[w];let I;if(g&&w===2&&o.lights&&(I=new Uc,I.resize(10*o.lights.length)),QI(f.featureArray,M,v,E,T,f.aabb.min[2],f.aabb.max[2],I),I&&g){g=!1;const z=o.meshes[o.lightMeshIndex];z.featureArray=I,z.featureArray._trim()}}f.featureArray._trim(),h++}}function Rw(s,e,i,o){const h=1<<s.z;e.lat=dr((o/At+s.y)/h),e.lng=Jr((i/At+s.x)/h)}Nt(S_,"Tiled3dModelBucket",{omit:["layers"]}),Nt(Pw,"Tiled3dModelFeature");const tC={circle:class extends sr{constructor(s,e,i,o){super(s,{layout:lt||(lt=new vn({"circle-sort-key":new Dt(Fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new yt(Fe.layout_circle["circle-elevation-reference"]),visibility:new yt(Fe.layout_circle.visibility)})),paint:Ce||(Ce=new vn({"circle-radius":new Dt(Fe.paint_circle["circle-radius"]),"circle-color":new Dt(Fe.paint_circle["circle-color"]),"circle-blur":new Dt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Dt(Fe.paint_circle["circle-opacity"]),"circle-translate":new yt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new yt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(Fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new yt(Fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(s){return new Z(s)}queryRadius(s){const e=s;return Qe("circle-radius",this,e)+Qe("circle-stroke-width",this,e)+Ke(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,o,h,l,f,g){const b=Ze(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return bh(s,o,l,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const o=Cl(this);return{config:new ka(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends sr{createBucket(s){return new c1(s)}constructor(s,e,i,o){super(s,{layout:u1||(u1=new vn({visibility:new yt(Fe.layout_heatmap.visibility)})),paint:h1||(h1=new vn({"heatmap-radius":new Dt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vl(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt(Fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Qe("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,o,h,l,f,g){const b=this.paint.get("heatmap-radius").evaluate(e,i);return bh(s,o,l,f,g,!0,!0,new ge(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new ka(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends sr{constructor(s,e,i,o){super(s,{layout:d1||(d1=new vn({visibility:new yt(Fe.layout_hillshade.visibility)})),paint:f1||(f1=new vn({"hillshade-illumination-direction":new yt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new yt(Fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends sr{constructor(s,e,i,o){super(s,{layout:w1||(w1=new vn({"fill-sort-key":new Dt(Fe.layout_fill["fill-sort-key"]),visibility:new yt(Fe.layout_fill.visibility),"fill-elevation-reference":new yt(Fe.layout_fill["fill-elevation-reference"])})),paint:T1||(T1=new vn({"fill-antialias":new yt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Dt(Fe.paint_fill["fill-opacity"]),"fill-color":new Dt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Dt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new yt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new yt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dt(Fe.paint_fill["fill-pattern"]),"fill-emissive-strength":new yt(Fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dt(Fe.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new ka(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new e0(s)}queryRadius(){return Ke(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,o,h,l){return!s.queryGeometry.isAboveHorizon&&X(Pe(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends sr{constructor(s,e,i,o){super(s,{layout:rb||(rb=new vn({visibility:new yt(Fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new yt(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:sb||(sb=new vn({"fill-extrusion-opacity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dt(Fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new t_(s)}queryRadius(){return Ke(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,o,h,l,f,g,b){const M=Ze(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(e,i),w=this.paint.get("fill-extrusion-base").evaluate(e,i),E=[0,0],v=g&&l.elevation,T=l.elevation?l.elevation.exaggeration():1,I=s.tile.getBucket(this);if(v&&I instanceof t_){const N=I.centroidVertexArray,G=b+1;G<N.length&&(E[0]=N.geta_centroid_pos0(G),E[1]=N.geta_centroid_pos1(G))}if(E[0]===0&&E[1]===1)return!1;l.projection.name==="globe"&&(o=nb([o],[new ge(0,0),new ge(At,At)],s.tileID.canonical).map(N=>N.polygon).flat());const z=v?g:null,[O,V]=function(N,G,H,K,se,re,ie,_e,oe,ye,be){return N.projection.name==="globe"?function(ve,Ee,Ie,De,Ae,Ye,rt,Xe,It,Et,pt){const ot=[],jt=[],Ct=ve.projection.upVectorScale(pt,ve.center.lat,ve.worldSize).metersToTile,Lt=[0,0,0,1],ai=[0,0,0,1],gi=(xi,Ai,Ii,an)=>{xi[0]=Ai,xi[1]=Ii,xi[2]=an,xi[3]=1},yi=ib();Ie>0&&(Ie+=yi),De+=yi;for(const xi of Ee){const Ai=[],Ii=[];for(const an of xi){const nn=an.x+Ae.x,fi=an.y+Ae.y,Yi=ve.projection.projectTilePoint(nn,fi,pt),Ji=ve.projection.upVector(pt,an.x,an.y);let mn=Ie,On=De;if(rt){const Hn=ab(nn,fi,Ie,De,rt,Xe,It,Et);mn+=Hn.base,On+=Hn.top}Ie!==0?gi(Lt,Yi.x+Ji[0]*Ct*mn,Yi.y+Ji[1]*Ct*mn,Yi.z+Ji[2]*Ct*mn):gi(Lt,Yi.x,Yi.y,Yi.z),gi(ai,Yi.x+Ji[0]*Ct*On,Yi.y+Ji[1]*Ct*On,Yi.z+Ji[2]*Ct*On),Te.vec3.transformMat4(Lt,Lt,Ye),Te.vec3.transformMat4(ai,ai,Ye),Ai.push(new Jc(Lt[0],Lt[1],Lt[2])),Ii.push(new Jc(ai[0],ai[1],ai[2]))}ot.push(Ai),jt.push(Ii)}return[ot,jt]}(N,G,H,K,se,re,ie,_e,oe,ye,be):ie?function(ve,Ee,Ie,De,Ae,Ye,rt,Xe,It){const Et=[],pt=[],ot=[0,0,0,1];for(const jt of ve){const Ct=[],Lt=[];for(const ai of jt){const gi=ai.x+De.x,yi=ai.y+De.y,xi=ab(gi,yi,Ee,Ie,Ye,rt,Xe,It);ot[0]=gi,ot[1]=yi,ot[2]=xi.base,ot[3]=1,Te.vec4.transformMat4(ot,ot,Ae),ot[3]=Math.max(ot[3],1e-5);const Ai=new Jc(ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]);ot[0]=gi,ot[1]=yi,ot[2]=xi.top,ot[3]=1,Te.vec4.transformMat4(ot,ot,Ae),ot[3]=Math.max(ot[3],1e-5);const Ii=new Jc(ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]);Ct.push(Ai),Lt.push(Ii)}Et.push(Ct),pt.push(Lt)}return[Et,pt]}(G,H,K,se,re,ie,_e,oe,ye):function(ve,Ee,Ie,De,Ae){const Ye=[],rt=[],Xe=Ae[8]*Ee,It=Ae[9]*Ee,Et=Ae[10]*Ee,pt=Ae[11]*Ee,ot=Ae[8]*Ie,jt=Ae[9]*Ie,Ct=Ae[10]*Ie,Lt=Ae[11]*Ie;for(const ai of ve){const gi=[],yi=[];for(const xi of ai){const Ai=xi.x+De.x,Ii=xi.y+De.y,an=Ae[0]*Ai+Ae[4]*Ii+Ae[12],nn=Ae[1]*Ai+Ae[5]*Ii+Ae[13],fi=Ae[2]*Ai+Ae[6]*Ii+Ae[14],Yi=Ae[3]*Ai+Ae[7]*Ii+Ae[15],Ji=an+Xe,mn=nn+It,On=fi+Et,Hn=Math.max(Yi+pt,1e-5),kn=an+ot,In=nn+jt,Nn=fi+Ct,Yn=Math.max(Yi+Lt,1e-5);gi.push(new Jc(Ji/Hn,mn/Hn,On/Hn)),yi.push(new Jc(kn/Yn,In/Yn,Nn/Yn))}Ye.push(gi),rt.push(yi)}return[Ye,rt]}(G,H,K,se,re)}(l,o,w,m,M,f,z,E,T,l.center.lat,s.tileID.canonical),j=s.queryGeometry;return function(N,G,H){let K=1/0;X(H,G)&&(K=ob(H,G[0]));for(let se=0;se<G.length;se++){const re=G[se],ie=N[se];for(let _e=0;_e<re.length-1;_e++){const oe=re[_e],ye=[oe,re[_e+1],ie[_e+1],ie[_e],oe];q(H,ye)&&(K=Math.min(K,ob(H,ye)))}}return K!==1/0&&K}(O,V,j.isPointQuery()?j.screenBounds:j.screenGeometry)}},line:class extends sr{constructor(s,e,i,o){const h=gb();super(s,h,e,i,o),h.layout&&(this.layout=new xl(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof cl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(Nf)return Nf;const i=gb();return Nf=new rI(i.paint.properties["line-width"].specification),Nf.useIntegerZoom=!0,Nf})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new u0(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const o=mb(this);return{config:new ka(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(s){const e=s,i=yb(Qe("line-width",this,e),Qe("line-gap-width",this,e)),o=Qe("line-offset",this,e);return i/2+Math.abs(o)+Ke(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,o,h,l){if(s.queryGeometry.isAboveHorizon)return!1;const f=Pe(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),g=s.pixelToTileUnitsFactor/2*yb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(o=function(M,m){const w=[],E=new ge(0,0);for(let v=0;v<M.length;v++){const T=M[v],I=[];for(let z=0;z<T.length;z++){const O=T[z],V=T[z+1],j=z===0?E:O.sub(T[z-1])._unit()._perp(),N=z===T.length-1?E:V.sub(O)._unit()._perp(),G=j._add(N)._unit();G._mult(1/(G.x*N.x+G.y*N.y)),I.push(G._mult(m)._add(O))}w.push(I)}return w}(o,b*s.pixelToTileUnitsFactor)),function(M,m,w){for(let E=0;E<m.length;E++){const v=m[E];if(M.length>=3){for(let T=0;T<v.length;T++)if(ue(M,v[T]))return!0}if(te(M,v,w))return!0}return!1}(f,o,g)}isTileClipped(){return!0}isDraped(s){return!this.hasElevatedBuckets}},symbol:__,background:class extends sr{constructor(s,e,i,o){super(s,{layout:iw||(iw=new vn({visibility:new yt(Fe.layout_background.visibility)})),paint:nw||(nw=new vn({"background-pitch-alignment":new yt(Fe.paint_background["background-pitch-alignment"]),"background-color":new yt(Fe.paint_background["background-color"]),"background-pattern":new yt(Fe.paint_background["background-pattern"]),"background-opacity":new yt(Fe.paint_background["background-opacity"]),"background-emissive-strength":new yt(Fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:lw,"raster-particle":pw,sky:class extends sr{constructor(s,e,i,o){super(s,{layout:hw||(hw=new vn({visibility:new yt(Fe.layout_sky.visibility)})),paint:dw||(dw=new vn({"sky-type":new yt(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new yt(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yt(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yt(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yt(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new vl(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yt(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yt(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yt(Fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),h=!o,l=s.style.light,f=l.properties.get("position");return h&&l.properties.get("anchor")==="viewport"&&_i("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?D0(f.azimuthal,90-f.polar,e):D0(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return D0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends sr{constructor(s,e,i,o){super(s,{paint:fw||(fw=new vn({}))},e,null)}},model:class extends sr{constructor(s,e,i,o){super(s,{layout:Sw||(Sw=new vn({visibility:new yt(Fe.layout_model.visibility),"model-id":new Dt(Fe.layout_model["model-id"])})),paint:Ew||(Ew=new vn({"model-opacity":new Dt(Fe.paint_model["model-opacity"]),"model-rotation":new Dt(Fe.paint_model["model-rotation"]),"model-scale":new Dt(Fe.paint_model["model-scale"]),"model-translation":new Dt(Fe.paint_model["model-translation"]),"model-color":new Dt(Fe.paint_model["model-color"]),"model-color-mix-intensity":new Dt(Fe.paint_model["model-color-mix-intensity"]),"model-type":new yt(Fe.paint_model["model-type"]),"model-cast-shadows":new yt(Fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new yt(Fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new yt(Fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dt(Fe.paint_model["model-emissive-strength"]),"model-roughness":new Dt(Fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dt(Fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new yt(Fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new yt(Fe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new O0(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof S_?At-1:0}queryIntersectsFeature(s,e,i,o,h,l){if(!this.modelManager)return!1;const f=this.modelManager,g=s.tile.getBucket(this);if(!(g&&g instanceof O0))return!1;for(const b in g.instancesPerModel){const M=g.instancesPerModel[b],m=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(m)){const w=M.features[M.idToFeaturesIndex[m]],E=f.getModel(b,this.scope);if(!E)return!1;let v=Te.mat4.create();const T=new Ni(0,0),I=g.canonical;let z=Number.MAX_VALUE;for(let O=0;O<w.instancedDataCount;++O){const V=16*(w.instancedDataOffset+O),j=M.instancedDataArray.float32,N=[j[V+4],j[V+5],j[V+6]];Rw(I,T,j[V],0|j[V+1]),Mw(v,E,l,T,w.rotation,w.scale,N,!1,!1,!1),l.projection.name==="globe"&&(v=L0(v,l));const G=Te.mat4.multiply([],l.projMatrix,v),H=s.queryGeometry,K=xw(H.isPointQuery()?H.screenBounds:H.screenGeometry,l,G,E.aabb);K!=null&&(z=Math.min(K,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Cc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends sr{constructor(s,e,i,o){super(s,{layout:S1||(S1=new vn({"clip-layer-types":new yt(Fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new yt(Fe.layout_clip["clip-layer-scope"])})),paint:E1||(E1=new vn({}))},e,i,o)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new M1(s)}isTileClipped(){return!0}is3D(){return!0}}};class iC{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nC{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new iC(this.process),this.nextId=0}add(e,i){const o=this.nextId++,h=function({type:l,isSymbolTile:f,zoom:g}){return g=g||0,l==="message"?0:l!=="maybePrepare"||f?l!=="parseTile"||f?l==="parseTile"&&f?300-g:l==="maybePrepare"&&f?400-g:500:200-g:100-g}(i);if(h===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:h,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const l=this.tasks[this.taskQueue[h]];l.priority<i&&(i=l.priority,e=h)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Dw{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nC}send(e,i,o,h,l=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[g]=o);const b=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:h,mustQueue:l,sourceMapId:this.mapId,data:ia(i,b)},b),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[o];delete this.cancelCallbacks[o],h&&h.cancel()}else if(i.mustQueue||Mo()){const h=this.callbacks[o],l=this.scheduler.add(()=>this.processTask(o,i),h&&h.metadata||{type:"message"});l&&(this.cancelCallbacks[o]=l)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Ra(i.error)):o(null,Ra(i.data)))}else{const o=new Set,h=i.hasCallback?(f,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?ia(f):null,data:ia(g,o)},o)}:()=>{},l=Ra(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,h);else if(this.parent.getWorkerSource){const f=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,f[0],l.source,l.scope)[f[1]](l,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Qf={workerUrl:"",workerClass:null,workerParams:void 0};const N0="mapboxgl_preloaded_worker_pool";class tu{constructor(){this.active={}}acquire(e,i=tu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Qf.workerClass!=null?new Qf.workerClass:new self.Worker(Qf.workerUrl,Qf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[N0]}numActive(){return Object.keys(this.active).length}}tu.workerCount=2;class Rh{constructor(e,i,o="Worker",h=tu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Qn();const l=this.workerPool.acquire(this.id,h);for(let f=0;f<l.length;f++){const g=new Rh.Actor(l[f],i,this.id);g.name=`${o} ${f}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Gi(this.actors,(h,l)=>{h.send(e,i,l)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ep,V0;function E_(){return ep||(ep=new tu),ep}Rh.Actor=Dw;const U0=new Hi(0,0,0);var j0=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(j0||{}),M_=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(M_||{}),tp=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(tp||{}),zw=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(zw||{}),Dh=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(Dh||{}),Lw=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(Lw||{});function rC(s,e,i){s===1&&e.icons.push(function(o,h){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:f}=l;if(f.content_area){const{content_area:g}=f;g.top==null&&(g.top=g.left),g.width==null&&(g.width=l.usvg_tree.width),g.height==null&&(g.height=g.width)}return f.stretch_x&&f.stretch_x.length&&Ow(f,"x"),f.stretch_y&&f.stretch_y.length&&Ow(f,"y"),l}(o.readFields(sC,{name:void 0},h))}(i,i.readVarint()+i.pos))}function Ow(s,e){const i=[],o=s[`stretch_${e}`];let h=null;for(let l=0;l<o.length;l++)h===null?h=i.length===0?o[0]:i[i.length-1][1]+o[l]:(i.push([h,h+o[l]]),h=null);s[`stretch_${e}_areas`]=i}function sC(s,e,i){s===1?e.name=i.readString():s===2?e.metadata=function(o,h){return o.readFields(oC,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):s===3&&(e.usvg_tree=function(o,h){return o.readFields(cC,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function oC(s,e,i){s===1?e.stretch_x=i.readPackedVarint():s===2?e.stretch_y=i.readPackedVarint():s===3?e.content_area=function(o,h){return o.readFields(aC,{left:0},h)}(i,i.readVarint()+i.pos):s===4&&e.variables.push(function(o,h){return o.readFields(lC,{name:void 0},h)}(i,i.readVarint()+i.pos))}function aC(s,e,i){s===1?e.left=i.readVarint():s===2?e.width=i.readVarint():s===3?e.top=i.readVarint():s===4&&(e.height=i.readVarint())}function lC(s,e,i){s===1?e.name=i.readString():s===2&&(e.rgb_color=C_(i.readVarint()),e.value="rgb_color")}function cC(s,e,i){s===1?e.width=e.height=i.readVarint():s===2?e.height=i.readVarint():s===3?e.children.push(A_(i,i.readVarint()+i.pos)):s===4?e.linear_gradients.push(function(o,h){return o.readFields(_C,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):s===5?e.radial_gradients.push(function(o,h){return o.readFields(yC,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):s===7?e.clip_paths.push(function(o,h){return o.readFields(xC,{children:[]},h)}(i,i.readVarint()+i.pos)):s===8&&e.masks.push(function(o,h){const l=o.readFields(vC,{left:0,width:20,mask_type:1,children:[]},h);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function A_(s,e){return s.readFields(uC,{},e)}function uC(s,e,i){s===1?(e.group=function(o,h){return o.readFields(hC,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),e.node="group"):s===2&&(e.path=function(o,h){return o.readFields(fC,{paint_order:1,commands:[],step:1,diffs:[],rule:1},h)}(i,i.readVarint()+i.pos),e.node="path")}function hC(s,e,i){s===1?e.transform=I_(i,i.readVarint()+i.pos):s===2?e.opacity=i.readVarint():s===5?e.clip_path_idx=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(A_(i,i.readVarint()+i.pos))}function I_(s,e){return s.readFields(dC,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function dC(s,e,i){s===1?e.sx=i.readFloat():s===2?e.ky=i.readFloat():s===3?e.kx=i.readFloat():s===4?e.sy=i.readFloat():s===5?e.tx=i.readFloat():s===6&&(e.ty=i.readFloat())}function fC(s,e,i){s===1?e.fill=function(o,h){return o.readFields(pC,{rgb_color:U0,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):s===2?e.stroke=function(o,h){return o.readFields(mC,{rgb_color:U0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):s===3?e.paint_order=i.readVarint():s===5?i.readPackedVarint(e.commands):s===6?e.step=i.readFloat():s===7?i.readPackedSVarint(e.diffs):s===8&&(e.rule=i.readVarint())}function pC(s,e,i){s===1?(e.rgb_color=C_(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=i.readVarint())}function C_(s){return new Hi((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function mC(s,e,i){s===1?(e.rgb_color=C_(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5?i.readPackedFloat(e.dasharray):s===6?e.dashoffset=i.readFloat():s===7?e.miterlimit=i.readFloat():s===8?e.opacity=i.readVarint():s===9?e.width=i.readFloat():s===10?e.linecap=i.readVarint():s===11&&(e.linejoin=i.readVarint())}function _C(s,e,i){s===1?e.transform=I_(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(kw(i,i.readVarint()+i.pos)):s===4?e.x1=i.readFloat():s===5?e.y1=i.readFloat():s===6?e.x2=i.readFloat():s===7&&(e.y2=i.readFloat())}function kw(s,e){return s.readFields(gC,{offset:0,opacity:255,rgb_color:U0},e)}function gC(s,e,i){s===1?e.offset=i.readFloat():s===2?e.opacity=i.readVarint():s===3&&(e.rgb_color=C_(i.readVarint()))}function yC(s,e,i){s===1?e.transform=I_(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(kw(i,i.readVarint()+i.pos)):s===4?e.cx=i.readFloat():s===5?e.cy=i.readFloat():s===6?e.r=i.readFloat():s===7?e.fx=i.readFloat():s===8?e.fy=i.readFloat():s===9&&(e.fr=i.readFloat())}function xC(s,e,i){s===1?e.transform=I_(i,i.readVarint()+i.pos):s===2?e.clip_path_idx=i.readVarint():s===3&&e.children.push(A_(i,i.readVarint()+i.pos))}function vC(s,e,i){s===1?e.left=e.top=i.readFloat():s===2?e.width=e.height=i.readFloat():s===3?e.top=i.readFloat():s===4?e.height=i.readFloat():s===5?e.mask_type=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(A_(i,i.readVarint()+i.pos))}class bC{static calculate(e,i){const o=new Map,h=new Map;if(Object.keys(e).length===0)return o;i.forEach(l=>{h.set(l.name,l.rgb_color||new Hi(0,0,0))});for(const[l,f]of Object.entries(e))h.has(l)?o.set(h.get(l).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${l}"`);return o}}function zh(s,e=255,i){const o=e/255,h=s.toStringPremultipliedAlpha(),l=i.has(h)?i.get(h).clone():s.clone();return l.a=o,l.toString()}function ip(s,e){if(!ee()){const i=document.createElement("canvas");return i.width=s,i.height=e,i}return new OffscreenCanvas(s,e)}function wC(s,e){const i=bC.calculate(e.params,s.metadata?s.metadata.variables:[]),o=s.usvg_tree,h=o.width,l=o.height,f=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(h*f.a)),b=Math.max(1,Math.round(l*f.d)),M=new DOMMatrix([g/h,0,0,b/l,0,0]),m=ip(g,b).getContext("2d");return G0(m,M,o,o,i),m.getImageData(0,0,g,b)}function G0(s,e,i,o,h){for(const l of o.children)Fw(s,e,i,l,h)}function Fw(s,e,i,o,h){o.group?(s.save(),function(l,f,g,b,M){const m=b.mask_idx!=null?g.masks[b.mask_idx]:null,w=b.clip_path_idx!=null?g.clip_paths[b.clip_path_idx]:null;if(b.transform&&(f=P_(b.transform).preMultiplySelf(f)),!function(T,I,z){return T.opacity!==255||I||z}(b,w!=null,m!=null))return void G0(l,f,g,b,M);const E=ip(l.canvas.width,l.canvas.height),v=E.getContext("2d");G0(v,f,g,b,M),w&&qw(v,f,g,w),m&&Hw(v,f,g,m,M),l.globalAlpha=b.opacity/255,l.drawImage(E,0,0)}(s,e,i,o.group,h),s.restore()):o.path&&(s.save(),function(l,f,g,b,M){const m=$w(b);l.setTransform(f),b.paint_order===zw.PAINT_ORDER_FILL_AND_STROKE?(Bw(l,g,b,m,M),Vw(l,g,b,m,M)):(Vw(l,g,b,m,M),Bw(l,g,b,m,M))}(s,e,i,o.path,h),s.restore())}function Bw(s,e,i,o,h){const l=i.fill;if(!l)return;const f=l.opacity/255;switch(l.paint){case"rgb_color":s.fillStyle=zh(l.rgb_color,l.opacity,h);break;case"linear_gradient_idx":s.fillStyle=Uw(s,e.linear_gradients[l.linear_gradient_idx],f,h);break;case"radial_gradient_idx":s.fillStyle=jw(s,e.radial_gradients[l.radial_gradient_idx],f,h)}s.fill(o,Nw(i))}function Nw(s){return s.rule===j0.PATH_RULE_NON_ZERO?"nonzero":s.rule===j0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Vw(s,e,i,o,h){const l=i.stroke;if(!l)return;s.lineWidth=l.width,s.miterLimit=l.miterlimit,s.setLineDash(l.dasharray),s.lineDashOffset=l.dashoffset;const f=l.opacity/255;switch(l.paint){case"rgb_color":s.strokeStyle=zh(l.rgb_color,l.opacity,h);break;case"linear_gradient_idx":s.strokeStyle=Uw(s,e.linear_gradients[l.linear_gradient_idx],f,h);break;case"radial_gradient_idx":s.strokeStyle=jw(s,e.radial_gradients[l.radial_gradient_idx],f,h)}switch(l.linejoin){case tp.LINE_JOIN_MITER_CLIP:case tp.LINE_JOIN_MITER:s.lineJoin="miter";break;case tp.LINE_JOIN_ROUND:s.lineJoin="round";break;case tp.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(l.linecap){case M_.LINE_CAP_BUTT:s.lineCap="butt";break;case M_.LINE_CAP_ROUND:s.lineCap="round";break;case M_.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(o)}function Uw(s,e,i,o){if(e.stops.length===1){const E=e.stops[0];return zh(E.rgb_color,E.opacity*i,o)}const h=P_(e.transform),{x1:l,y1:f,x2:g,y2:b}=e,M=h.transformPoint(new DOMPoint(l,f)),m=h.transformPoint(new DOMPoint(g,b)),w=s.createLinearGradient(M.x,M.y,m.x,m.y);for(const E of e.stops)w.addColorStop(E.offset,zh(E.rgb_color,E.opacity*i,o));return w}function jw(s,e,i,o){if(e.stops.length===1){const E=e.stops[0];return zh(E.rgb_color,E.opacity*i,o)}const h=P_(e.transform),{fx:l,fy:f,cx:g,cy:b}=e,M=h.transformPoint(new DOMPoint(l,f)),m=h.transformPoint(new DOMPoint(g,b)),w=s.createRadialGradient(M.x,M.y,0,m.x,m.y,e.r*((h.a+h.d)/2));for(const E of e.stops)w.addColorStop(E.offset,zh(E.rgb_color,E.opacity*i,o));return w}function Gw(s,e,i,o){const h=o.transform?P_(o.transform).preMultiplySelf(e):e,l=ip(s.canvas.width,s.canvas.height),f=l.getContext("2d");for(const b of o.children)if(b.group)Gw(f,h,i,b.group);else if(b.path){const M=b.path,m=new Path2D;m.addPath($w(M),h),f.fill(m,Nw(M))}const g=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;g&&qw(f,h,i,g),s.globalCompositeOperation="source-over",s.drawImage(l,0,0)}function qw(s,e,i,o){const h=ip(s.canvas.width,s.canvas.height);Gw(h.getContext("2d"),e,i,o),s.globalCompositeOperation="destination-in",s.drawImage(h,0,0)}function Hw(s,e,i,o,h){if(o.children.length===0)return;const l=o.mask_idx!=null?i.masks[o.mask_idx]:null;l&&Hw(s,e,i,l,h);const f=s.canvas.width,g=s.canvas.height,b=ip(f,g),M=b.getContext("2d"),m=o.width,w=o.height,E=o.left,v=o.top,T=new Path2D,I=new Path2D;I.rect(E,v,m,w),T.addPath(I,e),M.clip(T);for(const V of o.children)Fw(M,e,i,V,h);const z=M.getImageData(0,0,f,g),O=z.data;if(o.mask_type===Lw.MASK_TYPE_LUMINANCE)for(let V=0;V<O.length;V+=4)O[V+3]=O[V+3]/255*(.2126*O[V]+.7152*O[V+1]+.0722*O[V+2]);M.putImageData(z,0,0),s.globalCompositeOperation="destination-in",s.drawImage(b,0,0)}function P_(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function $w(s){const e=new Path2D,i=s.step;let o=s.diffs[0]*i,h=s.diffs[1]*i;e.moveTo(o,h);for(let l=0,f=2;l<s.commands.length;l++)switch(s.commands[l]){case Dh.PATH_COMMAND_MOVE:o+=s.diffs[f++]*i,h+=s.diffs[f++]*i,e.moveTo(o,h);break;case Dh.PATH_COMMAND_LINE:o+=s.diffs[f++]*i,h+=s.diffs[f++]*i,e.lineTo(o,h);break;case Dh.PATH_COMMAND_QUAD:{const g=o+s.diffs[f++]*i,b=h+s.diffs[f++]*i;o=g+s.diffs[f++]*i,h=b+s.diffs[f++]*i,e.quadraticCurveTo(g,b,o,h);break}case Dh.PATH_COMMAND_CUBIC:{const g=o+s.diffs[f++]*i,b=h+s.diffs[f++]*i,M=g+s.diffs[f++]*i,m=b+s.diffs[f++]*i;o=M+s.diffs[f++]*i,h=m+s.diffs[f++]*i,e.bezierCurveTo(g,b,M,m,o,h);break}case Dh.PATH_COMMAND_CLOSE:e.closePath()}return e}class q0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class H0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new br(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new q0(150)),this.cacheMap.get(o).get(ao(e.serialize(),i))}setInCache(e,i,o,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new q0(150));const l=this.cacheDependenciesMap.get(h);l.get(ao(e.id,o))||l.set(ao(e.id,o),new Set);const f=this.cacheMap.get(h),g=e.serialize();l.get(ao(e.id,o)).add(g),f.put(ao(e.serialize(),o),i)}removeImagesFromCacheByIds(e,i,o=""){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const h=this.cacheMap.get(o),l=this.cacheDependenciesMap.get(o);for(const f of e)if(l.has(ao(f,i))){for(const g of l.get(ao(f,i)))h.delete(g);l.delete(ao(f,i))}}rasterize(e,i,o,h,l=wC){const f=this.getFromCache(e,o,h);if(f)return f.clone();const g=l(i.icon,e.options),b=H0._getImage(g);return this.setInCache(e,b,o,h),b.clone()}}class Zw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Ww(s,e,i,o){let h=0,l=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<s[f]||i[f]>e[f])return null}else{const g=1/o[f];let b=(s[f]-i[f])*g,M=(e[f]-i[f])*g;if(b>M){const m=b;b=M,M=m}if(b>h&&(h=b),M<l&&(l=M),h>l)return null}return h}function Xw(s,e,i,o,h,l,f,g,b,M,m){const w=o-s,E=h-e,v=l-i,T=f-s,I=g-e,z=b-i,O=m[1]*z-m[2]*I,V=m[2]*T-m[0]*z,j=m[0]*I-m[1]*T,N=w*O+E*V+v*j;if(Math.abs(N)<1e-15)return null;const G=1/N,H=M[0]-s,K=M[1]-e,se=M[2]-i,re=(H*O+K*V+se*j)*G;if(re<0||re>1)return null;const ie=K*v-se*E,_e=se*w-H*v,oe=H*E-K*w,ye=(m[0]*ie+m[1]*_e+m[2]*oe)*G;return ye<0||re+ye>1?null:(T*ie+I*_e+z*oe)*G}function Yw(s,e,i){return(s-e)/(i-e)}function Kw(s,e,i,o,h,l,f,g,b){const M=1<<i,m=l-o,w=f-h,E=(s+1)/M*m+o,v=(e+0)/M*w+h,T=(e+1)/M*w+h;g[0]=(s+0)/M*m+o,g[1]=v,b[0]=E,b[1]=T}class Jw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const f=Math.ceil(Math.log2(l.dim/8)),g=[];let b=Math.ceil(Math.pow(2,f));const M=1/b,m=(v,T,I,z,O)=>{const V=z?1:0,j=(v+1)*I-V,N=T*I,G=(T+1)*I-V;O[0]=v*I,O[1]=N,O[2]=j,O[3]=G};let w=new Zw(b);const E=[];for(let v=0;v<b*b;v++){m(v%b,Math.floor(v/b),M,!1,E);const T=kl(E[0],E[1],l),I=kl(E[2],E[1],l),z=kl(E[2],E[3],l),O=kl(E[0],E[3],l);w.minimums.push(Math.min(T,I,z,O)),w.maximums.push(Math.max(T,I,z,O)),w.leaves.push(1)}for(g.push(w),b/=2;b>=1;b/=2){const v=g[g.length-1];w=new Zw(b);for(let T=0;T<b*b;T++){m(T%b,Math.floor(T/b),2,!0,E);const I=v.getElevation(E[0],E[1]),z=v.getElevation(E[2],E[1]),O=v.getElevation(E[2],E[3]),V=v.getElevation(E[0],E[3]),j=v.isLeaf(E[0],E[1]),N=v.isLeaf(E[2],E[1]),G=v.isLeaf(E[2],E[3]),H=v.isLeaf(E[0],E[3]),K=Math.min(I.min,z.min,O.min,V.min),se=Math.max(I.max,z.max,O.max,V.max),re=j&&N&&G&&H;w.maximums.push(se),w.minimums.push(K),w.leaves.push(se-K<=5&&re?1:0)}g.push(w)}return g}(this.dem),o=i.length-1,h=i[o];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,h,l,f,g=1){return Ww([e,i,-100],[o,h,this.maximums[0]*g],l,f)}raycast(e,i,o,h,l,f,g=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,o,h,l,f,g);if(b==null)return null;const M=[],m=[],w=[],E=[],v=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;v.length>0;){const{idx:T,t:I,nodex:z,nodey:O,depth:V}=v.pop();if(this.leaves[T]){Kw(z,O,V,e,i,o,h,w,E);const N=1<<V,G=(z+0)/N,H=(z+1)/N,K=(O+0)/N,se=(O+1)/N,re=kl(G,K,this.dem)*g,ie=kl(H,K,this.dem)*g,_e=kl(H,se,this.dem)*g,oe=kl(G,se,this.dem)*g,ye=Xw(w[0],w[1],re,E[0],w[1],ie,E[0],E[1],_e,l,f),be=Xw(E[0],E[1],_e,w[0],E[1],oe,w[0],w[1],re,l,f),ve=Math.min(ye!==null?ye:Number.MAX_VALUE,be!==null?be:Number.MAX_VALUE);if(ve!==Number.MAX_VALUE)return ve;{const Ee=Te.vec3.scaleAndAdd([],l,f,I);if(Qw(re,ie,oe,_e,Yw(Ee[0],w[0],E[0]),Yw(Ee[1],w[1],E[1]))>=Ee[2])return I}continue}let j=0;for(let N=0;N<this._siblingOffset.length;N++){Kw((z<<1)+this._siblingOffset[N][0],(O<<1)+this._siblingOffset[N][1],V+1,e,i,o,h,w,E),w[2]=-100,E[2]=this.maximums[this.childOffsets[T]+N]*g;const G=Ww(w,E,l,f);if(G!=null){const H=G;M[N]=H;let K=!1;for(let se=0;se<j&&!K;se++)H>=M[m[se]]&&(m.splice(se,0,N),K=!0);K||(m[j]=N),j++}}for(let N=0;N<j;N++){const G=m[N];v.push({idx:this.childOffsets[T]+G,t:M[G],nodex:(z<<1)+this._siblingOffset[G][0],nodey:(O<<1)+this._siblingOffset[G][1],depth:V+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,h,l){if(e[h].isLeaf(i,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const f=h-1,g=e[f];let b=0,M=0;for(let m=0;m<this._siblingOffset.length;m++){const w=2*i+this._siblingOffset[m][0],E=2*o+this._siblingOffset[m][1],v=g.getElevation(w,E),T=g.isLeaf(w,E),I=this._addNode(v.min,v.max,T);T&&(b|=1<<m),M||(M=I)}for(let m=0;m<this._siblingOffset.length;m++)b&1<<m||this._construct(e,2*i+this._siblingOffset[m][0],2*o+this._siblingOffset[m][1],f,M+m)}}function Qw(s,e,i,o,h,l){return ni(ni(s,i,l),ni(e,o,l),h)}function kl(s,e,i){const o=i.dim,h=Mt(s*o-.5,0,o-1),l=Mt(e*o-.5,0,o-1),f=Math.floor(h),g=Math.floor(l),b=Math.min(f+1,o-1),M=Math.min(g+1,o-1);return Qw(i.get(f,g),i.get(b,g),i.get(f,M),i.get(b,M),h-f,l-g)}const TC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function SC(s,e,i){return(256*s*256+256*e+i)/10-1e4}function EC(s,e,i){return 256*s+e+i/256-32768}class R_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void _i(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<l;b++)f[this._idx(-1,b)]=f[this._idx(0,b)],f[this._idx(l,b)]=f[this._idx(l-1,b)],f[this._idx(b,-1)]=f[this._idx(b,0)],f[this._idx(b,l)]=f[this._idx(b,l-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(l,-1)]=f[this._idx(l-1,0)],f[this._idx(-1,l)]=f[this._idx(0,l-1)],f[this._idx(l,l)]=f[this._idx(l-1,l-1)]}const g=o==="terrarium"?EC:SC;for(let b=0;b<f.length;++b){const M=4*b;this.floatView[b]=g(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=de.now()}_buildQuadTree(){this._tree=new Jw(this)}get(e,i,o=!1){o&&(e=Mt(e,-1,this.dim),i=Mt(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,o){const h=this._idx(e,i),l=this.floatView[h];return this.floatView[h]=o,o-l}static getUnpackVector(e){return TC[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],h=R_.getUnpackVector(i);let l=Math.floor((e+h[3])/h[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new _1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,l=i*this.dim+this.dim,f=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:h=l-1;break;case 1:l=h+1}switch(o){case-1:f=g-1;break;case 1:g=f+1}const b=-i*this.dim,M=-o*this.dim;for(let m=f;m<g;m++)for(let w=h;w<l;w++){const E=4*this._idx(w,m),v=4*this._idx(w+b,m+M);this.pixels[E+0]=e.pixels[v+0],this.pixels[E+1]=e.pixels[v+1],this.pixels[E+2]=e.pixels[v+2],this.pixels[E+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function MC(s,e,i){s===1?e.headerLength=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(o,h){return o.readFields(RC,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function AC(s,e,i){s===1?(e.delta_filter=function(o,h){return o.readFields(IC,{blockSize:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function IC(s,e,i){s===1&&(e.blockSize=i.readVarint())}function CC(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function PC(s,e,i){let o=0,h=0;s===1?e.firstByte=i.readFixed64():s===2?e.lastByte=i.readFixed64():s===3?e.filters.push(function(l,f){return l.readFields(AC,{},f)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(l,f){return l.readFields(CC,{},f)}(i,i.readVarint()+i.pos):s===5?h=i.readFloat():s===6?o=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=o)}function RC(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tileSize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixelFormat=i.readVarint():s===7&&e.dataIndex.push(function(o,h){return o.readFields(PC,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function DC(s,e,i){if(s===2)(function(o,h,l){o.readFields(zC,l,h)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function zC(s,e,i){if(s===1){let o=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[o++]=i.readVarint()}}function LC(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const h=o===1?1:0,l=o===2?1:0;for(let f=0;f<e[0];f++){const g=e[1]*f;for(let b=h;b<e[1];b++){const M=e[2]*(b+g);for(let m=l;m<e[2];m++){const w=e[3]*(m+M);for(let E=0;E<e[3];E++){const v=w+E;s[v]+=s[v-i]}}}}i*=e[o]}return s}function OC(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function kC(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const o=s[i],h=s[i+1];s[i]=(240&o)>>4|(61440&o)>>8|(240&h)<<4|61440&h,s[i+1]=15&o|(3840&o)>>4|(15&h)<<8|(3840&h)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const o=s[i],h=s[i+1],l=s[i+2],f=s[i+3];s[i+0]=(192&o)>>6|(192&h)>>4|(192&l)>>2|192&f,s[i+1]=(48&o)>>4|(48&h)>>2|48&l|(48&f)<<2,s[i+2]=(12&o)>>2|12&h|(12&l)<<2|(12&f)<<4,s[i+3]=3&o|(3&h)<<2|(3&l)<<4|(3&f)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}Nt(R_,"DEMData"),Nt(Jw,"DemMinMaxQuadTree",{omit:["dem"]});var Gs=Uint8Array,np=Uint16Array,FC=Int32Array,eT=new Gs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tT=new Gs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),BC=new Gs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iT=function(s,e){for(var i=new np(31),o=0;o<31;++o)i[o]=e+=1<<s[o-1];var h=new FC(i[30]);for(o=1;o<30;++o)for(var l=i[o];l<i[o+1];++l)h[l]=l-i[o]<<5|o;return{b:i,r:h}},nT=iT(eT,2),rT=nT.b,NC=nT.r;rT[28]=258,NC[258]=28;for(var VC=iT(tT,0).b,sT=new np(32768),qn=0;qn<32768;++qn){var Lh=(43690&qn)>>1|(21845&qn)<<1;sT[qn]=((65280&(Lh=(61680&(Lh=(52428&Lh)>>2|(13107&Lh)<<2))>>4|(3855&Lh)<<4))>>8|(255&Lh)<<8)>>1}var rp=function(s,e,i){for(var o=s.length,h=0,l=new np(e);h<o;++h)s[h]&&++l[s[h]-1];var f,g=new np(e);for(h=1;h<e;++h)g[h]=g[h-1]+l[h-1]<<1;f=new np(1<<e);var b=15-e;for(h=0;h<o;++h)if(s[h])for(var M=h<<4|s[h],m=e-s[h],w=g[s[h]-1]++<<m,E=w|(1<<m)-1;w<=E;++w)f[sT[w]>>b]=M;return f},sp=new Gs(288);for(qn=0;qn<144;++qn)sp[qn]=8;for(qn=144;qn<256;++qn)sp[qn]=9;for(qn=256;qn<280;++qn)sp[qn]=7;for(qn=280;qn<288;++qn)sp[qn]=8;var oT=new Gs(32);for(qn=0;qn<32;++qn)oT[qn]=5;var UC=rp(sp,9),jC=rp(oT,5),$0=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},Vo=function(s,e,i){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(7&e)&i},Z0=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},GC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Uo=function(s,e,i){var o=new Error(e||GC[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,Uo),!i)throw o;return o},qC=new Gs(0),HC=typeof TextDecoder<"u"&&new TextDecoder;try{HC.decode(qC,{stream:!0})}catch{}const $C={gzip_data:"gzip"};class mo extends Error{constructor(e){super(e),this.name="MRTError"}}const ZC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},aT={uint32:1,uint16:2,uint8:4},WC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let W0;class X0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new mo(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new mo("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new mo(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const h=function(l,f){return l.readFields(MC,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new W0(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new mo(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const l of h.layers)this.layers[l.name]=new XC(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let h of e.blockIndices){const l=o.dataIndex[h],f=l.firstByte-e.firstByte,g=l.lastByte-e.firstByte;if(o._blocksInProgress.has(h))continue;const b={layerName:o.name,firstByte:f,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:h,blockShape:[l.bands.length].concat(o.bandShape),buffer:o.buffer,codec:l.codec.codec,filters:l.filters.map(M=>M.filter)};o._blocksInProgress.add(h),i.push(b)}return new lT(i,()=>{i.forEach(h=>o._blocksInProgress.delete(h.blockIndex))},(h,l)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),h)throw h;l.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class XC{constructor({version:e,name:i,units:o,tileSize:h,pixelFormat:l,buffer:f,dataIndex:g},b){if(this.version=e,this.version!==1)throw new mo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=h,this.buffer=f,this.pixelFormat=ZC[l],this.dataIndex=g,this.bandShape=[h+2*f,h+2*f,aT[this.pixelFormat]],this._decodedBlocks=new q0(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return aT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,h]of this.dataIndex.entries()){for(const[l,f]of h.bands.entries())if(f===e)return{bandIndex:i+l,blockIndex:o,blockBandIndex:l};i+=h.bands.length}break;case"number":for(const[o,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new mo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new mo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const h=[],l=new Set;for(const f of e){const{blockIndex:g}=this.getBlockForBand(f);if(g<0)throw new mo(`Invalid band: ${JSON.stringify(f)}`);const b=this.dataIndex[g];h.includes(g)||h.push(g),l.add(g),i=Math.min(i,b.firstByte),o=Math.max(o,b.lastByte)}if(l.size>this.cacheSize)throw new mo(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),h=this._decodedBlocks.get(i.toString());if(!h)throw new mo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],f=this.bandShape.reduce((M,m)=>M*m,1),g=o*f,b=h.subarray(g,g+f);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}X0.setPbf=function(s){W0=s};class lT{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}X0.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(o=>{const{layerName:h,firstByte:l,lastByte:f,pixelFormat:g,blockShape:b,blockIndex:M,filters:m,codec:w}=o,E=i.subarray(l,f+1),v=new Uint32Array(b[0]*b[1]*b[2]);let T;if(w!=="gzip_data")throw new mo(`Unhandled codec: ${w}`);return T=function(I,z){if(!globalThis.DecompressionStream&&z==="gzip_data")return Promise.resolve(((N=function(K){K[0]==31&&K[1]==139&&K[2]==8||Uo(6,"invalid gzip data");var se=K[3],re=10;4&se&&(re+=2+(K[10]|K[11]<<8));for(var ie=(se>>3&1)+(se>>4&1);ie>0;ie-=!K[re++]);return re+(2&se)}(j=I))+8>j.length&&Uo(6,"invalid gzip data"),function(K,se,re,ie){var _e=K.length;if(!_e||se.f&&!se.l)return re||new Gs(0);var oe=!re,ye=oe||se.i!=2,be=se.i;oe&&(re=new Gs(3*_e));var ve,Ee,Ie=function(Fl){var ru=re.length;if(Fl>ru){var cp=new Gs(Math.max(2*ru,Fl));cp.set(re),re=cp}},De=se.f||0,Ae=se.p||0,Ye=se.b||0,rt=se.l,Xe=se.d,It=se.m,Et=se.n,pt=8*_e;do{if(!rt){De=Vo(K,Ae,1);var ot=Vo(K,Ae+1,3);if(Ae+=3,!ot){var jt=K[(fi=4+((Ae+7)/8|0))-4]|K[fi-3]<<8,Ct=fi+jt;if(Ct>_e){be&&Uo(0);break}ye&&Ie(Ye+jt),re.set(K.subarray(fi,Ct),Ye),se.b=Ye+=jt,se.p=Ae=8*Ct,se.f=De;continue}if(ot==1)rt=UC,Xe=jC,It=9,Et=5;else if(ot==2){var Lt=Vo(K,Ae,31)+257,ai=Vo(K,Ae+10,15)+4,gi=Lt+Vo(K,Ae+5,31)+1;Ae+=14;for(var yi=new Gs(gi),xi=new Gs(19),Ai=0;Ai<ai;++Ai)xi[BC[Ai]]=Vo(K,Ae+3*Ai,7);Ae+=3*ai;var Ii=$0(xi),an=(1<<Ii)-1,nn=rp(xi,Ii);for(Ai=0;Ai<gi;){var fi,Yi=nn[Vo(K,Ae,an)];if(Ae+=15&Yi,(fi=Yi>>4)<16)yi[Ai++]=fi;else{var Ji=0,mn=0;for(fi==16?(mn=3+Vo(K,Ae,3),Ae+=2,Ji=yi[Ai-1]):fi==17?(mn=3+Vo(K,Ae,7),Ae+=3):fi==18&&(mn=11+Vo(K,Ae,127),Ae+=7);mn--;)yi[Ai++]=Ji}}var On=yi.subarray(0,Lt),Hn=yi.subarray(Lt);It=$0(On),Et=$0(Hn),rt=rp(On,It),Xe=rp(Hn,Et)}else Uo(1);if(Ae>pt){be&&Uo(0);break}}ye&&Ie(Ye+131072);for(var kn=(1<<It)-1,In=(1<<Et)-1,Nn=Ae;;Nn=Ae){var Yn=(Ji=rt[Z0(K,Ae)&kn])>>4;if((Ae+=15&Ji)>pt){be&&Uo(0);break}if(Ji||Uo(2),Yn<256)re[Ye++]=Yn;else{if(Yn==256){Nn=Ae,rt=null;break}var Rr=Yn-254;Yn>264&&(Rr=Vo(K,Ae,(1<<(Go=eT[Ai=Yn-257]))-1)+rT[Ai],Ae+=Go);var fn=Xe[Z0(K,Ae)&In],ps=fn>>4;if(fn||Uo(3),Ae+=15&fn,Hn=VC[ps],ps>3){var Go=tT[ps];Hn+=Z0(K,Ae)&(1<<Go)-1,Ae+=Go}if(Ae>pt){be&&Uo(0);break}ye&&Ie(Ye+131072);var _o=Ye+Rr;if(Ye<Hn){var go=0-Hn,nu=Math.min(Hn,_o);for(go+Ye<0&&Uo(3);Ye<nu;++Ye)re[Ye]=(void 0)[go+Ye]}for(;Ye<_o;++Ye)re[Ye]=re[Ye-Hn]}}se.l=rt,se.p=Nn,se.b=Ye,se.f=De,rt&&(De=1,se.m=It,se.d=Xe,se.n=Et)}while(!De);return Ye!=re.length&&oe?(ve=re,((Ee=Ye)==null||Ee>ve.length)&&(Ee=ve.length),new Gs(ve.subarray(0,Ee))):re.subarray(0,Ye)}(j.subarray(N,-8),{i:2},new Gs(((O=j)[(V=O.length)-4]|O[V-3]<<8|O[V-2]<<16|O[V-1]<<24)>>>0))));var O,V,j,N;const G=$C[z];if(!G)throw new Error(`Unhandled codec: ${z}`);const H=new globalThis.DecompressionStream(G);return new Response(new Blob([I]).stream().pipeThrough(H)).arrayBuffer().then(K=>new Uint8Array(K))}(E,w).then(I=>(function(z,O){z.readFields(DC,O)}(new W0(I),v),new WC[g](v.buffer))),T.then(I=>{for(let z=m.length-1;z>=0;z--)switch(m[z]){case"delta_filter":LC(I,b);break;case"zigzag_filter":OC(I);break;case"bitshuffle_filter":kC(I,g);break;default:throw new mo(`Unhandled filter "${m[z]}"`)}return{layerName:h,blockIndex:M,data:I}}).catch(I=>{throw I})}))},Nt(lT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let op,Y0,jo,Oh,K0,kh=null;function cT(){return Mo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Y0||Wn.DRACO_URL}function uT(){if(Mo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Oh)return Oh;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Oh=WebAssembly.validate(s)?Wn.MESHOPT_SIMD_URL:Wn.MESHOPT_URL,Oh}const D_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},YC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ap={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function hT(s,e,i){const o=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:h,byteLength:s.byteLength},i.buffers[h]=s}const J0="KHR_draco_mesh_compression";function KC(s,e){const i=s.extensions&&s.extensions[J0];if(!i)return;const o=new jo.Decoder,h=mT(e,i.bufferView),l=new jo.Mesh;if(!o.DecodeArrayToMesh(h,h.byteLength,l))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[s.indices],g=D_[f.componentType],b=f.count*g.BYTES_PER_ELEMENT,M=jo._malloc(b);g===Uint16Array?o.GetTrianglesUInt16Array(l,b,M):o.GetTrianglesUInt32Array(l,b,M),hT(jo.memory.buffer.slice(M,M+b),f,e),jo._free(M);for(const m of Object.keys(i.attributes)){const w=o.GetAttributeByUniqueId(l,i.attributes[m]),E=e.json.accessors[s.attributes[m]],v=YC[E.componentType],T=E.count*ap[E.type]*D_[E.componentType].BYTES_PER_ELEMENT,I=jo._malloc(T);o.GetAttributeDataArrayForAllPoints(l,w,jo[v],T,I),hT(jo.memory.buffer.slice(I,I+T),E,e),jo._free(I)}o.destroy(),l.destroy(),delete s.extensions[J0]}const z_="EXT_meshopt_compression";function JC(s,e){if(!s.extensions||!s.extensions[z_])return;const i=s.extensions[z_],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);K0.decodeGltfBuffer(h,i.count,i.byteStride,o,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=h.buffer,delete s.extensions[z_]}const dT=1179937895,fT=new TextDecoder("utf8");function pT(s,e){return new URL(s,e).href}function QC(s,e,i,o){return fetch(pT(s.uri,o)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function mT(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function eP(s,e,i,o){if(s.uri){const h=pT(s.uri,o);return fetch(h).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(s.bufferView!==void 0){const h=mT(e,s.bufferView),l=new Blob([h],{type:s.mimeType});return createImageBitmap(l).then(f=>{e.images[i]=f})}}function _T(s,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===dT){const m=new Uint32Array(s,e);let w=2;const E=(m[w++]>>2)-3,v=m[w++]>>2;if(w++,o.json=JSON.parse(fT.decode(m.subarray(w,w+v))),w+=v,w<E){const T=m[w++];w++;const I=e+(w<<2);o.buffers[0]=s.slice(I,I+T)}}else o.json=JSON.parse(fT.decode(new Uint8Array(s,e)));const{buffers:h,images:l,meshes:f,extensionsUsed:g,bufferViews:b}=o.json;let M=Promise.resolve();if(h){const m=[];for(let w=0;w<h.length;w++){const E=h[w];E.uri?m.push(QC(E,o,w,i)):o.buffers[w]||(o.buffers[w]=null)}M=Promise.all(m)}return M.then(()=>{const m=[],w=g&&g.includes(J0),E=g&&g.includes(z_);if(w&&m.push(function(){if(!jo)return op??(op=function(v){let T,I=null;function z(){T=new Uint8Array(I.buffer)}function O(){throw new Error("Unexpected Draco error.")}const V={a:{a:O,d:function(j,N,G){return T.copyWithin(j,N,N+G)},c:function(j){const N=T.length,G=Math.max(j>>>0,Math.ceil(1.2*N)),H=Math.ceil((G-N)/65536);try{return I.grow(H),z(),!0}catch{return!1}},b:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(v,V):v.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,V))).then(j=>{const{Rb:N,Qb:G,P:H,T:K,X:se,Ja:re,La:ie,Qa:_e,Va:oe,Wa:ye,eb:be,jb:ve,f:Ee,e:Ie,yb:De,zb:Ae,Ab:Ye,Bb:rt,Db:Xe,Gb:It}=j.instance.exports;I=Ie;const Et=(()=>{let pt=0,ot=0,jt=0,Ct=0;return Lt=>{jt&&(N(Ct),N(pt),ot+=jt,jt=pt=0),pt||(ot+=128,pt=G(ot));const ai=Lt.length+7&-8;let gi=pt;ai>=ot&&(jt=ai,gi=Ct=G(ai));for(let yi=0;yi<Lt.length;yi++)T[gi+yi]=Lt[yi];return gi}})();return z(),Ee(),{memory:Ie,_free:N,_malloc:G,Mesh:class{constructor(){this.ptr=H()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=re()}destroy(){ve(this.ptr)}DecodeArrayToMesh(pt,ot,jt){const Ct=Et(pt),Lt=ie(this.ptr,Ct,ot,jt.ptr);return!!se(Lt)}GetAttributeByUniqueId(pt,ot){return{ptr:_e(this.ptr,pt.ptr,ot)}}GetTrianglesUInt16Array(pt,ot,jt){oe(this.ptr,pt.ptr,ot,jt)}GetTrianglesUInt32Array(pt,ot,jt){ye(this.ptr,pt.ptr,ot,jt)}GetAttributeDataArrayForAllPoints(pt,ot,jt,Ct,Lt){be(this.ptr,pt.ptr,ot.ptr,jt,Ct,Lt)}},DT_INT8:De(),DT_UINT8:Ae(),DT_INT16:Ye(),DT_UINT16:rt(),DT_UINT32:Xe(),DT_FLOAT32:It()}})}(fetch(cT())),op.then(v=>{jo=v,op=void 0}))}()),E&&m.push(function(){if(K0)return;const v=function(T){let I;const z=WebAssembly.instantiateStreaming(T,{}).then(j=>{I=j.instance,I.exports.__wasm_call_ctors()}),O={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},V={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(j,N,G,H,K,se){(function(re,ie,_e,oe,ye,be,ve){const Ee=re.exports.sbrk,Ie=oe+3&-4,De=Ee(Ie*ye),Ae=Ee(be.length),Ye=new Uint8Array(re.exports.memory.buffer);Ye.set(be,Ae);const rt=ie(De,oe,ye,Ae,be.length);if(rt===0&&ve&&ve(De,Ie,ye),_e.set(Ye.subarray(De,De+oe*ye)),Ee(De-Ee(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(I,I.exports[V[K]],j,N,G,H,I.exports[O[se]])}}}(fetch(uT()));return v.ready.then(()=>{K0=v})}()),l)for(let v=0;v<l.length;v++)m.push(eP(l[v],o,v,i));return(m.length?Promise.all(m):Promise.resolve()).then(()=>{if(w&&f)for(const{primitives:v}of f)for(const T of v)KC(T,o);if(E&&f&&b)for(const v of b)JC(v,o);return o})})}function iu(s,e){const i=s.json.bufferViews[e.bufferView],o=D_[e.componentType];return new o(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==ap[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:ap[e.type]))}function Q0(s,e,i,o){const h=D_[e.componentType],l=function(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),f=s.json.bufferViews[e.bufferView],g=f.byteStride?f.byteStride/h.BYTES_PER_ELEMENT:ap[e.type],b=i.float32,M=b.length/i.capacity;for(let m=0,w=0;m<e.count*g;m+=g,w+=M)for(let E=0;E<M;E++)b[w+E]=o[m+E]*l;i._trim()}function tP(s,e,i){const o=s.indices,h=s.attributes,l={};l.indexArray=new hr;const f=e.json.accessors[o],g=f.count/3;l.indexArray.reserve(g);const b=iu(e,f);for(let E=0;E<g;E++)l.indexArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);l.indexArray._trim(),l.vertexArray=new lo;const M=e.json.accessors[h.POSITION];l.vertexArray.reserve(M.count);const m=iu(e,M);for(let E=0;E<M.count;E++)l.vertexArray.emplaceBack(m[3*E],m[3*E+1],m[3*E+2]);if(l.vertexArray._trim(),l.aabb=new Ht(M.min,M.max),l.centroid=function(E,v){const T=[0,0,0],I=E.length;if(I>0){for(let z=0;z<I;z++){const O=3*E[z];T[0]+=v[O],T[1]+=v[O+1],T[2]+=v[O+2]}T[0]/=I,T[1]/=I,T[2]/=I}return T}(b,m),h.COLOR_0!==void 0){const E=e.json.accessors[h.COLOR_0],v=ap[E.type],T=iu(e,E);l.colorArray=v===3?new lo:new za,l.colorArray.resize(E.count),Q0(e,E,l.colorArray,T)}if(h.NORMAL!==void 0){l.normalArray=new lo;const E=e.json.accessors[h.NORMAL];l.normalArray.resize(E.count);const v=iu(e,E);Q0(e,E,l.normalArray,v)}if(h.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new Tl;const E=e.json.accessors[h.TEXCOORD_0];l.texcoordArray.resize(E.count);const v=iu(e,E);Q0(e,E,l.texcoordArray,v)}if(h._FEATURE_ID_RGBA4444!==void 0){const E=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=iu(e,E))}h._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(iu(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const w=s.material;return l.material=function(E,v){const{emissiveFactor:T=[0,0,0],alphaMode:I="OPAQUE",alphaCutoff:z=.5,normalTexture:O,occlusionTexture:V,emissiveTexture:j,doubleSided:N}=E,{baseColorFactor:G=[1,1,1,1],metallicFactor:H=1,roughnessFactor:K=1,baseColorTexture:se,metallicRoughnessTexture:re}=E.pbrMetallicRoughness||{},ie=V?v[V.index]:void 0;if(V&&V.extensions&&V.extensions.KHR_texture_transform&&ie){const _e=V.extensions.KHR_texture_transform;ie.offsetScale=[_e.offset[0],_e.offset[1],_e.scale[0],_e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Hi(...G),metallicFactor:H,roughnessFactor:K,baseColorTexture:se?v[se.index]:void 0,metallicRoughnessTexture:re?v[re.index]:void 0},doubleSided:N,emissiveFactor:T,alphaMode:I,alphaCutoff:z,normalTexture:O?v[O.index]:void 0,occlusionTexture:ie,emissionTexture:j?v[j.index]:void 0,defined:E.defined===void 0}}(w!==void 0?e.json.materials[w]:{defined:!1},i),l}function gT(s,e,i){const{matrix:o,rotation:h,translation:l,scale:f,mesh:g,extras:b,children:M}=s,m={};if(m.matrix=o||Te.mat4.fromRotationTranslationScale([],h||[0,0,0,1],l||[0,0,0],f||[1,1,1]),g!==void 0){m.meshes=i[g];const w=m.anchor=[0,0];for(const E of m.meshes){const{min:v,max:T}=E.aabb;w[0]+=v[0]+T[0],w[1]+=v[1]+T[1]}w[0]=Math.floor(w[0]/m.meshes.length/2),w[1]=Math.floor(w[1]/m.meshes.length/2)}if(b&&(b.id&&(m.id=b.id),b.lights&&(m.lights=function(w){if(!w.length)return[];const E=function(O){const V=atob(O),j=new Uint8Array(V.length);for(let N=0;N<V.length;N++)j[N]=V.codePointAt(N);return j}(w),v=[],T=E.length/24,I=new Uint16Array(E.buffer),z=new Float32Array(E.buffer);for(let O=0;O<T;O++){const V=I[2*O*6]/30,j=I[2*O*6+1]/30,N=I[2*O*6+10]/100,G=z[6*O+1],H=z[6*O+2],K=z[6*O+3],se=z[6*O+4],re=K-G,ie=se-H,_e=Math.hypot(re,ie);v.push({pos:[G+.5*re,H+.5*ie,j],normal:[ie/_e,-re/_e,0],width:_e,height:V,depth:N,points:[G,H,K,se]})}return v}(b.lights))),M){const w=[];for(const E of M)w.push(gT(e.json.nodes[E],e,i));m.children=w}return m}function iP(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new t0(s.vertices,s.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:o}}function nP(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const g=f[0],b=f[1];typeof g=="number"&&typeof b=="number"&&o.push(new ge(g,b))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let h=0;for(let f=0;f<o.length;f++){const g=o[f],b=o[(f+1)%o.length],M=o[(f+2)%o.length];h+=(g.x-b.x)*(M.y-b.y)-(M.x-b.x)*(g.y-b.y)}h>0&&o.reverse();const l=Rf(o.flatMap(f=>[f.x,f.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function rP(s,e){const i=[],o=[];let h=0;const l=[];for(const f of s){h=i.length;const g=f.vertexArray.float32,b=f.indexArray.uint16;for(let M=0;M<f.vertexArray.length;M++)l[0]=g[3*M+0],l[1]=g[3*M+1],l[2]=g[3*M+2],Te.vec3.transformMat4(l,l,e),i.push(new ge(l[0],l[1]));for(let M=0;M<3*f.indexArray.length;M++)o.push(b[M]+h)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const g=i[o[f+0]],b=i[o[f+1]],M=i[o[f+2]];(g.x-b.x)*(M.y-b.y)-(M.x-b.x)*(g.y-b.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function yT(s){const e=function(b,M){const m=[],w=WebGL2RenderingContext;if(b.json.textures)for(const E of b.json.textures){const v={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};E.sampler!==void 0&&Object.assign(v,b.json.samplers[E.sampler]),m.push({image:M[E.source],sampler:v,uploaded:!1})}return m}(s,s.images),i=function(b,M){const m=[];for(const w of b.json.meshes){const E=[];for(const v of w.primitives)E.push(tP(v,b,M));m.push(E)}return m}(s,e),{scenes:o,scene:h,nodes:l}=s.json,f=o?o[h||0].nodes:l,g=[];for(const b of f)g.push(gT(l[b],s,i));return function(b,M,m){const w={},E=new Set;for(let v=0;v<b.length;v++){const T=m[M[v]];if(!T.extras)continue;const I=T.extras["mapbox:footprint:version"],z=T.extras["mapbox:footprint:id"];(I||z)&&E.add(v),I==="1.0.0"&&z&&(w[z]=v)}for(let v=0;v<b.length;v++){if(E.has(v))continue;const T=b[v],I=m[M[v]];if(!I.extras)continue;let z=null;T.id in w&&(z=rP(b[w[T.id]].meshes,T.matrix)),z||(z=nP(I)),z&&(T.footprint=iP(z))}if(E.size>0){const v=Array.from(E.values()).sort((T,I)=>T-I);for(let T=v.length-1;T>=0;T--)b.splice(v[T],1)}}(g,f,s.json.nodes),g}function sP(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,o=s.aabb.min[1]-1,h=Qc/(s.aabb.max[0]-i+2),l=Qc/(s.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const g=e[f+2],b=(e[f+0]-i)*h|0,M=(e[f+1]-o)*l|0;g>s.heightmap[M*Qc+b]&&(s.heightmap[M*Qc+b]=g)}}function oP(s,e){const i={};i.indexArray=new hr,i.indexArray.reserve(4*s.length),i.vertexArray=new lo,i.vertexArray.reserve(10*s.length),i.colorArray=new za,i.vertexArray.reserve(10*s.length);let o=0;for(const f of s){const g=Math.min(10,Math.max(4,1.3*f.height))*e,b=[-f.normal[1],f.normal[0],0],M=Math.min(.29,.1*f.width/f.depth),m=f.width-2*f.depth*e*(M+.01),w=Te.vec3.scaleAndAdd([],f.pos,b,m/2),E=Te.vec3.scaleAndAdd([],f.pos,b,-m/2),v=[w[0],w[1],w[2]+f.height],T=[E[0],E[1],E[2]+f.height],I=Te.vec3.scaleAndAdd([],f.normal,b,M);Te.vec3.scale(I,I,g);const z=Te.vec3.scaleAndAdd([],f.normal,b,-M);Te.vec3.scale(z,z,g),Te.vec3.add(I,w,I),Te.vec3.add(z,E,z),w[2]+=.1,E[2]+=.1,i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(w[0],w[1],w[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(v[0],v[1],v[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(w[0],w[1],w[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]);const O=m/g/2;i.colorArray.emplaceBack(-O-M,-1,O,.8),i.colorArray.emplaceBack(O+M,-1,O,.8),i.colorArray.emplaceBack(-O,0,O,1.3),i.colorArray.emplaceBack(O,0,O,1.3),i.colorArray.emplaceBack(O+M,-.8,O,.7),i.colorArray.emplaceBack(O+M,-.8,O,.7),i.colorArray.emplaceBack(0,0,O,1.3),i.colorArray.emplaceBack(0,0,O,1.3),i.colorArray.emplaceBack(O+M,-1.2,O,.8),i.colorArray.emplaceBack(O+M,-1.2,O,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const h={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Hi.white,h.pbrMetallicRoughness=l,i.material=h,i.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class xT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const aP=["id","tile","layer","source","sourceLayer","state"];class Fh{constructor(e,i,o,h,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=h,this.properties=e.properties,this.id=l}clone(){const e=new Fh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of aP)this[i]!==void 0&&(e[i]=this[i]);return e}}class vT{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Pa(At,16,0),this.featureIndexArray=new qc,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,h,l,f=0,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,l,f);const M=this.grid;for(let m=0;m<i.length;m++){const w=i[m],E=[1/0,1/0,-1/0,-1/0];for(let v=0;v<w.length;v++){const T=w[v];E[0]=Math.min(E[0],T.x),E[1]=Math.min(E[1],T.y),E[2]=Math.max(E[2],T.x),E[3]=Math.max(E[3],T.y)}g!==0&&(E[0]-=g,E[1]-=g,E[2]+=g,E[3]+=g),E[0]<At&&E[1]<At&&E[2]>=0&&E[3]>=0&&M.insert(b,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Th.VectorTile(new n_(this.rawTileData)).layers,this.sourceLayerCoder=new xT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:h,tileTransform:l,pixelPosMatrix:f,availableImages:g}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const b=o.bufferedTilespaceBounds,M=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(v,T,I,z)=>xe(o.bufferedTilespaceGeometry,v,T,I,z));M.sort(lP);let m=null;h.elevation&&M.length>0&&(m=Ph.create(h.elevation,this.tileID));const w={};let E;for(let v=0;v<M.length;v++){const T=M[v];if(T===E)continue;E=T;const I=this.featureIndexArray.get(T);let z=null;this.is3DTile?this.loadMatchingModelFeature(w,I,e,o,h):this.loadMatchingFeature(w,I,e,g,(O,V,j,N=0)=>(z||(z=D(O,this.tileID.canonical,l)),V.queryIntersectsFeature(o,O,j,z,this.z,h,f,m,N)))}return w}loadMatchingFeature(e,i,o,h,l){const{featureIndex:f,bucketIndex:g,sourceLayerIndex:b,layoutVertexArrayOffset:M}=i,m=this.bucketLayerIDs[g],w=o.layers,E=Object.keys(w);if(E.length&&!function(O,V){for(let j=0;j<O.length;j++)if(V.indexOf(O[j])>=0)return!0;return!1}(E,m))return;const v=o.sourceCache,T=this.sourceLayerCoder.decode(b),I=this.vtLayers[T].feature(f),z=this.getId(I,T);for(let O=0;O<m.length;O++){const V=m[O];if(!w[V])continue;const{styleLayer:j,targets:N}=w[V];let G={};z!==void 0&&(G=v.getFeatureState(j.sourceLayer,z));const H=!l||l(I,j,G,M);if(!H)continue;const K=new Fh(I,this.z,this.x,this.y,z);K.tile=this.tileID.canonical,K.state=G;let se=this.serializedLayersCache.get(V);se||(se=j.serialize(),se.id=V,this.serializedLayersCache.set(V,se)),K.source=se.source,K.sourceLayer=se["source-layer"],K.layer=qi({},se),K.layer.paint=bT(se.paint,j.paint,I,G,h),K.layer.layout=bT(se.layout,j.layout,I,G,h);let re=!1;for(const ie of N){this.updateFeatureProperties(K,ie);const{filter:_e}=ie;if(_e){if(I.properties=K.properties,_e.needGeometry){const oe=k(I,!0);if(!_e.filter(new un(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!_e.filter(new un(this.tileID.overscaledZ),I))continue}re=!0,ie.targetId&&this.addFeatureVariant(K,ie)}re&&this.appendToResult(e,V,f,K,H)}}loadMatchingModelFeature(e,i,o,h,l){const f=this.bucketLayerIDs[0][0],g=o.layers;if(!g[f])return;const{styleLayer:b,targets:M}=g[f];if(b.type!=="model")return;const m=h.tile,w=i.featureIndex,E=m.getBucket(b);if(!(E&&E instanceof S_))return;const v=function(se,re,ie,_e){const oe=se.getNodesInfo()[re];if(oe.hiddenByReplacement||!oe.node.meshes)return;let ye=Number.MAX_VALUE;const be=oe.node,ve=ie.tile,Ee=_e.calculatePosMatrix(ve.tileID.toUnwrapped(),_e.worldSize),Ie=oe.evaluatedScale;let De=0;_e.elevation&&be.elevation&&(De=be.elevation*_e.elevation.exaggeration()),Te.mat4.translate(Ee,Ee,[(be.anchor?be.anchor[0]:0)*(Ie[0]-1),(be.anchor?be.anchor[1]:0)*(Ie[1]-1),De]),Te.mat4.scale(Ee,Ee,Ie);const Ae=ie.queryGeometry,Ye=Ae.isPointQuery()?Ae.screenBounds:Ae.screenGeometry,rt=function(It){const Et=Te.mat4.multiply([],Ee,It.matrix);Te.mat4.multiply(Et,_e.expandedFarZProjMatrix,Et);for(let pt=0;pt<It.meshes.length;++pt){const ot=It.meshes[pt];if(pt===It.lightMeshIndex)continue;const jt=xw(Ye,_e,Et,ot.aabb);jt!=null&&(ye=Math.min(jt,ye))}if(It.children)for(const pt of It.children)rt(pt)};if(rt(be),ye===Number.MAX_VALUE)return;const Xe=new Ni(0,0);return Rw(ve.tileID.canonical,Xe,oe.node.anchor[0],oe.node.anchor[1]),{intersectionZ:ye,position:Xe,feature:oe.feature}}(E,w,h,l);if(!v)return;const{z:T,x:I,y:z}=m.tileID.canonical,{feature:O,intersectionZ:V,position:j}=v;let N={};O.id!==void 0&&(N=o.sourceCache.getFeatureState(b.sourceLayer,O.id));const G=new Fh({},T,I,z,O.id);G.tile=this.tileID.canonical,G.state=N,G.properties=O.properties,G.geometry={type:"Point",coordinates:[j.lng,j.lat]};let H=this.serializedLayersCache.get(f);H||(H=b.serialize(),H.id=f,this.serializedLayersCache.set(f,H)),G.source=H.source,G.sourceLayer=H["source-layer"],G.layer=qi({},H);let K=!1;for(const se of M){this.updateFeatureProperties(G,se);const{filter:re}=se;if(re){if(O.properties=G.properties,re.needGeometry){if(!re.filter(new un(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!re.filter(new un(this.tileID.overscaledZ),O))continue}K=!0,se.targetId&&this.addFeatureVariant(G,se)}K&&this.appendToResult(e,f,w,G,V)}updateFeatureProperties(e,i,o){if(i.properties){const h={};for(const l in i.properties){const f=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(h[l]=f)}e.properties=h}}addFeatureVariant(e,i,o){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,o,h,l){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:h,intersectionZ:l})}lookupSymbolFeatures(e,i,o,h,l){const f={};this.loadVTLayers();for(const g of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:g,layoutVertexArrayOffset:0},h,l);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(o),l=this.vtFeatures[h];if(l[i])return l[i];const f=this.vtLayers[h].feature(i);return l[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const l=ml(h);if(l.result!=="success"){const f=l.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void _i(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new vd),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[h];typeof o=="boolean"&&(o=Number(o))}return o}}function bT(s,e,i,o,h){return bs(s,(l,f)=>{const g=e instanceof xl?e.get(f):null;return g&&g.evaluate?g.evaluate(i,o,h):g})}function lP(s,e){return e-s}Nt(vT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ex{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const l=wT[15&o];if(!l)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new ex(g,f,l,e)}constructor(e,i=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=wT.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return tx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:f,nodeSize:g}=this,b=[0,l.length-1,0],M=[];for(;b.length;){const m=b.pop()||0,w=b.pop()||0,E=b.pop()||0;if(w-E<=g){for(let z=E;z<=w;z++){const O=f[2*z],V=f[2*z+1];O>=e&&O<=o&&V>=i&&V<=h&&M.push(l[z])}continue}const v=E+w>>1,T=f[2*v],I=f[2*v+1];T>=e&&T<=o&&I>=i&&I<=h&&M.push(l[v]),(m===0?e<=T:i<=I)&&(b.push(E),b.push(v-1),b.push(1-m)),(m===0?o>=T:h>=I)&&(b.push(v+1),b.push(w),b.push(1-m))}return M}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:l,nodeSize:f}=this,g=[0,h.length-1,0],b=[],M=o*o;for(;g.length;){const m=g.pop()||0,w=g.pop()||0,E=g.pop()||0;if(w-E<=f){for(let z=E;z<=w;z++)ST(l[2*z],l[2*z+1],e,i)<=M&&b.push(h[z]);continue}const v=E+w>>1,T=l[2*v],I=l[2*v+1];ST(T,I,e,i)<=M&&b.push(h[v]),(m===0?e-o<=T:i-o<=I)&&(g.push(E),g.push(v-1),g.push(1-m)),(m===0?e+o>=T:i+o>=I)&&(g.push(v+1),g.push(w),g.push(1-m))}return b}}function tx(s,e,i,o,h,l){if(h-o<=i)return;const f=o+h>>1;TT(s,e,f,o,h,l),tx(s,e,i,o,f-1,1-l),tx(s,e,i,f+1,h,1-l)}function TT(s,e,i,o,h,l){for(;h>o;){if(h-o>600){const M=h-o+1,m=i-o+1,w=Math.log(M),E=.5*Math.exp(2*w/3),v=.5*Math.sqrt(w*E*(M-E)/M)*(m-M/2<0?-1:1);TT(s,e,i,Math.max(o,Math.floor(i-m*E/M+v)),Math.min(h,Math.floor(i+(M-m)*E/M+v)),l)}const f=e[2*i+l];let g=o,b=h;for(lp(s,e,o,i),e[2*h+l]>f&&lp(s,e,o,h);g<b;){for(lp(s,e,g,b),g++,b--;e[2*g+l]<f;)g++;for(;e[2*b+l]>f;)b--}e[2*o+l]===f?lp(s,e,o,b):(b++,lp(s,e,b,h)),b<=i&&(o=b+1),i<=b&&(h=b-1)}}function lp(s,e,i,o){ix(s,i,o),ix(e,2*i,2*o),ix(e,2*i+1,2*o+1)}function ix(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function ST(s,e,i,o){const h=s-i,l=e-o;return h*h+l*l}r.$=lf,r.A=xr,r.B=2,r.C=Gf,r.D=Rh,r.E=Ko,r.F=kb,r.G=class extends w_{},r.H=Ns,r.I=H0,r.J=zu,r.K=Em,r.L=Ic,r.M=Ac,r.N=Ju,r.O=pl,r.P=ge,r.Q=ah,r.R=Ui,r.S=wm,r.T=R0,r.U=ml,r.V=w_,r.W=bc,r.X=Aa,r.Y=al,r.Z=Gr,r._=ws,r.a=function(s){return Wn.API_CDN_URL_REGEX.test(s)},r.a$=Fh,r.a0=Wd,r.a1=xm,r.a2=function(s){const e=s.value;let i=[];if(!e)return i;const o=Ns(e);return o!=="string"?(i=i.concat([new w_(s.key,e,`string expected, "${o}" found`)]),i):(bw(e,!0)||(i=i.concat([new w_(s.key,e,`invalid url "${e}"`)])),i)},r.a3=Fe,r.a4=oh,r.a5=vn,r.a6=yt,r.a7=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Wr(s.expression.evaluate(e))}interpolate(s,e,i){return{x:ni(s.x,e.x,i),y:ni(s.y,e.y,i),z:ni(s.z,e.z,i),azimuthal:ni(s.azimuthal,e.azimuthal,i),polar:ni(s.polar,e.polar,i)}}},r.a8=un,r.a9=Cc,r.aA=Us,r.aB=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,o){const h=this.entries[s]=this.entries[s]||{callbacks:[]};if(h.result){const[l,f]=h.result;return this.scheduler?this.scheduler.add(()=>{o(l,f)},e):o(l,f),()=>{}}return h.callbacks.push(o),h.cancel||(h.cancel=i((l,f)=>{h.result=[l,f];for(const g of h.callbacks)this.scheduler?this.scheduler.add(()=>{g(l,f)},e):g(l,f);setTimeout(()=>delete this.entries[s],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(l=>l!==o),h.callbacks.length||(h.cancel(),delete this.entries[s]))}}},r.aC=ao,r.aD=function(s,e,i){const o=JSON.stringify(s.request);return s.data&&(this.deduped.entries[o]={result:[null,s.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},h=>{const l=er(s.request,(f,g,b,M)=>{f?h(f):g&&h(null,{vectorTile:i?void 0:new Th.VectorTile(new n_(g)),rawData:g,cacheControl:b,expires:M})});return()=>{l.cancel(),h()}},e)},r.aE=function(s){Yt++,Yt>Ue&&(s.getActor().send("enforceCacheSizeLimit",Se),Yt=0)},r.aF=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},r.aG=ft,r.aH=lw,r.aI=pw,r.aJ=aw,r.aK=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<s.length;o++){const h=document.createElement("source");Fr(s[o])||(i.crossOrigin="Anonymous"),h.src=s[o],i.appendChild(h)}return{cancel:()=>{}}},r.aL=g_,r.aM=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>_T(e,0,s))},r.aN=yT,r.aO=class{constructor(s,e,i,o){this.id=s,this.position=e!=null?new Ni(e[0],e[1]):new Ni(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Ht([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(Te.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const i of s.meshes){const o=Ht.applyTransformFast(i.aabb,s.matrix);this.aabb.encapsulate(o)}if(s.children)for(const i of s.children)this._applyTransformations(i,s.matrix)}computeBoundsAndApplyParent(){const s=Te.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,i,o,h,l,f=!1){Mw(this.matrix,this,s.transform,this.position,e,i,o,h,l,f)}upload(s){if(!this.uploaded){for(const e of this.nodes)k0(e,s);for(const e of this.nodes)T_(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)F0(s)}},r.aP=_r,r.aQ=$f,r.aR=Jr,r.aS=dr,r.aT=ko,r.aU=hr,r.aV=Qn,r.aW=wf,r.aX=m_,r.aY=function(){cs.isLoading()||cs.isLoaded()||rh()!=="deferred"||zc()},r.aZ=Mm,r.a_=k,r.aa=n,r.ab=Te,r.ac=di,r.ad=xl,r.ae=Hr,r.af=ni,r.ag=At,r.ah=nm,r.ai=mt,r.aj=Hi,r.ak=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,o]){const h=Wr([1,i,o]);return{x:h.x,y:h.y,z:h.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:ni(s.x,e.x,i),y:ni(s.y,e.y,i),z:ni(s.z,e.z,i)}}},r.al=function(s,e,i=0,o=!0){const h=new ge(i,i),l=s.sub(h),f=e.add(h),g=[l,new ge(f.x,l.y),f,new ge(l.x,f.y)];return o&&g.push(l.clone()),g},r.am=function(s,e){const i=[];for(let o=0;o<s.length;o++){const h=wi(o-1,-1,s.length-1),l=wi(o+1,-1,s.length-1),f=s[o],g=s[l],b=s[h].sub(f).unit(),M=g.sub(f).unit(),m=M.angleWithSep(b.x,b.y),w=b.add(M).unit().mult(-1*e/Math.sin(m/2));i.push(f.add(w))}return i},r.an=Zb,r.ao=xe,r.ap=function(s,e,i=0){return Te.vec3.fromValues(((e.x-i)*s.scale-s.x)*At,(e.y*s.scale-s.y)*At,Hm(e.z,e.y))},r.aq=ui,r.ar=hb,r.as=function(s){let e=1/0,i=1/0,o=-1/0,h=-1/0;for(const l of s)e=Math.min(e,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),h=Math.max(h,l.y);return{min:new ge(e,i),max:new ge(o,h)}},r.at=ho,r.au=ue,r.av=p,r.aw=Mt,r.ax=Nr,r.ay=function(s,e){const i={};for(let o=0;o<e.length;o++){const h=e[o];h in s&&(i[h]=s[h])}return i},r.az=ca,r.b=function(s){return Wn.API_FONTS_REGEX.test(s)},r.b$=v_,r.b0=el,r.b1=u0,r.b2=e0,r.b3=D,r.b4=Oo,r.b5=vf,r.b6=Jt,r.b7=Rn,r.b8=Rf,r.b9=I0,r.bA=G1,r.bB=w0,r.bC=Gb,r.bD=x0,r.bE=ex,r.bF=wi,r.bG=il,r.bH=Vr,r.bI=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},r.bJ=Yc,r.bK=Es,r.bL=Sl,r.bM=zn,r.bN=Wc,r.bO=Ni,r.bP=Jb,r.bQ=et,r.bR=Fi,r.bS=_w,r.bT=nt,r.bU=Ir,r.bV=function(s,e,i,o,h,l,f,g,b){if(b.name==="globe")return Ir(s,e,new nt(i,o,h),!1);const M=$f({z:i,x:o,y:h},b);return new Ht([(l+M.x/M.scale)*e,e*(M.y/M.scale),f],[(l+M.x2/M.scale)*e,e*(M.y2/M.scale),g])},r.bW=function(s,e,i){let o=0;for(let h=0;h<2;++h)s[h]>0&&(o+=(s[h]-0)*(s[h]-0)),e[h]<0&&(o+=(0-e[h])*(0-e[h]));return o},r.bX=Dn,r.bY=Gm,r.bZ=function(s){const e=Te.mat4.identity(new Float64Array(16));Te.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const i=[0,us,0],o=[0,hs,0];return Te.vec3.transformMat4(i,i,e),Te.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!As(s,new Ni(s.center.lat,90)),o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!As(s,new Ni(s.center.lat,-90))]},r.b_=function(s,e){const{scale:i}=s.tileTransform,o=i*At/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return Te.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.ba=function(s,e){const i=Hr(e.zoom);if(i===0)return jn(s);const o=wn(s),h=on(o),l=ho(o.getWest())*e.worldSize,f=ho(o.getEast())*e.worldSize,g=Us(o.getNorth())*e.worldSize,b=Us(o.getSouth())*e.worldSize,M=[l,g,0],m=[f,g,0],w=[l,b,0],E=[f,b,0],v=Te.mat4.invert([],e.globeMatrix);return Te.vec3.transformMat4(M,M,v),Te.vec3.transformMat4(m,m,v),Te.vec3.transformMat4(w,w,v),Te.vec3.transformMat4(E,E,v),h[0]=Gn(h[0],w,i),h[1]=Gn(h[1],E,i),h[2]=Gn(h[2],m,i),h[3]=Gn(h[3],M,i),Ht.fromPoints(h)},r.bb=ir,r.bc=rn,r.bd=Gn,r.be=wl,r.bf=Xt,r.bg=X0,r.bh=n_,r.bi=er,r.bj=function(s){const e=[];for(const i in s)e.push(s[i]);return e},r.bk=function(s,e){const i=[];for(const o in s)o in e||i.push(o);return i},r.bl=Gi,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=_t,r.bo=function(s,e){const{x:i,y:o}=s.point,h=Qr(i,o,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Te.mat4.multiply(h,h,sn(jn(e)))},r.bp=Sh,r.bq=js,r.br=i_,r.bs=function(s,e,i,o,h){const l=5*e+2;s.float32[l+0]=i,s.float32[l+1]=o,s.float32[l+2]=h},r.bt=p_,r.bu=Ob,r.bv=q,r.bw=Pr,r.bx=F1,r.by=vw,r.bz=j1,r.c=Pu,r.c$=(s,e,i,o,h,l,f,g)=>{const b=s.transform,M=b.pitch<15?db(.07,.7,Mt((14-b.zoom)/5,0,1)):.07,m=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:pb(s,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:l,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:fb(e,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(m?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:t(e.tileID.canonical,0)}},r.c0=mw,r.c1=function(s){const e=mw(s,!0);return Te.mat2.invert([],[e[0],e[1],e[4],e[5]])},r.c2=Ri,r.c3=function(s){const{x:e,y:i}=s.point,{lng:o,lat:h}=s._center;return Qr(e,i,s.worldSize,o,h)},r.c4=Gt,r.c5=xt,r.c6=El,r.c7=function(s){const e=Math.round((s+45+360)%360/90)%4;return $t[e]},r.c8=45,r.c9=vh,r.cA=class extends uo{constructor(s){super(s),this.current=Sf}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cB=Zt,r.cC=function(s,e,i){const o=Hr(i.zoom),h=s.style.map._antialias,l=s.terrain&&s.terrain.exaggeration()>0;return o===0&&!h&&!l},r.cD=function(s){const e=s.pixelsPerMeter,i=e/Vr(1,s.center.lat),o=Te.mat4.identity(new Float64Array(16));return Te.mat4.translate(o,o,[s.point.x,s.point.y,0]),Te.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},r.cE=wn,r.cF=function(s){const e=Dn-5;s=Mt(s,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(mt(s))),3);return Math.round(i*(xh.length-1))},r.cG=function(s,e,i,o){const h=e.getNorth(),l=e.getSouth(),f=e.getWest(),g=e.getEast(),b=1<<s.z,M=g-f,m=h-l,w=M/Ml,E=-m/xh[i],v=[0,w,0,E,0,0,h,f,0];if(s.z>0){const T=180/o;Te.mat3.multiply(v,v,[T/M+1,0,0,0,T/m+1,0,-.5*T/w,.5*T/E,1])}return v[2]=b,v[5]=s.x,v[8]=s.y,v},r.cH=jn,r.cI=function(s,e,i){const o=Te.mat4.identity(new Float64Array(16)),h=(e/(1<<s)-.5)*Math.PI*2;return Te.mat4.rotateY(o,i.globeMatrix,h),Float32Array.from(o)},r.cJ=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,h=Math.floor(s.x),l=Math.floor((s.x-h)*o),f=Math.floor(s.y*o),g=this.findDEMTileFor(new ft(i,h,i,l,f));return!(!g||!g.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||s.y<0||s.y>1)return e;const h=o.getSource().maxzoom,l=1<<h,f=Math.floor(s.x),g=s.x-f,b=new ft(h,f,h,Math.floor(g*l),Math.floor(s.y*l)),M=this.findDEMTileFor(b);if(!M||!M.dem)return e;const m=M.dem,w=1<<M.tileID.canonical.z,E=(g*w-M.tileID.canonical.x)*m.dim,v=(s.y*w-M.tileID.canonical.y)*m.dim,T=Math.floor(E),I=Math.floor(v);return(i?this.exaggeration():1)*ni(ni(m.get(T,I),m.get(T,I+1),v-I),ni(m.get(T+1,I),m.get(T+1,I+1),v-I),E-T)}getAtTileOffset(s,e,i){const o=1<<s.canonical.z;return this.getAtPointOrZero(new n(s.wrap+(s.canonical.x+e/At)/o,(s.canonical.y+i/At)/o))}getAtTileOffsetFunc(s,e,i,o){return h=>{const l=this.getAtTileOffset(s,h.x,h.y),f=o.upVector(s.canonical,h.x,h.y),g=o.upVectorScale(s.canonical,e,i).metersToTile;return Te.vec3.scale(f,f,l*g),f}}getForTilePoints(s,e,i,o){if(this.isUsingMockSource())return!1;const h=Ph.create(this,s,o);return!!h&&(e.forEach(l=>{l[2]=this.exaggeration()*h.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,h=1<<s.canonical.z-o.canonical.z;let l=s.canonical.x/h-o.canonical.x,f=s.canonical.y/h-o.canonical.y,g=0;for(let b=0;b<s.canonical.z-o.canonical.z&&!i.leaves[g];b++){l*=2,f*=2;const M=2*Math.floor(f)+Math.floor(l);g=i.childOffsets[g]+M,l%=1,f%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const h of s){const l=this.getMinMaxForTile(h.tileID);l&&(i=Math.min(i,l.min),o=Math.max(o,l.max),e=!0)}return e?{min:i,max:o}:null}},r.cK=_1,r.cL=Ci,r.cM=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},r.cN=Ms,r.cO=Cu,r.cP=Iu,r.cQ=256,r.cR=function(s,e){const i=[0,0,0],o=ir(jn(e.canonical));return Te.vec3.transformMat4(i,i,o),Te.vec3.transformMat4(i,i,s),i},r.cS=s=>({u_camera_to_center_distance:new zn(s),u_extrude_scale:new Ef(s),u_device_pixel_ratio:new zn(s),u_matrix:new Yc(s),u_inv_rot_matrix:new Yc(s),u_merc_center:new Es(s),u_tile_id:new Sl(s),u_zoom_transition:new zn(s),u_up_dir:new Sl(s),u_emissive_strength:new zn(s)}),r.cT=s=>({u_matrix:new Yc(s),u_pixels_to_tile_units:new Ef(s),u_device_pixel_ratio:new zn(s),u_width_scale:new zn(s),u_floor_width_scale:new zn(s),u_units_to_pixels:new Es(s),u_dash_image:new Wc(s),u_gradient_image:new Wc(s),u_image_height:new zn(s),u_texsize:new Es(s),u_tile_units_to_pixels:new zn(s),u_alpha_discard_threshold:new zn(s),u_trim_offset:new Es(s),u_trim_fade_range:new Es(s),u_trim_color:new Xc(s),u_emissive_strength:new zn(s),u_zbias_factor:new zn(s),u_tile_to_meter:new zn(s)}),r.cU=s=>({u_matrix:new Yc(s),u_texsize:new Es(s),u_pixels_to_tile_units:new Ef(s),u_device_pixel_ratio:new zn(s),u_width_scale:new zn(s),u_floor_width_scale:new zn(s),u_image:new Wc(s),u_units_to_pixels:new Es(s),u_tile_units_to_pixels:new zn(s),u_alpha_discard_threshold:new zn(s),u_trim_offset:new Es(s),u_trim_fade_range:new Es(s),u_trim_color:new Xc(s),u_emissive_strength:new zn(s),u_zbias_factor:new zn(s),u_tile_to_meter:new zn(s)}),r.cV=mf,r.cW=dI,r.cX=fI,r.cY=Cl,r.cZ=(s,e,i,o,h,l)=>{const f=s.transform,g=f.projection.name==="globe";let b;if(l.paint.get("circle-pitch-alignment")==="map")if(g){const m=Ms(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([m,0,0,m])}else b=f.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(f.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:de.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:Va,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(g){M.u_inv_rot_matrix=o,M.u_merc_center=h,M.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],M.u_zoom_transition=Hr(f.zoom);const m=h[0]*At,w=h[1]*At;M.u_up_dir=f.projection.upVector(new nt(0,0,0),m,w)}return M},r.c_=mb,r.ca=Xc,r.cb=function(s,e,i){const o=Math.sqrt(s*s+e*e+i*i),h=o>0?Math.acos(i/o)*kt:0;let l=s!==0||e!==0?Math.atan2(-e,-s)*kt+90:0;return l<0&&(l+=360),[o,l,h]},r.cc=t,r.cd=Ht,r.ce=Wr,r.cf=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},r.cg=function(s,e){return s.readFields(rC,{icons:[]},e)},r.ch=function(s){return s({pluginStatus:Yr,pluginURL:na}),_l.on("pluginStateChange",s),s},r.ci=E_,r.cj=Mh,r.ck=v0,r.cl=to,r.cm=sf,r.cn=we,r.co=Fs,r.cp=Mn,r.cq=function(s){const e=s.indexOf(ch);return e>=0?s.slice(0,e):s},r.cr=function(s){return s.indexOf(ch)>=0},r.cs=function(s){const e=s.indexOf(ch);return e>=0?s.slice(e+1):""},r.ct=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cu=function(s,e,i,o){return s.type==="custom"?new qI(s,e):new tC[s.type](s,e,i,o)},r.cv=Eo,r.cw=class extends Fh{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},r.cx=_l,r.cy=Xn,r.cz=Vm,r.d=function(s){return Wn.API_TILEJSON_REGEX.test(s)},r.d$=vT,r.d0=(s,e,i,o,h,l,f,g,b)=>{const M=s.transform,m=M.calculatePixelsToTileUnitsMatrix(e),w=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",E=M.pitch<15?db(.07,.7,Mt((14-M.zoom)/5,0,1)):.07;return{u_matrix:pb(s,e,i,o),u_pixels_to_tile_units:m,u_device_pixel_ratio:l,u_width_scale:f,u_floor_width_scale:g,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:_b(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fb(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(w?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:E,u_tile_to_meter:t(e.tileID.canonical,0)}},r.d1=Un,r.d2=Pf,r.d3=ib,r.d4=Rt,r.d5=t_,r.d6=Rl,r.d7=450,r.d8=7,r.d9=GI,r.dA=bi,r.dB=c,r.dC=Fa,r.dD=function([s,e,i]){const o=Math.hypot(s,e,i),h=Math.atan2(s,i),l=.5*Math.PI-Math.acos(-e/o);return new Ni(Gt(h),Gt(l))},r.dE=z0,r.dF=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(tl==null){const o=i.navigator?i.navigator.userAgent:null;tl=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return tl}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(s,e){Se=s,Ue=e},r.dH=As,r.dI=fo,r.dJ=function(s){const e=[0,0,0],i=Te.mat4.identity(new Float64Array(16));return Te.mat4.multiply(i,s.pixelMatrix,s.globeMatrix),Te.vec3.transformMat4(e,e,i),new ge(e[0],e[1])},r.dK=function(s,e,i=!1){if(Yr===Dc||Yr===nh||Yr===rf)throw new Error("setRTLTextPlugin cannot be called multiple times.");na=de.resolveURL(s),Yr=Dc,oo=e,of(),i||zc()},r.dL=rh,r.dM=function(){E_().acquire(N0)},r.dN=function(){const s=ep;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(N0),ep=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=tu,r.dP=function(s){const e=Tt();if(!e)return;const i=e.delete(Re);s&&i.catch(s).then(()=>s())},r.dQ=Qf,r.dR=cT,r.dS=function(s){Y0=de.resolveURL(s),kh||(kh=new Rh(E_(),new Ko)),kh.broadcast("setDracoUrl",Y0)},r.dT=uT,r.dU=function(s){Oh=de.resolveURL(s),kh||(kh=new Rh(E_(),new Ko)),kh.broadcast("setMeshoptUrl",Oh)},r.dV=Nt,r.dW=Pl,r.dX=No,r.dY=Th,r.dZ=class{constructor(s,e){this.pos=s,this.dir=e}intersectsPlane(s,e,i){const o=Te.vec2.dot(e,this.dir);if(Math.abs(o)<1e-6)return!1;const h=((s[0]-this.pos[0])*e[0]+(s[1]-this.pos[1])*e[1])/o;return i[0]=this.pos[0]+this.dir[0]*h,i[1]=this.pos[1]+this.dir[1]*h,!0}},r.d_=xT,r.da=$i,r.db=bf,r.dc=256,r.dd=sn,r.de=lo,r.df=oa,r.dg=fh,r.dh=function(s,e,i,o,h){return Mt((s-e)/(i-e)*(h-o)+o,o,h)},r.di=Yu,r.dj=Il,r.dk=class{constructor(s,e,i,o){this.context=s,this.format=o,this.size=i,this.texture=s.gl.createTexture();const[h,l,f]=this.size,{gl:g}=s;g.bindTexture(g.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,h,l,f,0,C0(this.format),P0(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),s!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},r.dl=L0,r.dm=[1,1,1],r.dn=Ph,r.dp=Ch,r.dq=sa,r.dr=Tl,r.ds=Ba,r.dt=ph,r.du=co,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ge(1/0,1/0),max:new ge(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=N1(new ge(0,0),new ge(At,At),s),o=[];if(e&&!s0(i,this._globalClipBounds))return o;for(const h of this._activeRegions){if(h.hiddenByOverlap||!s0(i,h))continue;const l=NA(h.min,h.max,s);o.push({min:l.min,max:l.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return o}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(o).buckets[e.layer];h&&h.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),o=s.getClipMask(),h=s.getClipScope();for(const l of e){if(!l.footprint)continue;const f=N1(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:o,clipScope:h})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Qm(e.min,i.min)||Qm(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,h){const l=(f,g)=>f+g;return o.length-h.length||o.reduce(l,"").localeCompare(h.reduce(l,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];s=i.priority!==o.priority||!B1(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!_t(i.clipScope,o.clipScope),++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==Jm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const h=o[i].priority;for(;i<o.length&&o[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let h=i;const l=i;for(;h!==o;){const f=this._activeRegions[h];f.hiddenByOverlap=!1;for(let g=0;g<l;g++){const b=this._activeRegions[g];if(!b.hiddenByOverlap&&f.order===Jm&&s0(f,b)&&(f.hiddenByOverlap=U1(f.footprint,f.tileId,b.footprint,b.tileId),f.hiddenByOverlap))break}++h}i=o,o=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},r.dw=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new Oo,o=new hr,h=[],l=s+1+2,f=e[0]+1,g=e[0]+1+(1+e.length),b=(M,m,w)=>{let E=M===l-1?M-2:M===0?M:M-1;return E+=w?24575:0,[E,m]};for(let M=0;M<l;++M)i.emplaceBack(...b(M,0,!0));for(let M=0;M<f;++M)for(let m=0;m<l;++m)i.emplaceBack(...b(m,M,(m===0||m===l-1)&&!0));for(let M=0;M<e.length;++M){const m=e[M];for(let w=0;w<l;++w)i.emplaceBack(...b(w,m,!0))}for(let M=0;M<e.length;++M){const m=o.length,w=e[M]+1+2,E=new hr;for(let I=0;I<w-1;I++){const z=I===w-2,O=z?l*(g-e.length+M-I):l;for(let V=0;V<l-1;V++){const j=I*l+V;I===0||z||V===0||V===l-2?(E.emplaceBack(j+1,j,j+O),E.emplaceBack(j+O,j+O+1,j+1)):(o.emplaceBack(j+1,j,j+O),o.emplaceBack(j+O,j+O+1,j+1))}}const v=Rn.simpleSegment(0,m,i.length,o.length-m);for(let I=0;I<E.uint16.length;I+=3)o.emplaceBack(E.uint16[I],E.uint16[I+1],E.uint16[I+2]);const T=Rn.simpleSegment(0,m,i.length,o.length-m);h.push({withoutSkirts:v,withSkirts:T})}return{vertices:i,indices:o,segments:h}}_createGrid(s){const e=this._fillGridMeshWithLods(Ml,xh);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,Jt.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new hr;for(let f=0;f<=Ml;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new oa,o=new oa,h=new oa,l=new oa;this._poleSegments=[];for(let f=0,g=0;f<El;f++){const b=360/(1<<f);i.emplaceBack(0,-Nr,0,.5,0),o.emplaceBack(0,-Nr,0,.5,1),h.emplaceBack(0,-Nr,0,.5,.5),l.emplaceBack(0,-Nr,0,.5,.5);for(let M=0;M<=Ml;M++){let m=M/Ml,w=0;const E=ni(0,b,m),[v,T,I]=Al(Na,po,E,Nr);i.emplaceBack(v,T,I,m,w),o.emplaceBack(v,T,I,m,1-w);const z=mt(E);m=.5+.5*Math.sin(z),w=.5+.5*Math.cos(z),h.emplaceBack(v,T,I,m,w),l.emplaceBack(v,T,I,m,1-w)}this._poleSegments.push(Rn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,si,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(o,si,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(h,si,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(l,si,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},r.dx=Jm,r.dy=Ut,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=Wn,r.e0=lb,r.e1=bs,r.e2=so,r.e3=Fb,r.e4=function(s,e,i,o,h,l,f,g,b,M,m=1,w,E){s.createArrays(),s.tilePixelRatio=At/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const v=s.layers[0].layout,T=s.layers[0]._unevaluatedLayout._values,I={};I.scaleFactor=m,I.textSizeScaleRange=v.get("text-size-scale-range"),I.iconSizeScaleRange=v.get("icon-size-scale-range");const[z,O]=I.textSizeScaleRange,[V,j]=I.iconSizeScaleRange;if(I.textScaleFactor=Mt(I.scaleFactor,z,O),I.iconScaleFactor=Mt(I.scaleFactor,V,j),s.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:se}=s.textSizeData;I.compositeTextSizes=[T["text-size"].possiblyEvaluate(new un(K),g),T["text-size"].possiblyEvaluate(new un(se),g)]}if(s.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:se}=s.iconSizeData;I.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new un(K),g),T["icon-size"].possiblyEvaluate(new un(se),g)]}I.layoutTextSize=T["text-size"].possiblyEvaluate(new un(b+1),g),I.layoutIconSize=T["icon-size"].possiblyEvaluate(new un(b+1),g),I.textMaxSize=T["text-size"].possiblyEvaluate(new un(18),g);const N=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point",G=v.get("text-size");let H=!1;for(const K of s.features)if(K.icon&&K.icon.nameSecondary){H=!0;break}for(const K of s.features){const se=v.get("text-font").evaluate(K,{},g).join(","),re=G.evaluate(K,{},g)*I.textScaleFactor,ie=I.layoutTextSize.evaluate(K,{},g)*I.textScaleFactor,_e=(I.layoutIconSize.evaluate(K,{},g),{horizontal:{},vertical:void 0}),oe=K.text;let ye,be=[0,0];if(oe){const Ie=oe.toString(),De=v.get("text-letter-spacing").evaluate(K,{},g)*Pr,Ae=v.get("text-line-height").evaluate(K,{},g)*Pr,Ye=Oy(Ie)?De:0,rt=v.get("text-anchor").evaluate(K,{},g),Xe=v.get("text-variable-anchor");if(!Xe){const jt=v.get("text-radial-offset").evaluate(K,{},g);be=jt?Gb(rt,[jt*Pr,b0]):v.get("text-offset").evaluate(K,{},g).map(Ct=>Ct*Pr)}let It=N?"center":v.get("text-justify").evaluate(K,{},g);const Et=v.get("symbol-placement")==="point",pt=Et?v.get("text-max-width").evaluate(K,{},g)*Pr:1/0,ot=jt=>{s.allowVerticalPlacement&&Qd(Ie)&&(_e.vertical=y0(oe,e,i,h,se,pt,Ae,rt,jt,Ye,be,js.vertical,!0,ie,re))};if(!N&&Xe){const jt=It==="auto"?Xe.map(Lt=>w0(Lt)):[It];let Ct=!1;for(let Lt=0;Lt<jt.length;Lt++){const ai=jt[Lt];if(!_e.horizontal[ai])if(Ct)_e.horizontal[ai]=_e.horizontal[0];else{const gi=y0(oe,e,i,h,se,pt,Ae,"center",ai,Ye,be,js.horizontal,!1,ie,re);gi&&(_e.horizontal[ai]=gi,Ct=gi.positionedLines.length===1)}}ot("left")}else{if(It==="auto"&&(It=w0(rt)),Et||v.get("text-writing-mode").indexOf("horizontal")>=0||!Qd(Ie)){const jt=y0(oe,e,i,h,se,pt,Ae,rt,It,Ye,be,js.horizontal,!1,ie,re);jt&&(_e.horizontal[It]=jt)}ot(Et?"left":It)}}let ve=!1;if(K.icon&&K.icon.namePrimary){const Ie=f0(s.iconSizeData,T["icon-size"],g,s.zoom,K)*I.iconScaleFactor*w,De=K.icon.getPrimary().scaleSelf(Ie).serialize(),Ae=o[De];Ae&&(ye=TI(h[De],K.icon.nameSecondary?h[K.icon.getSecondary().scaleSelf(Ie).serialize()]:void 0,v.get("icon-offset").evaluate(K,{},g),v.get("icon-anchor").evaluate(K,{},g)),ve=Ae.sdf,s.sdfIcons===void 0?s.sdfIcons=Ae.sdf:s.sdfIcons!==Ae.sdf&&_i("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==s.pixelRatio||v.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const Ee=Hb(_e.horizontal)||_e.vertical;s.iconsInText||(s.iconsInText=!!Ee&&Ee.iconsInText),(Ee||ye)&&PI(s,K,_e,ye,o,I,ie,0,be,ve,f,g,M,E,H)}l&&s.generateCollisionDebugBuffers(b,s.collisionBoxArray,I.textScaleFactor)},r.e5=R_,r.e6=Be,r.e7=z1,r.e8=wb,r.e9=W,r.ea=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==dT){const i=new Uint32Array(s,0,7),[,,o,h,l,f]=i;e=i.byteLength+h+l+f+l,(o!==s.byteLength||e>=s.byteLength)&&_i("Invalid b3dm header information.")}return _T(s,e)},r.eb=function(s,e){const i=yT(s);for(const o of i){for(const h of o.meshes)sP(h);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(oP(o.lights,e)))}return i},r.ec=S_,r.ed=Dw,r.ee=cs,r.ef=function(s){St(),Ge!=null&&Ge.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-s;o++)e.delete(i[o])})})},r.f=function(s){return s.indexOf("mapbox:")===0},r.g=function(s,e){return Xn(qi(s,{method:"GET"}),e)},r.h=rc,r.i=function(s){return Wn.API_STYLE_REGEX.test(s)&&!Pu(s)},r.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.l=qi,r.m=ti,r.n=function(s,e){return Xn(qi(s,{type:"json"}),e)},r.o=hd,r.p=function(s,e){return Xn(qi(s,{method:"POST"}),e)},r.q=de,r.r=br,r.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=ee,r.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},r.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},r.w=_i,r.x=function(){return V0||(V0=new tu),V0},r.y=Ru,r.z=no}),L(["./shared"],function(r){function W(qe){const $=qe?qe.url.toString():void 0;return $?performance.getEntriesByName($):[]}function ne(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let J="[";for(const ee of qe)J+=`${ne(ee)},`;return`${J}]`}let $="{";for(const J of Object.keys(qe).sort())$+=`${J}:${ne(qe[J])},`;return`${$}}`}function Q(qe){let $="";for(const J of r.bm)(qe.type!=="model"||J!=="minzoom"&&J!=="maxzoom")&&($+=`/${ne(qe[J])}`);return $}class ce{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,J){this._layerConfigs={},this._layers={},this.update($,[],J)}update($,J,ee){this._options=ee;for(const pe of $)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=r.cu(pe,this.scope,null,this._options)).compileFilter(ee),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of J)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const de=function(pe,we){const Re={};for(let Ue=0;Ue<pe.length;Ue++){const Ne=pe[Ue];let Ge=we&&we[Ne.id];!Ge&&(Ge=Q(Ne),Ne.type==="line"&&Ne.paint)&&function Tt(St){return typeof St=="string"&&St==="line-progress"||(Array.isArray(St)?St.some(Tt):!(!St||typeof St!="object")&&Object.values(St).some(Tt))}(Ne.paint["line-width"])&&(Ge+=`/${ne(Ne.paint["line-width"])}`),we&&(we[Ne.id]=Ge);let it=Re[Ge];it||(it=Re[Ge]=[]),it.push(Ne)}const Se=[];for(const Ue in Re)Se.push(Re[Ue]);return Se}(r.bj(this._layerConfigs),this.keyCache);for(const pe of de){const we=pe.map(it=>this._layers[it.id]),Re=we[0];if(Re.visibility==="none")continue;const Se=Re.source||"";let Ue=this.familiesBySource[Se];Ue||(Ue=this.familiesBySource[Se]={});const Ne=Re.sourceLayer||"_geojsonTileLayer";let Ge=Ue[Ne];Ge||(Ge=Ue[Ne]=[]),Ge.push(we)}}}const ze=1*r.dX;class je{constructor($){const J={},ee=[];for(const Re in $){const Se=$[Re],Ue=J[Re]={};for(const Ne in Se.glyphs){const Ge=Se.glyphs[+Ne];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const it=Ge.metrics.localGlyph?ze:1,Tt={x:0,y:0,w:Ge.bitmap.width+2*it,h:Ge.bitmap.height+2*it};ee.push(Tt),Ue[Ne]=Tt}}const{w:de,h:pe}=r.F(ee),we=new r.dW({width:de||1,height:pe||1});for(const Re in $){const Se=$[Re];for(const Ue in Se.glyphs){const Ne=Se.glyphs[+Ue];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ge=J[Re][Ue],it=Ne.metrics.localGlyph?ze:1;r.dW.copy(Ne.bitmap,we,{x:0,y:0},{x:Ge.x+it,y:Ge.y+it},Ne.bitmap)}}this.image=we,this.positions=J}}r.dV(je,"GlyphAtlas");const Oe="3d_elevation_id",Le="hd_road_elevation";class ct{constructor(){this._valid=!1}reset($){return this.feature=$,this._valid=!0,this._geometry=$.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry($,J){return this._valid&&$(J(this._geometry)),this}require($,J,ee){return this.get($,!0,J,ee)}optional($,J,ee){return this.get($,!1,J,ee)}success(){return this._valid}get($,J,ee,de){const pe=this.feature.properties.hasOwnProperty($)?+this.feature.properties[$]:void 0;return this._valid&&pe!==void 0?ee(de?de(pe):pe):J&&(this._valid=!1),this}}class st{constructor($,J){this.featureFunc=$,this.vertexFunc=J}parseFeature($,J,ee){return this.featureFunc($,J,ee)}parseVertex($,J,ee){return this.vertexFunc($,J,ee)}}const gt=new st((qe,$,J)=>qe.reset($).require(Oe,ee=>{J.id=ee}).optional("fixed_height_relative",ee=>{J.constantHeight=ee},Ve.decodeRelativeHeight).geometry(ee=>{J.bounds=ee},Ve.computeBounds).success(),(qe,$,J)=>qe.reset($).require(Oe,ee=>{J.id=ee}).require("elevation_idx",ee=>{J.idx=ee}).require("extent",ee=>{J.extent=ee}).require("height_relative",ee=>{J.height=ee},Ve.decodeRelativeHeight).geometry(ee=>{J.position=ee},Ve.getPoint).success()),He=new st((qe,$,J)=>qe.reset($).require(Oe,ee=>{J.id=ee}).optional("fixed_height",ee=>{J.constantHeight=ee},Ve.decodeMetricHeight).geometry(ee=>{J.bounds=ee},Ve.computeBounds).success(),(qe,$,J)=>qe.reset($).require(Oe,ee=>{J.id=ee}).require("elevation_idx",ee=>{J.idx=ee}).require("extent",ee=>{J.extent=ee}).require("height",ee=>{J.height=ee},Ve.decodeMetricHeight).geometry(ee=>{J.position=ee},Ve.getPoint).success());class Ve{static computeBounds($){const J=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),ee=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const de of $[0])J.x>de.x&&(J.x=de.x),J.y>de.y&&(J.y=de.y),ee.x<de.x&&(ee.x=de.x),ee.y<de.y&&(ee.y=de.y);return{min:J,max:ee}}static getPoint($){return r.ab.vec2.fromValues($[0][0].x,$[0][0].y)}static decodeRelativeHeight($){return 1e-4*$*5}static decodeMetricHeight($){return 1e-4*$}static parse($){const J=[],ee=[],de=$.length,pe=new ct;for(let Re=0;Re<de;Re++){const Se=$.feature(Re),Ue=Se.properties.hasOwnProperty("version")?String(Se.properties.version):void 0,Ne=(we=Ue)?we==="1.0.1"?He:void 0:gt;if(Ne===void 0){r.w(`Unknown elevation feature version number ${Ue||"(unknown)"}`);continue}const Ge=Se.properties.hasOwnProperty("type")?Se.properties.type:void 0;if(Ge){if(r.dY.VectorTileFeature.types[Se.type]==="Point"&&Ge==="curve_point"){const it={};Ne.parseVertex(pe,Se,it)&&J.push(it)}else if(r.dY.VectorTileFeature.types[Se.type]==="Polygon"&&Ge==="curve_meta"){const it={};Ne.parseFeature(pe,Se,it)&&ee.push(it)}}}var we;return{vertices:J,features:ee}}}class at{constructor($,J,ee,de,pe,we){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=$,this.heightRange={min:ee,max:ee},this.safeArea=J,this.constantHeight=ee,this.constantHeight==null&&(this.constantHeight!=null||de.length!==0)){this.vertices=de,this.edges=pe,this.edges=this.edges.filter(Re=>Re.a<this.vertices.length&&Re.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[Re.a].position,this.vertices[Re.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const Re of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,Re.height),this.heightRange.max=Math.max(this.heightRange.max,Re.height);for(const Re of this.edges){const Se=this.vertices[Re.a].position,Ue=this.vertices[Re.b].position,Ne=r.ab.vec2.subtract(r.ab.vec2.create(),Ue,Se),Ge=r.ab.vec2.length(Ne),it=r.ab.vec2.scale(r.ab.vec2.create(),Ne,1/Ge);this.edgeProps.push({vec:Ne,dir:it,len:Ge});const Tt=this.vertexProps[Re.a].dir,St=this.vertexProps[Re.b].dir;r.ab.vec2.add(Tt,Tt,it),r.ab.vec2.add(St,St,it)}for(const Re of this.vertexProps)Re.dir[0]===0&&Re.dir[1]===0||r.ab.vec2.normalize(Re.dir,Re.dir);this.tessellate(we)}}pointElevation($){if(this.constantHeight!=null)return this.constantHeight;const J=this.getClosestEdge($);if(J==null)return 0;const[ee,de]=J;return(1-(pe=de))*this.vertices[this.edges[ee].a].height+pe*this.vertices[this.edges[ee].b].height;var pe}getClosestEdge($){if(this.edges.length===0)return;let J=0,ee=Number.POSITIVE_INFINITY,de=0;const pe=r.ab.vec2.fromValues($.x,$.y);for(let we=0;we<this.edges.length;we++){const Re=this.edges[we],Se=this.edgeProps[we].dir,Ue=new r.dZ(pe,this.edgeProps[we].dir),Ne=this.vertices[Re.a].position,Ge=this.vertices[Re.b].position,it=r.ab.vec2.create(),Tt=r.ab.vec2.create(),St=Ue.intersectsPlane(Ne,this.vertexProps[Re.a].dir,it),Yt=Ue.intersectsPlane(Ge,this.vertexProps[Re.b].dir,Tt);if(!St||!Yt)continue;const ti=r.ab.vec2.subtract(r.ab.vec2.create(),Tt,it),ii=r.ab.vec2.subtract(r.ab.vec2.create(),pe,it),ei=r.ab.vec2.dot(ti,ti),Pi=ei>0?r.ab.vec2.dot(ii,ti)/ei:0,Oi=r.aw(Pi,0,1),Si=Math.abs((Pi-Oi)*this.edgeProps[we].len),Bi=r.ab.vec2.subtract(r.ab.vec2.create(),pe,Ne),Ui=Si+Math.abs(r.ab.vec2.dot(Bi,r.ab.vec2.fromValues(Se[1],-Se[0])));Ui<ee&&(J=we,ee=Ui,de=Oi)}return[J,de]}tessellate($){for(let J=this.edges.length-1;J>=0;--J){const ee=this.edges[J].a,de=this.edges[J].b,{position:pe,height:we,extent:Re}=this.vertices[ee],{position:Se,height:Ue,extent:Ne}=this.vertices[de],Ge=this.vertexProps[ee].dir,it=this.vertexProps[de].dir,Tt=r.ab.vec3.fromValues(pe[0]/$,pe[1]/$,we),St=r.ab.vec3.fromValues(Se[0]/$,Se[1]/$,Ue),Yt=r.ab.vec3.fromValues(Ge[1],-Ge[0],0);r.ab.vec3.scale(Yt,Yt,Re);const ti=r.ab.vec3.fromValues(it[1],-it[0],0);if(r.ab.vec3.scale(ti,ti,Ne),this.distSqLines(r.ab.vec3.fromValues(Tt[0]+.5*Yt[0],Tt[1]+.5*Yt[1],Tt[2]+.5*Yt[2]),r.ab.vec3.fromValues(St[0]-.5*ti[0],St[1]-.5*ti[1],St[2]-.5*ti[2]),r.ab.vec3.fromValues(Tt[0]-.5*Yt[0],Tt[1]-.5*Yt[1],Tt[2]-.5*Yt[2]),r.ab.vec3.fromValues(St[0]+.5*ti[0],St[1]+.5*ti[1],St[2]+.5*ti[2]))<=.05*.05)continue;const ii=this.vertices.length,ei=r.ab.vec2.add(r.ab.vec2.create(),pe,Se);this.vertices.push({position:r.ab.vec2.scale(ei,ei,.5),height:.5*(we+Ue),extent:.5*(Re+Ne)});const Pi=r.ab.vec2.add(r.ab.vec2.create(),Ge,it);this.vertexProps.push({dir:r.ab.vec2.normalize(Pi,Pi)}),this.edges.splice(J,1),this.edgeProps.splice(J,1),this.edges.push({a:ee,b:ii}),this.edges.push({a:ii,b:de});const Oi=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[ii].position,pe),Si=r.ab.vec2.length(Oi),Bi={vec:Oi,dir:r.ab.vec2.scale(r.ab.vec2.create(),Oi,1/Si),len:Si};this.edgeProps.push(Bi),this.edgeProps.push(Bi)}}distSqLines($,J,ee,de){const pe=r.ab.vec3.subtract(r.ab.vec3.create(),J,$),we=r.ab.vec3.subtract(r.ab.vec3.create(),de,ee),Re=r.ab.vec3.subtract(r.ab.vec3.create(),$,ee),Se=r.ab.vec3.dot(pe,pe),Ue=r.ab.vec3.dot(pe,we),Ne=r.ab.vec3.dot(pe,Re),Ge=r.ab.vec3.dot(we,we),it=r.ab.vec3.dot(we,Re),Tt=Se*Ge-Ue*Ue;if(Tt===0){const ei=r.ab.vec3.dot(Re,we)/r.ab.vec3.dot(we,we),Pi=r.ab.vec3.lerp(r.ab.vec3.create(),ee,de,ei);return r.ab.vec3.squaredDistance(Pi,$)}const St=(Ue*it-Ne*Ge)/Tt,Yt=(Se*it-Ue*Ne)/Tt,ti=r.ab.vec3.lerp(r.ab.vec3.create(),$,J,St),ii=r.ab.vec3.lerp(r.ab.vec3.create(),ee,de,Yt);return r.ab.vec3.squaredDistance(ti,ii)}}class Pt{static parseFrom($,J){const ee=Ve.parse($);if(!ee)return[];let{vertices:de,features:pe}=ee;const we=1/r.cc(J);pe.sort((Ne,Ge)=>Ne.id-Ge.id),de.sort((Ne,Ge)=>Ne.id-Ge.id||Ne.idx-Ge.idx),de=de.filter((Ne,Ge,it)=>Ge===it.findIndex(Tt=>Tt.id===Ne.id&&Tt.idx===Ne.idx));const Re=new Array;let Se=0;const Ue=de.length;for(const Ne of pe){if(Ne.constantHeight){Re.push(new at(Ne.id,Ne.bounds,Ne.constantHeight));continue}for(;Se!==Ue&&de[Se].id<Ne.id;)Se++;if(Se===Ue||de[Se].id!==Ne.id)continue;const Ge=new Array,it=new Array,Tt=Se;for(;Se!==Ue&&de[Se].id===Ne.id;){const St=de[Se];if(Ge.push({position:St.position,height:St.height,extent:St.extent}),Se!==Tt&&de[Se-1].idx===St.idx-1){const Yt=Se-Tt;it.push({a:Yt-1,b:Yt})}Se++}Re.push(new at(Ne.id,Ne.bounds,void 0,Ge,it,we))}return Re}}r.dV(at,"ElevationFeature");class dt{constructor($){this.tileID=new r.aG($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.request&&$.request.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=r.aQ($.tileID.canonical,$.projection),this.projection=$.projection,this.worldview=$.worldview,this.localizableLayerIds=$.localizableLayerIds,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep,this.scaleFactor=$.scaleFactor}parse($,J,ee,de,pe){this.status="parsing",this.data=$,this.collisionBoxArray=new r.aW;const we=new r.d_(Object.keys($.layers).sort()),Re=new r.d$(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const Se={},Ue=new r.e0(256,256),Ne={featureIndex:Re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ue,availableImages:ee,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Ge=J.familiesBySource[this.source];for(const ei in Ge){const Pi=$.layers[ei];if(!Pi)continue;let Oi=!1,Si=!1,Bi=!1;for(const Xn of Ge[ei])Xn[0].type==="symbol"?Oi=!0:Si=!0,Xn[0].is3D()&&Xn[0].type!=="model"&&(Bi=!0);if(this.extraShadowCaster&&!Bi||this.isSymbolTile===!0&&!Oi||this.isSymbolTile===!1&&!Si)continue;Pi.version===1&&r.w(`Vector tile source "${this.source}" layer "${ei}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ui=we.encode(ei),Fn=[];let to=!1;for(let Xn=0,er=0;Xn<Pi.length;Xn++){const Fr=Pi.feature(Xn),oc=Re.getId(Fr,ei);if(this.localizableLayerIds&&this.localizableLayerIds.has(ei)){const Ao=Fr.properties?Fr.properties.worldview:null;if(this.worldview&&typeof Ao=="string")if(Ao==="all")Fr.properties.$localized=!0;else{if(!Ao.split(",").includes(this.worldview))continue;Fr.properties.$localized=!0,Fr.properties.worldview=this.worldview}}!to&&Fr.properties&&Fr.properties.hasOwnProperty(Oe)&&(to=!0),Fn.push({feature:Fr,id:oc,index:er,sourceLayerIndex:Ui}),er++}to&&$.layers.hasOwnProperty(Le)&&(Ne.elevationFeatures=Pt.parseFrom($.layers[Le],this.canonical));for(const Xn of Ge[ei]){const er=Xn[0];(!this.extraShadowCaster||er.is3D()&&er.type!=="model")&&(this.isSymbolTile!==void 0&&er.type==="symbol"!==this.isSymbolTile||er.minzoom&&this.zoom<Math.floor(er.minzoom)||er.maxzoom&&this.zoom>=er.maxzoom||er.visibility!=="none"&&(zt(Xn,this.zoom,Ne.brightness,ee),(Se[er.id]=er.createBucket({index:Re.bucketLayerIDs.length,layers:Xn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ui,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Fn,Ne,this.tileID.canonical,this.tileTransform),Re.bucketLayerIDs.push(Xn.map(Fr=>r.aC(Fr.id,Fr.scope)))))}}let it,Tt,St,Yt;Ue.trim();const ti={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ii=()=>{if(it)return this.status="done",pe(it);if(this.extraShadowCaster)this.status="done",pe(null,{buckets:r.bj(Se).filter(ei=>!ei.isEmpty()),featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ne.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Tt&&St&&Yt){const ei=new je(Tt),Pi=new r.e3(St,Yt,this.lut);for(const Oi in Se){const Si=Se[Oi];Si instanceof r.aX?(zt(Si.layers,this.zoom,Ne.brightness,ee),r.e4(Si,Tt,ei.positions,St,Pi.iconPositions,this.showCollisionBoxes,ee,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Si.hasPattern&&(Si instanceof r.b1||Si instanceof r.b2||Si instanceof r.d5)&&(zt(Si.layers,this.zoom,Ne.brightness,ee),Si.addFeatures(Ne,this.tileID.canonical,Pi.patternPositions,ee,this.tileTransform,this.brightness))}this.status="done",pe(null,{buckets:r.bj(Se).filter(Oi=>!Oi.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ei.image,lineAtlas:Ue,imageAtlas:Pi,brightness:Ne.brightness})}};if(!this.extraShadowCaster){const ei=r.e1(Ne.glyphDependencies,Si=>Object.keys(Si).map(Number));Object.keys(ei).length?de.send("getGlyphs",{uid:this.uid,stacks:ei,scope:this.scope},(Si,Bi)=>{it||(it=Si,Tt=Bi,ii())},void 0,!1,ti):Tt={};const Pi=Object.keys(Ne.iconDependencies);Pi.length?de.send("getImages",{icons:Pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Si,Bi)=>{if(it)return;it=Si;const Ui={};Object.values(Bi).some(Fn=>Fn.usvg)?this.rasterize(de,Ui,Bi,Ne.iconDependencies,()=>{St=Ui,ii()}):(this.fillImageMap(Ui,Ne.iconDependencies,Bi),St=Ui,ii())},void 0,!1,ti):St={};const Oi=Object.keys(Ne.patternDependencies);Oi.length?de.send("getImages",{icons:Oi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Si,Bi)=>{if(!it){it=Si;const Ui={};Object.values(Bi).some(Fn=>Fn.usvg)?this.rasterize(de,Ui,Bi,Ne.patternDependencies,()=>{Yt=Ui,ii()}):(this.fillImageMap(Ui,Ne.patternDependencies,Bi),Yt=Ui,ii())}},void 0,!1,ti):Yt={}}ii()}fillImageMap($,J,ee){for(const de in ee){const pe=J[de]||[];for(const we of pe)ee[we.id].usvg||($[we.serialize()]=ee[we.id])}}getImageTaskQueue($,J,ee){const de={};for(const pe in J){const we=ee[pe]||[];for(const Re of we){const Se=Re.serialize();J[Re.id].usvg?de[Se]||(de[Se]=Re):$[Se]=J[Re.id]}}return de}rasterize($,J,ee,de,pe){const we=this.getImageTaskQueue(J,ee,de);this.rasterizeTask=$.send("rasterizeImages",{scope:this.scope,imageTasks:we},(Re,Se)=>{if(!Re)for(const Ue in Se){const{id:Ne}=r.e2.deserializeFromString(Ue);J[Ue]=Object.assign({},ee[Ne],{data:Se[Ue]})}pe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function zt(qe,$,J,ee){const de=new r.a8($,{brightness:J});for(const pe of qe)pe.recalculate(de,ee)}class ut extends r.E{constructor($,J,ee,de,pe,we){super(),this.actor=$,this.layerIndex=J,this.availableImages=ee,this.loadVectorData=pe||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB($.scheduler),this.isSpriteLoaded=de,this.scheduler=$.scheduler,this.brightness=we}loadTile($,J){const ee=$.uid,de=$&&$.request,pe=de&&de.collectResourceTiming,we=this.loading[ee]=new dt($);we.abort=this.loadVectorData($,(Re,Se)=>{const Ue=!this.loading[ee];if(delete this.loading[ee],we.cancelRasterize(),Ue||Re||!Se)return we.status="done",Ue||(this.loaded[ee]=we),J(Re);const Ne=Se.rawData,Ge={};Se.expires&&(Ge.expires=Se.expires),Se.cacheControl&&(Ge.cacheControl=Se.cacheControl),we.vectorTile=Se.vectorTile||new r.dY.VectorTile(new r.bh(Ne));const it=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,(Tt,St)=>{if(Tt||!St)return J(Tt);const Yt={};if(pe){const ti=W(de);ti.length>0&&(Yt.resourceTiming=JSON.parse(JSON.stringify(ti)))}J(null,r.l({rawTileData:Ne.slice(0)},St,Ge,Yt))})};this.isSpriteLoaded?it():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(it,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):it()}),this.loaded=this.loaded||{},this.loaded[ee]=we})}reloadTile($,J){const ee=this.loaded,de=$.uid;if(ee&&ee[de]){const pe=ee[de];pe.scaleFactor=$.scaleFactor,pe.showCollisionBoxes=$.showCollisionBoxes,pe.projection=$.projection,pe.brightness=$.brightness,pe.tileTransform=r.aQ($.tileID.canonical,$.projection),pe.extraShadowCaster=$.extraShadowCaster,pe.lut=$.lut;const we=(Re,Se)=>{const Ue=pe.reloadCallback;Ue&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ue)),J(Re,Se)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,we):we())}else J(null,void 0)}abortTile($,J){const ee=$.uid,de=this.loading[ee];de&&(de.abort&&de.abort(),delete this.loading[ee]),J()}removeTile($,J){const ee=this.loaded,de=$.uid;ee&&ee[de]&&delete ee[de],J()}}class Je{loadTile($,J){const{uid:ee,encoding:de,rawImageData:pe,padding:we}=$,Re=ImageBitmap&&pe instanceof ImageBitmap?this.getImageData(pe,we):pe;J(null,new r.e5(ee,Re,de,we<1))}getImageData($,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const ee=this.offscreenCanvasContext.getImageData(-J,-J,$.width+2*J,$.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}r.bg.setPbf(r.bh);class ht{decodeRasterArray({task:$,buffer:J},ee){r.bg.performDecoding(J,$).then(de=>{ee(null,de)},de=>{ee(de)})}}const vt=r.dY.VectorTileFeature.prototype.toGeoJSON;class Wt{constructor($){this._feature=$,this.extent=r.ag,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))}loadGeometry(){if(this._feature.type===1){const $=[];for(const J of this._feature.geometry)$.push([new r.P(J[0],J[1])]);return $}{const $=[];for(const J of this._feature.geometry){const ee=[];for(const de of J)ee.push(new r.P(de[0],de[1]));$.push(ee)}return $}}toGeoJSON($,J,ee){return vt.call(this,$,J,ee)}}class vi{constructor($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=$.length,this._features=$}feature($){return new Wt(this._features[$])}}const Ft=64/4096,Qt=128;class Ti{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],J){for(const ee of $){const de=ee.id;if(de==null)continue;let pe=this.features.get(de);pe&&this.updateCache(pe,J),ee.geometry?(pe=ri(ee),this.updateCache(pe,J),this.features.set(de,pe)):this.features.delete(de),this.updateCache(pe,J)}}updateCache($,J){for(const{canonical:ee,uid:de}of Object.values(J)){const{z:pe,x:we,y:Re}=ee;hi($,Math.pow(2,pe),we,Re)&&delete J[de]}}getTile($,J,ee){const de=Math.pow(2,$),pe=[];for(const we of this.features.values())hi(we,de,J,ee)&&pe.push(mi(we,de,J,ee));return{features:pe}}getFeatures(){return[...this.features.values()]}}function hi({minX:qe,minY:$,maxX:J,maxY:ee},de,pe,we){return qe<(pe+1+Ft)/de&&$<(we+1+Ft)/de&&J>(pe-Ft)/de&&ee>(we-Ft)/de}function ri(qe){const{id:$,geometry:J,properties:ee}=qe;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:de,coordinates:pe}=J,we={id:$,type:1,geometry:[],tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Re=we.geometry;if(de==="Point")rr(pe,Re,we);else if(de==="MultiPoint")for(const Se of pe)rr(Se,Re,we);else if(de==="LineString")we.type=2,mr(pe,Re,we);else if(de==="MultiLineString")we.type=2,ar(pe,Re,we);else if(de==="Polygon")we.type=3,ar(pe,Re,we,!0);else{if(de!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(const Se of pe)ar(Se,Re,we,!0)}return we}function rr([qe,$],J,ee){const de=r.at(qe);let pe=r.aA($);pe=pe<0?0:pe>1?1:pe,J.push(de,pe),ee.minX=Math.min(ee.minX,de),ee.minY=Math.min(ee.minY,pe),ee.maxX=Math.max(ee.maxX,de),ee.maxY=Math.max(ee.maxY,pe)}function mr(qe,$,J,ee=!1,de=!1){const pe=[];for(const we of qe)rr(we,pe,J);$.push(pe),ee&&function(we,Re){let Se=0;for(let Ue=0,Ne=we.length,Ge=Ne-2;Ue<Ne;Ge=Ue,Ue+=2)Se+=(we[Ue]-we[Ge])*(we[Ue+1]+we[Ge+1]);if(Se>0===Re)for(let Ue=0,Ne=we.length;Ue<Ne/2;Ue+=2){const Ge=we[Ue],it=we[Ue+1];we[Ue]=we[Ne-2-Ue],we[Ue+1]=we[Ne-1-Ue],we[Ne-2-Ue]=Ge,we[Ne-1-Ue]=it}}(pe,de)}function ar(qe,$,J,ee=!1){for(let de=0;de<qe.length;de++)mr(qe[de],$,J,ee,de===0)}function mi(qe,$,J,ee){const{id:de,type:pe,geometry:we,tags:Re}=qe,Se=[];if(pe===1)(function(Ue,Ne,Ge,it,Tt){for(let St=0;St<Ue.length;St+=2){const Yt=Math.round(r.ag*(Ue[St+0]*Ne-Ge)),ti=Math.round(r.ag*(Ue[St+1]*Ne-it));Tt.push([Yt,ti])}})(we,$,J,ee,Se);else for(const Ue of we)nc(Ue,$,J,ee,Se);return{id:de,type:pe,geometry:Se,tags:Re}}function nc(qe,$,J,ee,de){const pe=-Qt,we=r.ag+Qt;let Re;for(let Se=0;Se<qe.length-2;Se+=2){let Ue=Math.round(r.ag*(qe[Se+0]*$-J)),Ne=Math.round(r.ag*(qe[Se+1]*$-ee)),Ge=Math.round(r.ag*(qe[Se+2]*$-J)),it=Math.round(r.ag*(qe[Se+3]*$-ee));const Tt=Ge-Ue,St=it-Ne;Ue<pe&&Ge<pe||(Ue<pe?(Ne+=Math.round(St*((pe-Ue)/Tt)),Ue=pe):Ge<pe&&(it=Ne+Math.round(St*((pe-Ue)/Tt)),Ge=pe),Ne<pe&&it<pe||(Ne<pe?(Ue+=Math.round(Tt*((pe-Ne)/St)),Ne=pe):it<pe&&(Ge=Ue+Math.round(Tt*((pe-Ne)/St)),it=pe),Ue>=we&&Ge>=we||(Ue>=we?(Ne+=Math.round(St*((we-Ue)/Tt)),Ue=we):Ge>=we&&(it=Ne+Math.round(St*((we-Ue)/Tt)),Ge=we),Ne>=we&&it>=we||(Ne>=we?(Ue+=Math.round(Tt*((we-Ne)/St)),Ne=we):it>=we&&(Ge=Ue+Math.round(Tt*((we-Ne)/St)),it=we),Re&&Ue===Re[Re.length-1][0]&&Ne===Re[Re.length-1][1]||(Re=[[Ue,Ne]],de.push(Re)),Re.push([Ge,it])))))}}var Xo,vs,Os,Zr={exports:{}},So=function(){if(Os)return Zr.exports;Os=1;var qe=r.e8(),$=function(){if(vs)return Xo;vs=1;var Ne=r.e6(),Ge=r.e7().VectorTileFeature;function it(St,Yt){this.options=Yt||{},this.features=St,this.length=St.length}function Tt(St,Yt){this.id=typeof St.id=="number"?St.id:void 0,this.type=St.type,this.rawGeometry=St.type===1?[St.geometry]:St.geometry,this.properties=St.tags,this.extent=Yt||4096}return Xo=it,it.prototype.feature=function(St){return new Tt(this.features[St],this.options.extent)},Tt.prototype.loadGeometry=function(){var St=this.rawGeometry;this.geometry=[];for(var Yt=0;Yt<St.length;Yt++){for(var ti=St[Yt],ii=[],ei=0;ei<ti.length;ei++)ii.push(new Ne(ti[ei][0],ti[ei][1]));this.geometry.push(ii)}return this.geometry},Tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var St=this.geometry,Yt=1/0,ti=-1/0,ii=1/0,ei=-1/0,Pi=0;Pi<St.length;Pi++)for(var Oi=St[Pi],Si=0;Si<Oi.length;Si++){var Bi=Oi[Si];Yt=Math.min(Yt,Bi.x),ti=Math.max(ti,Bi.x),ii=Math.min(ii,Bi.y),ei=Math.max(ei,Bi.y)}return[Yt,ii,ti,ei]},Tt.prototype.toGeoJSON=Ge.prototype.toGeoJSON,Xo}();function J(Ne){var Ge=new qe;return function(it,Tt){for(var St in it.layers)Tt.writeMessage(3,ee,it.layers[St])}(Ne,Ge),Ge.finish()}function ee(Ne,Ge){var it;Ge.writeVarintField(15,Ne.version||1),Ge.writeStringField(1,Ne.name||""),Ge.writeVarintField(5,Ne.extent||4096);var Tt={keys:[],values:[],keycache:{},valuecache:{}};for(it=0;it<Ne.length;it++)Tt.feature=Ne.feature(it),Ge.writeMessage(2,de,Tt);var St=Tt.keys;for(it=0;it<St.length;it++)Ge.writeStringField(3,St[it]);var Yt=Tt.values;for(it=0;it<Yt.length;it++)Ge.writeMessage(4,Ue,Yt[it])}function de(Ne,Ge){var it=Ne.feature;it.id!==void 0&&Ge.writeVarintField(1,it.id),Ge.writeMessage(2,pe,Ne),Ge.writeVarintField(3,it.type),Ge.writeMessage(4,Se,it)}function pe(Ne,Ge){var it=Ne.feature,Tt=Ne.keys,St=Ne.values,Yt=Ne.keycache,ti=Ne.valuecache;for(var ii in it.properties){var ei=it.properties[ii],Pi=Yt[ii];if(ei!==null){Pi===void 0&&(Tt.push(ii),Yt[ii]=Pi=Tt.length-1),Ge.writeVarint(Pi);var Oi=typeof ei;Oi!=="string"&&Oi!=="boolean"&&Oi!=="number"&&(ei=JSON.stringify(ei));var Si=Oi+":"+ei,Bi=ti[Si];Bi===void 0&&(St.push(ei),ti[Si]=Bi=St.length-1),Ge.writeVarint(Bi)}}}function we(Ne,Ge){return(Ge<<3)+(7&Ne)}function Re(Ne){return Ne<<1^Ne>>31}function Se(Ne,Ge){for(var it=Ne.loadGeometry(),Tt=Ne.type,St=0,Yt=0,ti=it.length,ii=0;ii<ti;ii++){var ei=it[ii],Pi=1;Tt===1&&(Pi=ei.length),Ge.writeVarint(we(1,Pi));for(var Oi=Tt===3?ei.length-1:ei.length,Si=0;Si<Oi;Si++){Si===1&&Tt!==1&&Ge.writeVarint(we(2,Oi-1));var Bi=ei[Si].x-St,Ui=ei[Si].y-Yt;Ge.writeVarint(Re(Bi)),Ge.writeVarint(Re(Ui)),St+=Bi,Yt+=Ui}Tt===3&&Ge.writeVarint(we(7,1))}}function Ue(Ne,Ge){var it=typeof Ne;it==="string"?Ge.writeStringField(1,Ne):it==="boolean"?Ge.writeBooleanField(7,Ne):it==="number"&&(Ne%1!=0?Ge.writeDoubleField(3,Ne):Ne<0?Ge.writeSVarintField(6,Ne):Ge.writeVarintField(5,Ne))}return Zr.exports=J,Zr.exports.fromVectorTileJs=J,Zr.exports.fromGeojsonVt=function(Ne,Ge){Ge=Ge||{};var it={};for(var Tt in Ne)it[Tt]=new $(Ne[Tt].features,Ge),it[Tt].name=Tt,it[Tt].version=Ge.version,it[Tt].extent=Ge.extent;return J({layers:it})},Zr.exports.GeoJSONWrapper=$,Zr.exports}(),Te=r.e9(So);const Ks={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},Js=Math.fround||(Be=new Float32Array(1),qe=>(Be[0]=+qe,Be[0]));var Be;const ge=3,_t=5,Ot=6;class kt{constructor($){this.options=Object.assign(Object.create(Ks),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:J,minZoom:ee,maxZoom:de}=this.options;J&&console.time("total time");const pe=`prepare ${$.length} points`;J&&console.time(pe),this.points=$;const we=[];for(let Se=0;Se<$.length;Se++){const Ue=$[Se];if(!Ue.geometry)continue;const[Ne,Ge]=Ue.geometry.coordinates,it=Js($t(Ne)),Tt=Js(Zt(Ge));we.push(it,Tt,1/0,Se,-1,1),this.options.reduce&&we.push(0)}let Re=this.trees[de+1]=this._createTree(we);J&&console.timeEnd(pe);for(let Se=de;Se>=ee;Se--){const Ue=+Date.now();Re=this.trees[Se]=this._createTree(this._cluster(Re,Se)),J&&console.log("z%d: %d clusters in %dms",Se,Re.numItems,+Date.now()-Ue)}return J&&console.timeEnd("total time"),this}getClusters($,J){let ee=(($[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,$[1]));let pe=$[2]===180?180:(($[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ee=-180,pe=180;else if(ee>pe){const Ge=this.getClusters([ee,de,180,we],J),it=this.getClusters([-180,de,pe,we],J);return Ge.concat(it)}const Re=this.trees[this._limitZoom(J)],Se=Re.range($t(ee),Zt(we),$t(pe),Zt(de)),Ue=Re.data,Ne=[];for(const Ge of Se){const it=this.stride*Ge;Ne.push(Ue[it+_t]>1?mt(Ue,it,this.clusterProps):this.points[Ue[it+ge]])}return Ne}getChildren($){const J=this._getOriginId($),ee=this._getOriginZoom($),de="No cluster with the specified id.",pe=this.trees[ee];if(!pe)throw new Error(de);const we=pe.data;if(J*this.stride>=we.length)throw new Error(de);const Re=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Se=pe.within(we[J*this.stride],we[J*this.stride+1],Re),Ue=[];for(const Ne of Se){const Ge=Ne*this.stride;we[Ge+4]===$&&Ue.push(we[Ge+_t]>1?mt(we,Ge,this.clusterProps):this.points[we[Ge+ge]])}if(Ue.length===0)throw new Error(de);return Ue}getLeaves($,J,ee){const de=[];return this._appendLeaves(de,$,J=J||10,ee=ee||0,0),de}getTile($,J,ee){const de=this.trees[this._limitZoom($)],pe=Math.pow(2,$),{extent:we,radius:Re}=this.options,Se=Re/we,Ue=(ee-Se)/pe,Ne=(ee+1+Se)/pe,Ge={features:[]};return this._addTileFeatures(de.range((J-Se)/pe,Ue,(J+1+Se)/pe,Ne),de.data,J,ee,pe,Ge),J===0&&this._addTileFeatures(de.range(1-Se/pe,Ue,1,Ne),de.data,pe,ee,pe,Ge),J===pe-1&&this._addTileFeatures(de.range(0,Ue,Se/pe,Ne),de.data,-1,ee,pe,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom($){let J=this._getOriginZoom($)-1;for(;J<=this.options.maxZoom;){const ee=this.getChildren($);if(J++,ee.length!==1)break;$=ee[0].properties.cluster_id}return J}_appendLeaves($,J,ee,de,pe){const we=this.getChildren(J);for(const Re of we){const Se=Re.properties;if(Se&&Se.cluster?pe+Se.point_count<=de?pe+=Se.point_count:pe=this._appendLeaves($,Se.cluster_id,ee,de,pe):pe<de?pe++:$.push(Re),$.length===ee)break}return pe}_createTree($){const J=new r.bE($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<$.length;ee+=this.stride)J.add($[ee],$[ee+1]);return J.finish(),J.data=$,J}_addTileFeatures($,J,ee,de,pe,we){for(const Re of $){const Se=Re*this.stride,Ue=J[Se+_t]>1;let Ne,Ge,it;if(Ue)Ne=Gt(J,Se,this.clusterProps),Ge=J[Se],it=J[Se+1];else{const Yt=this.points[J[Se+ge]];Ne=Yt.properties;const[ti,ii]=Yt.geometry.coordinates;Ge=$t(ti),it=Zt(ii)}const Tt={type:1,geometry:[[Math.round(this.options.extent*(Ge*pe-ee)),Math.round(this.options.extent*(it*pe-de))]],tags:Ne};let St;St=Ue||this.options.generateId?J[Se+ge]:this.points[J[Se+ge]].id,St!==void 0&&(Tt.id=St),we.features.push(Tt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,J){const{radius:ee,extent:de,reduce:pe,minPoints:we}=this.options,Re=ee/(de*Math.pow(2,J)),Se=$.data,Ue=[],Ne=this.stride;for(let Ge=0;Ge<Se.length;Ge+=Ne){if(Se[Ge+2]<=J)continue;Se[Ge+2]=J;const it=Se[Ge],Tt=Se[Ge+1],St=$.within(Se[Ge],Se[Ge+1],Re),Yt=Se[Ge+_t];let ti=Yt;for(const ii of St){const ei=ii*Ne;Se[ei+2]>J&&(ti+=Se[ei+_t])}if(ti>Yt&&ti>=we){let ii,ei=it*Yt,Pi=Tt*Yt,Oi=-1;const Si=(Ge/Ne<<5)+(J+1)+this.points.length;for(const Bi of St){const Ui=Bi*Ne;if(Se[Ui+2]<=J)continue;Se[Ui+2]=J;const Fn=Se[Ui+_t];ei+=Se[Ui]*Fn,Pi+=Se[Ui+1]*Fn,Se[Ui+4]=Si,pe&&(ii||(ii=this._map(Se,Ge,!0),Oi=this.clusterProps.length,this.clusterProps.push(ii)),pe(ii,this._map(Se,Ui)))}Se[Ge+4]=Si,Ue.push(ei/ti,Pi/ti,1/0,Si,-1,ti),pe&&Ue.push(Oi)}else{for(let ii=0;ii<Ne;ii++)Ue.push(Se[Ge+ii]);if(ti>1)for(const ii of St){const ei=ii*Ne;if(!(Se[ei+2]<=J)){Se[ei+2]=J;for(let Pi=0;Pi<Ne;Pi++)Ue.push(Se[ei+Pi])}}}}return Ue}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,J,ee){if($[J+_t]>1){const we=this.clusterProps[$[J+Ot]];return ee?Object.assign({},we):we}const de=this.points[$[J+ge]].properties,pe=this.options.map(de);return ee&&pe===de?Object.assign({},pe):pe}}function mt(qe,$,J){return{type:"Feature",id:qe[$+ge],properties:Gt(qe,$,J),geometry:{type:"Point",coordinates:[(ee=qe[$],360*(ee-.5)),Ut(qe[$+1])]}};var ee}function Gt(qe,$,J){const ee=qe[$+_t],de=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,pe=qe[$+Ot],we=pe===-1?{}:Object.assign({},J[pe]);return Object.assign(we,{cluster:!0,cluster_id:qe[$+ge],point_count:ee,point_count_abbreviated:de})}function $t(qe){return qe/360+.5}function Zt(qe){const $=Math.sin(qe*Math.PI/180),J=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return J<0?0:J>1?1:J}function Ut(qe){const $=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function bi(qe,$,J,ee){let de=ee;const pe=$+(J-$>>1);let we,Re=J-$;const Se=qe[$],Ue=qe[$+1],Ne=qe[J],Ge=qe[J+1];for(let it=$+3;it<J;it+=3){const Tt=Mt(qe[it],qe[it+1],Se,Ue,Ne,Ge);if(Tt>de)we=it,de=Tt;else if(Tt===de){const St=Math.abs(it-pe);St<Re&&(we=it,Re=St)}}de>ee&&(we-$>3&&bi(qe,$,we,ee),qe[we+2]=de,J-we>3&&bi(qe,we,J,ee))}function Mt(qe,$,J,ee,de,pe){let we=de-J,Re=pe-ee;if(we!==0||Re!==0){const Se=((qe-J)*we+($-ee)*Re)/(we*we+Re*Re);Se>1?(J=de,ee=pe):Se>0&&(J+=we*Se,ee+=Re*Se)}return we=qe-J,Re=$-ee,we*we+Re*Re}function di(qe,$,J,ee){const de={id:qe??null,type:$,geometry:J,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")wi(de,J);else if($==="Polygon")wi(de,J[0]);else if($==="MultiLineString")for(const pe of J)wi(de,pe);else if($==="MultiPolygon")for(const pe of J)wi(de,pe[0]);return de}function wi(qe,$){for(let J=0;J<$.length;J+=3)qe.minX=Math.min(qe.minX,$[J]),qe.minY=Math.min(qe.minY,$[J+1]),qe.maxX=Math.max(qe.maxX,$[J]),qe.maxY=Math.max(qe.maxY,$[J+1])}function Gi(qe,$,J,ee){if(!$.geometry)return;const de=$.geometry.coordinates;if(de&&de.length===0)return;const pe=$.geometry.type,we=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Re=[],Se=$.id;if(J.promoteId?Se=$.properties[J.promoteId]:J.generateId&&(Se=ee||0),pe==="Point")qi(de,Re);else if(pe==="MultiPoint")for(const Ue of de)qi(Ue,Re);else if(pe==="LineString")tn(de,Re,we,!1);else if(pe==="MultiLineString"){if(J.lineMetrics){for(const Ue of de)Re=[],tn(Ue,Re,we,!1),qe.push(di(Se,"LineString",Re,$.properties));return}Qn(de,Re,we,!1)}else if(pe==="Polygon")Qn(de,Re,we,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const Ue of $.geometry.geometries)Gi(qe,{id:Se,geometry:Ue,properties:$.properties},J,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ue of de){const Ne=[];Qn(Ue,Ne,we,!0),Re.push(Ne)}}qe.push(di(Se,pe,Re,$.properties))}function qi(qe,$){$.push(Un(qe[0]),_r(qe[1]),0)}function tn(qe,$,J,ee){let de,pe,we=0;for(let Se=0;Se<qe.length;Se++){const Ue=Un(qe[Se][0]),Ne=_r(qe[Se][1]);$.push(Ue,Ne,0),Se>0&&(we+=ee?(de*Ne-Ue*pe)/2:Math.sqrt(Math.pow(Ue-de,2)+Math.pow(Ne-pe,2))),de=Ue,pe=Ne}const Re=$.length-3;$[2]=1,bi($,0,Re,J),$[Re+2]=1,$.size=Math.abs(we),$.start=0,$.end=$.size}function Qn(qe,$,J,ee){for(let de=0;de<qe.length;de++){const pe=[];tn(qe[de],pe,J,ee),$.push(pe)}}function Un(qe){return qe/360+.5}function _r(qe){const $=Math.sin(qe*Math.PI/180),J=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return J<0?0:J>1?1:J}function xn(qe,$,J,ee,de,pe,we,Re){if(ee/=$,pe>=(J/=$)&&we<ee)return qe;if(we<J||pe>=ee)return null;const Se=[];for(const Ue of qe){const Ne=Ue.geometry;let Ge=Ue.type;const it=de===0?Ue.minX:Ue.minY,Tt=de===0?Ue.maxX:Ue.maxY;if(it>=J&&Tt<ee){Se.push(Ue);continue}if(Tt<J||it>=ee)continue;let St=[];if(Ge==="Point"||Ge==="MultiPoint")bs(Ne,St,J,ee,de);else if(Ge==="LineString")Eo(Ne,St,J,ee,de,!1,Re.lineMetrics);else if(Ge==="MultiLineString")gr(Ne,St,J,ee,de,!1);else if(Ge==="Polygon")gr(Ne,St,J,ee,de,!0);else if(Ge==="MultiPolygon")for(const Yt of Ne){const ti=[];gr(Yt,ti,J,ee,de,!0),ti.length&&St.push(ti)}if(St.length){if(Re.lineMetrics&&Ge==="LineString"){for(const Yt of St)Se.push(di(Ue.id,Ge,Yt,Ue.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(St.length===1?(Ge="LineString",St=St[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=St.length===3?"Point":"MultiPoint"),Se.push(di(Ue.id,Ge,St,Ue.tags))}}return Se.length?Se:null}function bs(qe,$,J,ee,de){for(let pe=0;pe<qe.length;pe+=3){const we=qe[pe+de];we>=J&&we<=ee&&_i($,qe[pe],qe[pe+1],qe[pe+2])}}function Eo(qe,$,J,ee,de,pe,we){let Re=Mn(qe);const Se=de===0?Qs:Mu;let Ue,Ne,Ge=qe.start;for(let ti=0;ti<qe.length-3;ti+=3){const ii=qe[ti],ei=qe[ti+1],Pi=qe[ti+2],Oi=qe[ti+3],Si=qe[ti+4],Bi=de===0?ii:ei,Ui=de===0?Oi:Si;let Fn=!1;we&&(Ue=Math.sqrt(Math.pow(ii-Oi,2)+Math.pow(ei-Si,2))),Bi<J?Ui>J&&(Ne=Se(Re,ii,ei,Oi,Si,J),we&&(Re.start=Ge+Ue*Ne)):Bi>ee?Ui<ee&&(Ne=Se(Re,ii,ei,Oi,Si,ee),we&&(Re.start=Ge+Ue*Ne)):_i(Re,ii,ei,Pi),Ui<J&&Bi>=J&&(Ne=Se(Re,ii,ei,Oi,Si,J),Fn=!0),Ui>ee&&Bi<=ee&&(Ne=Se(Re,ii,ei,Oi,Si,ee),Fn=!0),!pe&&Fn&&(we&&(Re.end=Ge+Ue*Ne),$.push(Re),Re=Mn(qe)),we&&(Ge+=Ue)}let it=qe.length-3;const Tt=qe[it],St=qe[it+1],Yt=de===0?Tt:St;Yt>=J&&Yt<=ee&&_i(Re,Tt,St,qe[it+2]),it=Re.length-3,pe&&it>=3&&(Re[it]!==Re[0]||Re[it+1]!==Re[1])&&_i(Re,Re[0],Re[1],Re[2]),Re.length&&$.push(Re)}function Mn(qe){const $=[];return $.size=qe.size,$.start=qe.start,$.end=qe.end,$}function gr(qe,$,J,ee,de,pe){for(const we of qe)Eo(we,$,J,ee,de,pe,!1)}function _i(qe,$,J,ee){qe.push($,J,ee)}function Qs(qe,$,J,ee,de,pe){const we=(pe-$)/(ee-$);return _i(qe,pe,J+(de-J)*we,1),we}function Mu(qe,$,J,ee,de,pe){const we=(pe-J)/(de-J);return _i(qe,$+(ee-$)*we,pe,1),we}function Wr(qe,$){const J=[];for(let ee=0;ee<qe.length;ee++){const de=qe[ee],pe=de.type;let we;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")we=Mo(de.geometry,$);else if(pe==="MultiLineString"||pe==="Polygon"){we=[];for(const Re of de.geometry)we.push(Mo(Re,$))}else if(pe==="MultiPolygon"){we=[];for(const Re of de.geometry){const Se=[];for(const Ue of Re)Se.push(Mo(Ue,$));we.push(Se)}}J.push(di(de.id,pe,we,de.tags))}return J}function Mo(qe,$){const J=[];J.size=qe.size,qe.start!==void 0&&(J.start=qe.start,J.end=qe.end);for(let ee=0;ee<qe.length;ee+=3)J.push(qe[ee]+$,qe[ee+1],qe[ee+2]);return J}function el(qe,$){if(qe.transformed)return qe;const J=1<<qe.z,ee=qe.x,de=qe.y;for(const pe of qe.features){const we=pe.geometry,Re=pe.type;if(pe.geometry=[],Re===1)for(let Se=0;Se<we.length;Se+=2)pe.geometry.push(tl(we[Se],we[Se+1],$,J,ee,de));else for(let Se=0;Se<we.length;Se++){const Ue=[];for(let Ne=0;Ne<we[Se].length;Ne+=2)Ue.push(tl(we[Se][Ne],we[Se][Ne+1],$,J,ee,de));pe.geometry.push(Ue)}}return qe.transformed=!0,qe}function tl(qe,$,J,ee,de,pe){return[Math.round(J*(qe*ee-de)),Math.round(J*($*ee-pe))]}function il(qe,$,J,ee,de){const pe=$===de.maxZoom?0:de.tolerance/((1<<$)*de.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:J,y:ee,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of qe)Au(we,Re,pe,de);return we}function Au(qe,$,J,ee){const de=$.geometry,pe=$.type,we=[];if(qe.minX=Math.min(qe.minX,$.minX),qe.minY=Math.min(qe.minY,$.minY),qe.maxX=Math.max(qe.maxX,$.maxX),qe.maxY=Math.max(qe.maxY,$.maxY),pe==="Point"||pe==="MultiPoint")for(let Re=0;Re<de.length;Re+=3)we.push(de[Re],de[Re+1]),qe.numPoints++,qe.numSimplified++;else if(pe==="LineString")nl(we,de,qe,J,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Re=0;Re<de.length;Re++)nl(we,de[Re],qe,J,pe==="Polygon",Re===0);else if(pe==="MultiPolygon")for(let Re=0;Re<de.length;Re++){const Se=de[Re];for(let Ue=0;Ue<Se.length;Ue++)nl(we,Se[Ue],qe,J,!0,Ue===0)}if(we.length){let Re=$.tags||null;if(pe==="LineString"&&ee.lineMetrics){Re={};for(const Ue in $.tags)Re[Ue]=$.tags[Ue];Re.mapbox_clip_start=de.start/de.size,Re.mapbox_clip_end=de.end/de.size}const Se={geometry:we,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Re};$.id!==null&&(Se.id=$.id),qe.features.push(Se)}}function nl(qe,$,J,ee,de,pe){const we=ee*ee;if(ee>0&&$.size<(de?we:ee))return void(J.numPoints+=$.length/3);const Re=[];for(let Se=0;Se<$.length;Se+=3)(ee===0||$[Se+2]>we)&&(J.numSimplified++,Re.push($[Se],$[Se+1])),J.numPoints++;de&&function(Se,Ue){let Ne=0;for(let Ge=0,it=Se.length,Tt=it-2;Ge<it;Tt=Ge,Ge+=2)Ne+=(Se[Ge]-Se[Tt])*(Se[Ge+1]+Se[Tt+1]);if(Ne>0===Ue)for(let Ge=0,it=Se.length;Ge<it/2;Ge+=2){const Tt=Se[Ge],St=Se[Ge+1];Se[Ge]=Se[it-2-Ge],Se[Ge+1]=Se[it-1-Ge],Se[it-2-Ge]=Tt,Se[it-1-Ge]=St}}(Re,pe),qe.push(Re)}const Iu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Cu{constructor($,J){const ee=(J=this.options=function(pe,we){for(const Re in we)pe[Re]=we[Re];return pe}(Object.create(Iu),J)).debug;if(ee&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(pe,we){const Re=[];if(pe.type==="FeatureCollection")for(let Se=0;Se<pe.features.length;Se++)Gi(Re,pe.features[Se],we,Se);else Gi(Re,pe.type==="Feature"?pe:{geometry:pe},we);return Re}($,J);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(pe,we){const Re=we.buffer/we.extent;let Se=pe;const Ue=xn(pe,1,-1-Re,Re,0,-1,2,we),Ne=xn(pe,1,1-Re,2+Re,0,-1,2,we);return(Ue||Ne)&&(Se=xn(pe,1,-Re,1+Re,0,-1,2,we)||[],Ue&&(Se=Wr(Ue,1).concat(Se)),Ne&&(Se=Se.concat(Wr(Ne,-1)))),Se}(de,J),de.length&&this.splitTile(de,0,0,0),ee&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,J,ee,de,pe,we,Re){const Se=[$,J,ee,de],Ue=this.options,Ne=Ue.debug;for(;Se.length;){de=Se.pop(),ee=Se.pop(),J=Se.pop(),$=Se.pop();const Ge=1<<J,it=Wn(J,ee,de);let Tt=this.tiles[it];if(!Tt&&(Ne>1&&console.time("creation"),Tt=this.tiles[it]=il($,J,ee,de,Ue),this.tileCoords.push({z:J,x:ee,y:de}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ee,de,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));const Fn=`z${J}`;this.stats[Fn]=(this.stats[Fn]||0)+1,this.total++}if(Tt.source=$,pe==null){if(J===Ue.indexMaxZoom||Tt.numPoints<=Ue.indexMaxPoints)continue}else{if(J===Ue.maxZoom||J===pe)continue;if(pe!=null){const Fn=pe-J;if(ee!==we>>Fn||de!==Re>>Fn)continue}}if(Tt.source=null,$.length===0)continue;Ne>1&&console.time("clipping");const St=.5*Ue.buffer/Ue.extent,Yt=.5-St,ti=.5+St,ii=1+St;let ei=null,Pi=null,Oi=null,Si=null,Bi=xn($,Ge,ee-St,ee+ti,0,Tt.minX,Tt.maxX,Ue),Ui=xn($,Ge,ee+Yt,ee+ii,0,Tt.minX,Tt.maxX,Ue);$=null,Bi&&(ei=xn(Bi,Ge,de-St,de+ti,1,Tt.minY,Tt.maxY,Ue),Pi=xn(Bi,Ge,de+Yt,de+ii,1,Tt.minY,Tt.maxY,Ue),Bi=null),Ui&&(Oi=xn(Ui,Ge,de-St,de+ti,1,Tt.minY,Tt.maxY,Ue),Si=xn(Ui,Ge,de+Yt,de+ii,1,Tt.minY,Tt.maxY,Ue),Ui=null),Ne>1&&console.timeEnd("clipping"),Se.push(ei||[],J+1,2*ee,2*de),Se.push(Pi||[],J+1,2*ee,2*de+1),Se.push(Oi||[],J+1,2*ee+1,2*de),Se.push(Si||[],J+1,2*ee+1,2*de+1)}}getTile($,J,ee){$=+$,J=+J,ee=+ee;const de=this.options,{extent:pe,debug:we}=de;if($<0||$>24)return null;const Re=1<<$,Se=Wn($,J=J+Re&Re-1,ee);if(this.tiles[Se])return el(this.tiles[Se],pe);we>1&&console.log("drilling down to z%d-%d-%d",$,J,ee);let Ue,Ne=$,Ge=J,it=ee;for(;!Ue&&Ne>0;)Ne--,Ge>>=1,it>>=1,Ue=this.tiles[Wn(Ne,Ge,it)];return Ue&&Ue.source?(we>1&&(console.log("found parent tile z%d-%d-%d",Ne,Ge,it),console.time("drilling down")),this.splitTile(Ue.source,Ne,Ge,it,$,J,ee),we>1&&console.timeEnd("drilling down"),this.tiles[Se]?el(this.tiles[Se],pe):null):null}}function Wn(qe,$,J){return 32*((1<<qe)*J+$)+qe}function rc(qe,$){const J=qe.tileID.canonical;if(!this._geoJSONIndex)return void $(null,null);const ee=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!ee)return void $(null,null);const de=new vi(ee.features);let pe=Te(de);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),$(null,{vectorTile:de,rawData:pe.buffer})}class Pu extends ut{constructor($,J,ee,de,pe,we){super($,J,ee,de,rc,we),pe&&(this.loadGeoJSON=pe),this._dynamicIndex=new Ti}loadData($,J){const ee=$&&$.request,de=ee&&ee.collectResourceTiming;this.loadGeoJSON($,(pe,we)=>{if(pe||!we)return J(pe);if(typeof we!="object")return J(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){const Se=r.U($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));we.features=we.features.filter(Ue=>Se.value.evaluate({zoom:0},Ue))}$.dynamic?(we.type==="Feature"&&(we={type:"FeatureCollection",features:[we]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),$.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new kt(function({superclusterOptions:Se,clusterProperties:Ue}){if(!Ue||!Se)return Se;const Ne={},Ge={},it={accumulated:null,zoom:0},Tt={properties:null},St=Object.keys(Ue);for(const Yt of St){const[ti,ii]=Ue[Yt],ei=r.U(ii),Pi=r.U(typeof ti=="string"?[ti,["accumulated"],["get",Yt]]:ti);Ne[Yt]=ei.value,Ge[Yt]=Pi.value}return Se.map=Yt=>{Tt.properties=Yt;const ti={};for(const ii of St)ti[ii]=Ne[ii].evaluate(it,Tt);return ti},Se.reduce=(Yt,ti)=>{Tt.properties=ti;for(const ii of St)it.accumulated=Yt[ii],Yt[ii]=Ge[ii].evaluate(it,Tt)},Se}($)).load(we.features):$.dynamic?this._dynamicIndex:function(Se,Ue){return new Cu(Se,Ue)}(we,$.geojsonVtOptions)}catch(Se){return J(Se)}const Re={};if(de){const Se=W(ee);Se&&(Re.resourceTiming={},Re.resourceTiming[$.source]=JSON.parse(JSON.stringify(Se)))}J(null,Re)}})}reloadTile($,J){const ee=this.loaded;return ee&&ee[$.uid]?$.partial?J(null,void 0):super.reloadTile($,J):this.loadTile($,J)}loadGeoJSON($,J){if($.request)r.n($.request,J);else{if(typeof $.data!="string")return J(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse($.data))}catch{return J(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(ee){J(ee)}}getClusterChildren($,J){try{J(null,this._geoJSONIndex.getChildren($.clusterId))}catch(ee){J(ee)}}getClusterLeaves($,J){try{J(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(ee){J(ee)}}}class sc{constructor($,J){this.tileID=new r.aG($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=J}parse($,J,ee,de){this.status="parsing";const pe=new r.aG(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),we=[],Re=J.familiesBySource[ee.source],Se=new r.d$(pe,ee.promoteId);return Se.bucketLayerIDs=[],Se.is3DTile=!0,r.ea($).then(Ue=>{if(!Ue)return de(new Error("Could not parse tile"));const Ne=r.eb(Ue,1/r.cc(ee.tileID.canonical)),Ge=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ue.json.asset.extras&&Ue.json.asset.extras.MAPBOX_mesh_features,it=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("EXT_meshopt_compression"),Tt=new r.a8(this.zoom,{brightness:this.brightness});for(const St in Re)for(const Yt of Re[St]){const ti=Yt[0];Se.bucketLayerIDs.push(Yt.map(ei=>r.aC(ei.id,ei.scope))),ti.recalculate(Tt,[]);const ii=new r.ec(Yt,Ne,pe,Ge,it,this.brightness,Se);Ge||(ii.needsUpload=!0),we.push(ii),ii.evaluate(ti)}this.status="done",de(null,{buckets:we,featureIndex:Se,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ue=>de(new Error(Ue.message)))}}class yr{constructor($,J,ee,de,pe,we){this.actor=$,this.layerIndex=J,this.availableImages=ee,this.brightness=we,this.loading={},this.loaded={}}loadTile($,J){const ee=$.uid,de=this.loading[ee]=new sc($,this.brightness);r.bi($.request,(pe,we)=>{const Re=!this.loading[ee];return delete this.loading[ee],Re||pe?(de.status="done",Re||(this.loaded[ee]=de),J(pe)):we&&we.byteLength!==0?void de.parse(we,this.layerIndex,$,(Se,Ue)=>{de.status="done",this.loaded=this.loaded||{},this.loaded[ee]=de,Se||!Ue?J(Se):J(null,Ue)}):(de.status="done",this.loaded[ee]=de,J())})}reloadTile($,J){const ee=this.loaded,de=$.uid;if(ee&&ee[de]){const pe=ee[de];pe.projection=$.projection,pe.brightness=$.brightness;const we=(Re,Se)=>{pe.reloadCallback&&(delete pe.reloadCallback,this.loadTile($,J)),J(Re,Se)};pe.status==="parsing"?pe.reloadCallback=we:pe.status==="done"&&this.loadTile($,J)}}abortTile($,J){const ee=$.uid;this.loading[ee]&&delete this.loading[ee],J()}removeTile($,J){const ee=this.loaded,de=$.uid;ee&&ee[de]&&delete ee[de],J()}}class eo{constructor($){this.self=$,this.actor=new r.ed($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:ut,geojson:Pu,"batched-model":yr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,ee)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=ee},this.self.registerRTLTextPlugin=J=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=J.applyArabicShaping,r.ee.processBidirectionalText=J.processBidirectionalText,r.ee.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches($,J,ee){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,ee()}checkIfReady($,J,ee){ee()}setReferrer($,J){this.referrer=J}spriteLoaded($,{scope:J,isLoaded:ee}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][J]=ee,this.workerSources[$]&&this.workerSources[$][J])for(const de in this.workerSources[$][J]){const pe=this.workerSources[$][J][de];for(const we in pe){const Re=pe[we];Re instanceof ut&&(Re.isSpriteLoaded=ee,Re.fire(new r.z("isSpriteLoaded")))}}}setImages($,{scope:J,images:ee},de){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][J]=ee,this.workerSources[$]&&this.workerSources[$][J]){for(const pe in this.workerSources[$][J]){const we=this.workerSources[$][J][pe];for(const Re in we)we[Re].availableImages=ee}de()}else de()}setProjection($,J){this.projections[$]=r.bP(J)}setBrightness($,J,ee){this.brightness=J,ee()}setLayers($,J,ee){this.getLayerIndex($,J.scope).replace(J.layers,J.options),ee()}updateLayers($,J,ee){this.getLayerIndex($,J.scope).update(J.layers,J.removedIds,J.options),ee()}loadTile($,J,ee){J.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,J.type,J.source,J.scope).loadTile(J,ee)}loadDEMTile($,J,ee){this.getDEMWorkerSource($,J.source,J.scope).loadTile(J,ee)}decodeRasterArray($,J,ee){this.getRasterArrayWorkerSource().decodeRasterArray(J,ee)}reloadTile($,J,ee){J.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,J.type,J.source,J.scope).reloadTile(J,ee)}abortTile($,J,ee){this.getWorkerSource($,J.type,J.source,J.scope).abortTile(J,ee)}removeTile($,J,ee){this.getWorkerSource($,J.type,J.source,J.scope).removeTile(J,ee)}removeSource($,J,ee){if(!(this.workerSources[$]&&this.workerSources[$][J.scope]&&this.workerSources[$][J.scope][J.type]&&this.workerSources[$][J.scope][J.type][J.source]))return;const de=this.workerSources[$][J.scope][J.type][J.source];delete this.workerSources[$][J.scope][J.type][J.source],de.removeSource!==void 0?de.removeSource(J,ee):ee()}loadWorkerSource($,J,ee){try{this.self.importScripts(J.url),ee()}catch(de){ee(de.toString())}}syncRTLPluginState($,J,ee){try{r.ee.setState(J);const de=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&de!=null){this.self.importScripts(de);const pe=r.ee.isParsed();ee(pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),pe)}}catch(de){ee(de.toString())}}setDracoUrl($,J){this.dracoUrl=J}getAvailableImages($,J){this.availableImages[$]||(this.availableImages[$]={});let ee=this.availableImages[$][J];return ee||(ee=[]),ee}getLayerIndex($,J){this.layerIndexes[$]||(this.layerIndexes[$]={});let ee=this.layerIndexes[$][J];return ee||(ee=this.layerIndexes[$][J]=new ce,ee.scope=J),ee}getWorkerSource($,J,ee,de){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][de]||(this.workerSources[$][de]={}),this.workerSources[$][de][J]||(this.workerSources[$][de][J]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][de][J][ee]||(this.workerSources[$][de][J][ee]=new this.workerSourceTypes[J]({send:(pe,we,Re,Se,Ue,Ne)=>{this.actor.send(pe,we,Re,$,Ue,Ne)},scheduler:this.actor.scheduler},this.getLayerIndex($,de),this.getAvailableImages($,de),this.isSpriteLoaded[$][de],void 0,this.brightness)),this.workerSources[$][de][J][ee]}rasterizeImages($,J,ee){const{imageTasks:de,scope:pe}=J,we={};for(const Re in de){const{image:Se,imageIdWithOptions:Ue}=de[Re];we[Re]=this.imageRasterizer.rasterize(Ue,Se,pe,$)}ee(void 0,we)}removeRasterizedImages($,J,ee){const{imageIds:de,scope:pe}=J;this.imageRasterizer.removeImagesFromCacheByIds(de,pe,$),ee()}getDEMWorkerSource($,J,ee){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][ee]||(this.demWorkerSources[$][ee]={}),this.demWorkerSources[$][ee][J]||(this.demWorkerSources[$][ee][J]=new Je),this.demWorkerSources[$][ee][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ht),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,J){r.ef(J)}getWorkerPerformanceMetrics($,J,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new eo(self)),eo}),L(["./shared"],function(r){var W="3.10.0";const ne={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(c){performance.mark(c)},measure(c,t,n){performance.measure(c,t,n)}};function ce(c){const t=c.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var ze,je={},Oe=function(){if(ze)return je;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,S=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(S);try{x=new Worker(C),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(C),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===_.width}()?(n[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(n[p]=function(_){var x,S=function(C){var R=document.createElement("canvas"),D=Object.create(c.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,R.getContext("webgl2",D)}(_);if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),S.getShaderParameter(x,S.COMPILE_STATUS)===!0)}(p)),n[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}ze=1,je.supported=c,je.notSupportedReason=t;var n={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},je}();function Le(c,t,n){const u=document.createElement(c);return t!=null&&(u.className=t),n&&n.appendChild(u),u}function ct(c,t,n){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return n&&n.appendChild(u),u}const st=typeof document<"u"?document.documentElement&&document.documentElement.style:null,gt=st&&st.userSelect!==void 0?"userSelect":"WebkitUserSelect";let He;function Ve(){st&&gt&&(He=st[gt],st[gt]="none")}function at(){st&&gt&&(st[gt]=He)}function Pt(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Pt,!0)}function dt(){window.addEventListener("click",Pt,!0),window.setTimeout(()=>{window.removeEventListener("click",Pt,!0)},0)}function zt(c,t){const n=c.getBoundingClientRect();return ht(c,n,t)}function ut(c,t){const n=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(ht(c,n,t[p]));return u}function Je(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function ht(c,t,n){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new r.P((n.clientX-t.left)*u,(n.clientY-t.top)*u)}const vt="01",Wt="NO_ACCESS_TOKEN";class vi{constructor(t,n,u){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let u=0;u<10;u++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!r.f(t))return t;const u=Qt(t);return u.params.push(`sdk=js-${W}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!r.f(t))return t;const u=Qt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeModelURL(t,n){if(!r.f(t))return t;const u=Qt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeSourceURL(t,n,u,p){if(!r.f(t))return t;const _=Qt(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||n)}normalizeIconsetURL(t,n){const u=Qt(t);return r.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||n)):Ti(u)}normalizeSpriteURL(t,n,u,p){const _=Qt(t);return r.f(t)?(_.path=`/styles/v1${_.path}/sprite${n}${u}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${n}${u}`,Ti(_))}normalizeTileURL(t,n,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const p=Qt(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||u&&p.authority!=="raster"&&u===512?"@2x":""}${r.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${r.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${r.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${r.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||function(x){for(const S of x){const C=S.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(p.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,n){const u=Qt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let _=u.params;return n&&(_=_.filter(x=>!x.match(/^access_token=/))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,n){const u=!!n&&r.f(n),p=[];for(const _ of t.tiles||[])r.h(_)?p.push(this.canonicalizeTileURL(_,u)):p.push(_);return p}_makeAPIURL(t,n){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=Qt(r.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Ti(t);if(n=n||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),Ti(t)}}const Ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qt(c){const t=c.match(Ft);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ti(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const hi="mapbox.eventData";function ri(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class rr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=ri(r.e.ACCESS_TOKEN);let u="";return u=n&&n.u?r.k(n.u):r.e.ACCESS_TOKEN||"",t?`${hi}.${t}:${u}`:`${hi}:${u}`}fetchEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(n);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(u);_&&(this.anonId=_)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,u,p){if(!r.e.EVENTS_URL)return;const _=Qt(r.e.EVENTS_URL);_.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},S=n?r.l(x,n):x,C={url:Ti(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=r.p(C,R=>{this.pendingRequest=null,u(R),this.saveEventData(),this.processRequests(p)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const mr=new class extends rr{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(n=>r.f(n)||r.h(n))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ri(r.e.ACCESS_TOKEN),n=t?t.u:r.e.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(p),S=(p-this.eventData.lastSuccess)/864e5;u=u||S>=1||S<-1||_.getDate()!==x.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:vt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=n)},c):this.processRequests()}},ar=mr.postTurnstileEvent.bind(mr),mi=new class extends rr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,n,u){this.skuToken=t,this.errorCb=u,r.e.EVENTS_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},n):this.errorCb(new Error(Wt)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:vt,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},nc=mi.postMapLoadEvent.bind(mi),Xo=new class extends rr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=r.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:n,style:u,importedStyles:p}=t;if(!r.e.EVENTS_URL||!c&&!r.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(n),x={mapInstanceId:_,eventId:this.getEventId(_),style:u};p.length&&(x.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:x},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},c)}},vs=Xo.postStyleLoadEvent.bind(Xo),Os=new class extends rr{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),u=function(p){const _=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),S=function(U){const Z={};if(U){for(const q in U)if(q!=="other")for(const Y of U[q]){const X=`${q}ResolveRangeMin`,te=`${q}ResolveRangeMax`,le=`${q}RequestCount`,ae=`${q}RequestCachedCount`;Z[X]=Math.min(Z[X]||1/0,Y.startTime),Z[te]=Math.max(Z[te]||-1/0,Y.responseEnd);const me=he=>{Z[he]===void 0&&(Z[he]=0),++Z[he]};Y.transferSize!==void 0&&Y.transferSize===0&&me(ae),me(le)}}return Z}(function(U,Z){const q={};if(U)for(const Y of U){const X=Z(Y);q[X]===void 0&&(q[X]=[]),q[X].push(Y)}return q}(_,ce)),C=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=R?R.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},B=(U,Z,q)=>{q!=null&&U.push({name:Z,value:q.toString()})};for(const U in S)B(k.counters,U,S[U]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(B(k.counters,"interactionRangeMin",p.interactionRange[0]),B(k.counters,"interactionRangeMax",p.interactionRange[1])),x)for(const U of Object.keys(ne)){const Z=ne[U],q=x.find(Y=>Y.name===Z);q&&B(k.counters,Z,q.startTime)}return B(k.counters,"visibilityHidden",p.visibilityHidden),B(k.attributes,"style",function(U){if(U)for(const Z of U){const q=Z.name.split("?")[0];if(r.i(q)){const Y=q.split("/").slice(-2);if(Y.length===2)return`mapbox://styles/${Y[0]}/${Y[1]}`}}}(_)),B(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),B(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),B(k.attributes,"projection",p.projection),B(k.attributes,"zoom",p.zoom),B(k.metadata,"devicePixelRatio",C),B(k.metadata,"connectionEffectiveType",D),B(k.metadata,"navigatorUserAgent",navigator.userAgent),B(k.metadata,"screenWidth",window.screen.width),B(k.metadata,"screenHeight",window.screen.height),B(k.metadata,"windowWidth",window.innerWidth),B(k.metadata,"windowHeight",window.innerHeight),B(k.metadata,"mapWidth",p.width/C),B(k.metadata,"mapHeight",p.height/C),B(k.metadata,"webglRenderer",p.renderer),B(k.metadata,"webglVendor",p.vendor),B(k.metadata,"sdkVersion",W),B(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(n);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},Zr=Os.postPerformanceEvent.bind(Os),So=new class extends rr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,n,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const p=Qt(r.e.API_URL+r.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const _={url:Ti(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(_,x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,n,u){this.skuToken=t,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},n):this.errorCb(new Error(Wt)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},Te=So.getSessionAPI.bind(So),Ks=new Set;function Js(c,t){t?Ks.add(c):Ks.delete(c)}class Be{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function ge(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class _t extends r.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new r.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,n,p);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,u){this._validate(t,u)&&(this.images[n][t]=u)}_validate(t,n){let u=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,u){u.version=this.images[n][t].version+1,this.images[n][t]=u,this.updatedImages[n][t]=!0,this.removeFromImageRasterizerCache(t,n)}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const u=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],this.removeFromImageRasterizerCache(t,n),u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,u){let p=!0;const _=!!this.loaded[n];if(!_)for(const x of t)this.images[n][x]||(p=!1);_||p?this._notify(t,n,u):this.requestors.push({ids:t,scope:n,callback:u})}rasterizeImages({scope:t,imageTasks:n},u){const p={};for(const _ in n){const x=n[_],S=this.getImage(x.id,t);S&&(p[_]={image:S,imageIdWithOptions:x})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:p,scope:t},u):this.rasterizeImagesInMainThread({imageTasks:p,scope:t},u)}rasterizeImagesInMainThread(t,n){const{imageTasks:u,scope:p}=t,_={};for(const x in u){const{image:S,imageIdWithOptions:C}=u[x];_[x]=this.imageRasterizer.rasterize(C,S,p,"")}n(void 0,_)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,u){const p={};for(const _ of t){this.images[n][_]||this.fire(new r.z("styleimagemissing",{id:_}));const x=this.images[n][_];x?p[_]={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:r.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,p)}getPixelSize(t){const{width:n,height:u}=this.atlasImage[t];return{width:n,height:u}}getPattern(t,n,u){const p=this.patterns[n][t],_=this.getImage(t,n);if(!_)return null;if(p&&p.position.version===_.version)return p.position;if(p)p.position.version=_.version;else{_.usvg&&!_.data&&(_.data=this.imageRasterizer.rasterize(r.A.from(t).getPrimary(),_,n,""));const x={w:_.data.width+2*r.B,h:_.data.height+2*r.B,x:0,y:0},S=new r.C(x,_,r.B);this.patterns[n][t]={bin:x,position:S}}return this._updatePatternAtlas(n,u),this.patterns[n][t].position}bind(t,n){const u=t.gl;let p=this.atlasTexture[n];p?this.dirty&&(p.update(this.atlasImage[n]),this.dirty=!1):(p=new r.T(t,this.atlasImage[n],u.RGBA8),this.atlasTexture[n]=p),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const u=[];for(const S in this.patterns[t])u.push(this.patterns[t][S].bin);const{w:p,h:_}=r.F(u),x=this.atlasImage[t];x.resize({width:p||1,height:_||1});for(const S in this.patterns[t]){const{bin:C,position:R}=this.patterns[t][S];let D=R.padding;const k=C.x+D,B=C.y+D,U=this.images[t][S].data,Z=U.width,q=U.height;D=D>1?D-1:D,r.r.copy(U,x,{x:0,y:0},{x:k,y:B},{width:Z,height:q},n),r.r.copy(U,x,{x:0,y:q-D},{x:k,y:B-D},{width:Z,height:D},n),r.r.copy(U,x,{x:0,y:0},{x:k,y:B+q},{width:Z,height:D},n),r.r.copy(U,x,{x:Z-D,y:0},{x:k-D,y:B},{width:D,height:q},n),r.r.copy(U,x,{x:0,y:0},{x:k+Z,y:B},{width:D,height:q},n),r.r.copy(U,x,{x:Z-D,y:q-D},{x:k-D,y:B-D},{width:D,height:D},n),r.r.copy(U,x,{x:0,y:q-D},{x:k+Z,y:B-D},{width:D,height:D},n),r.r.copy(U,x,{x:0,y:0},{x:k+Z,y:B+q},{width:D,height:D},n),r.r.copy(U,x,{x:Z-D,y:0},{x:k-D,y:B+q},{width:D,height:D},n)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const u of t){if(this.callbackDispatchedThisFrame[n][u])continue;this.callbackDispatchedThisFrame[n][u]=!0;const p=this.images[n][u];ge(p)&&this.updateImage(u,n,p)}}}function Ot(c){const t=c.key,n=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,x=c.styleSpec;let S=[];const C=r.H(n);if(C!=="object")return[new r.V(t,n,`object expected, ${C} found`)];for(const R in n){const D=R.split(".")[0];let k;p[D]?k=p[D]:u[D]?k=_i:p["*"]?k=p["*"]:u["*"]&&(k=_i),k?S=S.concat(k({key:(t&&`${t}.`)+R,value:n[R],valueSpec:u[D]||u["*"],style:_,styleSpec:x,object:n,objectKey:R},n)):S.push(new r.G(t,n[R],`unknown property "${R}"`))}for(const R in u)p[R]||u[R].required&&u[R].default===void 0&&n[R]===void 0&&S.push(new r.V(t,n,`missing required property "${R}"`));return S}function kt(c){const t=c.value,n=c.valueSpec,u=c.style,p=c.styleSpec,_=c.key,x=c.arrayElementValidator||_i;if(r.H(t)!=="array")return[new r.V(_,t,`array expected, ${r.H(t)} found`)];if(n.length&&t.length!==n.length)return[new r.V(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new r.V(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let S={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};p.$version<7&&(S.function=n.function),r.H(n.value)==="object"&&(S=n.value);let C=[];for(let R=0;R<t.length;R++)C=C.concat(x({array:t,arrayIndex:R,value:t[R],valueSpec:S,style:u,styleSpec:p,key:`${_}[${R}]`},!0));return C}function mt(c){const t=c.key,n=c.value,u=c.valueSpec;let p=r.H(n);if(p==="number"&&n!=n&&(p="NaN"),p!=="number")return[new r.V(t,n,`number expected, ${p} found`)];if("minimum"in u){let _=u.minimum;if(r.H(u.minimum)==="array"&&(_=u.minimum[c.arrayIndex]),n<_)return[new r.V(t,n,`${n} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if(r.H(u.maximum)==="array"&&(_=u.maximum[c.arrayIndex]),n>_)return[new r.V(t,n,`${n} is greater than the maximum value ${_}`)]}return[]}function Gt(c){const t=c.valueSpec,n=r.K(c.value.type);let u,p,_,x={};const S=n!=="categorical"&&c.value.property===void 0,C=!S,R=r.H(c.value.stops)==="array"&&r.H(c.value.stops[0])==="array"&&r.H(c.value.stops[0][0])==="object",D=Ot({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(U){if(n==="identity")return[new r.V(U.key,U.value,'identity function may not have a "stops" property')];let Z=[];const q=U.value;return Z=Z.concat(kt({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:k})),r.H(q)==="array"&&q.length===0&&Z.push(new r.V(U.key,q,"array must have at least one stop")),Z},default:function(U){return _i({key:U.key,value:U.value,valueSpec:t,style:U.style,styleSpec:U.styleSpec})}}});return n==="identity"&&S&&D.push(new r.V(c.key,c.value,'missing required property "property"')),n==="identity"||c.value.stops||D.push(new r.V(c.key,c.value,'missing required property "stops"')),n==="exponential"&&c.valueSpec.expression&&!r.L(c.valueSpec)&&D.push(new r.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!r.M(c.valueSpec)?D.push(new r.V(c.key,c.value,"property functions not supported")):S&&!r.N(c.valueSpec)&&D.push(new r.V(c.key,c.value,"zoom functions not supported"))),n!=="categorical"&&!R||c.value.property!==void 0||D.push(new r.V(c.key,c.value,'"property" property is required')),D;function k(U){let Z=[];const q=U.value,Y=U.key;if(r.H(q)!=="array")return[new r.V(Y,q,`array expected, ${r.H(q)} found`)];if(q.length!==2)return[new r.V(Y,q,`array length 2 expected, length ${q.length} found`)];if(R){if(r.H(q[0])!=="object")return[new r.V(Y,q,`object expected, ${r.H(q[0])} found`)];if(q[0].zoom===void 0)return[new r.V(Y,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new r.V(Y,q,"object stop key must have value")];const X=r.K(q[0].zoom);if(typeof X!="number")return[new r.V(Y,q[0].zoom,"stop zoom values must be numbers")];if(_&&_>X)return[new r.V(Y,q[0].zoom,"stop zoom values must appear in ascending order")];X!==_&&(_=X,p=void 0,x={}),Z=Z.concat(Ot({key:`${Y}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:mt,value:B}}))}else Z=Z.concat(B({key:`${Y}[0]`,value:q[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},q));return r.O(r.Q(q[1]))?Z.concat([new r.V(`${Y}[1]`,q[1],"expressions are not allowed in function stops.")]):Z.concat(_i({key:`${Y}[1]`,value:q[1],valueSpec:t,style:U.style,styleSpec:U.styleSpec}))}function B(U,Z){const q=r.H(U.value),Y=r.K(U.value),X=U.value!==null?U.value:Z;if(u){if(q!==u)return[new r.V(U.key,X,`${q} stop domain type must match previous stop domain type ${u}`)]}else u=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new r.V(U.key,X,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let te=`number expected, ${q} found`;return r.M(t)&&n===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(U.key,X,te)]}return n!=="categorical"||q!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&q==="number"&&typeof Y=="number"&&typeof p=="number"&&p!==void 0&&Y<p?[new r.V(U.key,X,"stop domain values must appear in ascending order")]:(p=Y,n==="categorical"&&Y in x?[new r.V(U.key,X,"stop domain values must be unique")]:(x[Y]=!0,[])):[new r.V(U.key,X,`integer expected, found ${String(Y)}`)]}}function $t(c){const t=(c.expressionContext==="property"?r.S:r.U)(r.Q(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new r.V(`${c.key}${u.key}`,c.value,u.message));const n=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!n.outputDefined())return[new r.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!r.W(n))return[new r.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Zt(n,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!r.X(n,["zoom","feature-state"]))return[new r.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!r.Y(n))return[new r.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zt(c,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)n.delete(p);if(n.size===0)return[];const u=[];return c instanceof r.Z&&n.has(c.name)?[new r.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...Zt(p,t))}),u)}function Ut(c){const t=c.key,n=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(r.K(n))===-1&&p.push(new r.V(t,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(r.K(n))===-1&&p.push(new r.V(t,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function bi(c){return r.$(r.Q(c.value))?$t(r.J({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Mt(c)}function Mt(c){const t=c.value,n=c.key;if(r.H(t)!=="array")return[new r.V(n,t,`array expected, ${r.H(t)} found`)];const u=c.styleSpec;let p,_=[];if(t.length<1)return[new r.V(n,t,"filter array must have at least 1 element")];switch(_=_.concat(Ut({key:`${n}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),r.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.K(t[1])==="$type"&&_.push(new r.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new r.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=r.H(t[1]),p!=="string"&&_.push(new r.V(`${n}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=r.H(t[x]),r.K(t[1])==="$type"?_=_.concat(Ut({key:`${n}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new r.V(`${n}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)_=_.concat(Mt({key:`${n}[${x}]`,value:t[x],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=r.H(t[1]),t.length!==2?_.push(new r.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new r.V(`${n}[1]`,t[1],`string expected, ${p} found`))}return _}function di(c,t){const n=c.key,u=c.style,p=c.layer,_=c.styleSpec,x=c.value,S=c.objectKey,C=_[`${t}_${c.layerType}`];if(!C)return[];const R=S.match(/^(.*)-use-theme$/);if(t==="paint"&&R&&C[R[1]])return r.O(x)?[].concat(_i({key:c.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S})):_i({key:n,value:x,valueSpec:{type:"string"},style:u,styleSpec:_});const D=S.match(/^(.*)-transition$/);if(t==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return _i({key:n,value:x,valueSpec:_.transition,style:u,styleSpec:_});const k=c.valueSpec||C[S];if(!k)return[new r.G(n,x,`unknown property "${S}"`)];let B;if(r.H(x)==="string"&&r.M(k)&&!k.tokens&&(B=/^{([^}]+)}$/.exec(x))){const Z=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new r.V(n,x,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const U=[];if(c.layerType==="symbol")S!=="text-field"||!u||u.glyphs||u.imports||U.push(new r.V(n,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&r.a0(r.Q(x))&&r.K(x.type)==="identity"&&U.push(new r.V(n,x,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&r.M(k)&&(r.a1(k)||r.N(k))){const Z=r.S(r.Q(x),k),q=Z.value.expression||Z.value._styleExpression.expression;q&&!r.X(q,["measure-light"])&&(S==="model-emissive-strength"&&r.Y(q)&&r.W(q)||U.push(new r.V(n,x,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(_i({key:c.key,value:x,valueSpec:k,style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S}))}function wi(c){return di(c,"paint")}function Gi(c){return di(c,"layout")}function qi(c){let t=[];const n=c.value,u=c.key,p=c.style,_=c.styleSpec;n.type||n.ref||t.push(new r.V(u,n,'either "type" or "ref" is required'));let x=r.K(n.type);const S=r.K(n.ref);if(n.id){const C=r.K(n.id);for(let R=0;R<c.arrayIndex;R++){const D=p.layers[R];r.K(D.id)===C&&t.push(new r.V(u,n.id,`duplicate layer id "${n.id}", previously used at line ${D.id.__line__}`))}}if("ref"in n){let C;["type","source","source-layer","filter","layout"].forEach(R=>{R in n&&t.push(new r.V(u,n[R],`"${R}" is prohibited for ref layers`))}),p.layers.forEach(R=>{r.K(R.id)===S&&(C=R)}),C?C.ref?t.push(new r.V(u,n.ref,"ref cannot reference another ref layer")):x=r.K(C.type):typeof S=="string"&&t.push(new r.V(u,n.ref,`ref layer "${S}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(n.source){const C=p.sources&&p.sources[n.source],R=C&&r.K(C.type);C?R==="vector"&&x==="raster"?t.push(new r.V(u,n.source,`layer "${n.id}" requires a raster source`)):R==="raster"&&x!=="raster"?t.push(new r.V(u,n.source,`layer "${n.id}" requires a vector source`)):R!=="vector"||n["source-layer"]?R==="raster-dem"&&x!=="hillshade"?t.push(new r.V(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||R==="geojson"&&C.lineMetrics?x==="raster-particle"&&R!=="raster-array"&&t.push(new r.V(u,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new r.V(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new r.V(u,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(u,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new r.V(u,n.source,`source "${n.source}" not found`))}else t.push(new r.V(u,n,'missing required property "source"'));return t=t.concat(Ot({key:u,value:n,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_i({key:`${u}.type`,value:n.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:n,objectKey:"type"}),filter:C=>bi(r.J({layerType:x},C)),layout:C=>Ot({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>Gi(r.J({layerType:x},R))}}),paint:C=>Ot({layer:n,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>wi(r.J({layerType:x,layer:n},R))}})}})),t}function tn(c){const t=c.value,n=c.key,u=r.H(t);return u!=="string"?[new r.V(n,t,`string expected, ${u} found`)]:[]}const Qn={promoteId:function c({key:t,value:n}){if(r.H(n)==="string")return tn({key:t,value:n});if(Array.isArray(n)){const u=[],p=r.Q(n),_=r.U(p);return _.result==="error"&&_.value.forEach(x=>{u.push(new r.V(`${t}${x.key}`,null,`${x.message}`))}),r.X(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in n)u.push(...c({key:`${t}.${p}`,value:n[p]}));return u}}};function Un(c){const t=c.value,n=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new r.V(n,t,'"type" is required')];const _=r.K(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||x.push(new r.G(n,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Ot({key:n,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:Qn})),x;case"geojson":if(x=Ot({key:n,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Qn}),t.cluster)for(const S in t.clusterProperties){const[C,R]=t.clusterProperties[S],D=typeof C=="string"?[C,["accumulated"],["get",S]]:C;x.push(...$t({key:`${n}.${S}.map`,value:R,expressionContext:"cluster-map"})),x.push(...$t({key:`${n}.${S}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return x;case"video":return Ot({key:n,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Ot({key:n,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new r.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ut({key:`${n}.type`,value:t.type,valueSpec:{values:_r(u)},style:p,styleSpec:u})}}function _r(c){return c.source.reduce((t,n)=>{const u=c[n];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function xn(c){const t=c.value,n=c.styleSpec,u=n.light,p=c.style;let _=[];const x=r.H(t);if(t===void 0)return _;if(x!=="object")return _=_.concat([new r.V("light",t,`object expected, ${x} found`)]),_;for(const S in t){const C=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);_=_.concat(R&&u[R[1]]?_i({key:S,value:t[S],valueSpec:{type:"string"},style:p,styleSpec:n}):C&&u[C[1]]&&u[C[1]].transition?_i({key:S,value:t[S],valueSpec:n.transition,style:p,styleSpec:n}):u[S]?_i({key:S,value:t[S],valueSpec:u[S],style:p,styleSpec:n}):[new r.V(S,t[S],`unknown property "${S}"`)])}return _}function bs(c){const t=c.value;let n=[];if(!t)return n;const u=r.H(t);if(u!=="object")return n=n.concat([new r.V("light-3d",t,`object expected, ${u} found`)]),n;const p=c.styleSpec,_=p["light-3d"],x=c.key,S=c.style,C=c.style.lights;for(const k of["type","id"])if(!(k in t))return n=n.concat([new r.V("light-3d",t,`missing property ${k} on light`)]),n;if(t.type&&C)for(let k=0;k<c.arrayIndex;k++){const B=r.K(t.type),U=C[k];r.K(U.type)===B&&n.push(new r.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${U.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in p))return n=n.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const D=p[R];for(const k in t)if(k==="properties"){const B=t[k],U=r.H(B);if(U!=="object")return n=n.concat([new r.V("properties",B,`object expected, ${U} found`)]),n;for(const Z in B)n=n.concat(D[Z]?_i({key:Z,value:B[Z],valueSpec:D[Z],style:S,styleSpec:p}):[new r.G(c.key,B[Z],`unknown property "${Z}"`)])}else{const B=k.match(/^(.*)-transition$/),U=k.match(/^(.*)-use-theme$/);n=n.concat(U&&_[U[1]]?_i({key:k,value:t[k],valueSpec:{type:"string"},style:S,styleSpec:p}):B&&_[B[1]]&&_[B[1]].transition?_i({key:k,value:t[k],valueSpec:p.transition,style:S,styleSpec:p}):_[k]?_i({key:k,value:t[k],valueSpec:_[k],style:S,styleSpec:p}):[new r.G(k,t[k],`unknown property "${k}"`)])}return n}function Eo(c){const t=c.value,n=c.key,u=c.style,p=c.styleSpec,_=p.terrain;let x=[];const S=r.H(t);if(t===void 0||S==="null")return x;if(S!=="object")return x=x.concat([new r.V("terrain",t,`object expected, ${S} found`)]),x;for(const C in t){const R=C.match(/^(.*)-transition$/),D=C.match(/^(.*)-use-theme$/);x=x.concat(D&&_[D[1]]?_i({key:C,value:t[C],valueSpec:{type:"string"},style:u,styleSpec:p}):R&&_[R[1]]&&_[R[1]].transition?_i({key:C,value:t[C],valueSpec:p.transition,style:u,styleSpec:p}):_[C]?_i({key:C,value:t[C],valueSpec:_[C],style:u,styleSpec:p}):[new r.G(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=u.sources&&u.sources[t.source],R=C&&r.K(C.type);C?R!=="raster-dem"&&x.push(new r.V(n,t.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):x.push(new r.V(n,t.source,`source "${t.source}" not found`))}else x.push(new r.V(n,t,'terrain is missing required property "source"'));return x}function Mn(c){const t=c.value,n=c.style,u=c.styleSpec,p=u.fog;let _=[];const x=r.H(t);if(t===void 0)return _;if(x!=="object")return _=_.concat([new r.V("fog",t,`object expected, ${x} found`)]),_;for(const S in t){const C=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);_=_.concat(R&&p[R[1]]?_i({key:S,value:t[S],valueSpec:{type:"string"},style:n,styleSpec:u}):C&&p[C[1]]&&p[C[1]].transition?_i({key:S,value:t[S],valueSpec:u.transition,style:n,styleSpec:u}):p[S]?_i({key:S,value:t[S],valueSpec:p[S],style:n,styleSpec:u}):[new r.G(S,t[S],`unknown property "${S}"`)])}return _}const gr={"*":()=>[],array:kt,boolean:function(c){const t=c.value,n=c.key,u=r.H(t);return u!=="boolean"?[new r.V(n,t,`boolean expected, ${u} found`)]:[]},number:mt,color:function(c){const t=c.key,n=c.value,u=r.H(n);return u!=="string"?[new r.V(t,n,`color expected, ${u} found`)]:r._.parseCSSColor(n)===null?[new r.V(t,n,`color expected, "${n}" found`)]:[]},enum:Ut,filter:bi,function:Gt,layer:qi,object:Ot,source:Un,model:r.a2,light:xn,"light-3d":bs,terrain:Eo,fog:Mn,string:tn,formatted:function(c){return tn(c).length===0?[]:$t(c)},resolvedImage:function(c){return tn(c).length===0?[]:$t(c)},projection:function(c){const t=c.value,n=c.styleSpec,u=n.projection,p=c.style;let _=[];const x=r.H(t);if(x==="object")for(const S in t)_=_.concat(_i({key:S,value:t[S],valueSpec:u[S],style:p,styleSpec:n}));else x!=="string"&&(_=_.concat([new r.V("projection",t,`object or string expected, ${x} found`)]));return _},import:function(c){const{value:t,styleSpec:n}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let _=Ot(r.J({},c,{value:p,valueSpec:n.import}));return r.K(p.id)===""&&_.push(new r.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(_=_.concat(Mu(u,n,{key:`${c.key}.data`}))),_}};function _i(c,t=!1){const n=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&r.a0(r.K(n)))return Gt(c);if(u.expression&&r.O(r.Q(n)))return $t(c);if(u.type&&gr[u.type]){const _=gr[u.type](c);return t===!0&&_.length>0&&r.H(c.value)==="array"?$t(c):_}return Ot(r.J({},c,{valueSpec:u.type?p[u.type]:u}))}function Qs(c){const t=c.value,n=c.key,u=tn(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new r.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new r.V(n,t,'"glyphs" url must include a "{range}" token'))),u}function Mu(c,t=r.a3,n={}){return _i({key:n.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:Qs,"*":()=>[]}})}function Wr(c,t=r.a3){return yr(Mu(c,t))}const Mo=c=>yr(Un(c)),el=c=>yr(xn(c)),tl=c=>yr(bs(c)),il=c=>yr(Eo(c)),Au=c=>yr(Mn(c)),nl=c=>yr(function(t){const n=t.value,u=t.style,p=t.styleSpec,_=p.snow;let x=[];const S=r.H(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new r.V("snow",n,`object expected, ${S} found`)]),x;for(const C in n){const R=C.match(/^(.*)-transition$/);x=x.concat(R&&_[R[1]]&&_[R[1]].transition?_i({key:C,value:n[C],valueSpec:p.transition,style:u,styleSpec:p}):_[C]?_i({key:C,value:n[C],valueSpec:_[C],style:u,styleSpec:p}):[new r.G(C,n[C],`unknown property "${C}"`)])}return x}(c)),Iu=c=>yr(function(t){const n=t.value,u=t.style,p=t.styleSpec,_=p.rain;let x=[];const S=r.H(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new r.V("rain",n,`object expected, ${S} found`)]),x;for(const C in n){const R=C.match(/^(.*)-transition$/);x=x.concat(R&&_[R[1]]&&_[R[1]].transition?_i({key:C,value:n[C],valueSpec:p.transition,style:u,styleSpec:p}):_[C]?_i({key:C,value:n[C],valueSpec:_[C],style:u,styleSpec:p}):[new r.G(C,n[C],`unknown property "${C}"`)])}return x}(c)),Cu=c=>yr(qi(c)),Wn=c=>yr(bi(c)),rc=c=>yr(wi(c)),Pu=c=>yr(Gi(c)),sc=c=>yr(r.a2(c));function yr(c){return c.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function eo(c,t){let n=!1;if(t&&t.length)for(const u of t)u instanceof r.G?r.w(u.message):(c.fire(new r.y(new Error(u.message))),n=!0);return n}let qe;class $ extends r.E{constructor(t,n="flat"){super(),this._transitionable=new r.a4(qe||(qe=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,u={}){this._validate(el,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&eo(this,t.call(Wr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let J=class extends r.E{constructor(c,t,n,u){super(),this.scope=n,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),n,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new r.a8(c)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let n=-1,u=-1,p=1;for(const _ of t.zoomStops)p=t.evaluate(new r.a8(_)),p>.01?(n=_,u=-1):u=_;return p<.01&&n>0&&u>n?[n,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof r.a9}};const ee=45,de=65,pe=.05;function we(c,t,n,u){const p=r.ac(ee,de,n),[_,x]=Re(c,u);let S=1-Math.min(1,Math.exp((t-_)/(x-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*p*c.alpha}function Re(c,t){const n=.5/Math.tan(.5*t);return[c.range[0]+n,c.range[1]+n]}function Se(c,t,n,u,p){const _=r.ab.vec3.transformMat4([],[t,n,u],p.mercatorFogMatrix);return we(c,r.ab.vec3.length(_),p.pitch,p._fov)}function Ue(c,t,n,u,p,_,x){const S=[[n,u,0],[p,u,0],[p,_,0],[n,_,0]];let C=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const D of S){const k=r.ab.vec3.transformMat4([],D,t),B=r.ab.vec3.length(k);C=Math.min(C,B),R=Math.max(R,B)}return[we(c,C,x.pitch,x._fov),we(c,R,x.pitch,x._fov)]}class Ne extends r.E{constructor(t,n,u,p){super();const _=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(_,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new r.ad(_),this.scope=u}get state(){const t=this._transform,n=t.projection.name==="globe",u=r.ae(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:n?[r.af(_[0],p[0],u),r.af(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,u={}){if(this._validate(Au,t,u))return;const p=r.l({},t);for(const _ of Object.keys(r.a3.fog))p[_]===void 0&&(p[_]=r.a3.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(ee,de,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(u,p,_){const x=r.aa.fromLngLat(p),S=_.elevation?_.elevation.getAtPointOrZero(x):0;return Se(u,x.x,x.y,S,_)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ue(this.state,n,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(t,n,u,p,_){return this._transform.projection.supportsFog?Ue(this.state,t,n,u,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Re(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const u of n){const p=t.points[u];let _;if(p[2]>=0)_=p;else{const x=t.points[u-4];_=r.ah(x,p,x[2]/(x[2]-p[2]))}if(Se(this.state,_[0],_[1],0,this._transform)>=pe)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&eo(this,t.call(Wr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let Ge,it,Tt,St,Yt=class extends r.E{constructor(c,t,n,u){super();const p=Ge||(Ge=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(p,n,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(p),this.scope=n}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=r.ai(n[0]),p=-Math.max(r.ai(n[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(c,t,n={}){if(this._validate(nl,c,n))return;const u=r.l({},c);for(const p of Object.keys(r.a3.snow))u[p]===void 0&&(u[p]=r.a3.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,n){return(!n||n.validate!==!1)&&eo(this,c.call(Wr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},ti=class extends r.E{constructor(c,t,n,u){super();const p=it||(it=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(p,n,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(p),this.scope=n}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=r.ai(n[0]),p=-Math.max(r.ai(n[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(c,t,n={}){if(this._validate(Iu,c,n))return;const u=r.l({},c);for(const p of Object.keys(r.a3.rain))u[p]===void 0&&(u[p]=r.a3.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,n){return(!n||n.validate!==!1)&&eo(this,c.call(Wr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class ii extends r.E{constructor(t,n,u,p){super(),this.scope=u,this._options=t,this.properties=new r.ad(n),this._transitionable=new r.a4(n,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ei{constructor(t,n,u,p){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,n){let u,p;if(t instanceof r.P||typeof t[0]=="number"){const _=r.P.convert(t);u=[_],p=n.isPointAboveHorizon(_)}else{const _=r.P.convert(t[0]),x=r.P.convert(t[1]);u=[_,x],p=r.al(_,x).every(S=>n.isPointAboveHorizon(S))}return new ei(u,n.getCameraPoint(),p,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.al(n,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(p[3]=this.cameraPoint)),r.am(p,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.al(n,u,t),_=this.cameraPoint.clone();switch(3*((_.y>n.y)+(_.y>u.y))+((_.x>n.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,n,u,p=0){const _=t.queryPadding/n._pixelsPerMercatorPixel+1,x=u?this._bufferedCameraMercator(_,n):this._bufferedScreenMercator(_,n);let S=t.tileID.wrap+(x.unwrapped?p:0);const C=x.polygon.map(Y=>r.an(t.tileTransform,Y,S));if(!r.ao(C,0,0,r.ag,r.ag))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const R=this.screenGeometryMercator.polygon.map(Y=>r.ap(t.tileTransform,Y,S)),D=R.map(Y=>new r.P(Y[0],Y[1])),k=n.getFreeCameraOptions().position||new r.aa(0,0,0),B=r.ap(t.tileTransform,k,S),U=R.map(Y=>{const X=r.ab.vec3.sub(Y,Y,B);return r.ab.vec3.normalize(X,X),new r.aq(B,X)}),Z=r.ar(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:U,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(q=r.as(C),q.min.x=r.aw(q.min.x,0,r.ag),q.min.y=r.aw(q.min.y,0,r.ag),q.max.x=r.aw(q.max.x,0,r.ag),q.max.y=r.aw(q.max.y,0,r.ag),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var q}_bufferedScreenMercator(t,n){const u=Si(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(_=>n.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,n){const u=Si(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(_=>n.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,n){const u=function(_,x){const S=r.ab.mat4.multiply([],x.pixelMatrix,x.globeMatrix),C=[0,-r.ax,0,1],R=[0,r.ax,0,1],D=[0,0,0,1];r.ab.vec4.transformMat4(C,C,S),r.ab.vec4.transformMat4(R,R,S),r.ab.vec4.transformMat4(D,D,S);const k=new r.P(C[0]/C[3],C[1]/C[3]),B=new r.P(R[0]/R[3],R[1]/R[3]),U=r.au(_,k)&&C[3]<D[3],Z=r.au(_,B)&&R[3]<D[3];if(!U&&!Z)return null;const q=function(fe,ue,xe){for(let Me=1;Me<fe.length;Me++){const $e=Oi(ue.pointCoordinate3D(fe[Me-1]).x),ke=Oi(ue.pointCoordinate3D(fe[Me]).x);if(xe<0){if($e<ke)return{idx:Me,t:-$e/(ke-1-$e)}}else if(ke<$e)return{idx:Me,t:(1-$e)/(ke+1-$e)}}return null}(_,x,U?-1:1);if(!q)return null;const{idx:Y,t:X}=q;let te=Y>1?Pi(_.slice(0,Y),x):[],le=Y<_.length?Pi(_.slice(Y),x):[];te=te.map(fe=>new r.P(Oi(fe.x),fe.y)),le=le.map(fe=>new r.P(Oi(fe.x),fe.y));const ae=[...te];ae.length===0&&ae.push(le[le.length-1]);const me=r.af(ae[ae.length-1].y,(le.length===0?te[0]:le[0]).y,X);let he;return he=U?[new r.P(0,me),new r.P(0,0),new r.P(1,0),new r.P(1,me)]:[new r.P(1,me),new r.P(1,1),new r.P(0,1),new r.P(0,me)],ae.push(...he),le.length===0?ae.push(te[0]):ae.push(...le),{polygon:ae.map(fe=>new r.aa(fe.x,fe.y)),unwrapped:!1}}(t,n);if(u)return u;const p=function(_,x){let S=!1,C=-1/0,R=0;for(let k=0;k<_.length-1;k++)_[k].x>C&&(C=_[k].x,R=k);for(let k=0;k<_.length-1;k++){const B=(R+k)%(_.length-1),U=_[B],Z=_[B+1];Math.abs(U.x-Z.x)>.5&&(U.x<Z.x?(U.x+=1,B===0&&(_[_.length-1].x+=1)):(Z.x+=1,B+1===_.length-1&&(_[0].x+=1)),S=!0)}const D=r.at(x.center.lng);return S&&D<Math.abs(D-1)&&_.forEach(k=>{k.x-=1}),{polygon:_,unwrapped:S}}(Pi(t,n).map(_=>new r.P(Oi(_.x),_.y)),n);return{polygon:p.polygon.map(_=>new r.aa(_.x,_.y)),unwrapped:p.unwrapped}}}function Pi(c,t){return r.av(c,n=>{const u=t.pointCoordinate3D(n);n.x=u.x,n.y=u.y},1/256)}function Oi(c){return c<0?1+c%1:c%1}function Si(c){return 100*c|0}function Bi(c,t,n,u,p){const _=function(S,C){if(S)return p(S);if(C){if(c.url&&C.tiles&&c.tiles&&delete c.tiles,C.variants){if(!Array.isArray(C.variants))return p(new Error("variants must be an array"));for(const D of C.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return p(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){C=r.l(C,D);break}}}const R=r.ay(r.l({},C,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=t.canonicalizeTileset(R,c.url),p(null,R)}},x=function(S,C,R){if(!S)return null;if(!C&&!R)return S;R=R||S.worldview_default;const D=Object.values(S.language||{});if(D.length===0)return null;const k=Object.values(S.worldview||{});if(k.length===0)return null;const B=D.every(Z=>Z===C),U=k.every(Z=>Z===R);return B&&U?S:C in(S.language_options||{})||R in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(c.data,n,u);return x?r.q.frame(()=>_(null,x)):c.url?r.n(t.transformRequest(t.normalizeSourceURL(c.url,null,n,u),r.R.Source),_):r.q.frame(()=>{const{data:S,...C}=c;_(null,C)})}class Ui{constructor(t,n,u){this.bounds=r.az.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(r.at(this.bounds.getWest())*n),p=Math.floor(r.aA(this.bounds.getNorth())*n),_=Math.ceil(r.at(this.bounds.getEast())*n),x=Math.ceil(r.aA(this.bounds.getSouth())*n);return t.x>=u&&t.x<_&&t.y>=p&&t.y<x}}class Fn extends r.E{constructor(t,n,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(n,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new r.aB}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,n,u,(p,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.y(p));else if(_){if(r.l(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of _.vector_layers)this.vectorLayerIds.push(x.id),_.worldview&&_.worldview[x.source]&&this.localizableLayerIds.add(x.id)}_.bounds&&(this.tileBounds=new Ui(_.bounds,this.minzoom,this.maxzoom)),ar(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),_=this.map._requestManager.transformRequest(p,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,S=x?{image:x.image.clone()}:null,C={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(u)&&(C.worldview=this.map.getWorldview()||this.worldviewDefault,C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",C,R.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,R.bind(this),void 0,!0);else{const D=r.aD.call({deduped:this._deduped},C,(k,B)=>{k||!B?R.call(this,k):(C.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",C,R.bind(this),void 0,!0))},!0);t.request={cancel:D}}function R(D,k){return delete t.request,t.aborted?n(null):D&&D.status!==404?n(D):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),r.aE(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class to extends r.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},n),r.l(this,r.ay(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Bi(this._options,this.map._requestManager,null,null,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new r.y(n)):u&&(r.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),u.bounds&&(this.tileBounds=new Ui(u.bounds,this.minzoom,this.maxzoom)),ar(u.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=r.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(p,r.R.Tile),(_,x,S,C)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):_?(t.state="errored",n(_)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:C}),t.setTexture(x,this.map.painter),t.state="loaded",r.aE(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xn extends to{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);n&&n.enabled&&u&&n._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,r.R.Tile);t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(_,x,S,C)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(_)return _.code===20?void 0:(t.state="errored",n(_));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:C}),t.state="empty",n(null)})}unloadTile(t,n){const u=t.texture;u&&u instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,u,(p,_)=>{if(p)return t.state="errored",this.fire(new r.y(p)),void this.triggerRepaint(t);_&&(t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:_})=>_===t),u=n&&n.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,n,u){if(!t)return;const p=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;n instanceof r.aH?_=n.paint.get("raster-array-band"):n instanceof r.aI&&(_=n.paint.get("raster-particle-array-band"));const x=_||this.getInitialBand(p);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,x)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,x)}}const er={vector:Fn,raster:to,"raster-dem":class extends to{constructor(c,t,n,u){super(c,t,n,u),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const n=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(c.state="errored",t(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=r.o(this.map._requestManager.transformRequest(n,r.R.Tile),(function(p,_,x,S){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:x,expires:S});const C=ImageBitmap&&_ instanceof ImageBitmap&&r.t(),R=1-(_.width-r.aF(_.width))/2;R<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const D=C?_:r.q.getImageData(_,R),k={uid:c.uid,coord:c.tileID,source:this.id,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:R};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",k,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,n=Math.pow(2,t.z),u=(t.x-1+n)%n,p=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+n)%n,x=t.x+1===n?c.wrap+1:c.wrap,S={};return S[new r.aG(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},S[new r.aG(c.overscaledZ,x,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(S[new r.aG(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},S[new r.aG(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new r.aG(c.overscaledZ,x,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<n&&(S[new r.aG(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},S[new r.aG(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new r.aG(c.overscaledZ,x,t.z,_,t.y+1).key]={backfilled:!1}),S}},"raster-array":Xn,geojson:class extends r.E{constructor(c,t,n,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(u),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of c.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,n,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:n},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:c},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(n),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.y(u));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new r.z("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=r.aC(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const n=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,_=this._partialReload,x={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:_};c.request=this.actor.send(n,x,(S,C)=>_&&!C?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):S?t(S):(c.loadVectorData(C,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(c,t,n,u){super(c,t,n,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aK(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new r.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(c,t,n,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const n=this._options.models[t],u=r.aM(this.map._requestManager.transformRequest(n.uri,r.R.Model).url).then(p=>{if(!p)return;const _=r.aN(p),x=new r.aO(t,n.position,n.orientation,_);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(p=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${n.uri}: ${p.message}`)))});c.push(u)}return Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(c,t,n,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,t,n,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new r.y(u))):p&&(r.l(this,p),p.bounds&&(this.tileBounds=new Ui(p.bounds,this.minzoom,this.maxzoom)),ar(p.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const n=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(n,r.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const _=Object.values(c.buckets);for(const x of _)x.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(_,x){return c.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&x&&c.setExpiryData(x),c.loadModelData(x,this.map.painter),c.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(c,t,n,u){super(c,t,n,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new r.y(new r.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends r.E{constructor(c,t,n,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ui(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:n,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:n,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:n,y:u,z:p}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:n,y:u,z:p},{signal:_.signal})).then((function(x){return delete c.request,c.aborted?(c.state="unloaded",t(null)):x===void 0?(c.state="errored",t(null)):x===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(x)?(this.loadTileData(c,x),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(c.state="errored",t(x))}),c.request.cancel=()=>_.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof r.T?(c.destroy(!0),c.texture&&c.texture instanceof r.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:n,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:n,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=r.aC(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Fr=function(c,t,n,u){const p=new er[t.type](c,t,n,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return r.aP(["load","abort","unload","serialize","prepare"],p),p};function oc(c,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:_}=u;return`featureset:${p}${_?`:import:${_}`:""}`}}(c.target)}`}function Ao(c,t,n,u=""){if(c.uniqueFeatureID){const p=oc(c,t,u);if(n.has(p))return!0;n.add(p)}return!1}function ac(c,t,n,u,p=!1){const _=t.sourceCache.transform,x=t.sourceCache.tilesIn(c,t.has3DLayers,p);x.sort(dd);const S=[];for(const C of x){const R=C.tile.queryRenderedFeatures(t,C,n,u,_,p);Object.keys(R).length&&S.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:R})}return S.length===0?{}:function(C){const R={},D={};for(const k of C){const B=k.queryResults,U=k.wrappedTileID,Z=D[U]=D[U]||{};for(const q in B){const Y=B[q],X=Z[q]=Z[q]||{},te=R[q]=R[q]||[];for(const le of Y)X[le.featureIndex]||(X[le.featureIndex]=!0,te.push(le))}}return R}(S)}function hd(c,t,n,u,p){const _={},x=u.queryRenderedSymbols(c),S=[];for(const C of Object.keys(x).map(Number))S.push(p[C]);S.sort(dd);for(const C of S){const R=C.featureIndex.lookupSymbolFeatures(x[C.bucketInstanceId],C.bucketIndex,C.sourceLayerIndex,t,n);for(const D in R){const k=_[D]=_[D]||[],B=R[D];B.sort((U,Z)=>{const q=C.featureSortOrder;if(q){const Y=q.indexOf(U.featureIndex);return q.indexOf(Z.featureIndex)-Y}return Z.featureIndex-U.featureIndex});for(const U of B)k.push(U)}}return _}function tm(c,t){const n=c.getRenderableIds().map(_=>c.getTileByID(_)),u=[],p={};for(let _=0;_<n.length;_++){const x=n[_],S=x.tileID.canonical.key;p[S]||(p[S]=!0,x.querySourceFeatures(u,t))}return u}function dd(c,t){const n=c.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function fd(c,t){const n={};if(!t)return n;for(const u of c){const p=u.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(_=>p.filter(x=>x.id===_)[0]));for(const _ of p)n[_.fqid]=u}}return n}const Br=32,ks=33,Io=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,n=0,u=0,p=0,_=0,x=0,S=0;for(1&t?p=_=x=Br:n=u=S=Br;(t>>=1)>1;){const R=n+p>>1,D=u+_>>1;1&t?(p=n,_=u,n=x,u=S):(n=p,u=_,p=x,_=S),x=R,S=D}const C=4*c;Io[C+0]=n,Io[C+1]=u,Io[C+2]=p,Io[C+3]=_}const io=new Uint16Array(2178),Fs=new Uint8Array(1089),no=new Uint16Array(1089);function Ru(c){return c===0?-.03125:c===32?.03125:0}const pd=(()=>({type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]}))();class Yo{constructor(t,n,u,p,_){this.tileID=t,this.uid=r.aV(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<r.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=fd(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof r.aX){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof r.aX&&_.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],x=n.style.getOwnLayer(p);if(!x)continue;const S=x.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,fd(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const n=t.gl,u=this.imageAtlas;if(u&&!u.uploaded){const p=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new r.T(t,u.image,n.RGBA8,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=n.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,n,u,p,_,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=function(C,R){const D=r.ab.mat4.fromScaling([],[.5*C.width,.5*-C.height,1]);return r.ab.mat4.translate(D,D,[1,-1,0]),r.ab.mat4.multiply(D,D,C.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(D)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:S,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=n?n.sourceLayer:"",x=p._geojsonTileLayer||p[_];if(!x)return;const S=r.aZ(n&&n.filter),{z:C,x:R,y:D}=this.tileID.canonical,k={z:C,x:R,y:D};for(let B=0;B<x.length;B++){const U=x.feature(B);if(S.needGeometry){const Y=r.a_(U,!0);if(!S.filter(new r.a8(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!S.filter(new r.a8(this.tileID.overscaledZ),U))continue;const Z=u.getId(U,_),q=new r.a$(U,C,R,D,Z);q.tile=k,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=r.b0(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const _=this.expirationTime-n;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),_=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const S=this.buckets[x],C=S.layers[0],R=C.sourceLayer||"_geojsonTileLayer",D=u[R],k=t.style.getLayerSourceCache(C);let B={};k&&(B=k._state.getState(R,void 0));const U=this.imageAtlas&&this.imageAtlas.patternPositions||{},Z=Object.keys(B).length>0&&!n;Z&&!S.stateDependentLayers.length&&!n||S.update(B,D,p,U,Z?S.stateDependentLayers:S.layers,n,_),(S instanceof r.b1||S instanceof r.b2)&&t._terrain&&t._terrain.enabled&&k&&S.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);const q=t&&t.style&&t.style.getOwnLayer(x);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const _ of n)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const u=r.b3(pd,this.tileID.canonical,this.tileTransform)[0],p=new r.b4,_=new r.b5;for(let x=0;x<u.length;x++){const{x:S,y:C}=u[x];p.emplaceBack(S,C),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const u=r.b3(pd,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const x=function(S,C){const R=r.aQ(S,C),D=Math.pow(2,S.z);for(let Y=0;Y<ks;Y++)for(let X=0;X<ks;X++){const te=r.aR((S.x+(X+Ru(X))/Br)/D),le=r.aS((S.y+(Y+Ru(Y))/Br)/D),ae=C.project(te,le),me=Y*ks+X;io[2*me+0]=Math.round((ae.x*R.scale-R.x)*r.ag),io[2*me+1]=Math.round((ae.y*R.scale-R.y)*r.ag)}Fs.fill(0),no.fill(0);for(let Y=2045;Y>=0;Y--){const X=4*Y,te=Io[X+0],le=Io[X+1],ae=Io[X+2],me=Io[X+3],he=te+ae>>1,fe=le+me>>1,ue=he+fe-le,xe=fe+te-he,Me=le*ks+te,$e=me*ks+ae,ke=fe*ks+he,Qe=Math.hypot((io[2*Me+0]+io[2*$e+0])/2-io[2*ke+0],(io[2*Me+1]+io[2*$e+1])/2-io[2*ke+1])>=16;Fs[ke]=Fs[ke]||(Qe?1:0),Y<1022&&(Fs[ke]=Fs[ke]||Fs[(le+xe>>1)*ks+(te+ue>>1)]||Fs[(me+xe>>1)*ks+(ae+ue>>1)])}const k=new r.aT,B=new r.aU;let U=0;function Z(Y,X){const te=X*ks+Y;return no[te]===0&&(k.emplaceBack(io[2*te+0],io[2*te+1],Y*r.ag/Br,X*r.ag/Br),no[te]=++U),no[te]-1}function q(Y,X,te,le,ae,me){const he=Y+te>>1,fe=X+le>>1;if(Math.abs(Y-ae)+Math.abs(X-me)>1&&Fs[fe*ks+he])q(ae,me,Y,X,he,fe),q(te,le,ae,me,he,fe);else{const ue=Z(Y,X),xe=Z(te,le),Me=Z(ae,me);B.emplaceBack(ue,xe,Me)}}return q(0,0,Br,Br,Br,0),q(Br,Br,0,0,0,Br),{vertices:k,indices:B}}(this.tileID.canonical,n);p=x.vertices,_=x.indices}else{p=new r.aT,_=new r.aU;for(const{x:S,y:C}of u)p.emplaceBack(S,C,0,0);const x=r.b8(p.int16,void 0,4);for(let S=0;S<x.length;S+=3)_.emplaceBack(x[S],x[S+1],x[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,r.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=r.b7.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,n){const u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;const p=this.tileID.canonical,_=r.ba(p,n),x=r.bb(_),S=r.ae(n.zoom);let C;S>0&&(C=r.ab.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,n,x,C,S),this._makeGlobeTileDebugTextBuffer(t,p,n,x,C,S)}_globePoint(t,n,u,p,_,x,S){let C=r.bc(t,n,u);if(x){const R=1<<u.z,D=r.at(p.center.lng),k=r.aA(p.center.lat),B=(u.x+.5)/R-D;let U=0;B>.5?U=-1:B<-.5&&(U=1);let Z=(t/r.ag+u.x)/R+U,q=(n/r.ag+u.y)/R;Z=(Z-D)*p._pixelsPerMercatorPixel+D,q=(q-k)*p._pixelsPerMercatorPixel+k;const Y=[Z*p.worldSize,q*p.worldSize,0];r.ab.vec3.transformMat4(Y,Y,x),C=r.bd(C,Y,S)}return r.ab.vec3.transformMat4(C,C,_)}_makeGlobeTileDebugBorderBuffer(t,n,u,p,_,x){const S=new r.b4,C=new r.b5,R=new r.be,D=(B,U,Z,q,Y)=>{const X=(Z-B)/(Y-1),te=(q-U)/(Y-1),le=S.length;for(let ae=0;ae<Y;ae++){const me=B+ae*X,he=U+ae*te;S.emplaceBack(me,he);const fe=this._globePoint(me,he,n,u,p,_,x);R.emplaceBack(fe[0],fe[1],fe[2]),C.emplaceBack(le+ae)}},k=r.ag;D(0,0,k,0,16),D(k,0,k,k,16),D(k,k,0,k,16),D(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(S,r.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,S.length,C.length)}_makeGlobeTileDebugTextBuffer(t,n,u,p,_,x){const S=r.ag/4,C=new r.b4,R=new r.aU,D=new r.be,k=25;R.reserve(32),C.reserve(k),D.reserve(k);const B=(U,Z)=>k*U+Z;for(let U=0;U<k;U++){const Z=U*S;for(let q=0;q<k;q++){const Y=q*S;C.emplaceBack(Y,Z);const X=this._globePoint(Y,Z,n,u,p,_,x);D.emplaceBack(X[0],X[1],X[2])}}for(let U=0;U<4;U++)for(let Z=0;Z<4;Z++){const q=B(U,Z),Y=B(U,Z+1),X=B(U+1,Z),te=B(U+1,Z+1);R.emplaceBack(q,Y,X),R.emplaceBack(X,Y,te)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(R),this._tileDebugTextBuffer=t.createVertexBuffer(C,r.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(D,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,k,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class Ko extends Yo{constructor(t,n,u,p,_){super(t,n,u,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const u=this._mrt=new r.bg(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bi(p,(_,x,S,C)=>{if(_)n(_);else try{const R=u.getHeaderLength(x);if(R>t)return void(this.request=this.fetchHeader(R,n));u.parseHeader(x),this._isHeaderLoaded=!0;let D=0;for(const k of Object.values(u.layers))D=Math.max(D,k.dataIndex[k.dataIndex.length-1].last_byte);x.byteLength>=D&&(this.entireBuffer=x),n(null,this.entireBuffer||x,S,C)}catch(R){n(R)}}),this.request}fetchBand(t,n,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void u(new Error("Can't fetch tile band without an actor"));let x;const S=(k,B)=>{x.complete(k,B),k?u(k):(this.updateTextureDescriptor(t,n),u(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(k,B)=>{if(k)return u(k);const U=_.send("decodeRasterArray",{buffer:B,task:x},S,void 0,!0);this._workQueue.push(()=>{U&&U.cancel(),x.cancel()})},R=p.getLayer(t);if(!R)return void u(new Error(`Unknown sourceLayer "${t}"`));if(R.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=R.getDataRange([n]);if(x=p.createDecodingTask(D),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),B=r.bi(k,C);this._fetchQueue.push(()=>{B.cancel(),x.cancel()})}else u(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(n)||!u.hasDataForBand(n))return;const{bytes:p,tileSize:_,buffer:x,offset:S,scale:C}=u.getBandView(n),R=_+2*x,D={data:p,width:R,height:R},k=this.texture;k&&k instanceof r.T&&k.update(D,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:D,buffer:x,offset:S,tileSize:_,format:u.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class im{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:n,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,p=n===void 0?0:this.data[u].indexOf(n),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class md{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},r.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])u[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(n!==void 0){const S=String(n),C=r.l({},u[S],p[S]);if(_){const R=_[n];if(R===null)return{};for(const D in R)delete C[D]}return C}const x=r.l({},u,p);if(_)for(const S in _)delete x[S];return x}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),r.l(this.state[p][x],this.stateChanges[p][x]),_[x]=this.state[p][x];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const x in this.state[p])_[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const S of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][S];_[x]=this.state[p][x]}u[p]=u[p]||{},r.l(u[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(n)}}class ws extends r.E{constructor(t,n,u){super(),this.id=t,this._onlySymbols=u,n.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new im(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new md,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(t=>t.tileID).sort(Hi).map(t=>t.key)}getRenderableIds(t,n){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,n)&&u.push(this._tiles[p]);return t?u.sort((p,_)=>{const x=p.tileID,S=_.tileID,C=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),R=new r.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-S.overscaledZ||R.y-C.y||R.x-C.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Hi).map(p=>p.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new r.y(p,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const _=n[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const x=this.getTileByID(_);u(t,x),u(x,t)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-p.tileID.canonical.x;const S=_.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),R=_.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+C)===1?x+=C:Math.abs(x-C)===1&&(x-=C)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,x,S),p.neighboringTiles&&p.neighboringTiles[R]&&(p.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,p){for(const _ in this._tiles){let x=this._tiles[_];if(p[_]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const R=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[R.key],x&&x.hasData()&&(S=R)}let C=S;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){p[S.key]=S;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const p=t.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const u=Math.ceil(t.width/n)+1,p=Math.ceil(t.height/n)+1,_=Math.floor(u*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(S)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,n,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let x,S=this._source.maxzoom;const C=this.map&&this.map.painter?this.map.painter._terrain:null;if(C&&C.sourceCache===this&&C.attenuationRange()){const k=C.attenuationRange()[0],B=Math.floor(k)-Math.log2(C.getDemUpscale());S>B&&(S=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new r.aG(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){const k=t.clone();k.tileCoverLift=this.tileCoverLift,x=k.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new r.aG(1,0,1,0,0)),x.push(new r.aG(1,0,1,1,0)),x.push(new r.aG(1,0,1,0,1)),x.push(new r.aG(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const k=this._source.hasTile.bind(this._source);x=x.filter(B=>k(B))}}else x=[];if(x.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!_d(this._source.type)){const k=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),B=Math.min(k,this._source.maxzoom);if(_){const U=t.extendTileCover(x,B);for(const Z of U)x.push(Z)}else{const U=t.extendTileCover(x,B,p);for(const Z of U)this._shadowCasterTiles[Z.key]=!0,x.push(Z)}}const R=this._updateRetainedTiles(x);if(_d(this._source.type)&&x.length!==0){const k={},B={},U=Object.keys(R);for(const q of U){const Y=R[q],X=this._tiles[q];if(!X||X.fadeEndTime&&X.fadeEndTime<=r.q.now())continue;const te=this.findLoadedParent(Y,Math.max(Y.overscaledZ-ws.maxOverzooming,this._source.minzoom));te&&(this._addTile(te.tileID),k[te.tileID.key]=te.tileID),B[q]=Y}const Z=x[x.length-1].overscaledZ;for(const q in this._tiles){const Y=this._tiles[q];if(R[q]||!Y.hasData())continue;let X=Y.tileID;for(;X.overscaledZ>Z;){X=X.scaledTo(X.overscaledZ-1);const te=this._tiles[X.key];if(te&&te.hasData()&&B[X.key]){R[q]=Y.tileID;break}}}for(const q in k)R[q]||(this._coveredTiles[q]=!0,R[q]=k[q])}for(const k in R)this._tiles[k].clearFadeHold();const D=r.bk(this._tiles,R);for(const k of D){const B=this._tiles[k];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const u={},p=t.reduce((R,D)=>Math.min(R,D.overscaledZ),1/0),_=t[0].overscaledZ,x=Math.max(_-ws.maxOverzooming,this._source.minzoom),S=Math.max(_+ws.maxUnderzooming,this._source.minzoom),C={};for(const R of t){const D=this._addTile(R);n[R.key]=R,D.hasData()||p<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,p,S,n);for(const R of t){let D=this._tiles[R.key];if(D.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const B=R.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){n[B.key]=B;continue}}else{const B=R.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let k=D.wasRequested();for(let B=R.overscaledZ-1;B>=x;--B){const U=R.scaledTo(B);if(u[U.key]||(u[U.key]=!0,D=this.getTile(U),!D&&k&&(D=this._addTile(U)),D&&(n[U.key]=U,k=D.wasRequested(),D.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of n)this._loadedParentTiles[_]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=!!n;if(!u){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new Ko(t,_,this.transform.tileZoom,p,this._isRaster):new Yo(t,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,u||this._source.fire(new r.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,u){const p=[],_=this.transform;if(!_)return p;const x=_.projection.name==="globe",S=r.at(_.center.lng);for(const C in this._tiles){const R=this._tiles[C];if(u&&R.clearQueryDebugViz(),R.holdingForFade())continue;let D;if(x){const k=R.tileID.canonical;if(k.z===0){const B=[Math.abs(r.aw(S,...ni(k,-1))-S),Math.abs(r.aw(S,...ni(k,1))-S)];D=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(r.aw(S,...ni(k,-1))-S),Math.abs(r.aw(S,...ni(k,0))-S),Math.abs(r.aw(S,...ni(k,1))-S)];D=[B.indexOf(Math.min(...B))-1]}}else D=[0];for(const k of D){const B=t.containsTile(R,_,n,k);B&&p.push(B)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const u=this.getRenderableIds(t,n).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(t){const n=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const x of n){const S=1/(1<<x.canonical.z);_[x.key]=((x.canonical.x+.5)*S+x.wrap-u[0])*p[0]+((x.canonical.y+.5)*S-u[1])*p[1]-u[2]*p[2]}return n.sort((x,S)=>_[x.key]-_[S.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(_d(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const p=this._tiles[t];p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,n))};return void this._source.on("data",C)}const u=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const C of p){const R=C.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of R)u.set(D.key,D);this.usedForTerrain&&C.updateElevation(!1)}const S=Array.from(u.values());r.bl(S,(C,R)=>{const D=new Yo(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),R(k,D)})},n)}}function Hi(c,t){const n=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-n||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function _d(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function ni(c,t){const n=1<<c.z;return[c.x/n+t,(c.x+1)/n+t]}ws.maxOverzooming=10,ws.maxUnderzooming=3;class nm{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:n});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const u=n.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&n.visible,n.visible=p}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,x=this.style.getLayerSourceCache(_);let S=1;_.type==="fill-extrusion"&&(S=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let C=x?x.getTile(n):null;if(!C&&x&&n.canonical.z>x.getSource().minzoom){let R=n.scaledTo(Math.min(x.getSource().maxzoom,n.overscaledZ-1));for(;R.overscaledZ>=x.getSource().minzoom&&(C=x.getTile(R),!C&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(_):null,tileID:C?C.tileID:n,verticalScale:S})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),x=_.zOffset,S=this._getHeightAtTileOffset(n,_.tileAnchorX,_.tileAnchorY);_.zOffset=S!==Number.NEGATIVE_INFINITY?S:x,u||x===_.zOffset||(u=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,u,p){let _=n,x=u;if(t.canonical.z!==p.canonical.z){const S=p.canonical,C=1/(1<<t.canonical.z-S.z);_=(n+t.canonical.x*r.ag)*C-S.x*r.ag|0,x=(u+t.canonical.y*r.ag)*C-S.y*r.ag|0}return{tileX:_,tileY:x}}_getHeightAtTileOffset(t,n,u){let p,_;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:S,tileID:C,verticalScale:R}=this.currentBuildingBuckets[x];if(!S)continue;const{tileX:D,tileY:k}=this._mapCoordToOverlappingTile(t,n,u,C),B=S.getHeightAtTileCoord(D,k);B&&B.height!==void 0&&(B.hidden?p=B.height:_=Math.max(B.height*R,_||0))}if(_!==void 0)return _;for(let x=0;x<this.layers.length;++x){const S=this.layers[x];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:C,tileID:R}=this.currentBuildingBuckets[x];if(!C)continue;const{tileX:D,tileY:k}=this._mapCoordToOverlappingTile(t,n,u,R),B=C.getHeightAtTileCoord(D,k);if(B&&!B.hidden)return B.height===void 0&&p!==void 0?Math.min(B.maxHeight,p)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Du(c,t){const n={};for(const u in c)u!=="ref"&&(n[u]=c[u]);return r.bm.forEach(u=>{u in t&&(n[u]=t[u])}),n}function zu(c){c=c.slice();const t=Object.create(null);for(let n=0;n<c.length;n++)t[c[n].id]=c[n];for(let n=0;n<c.length;n++)"ref"in c[n]&&(c[n]=Du(c[n],t[c[n].ref]));return c}const Mi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Lu(c,t,n){n.push({command:Mi.addSource,args:[c,t[c]]})}function ya(c,t,n){t.push({command:Mi.removeSource,args:[c]}),n[c]=!0}function Vt(c,t,n,u){ya(c,n,u),Lu(c,t,n)}function Xi(c,t,n){let u;for(u in c[n])if(c[n].hasOwnProperty(u)&&u!=="data"&&!r.bn(c[n][u],t[n][u]))return!1;for(u in t[n])if(t[n].hasOwnProperty(u)&&u!=="data"&&!r.bn(c[n][u],t[n][u]))return!1;return!0}function ki(c,t,n,u,p,_){let x;for(x in t=t||{},c=c||{})c.hasOwnProperty(x)&&(r.bn(c[x],t[x])||n.push({command:_,args:[u,x,t[x],p]}));for(x in t)t.hasOwnProperty(x)&&!c.hasOwnProperty(x)&&(r.bn(c[x],t[x])||n.push({command:_,args:[u,x,t[x],p]}))}function Er(c){return c.id}function Co(c,t){return c[t.id]=t,c}class Vi{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aw(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const _=n-1,x=this._distances[_],S=u-x,C=S>0?(p-x)/S:0;return this.points[_].mult(1-C).add(this.points[n].mult(C))}}class lc{constructor(t,n,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,_){this._forEachCell(n,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,n,u,p,_,x){this.circleCells[_].push(x)}_query(t,n,u,p,_,x){if(u<0||t>this.width||p<0||n>this.height)return!_&&[];const S=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const R=this.circles[3*C],D=this.circles[3*C+1],k=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:R-k,y1:D-k,x2:R+k,y2:D+k})}return x?S.filter(x):S}return this._forEachCell(t,n,u,p,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?S.length>0:S}_queryCircle(t,n,u,p,_){const x=t-u,S=t+u,C=n-u,R=n+u;if(S<0||x>this.width||R<0||C>this.height)return!p&&[];const D=[];return this._forEachCell(x,C,S,R,this._queryCellCircle,D,{hitTest:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},_),p?D.length>0:D}query(t,n,u,p,_){return this._query(t,n,u,p,!1,_)}hitTest(t,n,u,p,_){return this._query(t,n,u,p,!0,_)}hitTestCircle(t,n,u,p){return this._queryCircle(t,n,u,!0,p)}_queryCell(t,n,u,p,_,x,S,C){const R=S.seenUids,D=this.boxCells[_];if(D!==null){const B=this.bboxes;for(const U of D)if(!R.box[U]){R.box[U]=!0;const Z=4*U;if(t<=B[Z+2]&&n<=B[Z+3]&&u>=B[Z+0]&&p>=B[Z+1]&&(!C||C(this.boxKeys[U]))){if(S.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[U],x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]})}}}const k=this.circleCells[_];if(k!==null){const B=this.circles;for(const U of k)if(!R.circle[U]){R.circle[U]=!0;const Z=3*U;if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],t,n,u,p)&&(!C||C(this.circleKeys[U]))){if(S.hitTest)return x.push(!0),!0;{const q=B[Z],Y=B[Z+1],X=B[Z+2];x.push({key:this.circleKeys[U],x1:q-X,y1:Y-X,x2:q+X,y2:Y+X})}}}}}_queryCellCircle(t,n,u,p,_,x,S,C){const R=S.circle,D=S.seenUids,k=this.boxCells[_];if(k!==null){const U=this.bboxes;for(const Z of k)if(!D.box[Z]){D.box[Z]=!0;const q=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,U[q+0],U[q+1],U[q+2],U[q+3])&&(!C||C(this.boxKeys[Z])))return x.push(!0),!0}}const B=this.circleCells[_];if(B!==null){const U=this.circles;for(const Z of B)if(!D.circle[Z]){D.circle[Z]=!0;const q=3*Z;if(this._circlesCollide(U[q],U[q+1],U[q+2],R.x,R.y,R.radius)&&(!C||C(this.circleKeys[Z])))return x.push(!0),!0}}}_forEachCell(t,n,u,p,_,x,S,C){const R=this._convertToXCellCoord(t),D=this._convertToYCellCoord(n),k=this._convertToXCellCoord(u),B=this._convertToYCellCoord(p);for(let U=R;U<=k;U++)for(let Z=D;Z<=B;Z++)if(_.call(this,t,n,u,p,this.xCellCount*Z+U,x,S,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,_,x){const S=p-t,C=_-n,R=u+x;return R*R>S*S+C*C}_circleAndRectCollide(t,n,u,p,_,x,S){const C=(x-p)/2,R=Math.abs(t-(p+C));if(R>C+u)return!1;const D=(S-_)/2,k=Math.abs(n-(_+D));if(k>D+u)return!1;if(R<=C||k<=D)return!0;const B=R-C,U=k-D;return B*B+U*U<=u*u}}const ro={unknown:0,flipRequired:1,flipNotRequired:2},cc=Math.tan(85*Math.PI/180);function lr(c,t,n,u,p,_,x){const S=r.ab.mat4.create();if(n)if(_.name==="globe"){const C=r.bo(p,t);r.ab.mat4.multiply(S,S,C)}else{const C=r.ab.mat2.invert([],x);S[0]=C[0],S[1]=C[1],S[4]=C[2],S[5]=C[3],u||r.ab.mat4.rotateZ(S,S,p.angle)}else r.ab.mat4.multiply(S,p.labelPlaneMatrix,c);return S}function Pn(c,t,n,u,p,_,x){const S=lr(c,t,n,u,p,_,x);return _.name==="globe"&&n||(S[2]=S[6]=S[10]=S[14]=0),S}function gd(c,t,n,u,p,_,x){if(n){if(_.name==="globe"){const S=lr(c,t,n,u,p,_,x);return r.ab.mat4.invert(S,S),r.ab.mat4.multiply(S,c,S),S}{const S=r.ab.mat4.clone(c),C=r.ab.mat4.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],r.ab.mat4.multiply(S,S,C),u||r.ab.mat4.rotateZ(S,S,-p.angle),S}}return p.glCoordMatrix}function jr(c,t,n,u){const p=[c,t,n,1];n?r.ab.vec4.transformMat4(p,p,u):Ts(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Ou(c,t){return Math.min(.5+c/t*.5,1.5)}function uc(c,t){const n=c[0]/c[3],u=c[1]/c[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function ku(c,t,n,u,p,_,x,S,C,R){const D=n.transform,k=u?c.textSizeData:c.iconSizeData,B=r.bp(k,n.transform.zoom),U=D.projection.name==="globe",Z=[256/n.width*2+1,256/n.height*2+1],q=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;q.clear();let Y=null;U&&(Y=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const X=c.lineVertexArray,te=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,le=n.transform.width/n.transform.height;let ae,me=!1;for(let he=0;he<te.length;he++){const fe=te.get(he),{numGlyphs:ue,writingMode:xe}=fe;if(xe!==r.bq.vertical||me||ae===r.bq.horizontal||(me=!0),ae=xe,(fe.hidden||xe===r.bq.vertical)&&!me){An(ue,q);continue}me=!1;const Me=new r.P(fe.tileAnchorX,fe.tileAnchorY);let{x:$e,y:ke,z:Qe}=D.projection.projectTilePoint(Me.x,Me.y,R.canonical);if(C){const[et,ft,xt]=C(Me);$e+=et,ke+=ft,Qe+=xt}const Ke=[$e,ke,Qe,1];if(r.ab.vec4.transformMat4(Ke,Ke,t),!uc(Ke,Z)){An(ue,q);continue}const Pe=Ke[3],Ze=Ou(n.transform.getCameraToCenterDistance(D.projection),Pe),lt=r.br(k,B,fe),Ce=x?lt/Ze:lt*Ze,tt=jr($e,ke,Qe,p);if(tt[3]<=0){An(ue,q);continue}let We={};const bt=x?null:C,nt=so(fe,Ce,!1,S,t,p,_,c.glyphOffsetArray,X,q,Y,tt,Me,We,le,bt,D.projection,R,x);me=nt.useVertical,bt&&nt.needsFlipping&&(We={}),(nt.notEnoughRoom||me||nt.needsFlipping&&so(fe,Ce,!0,S,t,p,_,c.glyphOffsetArray,X,q,Y,tt,Me,We,le,bt,D.projection,R,x).notEnoughRoom)&&An(ue,q)}u?(c.text.dynamicLayoutVertexBuffer.updateData(q),Y&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(Y)):(c.icon.dynamicLayoutVertexBuffer.updateData(q),Y&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(Y))}function hc(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q){const{lineStartIndex:Y,glyphStartIndex:X,segment:te}=S,le=X+S.numGlyphs,ae=Y+S.lineLength,me=t.getoffsetX(X),he=t.getoffsetX(le-1),fe=Po(c*me,n,u,p,_,x,te,Y,ae,C,R,D,k,B,!0,U,Z,q);if(!fe)return null;const ue=Po(c*he,n,u,p,_,x,te,Y,ae,C,R,D,k,B,!0,U,Z,q);return ue?{first:fe,last:ue}:null}function Mr(c,t,n,u){return c===r.bq.horizontal&&Math.abs(u)>Math.abs(n)?{useVertical:!0}:c===r.bq.vertical?u>0?{needsFlipping:!0}:null:t!==ro.unknown&&function(p,_){return p===0||Math.abs(_/p)>cc}(n,u)?t===ro.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function so(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X,te){const le=t/24,ae=c.lineOffsetX*le,me=c.lineOffsetY*le,{lineStartIndex:he,glyphStartIndex:fe,numGlyphs:ue,segment:xe,writingMode:Me,flipState:$e}=c,ke=he+c.lineLength,Qe=Ke=>{if(D){const[Ce,tt,We]=Ke.up,bt=R.length;r.bs(D,bt+0,Ce,tt,We),r.bs(D,bt+1,Ce,tt,We),r.bs(D,bt+2,Ce,tt,We),r.bs(D,bt+3,Ce,tt,We)}const[Pe,Ze,lt]=Ke.point;r.bt(R,Pe,Ze,lt,Ke.angle)};if(ue>1){const Ke=hc(le,S,ae,me,n,k,B,c,C,_,U,q,!1,Y,X,te);if(!Ke)return{notEnoughRoom:!0};if(u&&!n){let[Pe,Ze,lt]=Ke.first.point,[Ce,tt,We]=Ke.last.point;[Pe,Ze]=jr(Pe,Ze,lt,x),[Ce,tt]=jr(Ce,tt,We,x);const bt=Mr(Me,$e,(Ce-Pe)*Z,tt-Ze);if(c.flipState=bt&&bt.needsFlipping?ro.flipRequired:ro.flipNotRequired,bt)return bt}Qe(Ke.first);for(let Pe=fe+1;Pe<fe+ue-1;Pe++){const Ze=Po(le*S.getoffsetX(Pe),ae,me,n,k,B,xe,he,ke,C,_,U,q,!1,!1,Y,X,te);if(!Ze)return R.length-=4*(Pe-fe),{notEnoughRoom:!0};Qe(Ze)}Qe(Ke.last)}else{if(u&&!n){const Pe=jr(B.x,B.y,0,p),Ze=he+xe+1,lt=new r.P(C.getx(Ze),C.gety(Ze)),Ce=jr(lt.x,lt.y,0,p),tt=Ce[3]>0?Ce:yd(B,lt,Pe,1,p,void 0,Y,X.canonical),We=Mr(Me,$e,(tt[0]-Pe[0])*Z,tt[1]-Pe[1]);if(c.flipState=We&&We.needsFlipping?ro.flipRequired:ro.flipNotRequired,We)return We}const Ke=Po(le*S.getoffsetX(fe),ae,me,n,k,B,xe,he,ke,C,_,U,q,!1,!1,Y,X,te);if(!Ke)return{notEnoughRoom:!0};Qe(Ke)}return{}}function xr(c,t,n,u,p){const{x:_,y:x,z:S}=u.projectTilePoint(c.x,c.y,t);if(!p)return jr(_,x,S,n);const[C,R,D]=p(c);return jr(_+C,x+R,S+D,n)}function yd(c,t,n,u,p,_,x,S){const C=xr(c.sub(t)._unit()._add(c),S,p,x,_);return r.ab.vec3.sub(C,n,C),r.ab.vec3.normalize(C,C),r.ab.vec3.scaleAndAdd(C,n,C,u)}function Po(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X){const te=u?c-t:c+t;let le=te>0?1:-1,ae=0;u&&(le*=-1,ae=Math.PI),le<0&&(ae+=Math.PI);let me=S+x+(le>0?0:1)|0,he=p,fe=p,ue=0,xe=0;const Me=Math.abs(te),$e=[],ke=[];let Qe=_,Ke=Qe;const Pe=()=>yd(Ke,Qe,fe,Me-ue+1,D,B,q,Y.canonical);for(;ue+xe<=Me;){if(me+=le,me<S||me>=C)return null;if(fe=he,Ke=Qe,$e.push(fe),U&&ke.push(Ke),Qe=new r.P(R.getx(me),R.gety(me)),he=k[me],!he){const ft=xr(Qe,Y.canonical,D,q,B);he=ft[3]>0?k[me]=ft:Pe()}ue+=xe,xe=r.ab.vec3.distance(fe,he)}Z&&B&&(k[me]&&(he=Pe(),xe=r.ab.vec3.distance(fe,he)),k[me]=he);const Ze=(Me-ue)/xe,lt=Qe.sub(Ke)._mult(Ze)._add(Ke),Ce=r.ab.vec3.sub([],he,fe),tt=r.ab.vec3.scaleAndAdd([],fe,Ce,Ze);let We=[0,0,1],bt=Ce[0],nt=Ce[1];if(X&&(We=q.upVector(Y.canonical,lt.x,lt.y),We[0]!==0||We[1]!==0||We[2]!==1)){const ft=[We[2],0,-We[0]],xt=r.ab.vec3.cross([],We,ft);r.ab.vec3.normalize(ft,ft),r.ab.vec3.normalize(xt,xt),bt=r.ab.vec3.dot(Ce,ft),nt=r.ab.vec3.dot(Ce,xt)}if(n){const ft=r.ab.vec3.cross([],We,Ce);r.ab.vec3.normalize(ft,ft),r.ab.vec3.scaleAndAdd(tt,tt,ft,n*le)}const et=ae+Math.atan2(nt,bt);return $e.push(tt),U&&ke.push(lt),{point:tt,angle:et,path:$e,tilePath:ke,up:We}}function An(c,t){const n=t.length,u=n+4*c;t.resize(u),t.float32.fill(-1/0,4*n,4*u)}function Ts(c,t,n){const u=t[0],p=t[1];return c[0]=n[0]*u+n[4]*p+n[12],c[1]=n[1]*u+n[5]*p+n[13],c[3]=n[3]*u+n[7]*p+n[15],c}const cr=100;class Bn{constructor(t,n,u=new lc(t.width+200,t.height+200,25),p=new lc(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+cr,this.screenBottomBoundary=t.height+cr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,u,p,_,x,S,C){let R=u.projectedAnchorX,D=u.projectedAnchorY,k=u.projectedAnchorZ;const B=u.elevation,U=u.tileID,Z=t.getProjection();if(B&&U){const[he,fe,ue]=Z.upVector(U.canonical,u.tileAnchorX,u.tileAnchorY),xe=Z.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=he*B*xe,D+=fe*B*xe,k+=ue*B*xe}const q=this.projectAndGetPerspectiveRatio(S,R,D,k,u.tileID,Z.name==="globe"||!!B||this.transform.pitch>0,Z),Y=x*q.perspectiveRatio,X=(u.x1*n+p.x-u.padding)*Y+q.point.x,te=(u.y1*n+p.y-u.padding)*Y+q.point.y,le=(u.x2*n+p.x+u.padding)*Y+q.point.x,ae=(u.y2*n+p.y+u.padding)*Y+q.point.y,me=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(X,te,le,ae)||!_&&this.grid.hitTest(X,te,le,ae,C)||me?{box:[],offscreen:!1,occluded:q.occluded}:{box:[X,te,le,ae],offscreen:this.isOffscreen(X,te,le,ae),occluded:!1}}placeCollisionCircles(t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q){const Y=[],X=this.transform.elevation,te=t.getProjection(),le=X?X.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,te):null,ae=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:me,y:he,z:fe}=te.projectTilePoint(ae.x,ae.y,q.canonical);if(le){const[lt,Ce,tt]=le(ae);me+=lt,he+=Ce,fe+=tt}const ue=te.name==="globe",xe=this.projectAndGetPerspectiveRatio(S,me,he,fe,q,ue||!!X||this.transform.pitch>0,te),{perspectiveRatio:Me}=xe,$e=(k?x/Me:x*Me)/r.bw,ke=jr(me,he,fe,C),Qe=xe.signedDistanceFromCamera>0?hc($e,_,u.lineOffsetX*$e,u.lineOffsetY*$e,!1,ke,ae,u,p,C,{},X&&!k?le:null,k&&!!X,te,q,k):null;let Ke=!1,Pe=!1,Ze=!0;if(Qe&&!xe.occluded){const lt=.5*U*Me+Z,Ce=new r.P(-100,-100),tt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),We=new Vi,{first:bt,last:nt}=Qe,et=bt.path.length;let ft=[];for(let Bt=et-1;Bt>=1;Bt--)ft.push(bt.path[Bt]);for(let Bt=1;Bt<nt.path.length;Bt++)ft.push(nt.path[Bt]);const xt=2.5*lt;R&&(ft=ft.map(([Bt,si,Xt],Jt)=>(le&&!ue&&(Xt=le(Jt<et-1?bt.tilePath[et-1-Jt]:nt.tilePath[Jt-et+2])[2]),jr(Bt,si,Xt,R))),ft.some(Bt=>Bt[3]<=0)&&(ft=[]));let Rt=[];if(ft.length>0){let Bt=1/0,si=-1/0,Xt=1/0,Jt=-1/0;for(const ui of ft)Bt=Math.min(Bt,ui[0]),Xt=Math.min(Xt,ui[1]),si=Math.max(si,ui[0]),Jt=Math.max(Jt,ui[1]);si>=Ce.x&&Bt<=tt.x&&Jt>=Ce.y&&Xt<=tt.y&&(Rt=[ft.map(ui=>new r.P(ui[0],ui[1]))],(Bt<Ce.x||si>tt.x||Xt<Ce.y||Jt>tt.y)&&(Rt=r.bu(Rt,Ce.x,Ce.y,tt.x,tt.y)))}for(const Bt of Rt){We.reset(Bt,.25*lt);let si=0;si=We.length<=.5*lt?1:Math.ceil(We.paddedLength/xt)+1;for(let Xt=0;Xt<si;Xt++){const Jt=Xt/Math.max(si-1,1),ui=We.lerp(Jt),Ri=ui.x+cr,Ki=ui.y+cr;Y.push(Ri,Ki,lt,0);const En=Ri-lt,dn=Ki-lt,pi=Ri+lt,Fi=Ki+lt;if(Ze=Ze&&this.isOffscreen(En,dn,pi,Fi),Pe=Pe||this.isInsideGrid(En,dn,pi,Fi),!n&&this.grid.hitTestCircle(Ri,Ki,lt,B)&&(Ke=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ke,occluded:!1}}}}return{circles:!D&&Ke||!Pe?[]:Y,offscreen:Ze,collisionDetected:Ke,occluded:xe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,p=1/0,_=-1/0,x=-1/0;for(const D of t){const k=new r.P(D.x+cr,D.y+cr);u=Math.min(u,k.x),p=Math.min(p,k.y),_=Math.max(_,k.x),x=Math.max(x,k.y),n.push(k)}const S=this.grid.query(u,p,_,x).concat(this.ignoredGrid.query(u,p,_,x)),C={},R={};for(const D of S){const k=D.key;if(C[k.bucketInstanceId]===void 0&&(C[k.bucketInstanceId]={}),C[k.bucketInstanceId][k.featureIndex])continue;const B=[new r.P(D.x1,D.y1),new r.P(D.x2,D.y1),new r.P(D.x2,D.y2),new r.P(D.x1,D.y2)];r.bv(n,B)&&(C[k.bucketInstanceId][k.featureIndex]=!0,R[k.bucketInstanceId]===void 0&&(R[k.bucketInstanceId]=[]),R[k.bucketInstanceId].push(k.featureIndex))}return R}insertCollisionBox(t,n,u,p,_){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,_){const x=n?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let C=0;C<t.length;C+=4)x.insertCircle(S,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,u,p,_,x,S){const C=[n,u,p,1];let R=!1;p||this.transform.pitch>0?(r.ab.vec4.transformMat4(C,C,t),this.fogState&&_&&S.name!=="globe"&&(R=function(B,U,Z,q,Y,X){const te=X.calculateFogTileMatrix(Y),le=[U,Z,q];return r.ab.vec3.transformMat4(le,le,te),we(B,r.ab.vec3.length(le),X.pitch,X._fov)}(this.fogState,n,u,p,_.toUnwrapped(),this.transform)>.9)):Ts(C,C,t);const D=C[3];return{point:new r.P((C[0]/D+1)/2*this.transform.width+cr,(-C[1]/D+1)/2*this.transform.height+cr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/D*.5,1.5),signedDistanceFromCamera:D,occluded:x&&C[2]>D||R}}isOffscreen(t,n,u,p){return u<cr||t>=this.screenRightBoundary||p<cr||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=r.ab.mat4.identity([]);return r.ab.mat4.translate(t,t,[-100,-100,0]),t}}function dc(c,t,n){const u=t.createTileMatrix(c,c.worldSize,n.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),c.projMatrix,u)}function Bs(c,t,n){if(t.projection.name===n.projection.name)return c.projMatrix;const u=n.clone();return u.setProjection(t.projection),dc(u,t.getProjection(),c)}function xa(c,t,n){return t.name===n.projection.name?c.projMatrix:dc(n,t,c)}class fc{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Ns{constructor(t,n,u,p,_,x=!1){this.text=new fc(t?t.text:null,n,u,_),this.icon=new fc(t?t.icon:null,n,p,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xd{constructor(t,n,u,p=!1){this.text=t,this.icon=n,this.skipFade=u,this.clipped=p}}class Ro{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class dy{constructor(t,n,u,p,_){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class vd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function Gr(c,t,n,u,p){const{horizontalAlign:_,verticalAlign:x}=r.bD(c),S=-(_-.5)*t,C=-(x-.5)*n,R=r.bC(c,u);return new r.P(S+R[0]*p,C+R[1]*p)}function bd(c,t,n,u,p){const _=new r.P(c,t);return n&&_._rotate(u?p:-p),_}class Fu{constructor(t,n,u,p,_,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Bn(this.transform,_),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new vd(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,p,_=1){const x=u.getBucket(n),S=u.latestFeatureIndex;if(!x||!S||n.fqid!==x.layerIds[0])return;const C=x.layers[0].layout,R=x.layers[0].paint,D=u.collisionBoxArray,k=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/r.ag,U=u.tileID.toUnwrapped();this.transform.setProjection(x.projection);const Z=(q=u.tileID,Y=x.getProjection(),X=this.transform,Y.name===this.projection?X.calculateProjMatrix(q.toUnwrapped()):dc(X,Y,q));var q,Y,X;const te=C.get("text-pitch-alignment")==="map",le=C.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const ae=n.dynamicFilter(),me=n.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(u),fe=Pn(Z,u.tileID.canonical,te,le,this.transform,x.getProjection(),he);let ue=null;if(te){const lt=gd(Z,u.tileID.canonical,te,le,this.transform,x.getProjection(),he);ue=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,lt)}let xe=null;ae&&u.latestFeatureIndex&&(xe={unwrappedTileID:U,dynamicFilter:ae,dynamicFilterNeedsFeature:me}),this.retainedQueryData[x.bucketInstanceId]=new dy(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,u.tileID);const[Me,$e]=x.layers[0].layout.get("text-size-scale-range"),ke=r.aw(_,Me,$e),[Qe,Ke]=C.get("icon-size-scale-range"),Pe=r.aw(_,Qe,Ke),Ze={bucket:x,layout:C,paint:R,posMatrix:Z,textLabelPlaneMatrix:fe,labelToScreenMatrix:ue,clippingData:xe,scale:k,textPixelRatio:B,holdingForFade:u.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:r.bp(x.textSizeData,this.transform.zoom,ke),partiallyEvaluatedIconSize:r.bp(x.iconSizeData,this.transform.zoom,Pe),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const lt of x.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:tt,symbolInstanceEnd:We}=lt;t.push({sortKey:Ce,symbolInstanceStart:tt,symbolInstanceEnd:We,parameters:Ze})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X,te){const{textOffset0:le,textOffset1:ae,crossTileID:me}=B,he=[le,ae],fe=Gr(t,u,p,he,_),ue=this.collisionIndex.placeCollisionBox(Z,_,n,bd(fe.x,fe.y,x,S,this.transform.angle),k,C,R,D.predicate);if(Y){const xe=Z.getSymbolInstanceIconSize(te,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,xe,Y,bd(fe.x,fe.y,x,S,this.transform.angle),k,C,R,D.predicate).box.length===0)return}if(ue.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[me]&&this.prevPlacement.placements[me]&&this.prevPlacement.placements[me].text&&(xe=this.prevPlacement.variableOffsets[me].anchor),this.variableOffsets[me]={textOffset:he,width:u,height:p,anchor:t,textScale:_,prevAnchor:xe},this.markUsedJustification(Z,t,B,q),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,q,B),this.placedOrientations[me]=q),{shift:fe,placedGlyphBoxes:ue}}}placeLayerBucketPart(t,n,u,p,_=1){const{bucket:x,layout:S,paint:C,posMatrix:R,textLabelPlaneMatrix:D,labelToScreenMatrix:k,clippingData:B,textPixelRatio:U,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:X,collisionGroup:te,latestFeatureIndex:le}=t.parameters,ae=S.get("text-optional"),me=S.get("icon-optional"),he=S.get("text-allow-overlap"),fe=S.get("icon-allow-overlap"),ue=S.get("text-rotation-alignment")==="map",xe=S.get("text-pitch-alignment")==="map",Me=S.get("symbol-z-elevate"),$e=C.get("symbol-z-offset"),ke=S.get("symbol-elevation-reference")==="sea",[Qe,Ke]=S.get("text-size-scale-range"),[Pe,Ze]=S.get("icon-size-scale-range"),lt=r.aw(_,Qe,Ke),Ce=r.aw(_,Pe,Ze);this.transform.setProjection(x.projection);let tt=he&&(fe||!x.hasIconData()||me),We=fe&&(he||!x.hasTextData()||ae);const bt=!$e.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),u&&p&&x.updateCollisionDebugBuffers(this.transform.zoom,q,lt,Ce);const nt=(et,ft,xt)=>{const{crossTileID:Rt,numVerticalGlyphVertices:Bt}=et;let si=null;if(B&&B.dynamicFilterNeedsFeature||bt){const on=this.retainedQueryData[x.bucketInstanceId];si=le.loadFeature({featureIndex:et.featureIndex,bucketIndex:on.bucketIndex,sourceLayerIndex:on.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},si,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(et.tileAnchorX,et.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Rt]=new xd(!1,!1,!1,!0),void n.add(Rt);const Xt=$e.evaluate(si,{});if(n.has(Rt))return;if(Z)return void(this.placements[Rt]=new xd(!1,!1,!1));let Jt=!1,ui=!1,Ri=!0,Ki=!1,En=!1,dn=null,pi={box:null,offscreen:null,occluded:null},Fi={box:null,offscreen:null,occluded:null},Ht=null,Ci=null,ji=null,Zi=0,bn=0,tr=0;xt.textFeatureIndex?Zi=xt.textFeatureIndex:et.useRuntimeCollisionCircles&&(Zi=et.featureIndex),xt.verticalTextFeatureIndex&&(bn=xt.verticalTextFeatureIndex);const jn=on=>{on.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const rn=this.transform.elevation;on.elevation=ke?Xt:Xt+(rn?rn.getAtTileOffset(on.tileID,on.tileAnchorX,on.tileAnchorY):0),on.elevation+=et.zOffset},Gn=xt.textBox;if(Gn){jn(Gn);const on=zi=>{let Ln=r.bq.horizontal;if(x.allowVerticalPlacement&&!zi&&this.prevPlacement){const ir=this.prevPlacement.placedOrientations[Rt];ir&&(this.placedOrientations[Rt]=ir,Ln=ir,this.markUsedOrientation(x,Ln,et))}return Ln},rn=(zi,Ln)=>{if(x.allowVerticalPlacement&&Bt>0&&xt.verticalTextBox){for(const ir of x.writingModes)if(ir===r.bq.vertical?(pi=Ln(),Fi=pi):pi=zi(),pi&&pi.box&&pi.box.length)break}else pi=zi()};if(S.get("text-variable-anchor")){let zi=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt]){const sn=this.prevPlacement.variableOffsets[Rt];zi.indexOf(sn.anchor)>0&&(zi=zi.filter(Cr=>Cr!==sn.anchor),zi.unshift(sn.anchor))}const Ln=(sn,Cr,Ms)=>{const Qr=x.getSymbolInstanceTextSize(Y,et,this.transform.zoom,ft),Hr=(sn.x2-sn.x1)*Qr+2*sn.padding,fo=(sn.y2-sn.y1)*Qr+2*sn.padding,As=et.hasIconTextFit&&!fe?Cr:null;As&&jn(As);let fs={box:[],offscreen:!1,occluded:!1};const Na=he?2*zi.length:zi.length;for(let po=0;po<Na;++po){const Va=this.attemptAnchorPlacement(zi[po%zi.length],sn,Hr,fo,Qr,ue,xe,U,R,te,po>=zi.length,et,ft,x,Ms,As,Y,X);if(Va&&(fs=Va.placedGlyphBoxes,fs&&fs.box&&fs.box.length)){Jt=!0,dn=Va.shift;break}}return fs};rn(()=>Ln(Gn,xt.iconBox,r.bq.horizontal),()=>{const sn=xt.verticalTextBox;return sn&&jn(sn),x.allowVerticalPlacement&&!(pi&&pi.box&&pi.box.length)&&Bt>0&&sn?Ln(sn,xt.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),pi&&(Jt=pi.box,Ri=pi.offscreen,Ki=pi.occluded);const ir=on(!(!pi||!pi.box));if(!Jt&&this.prevPlacement){const sn=this.prevPlacement.variableOffsets[Rt];sn&&(this.variableOffsets[Rt]=sn,this.markUsedJustification(x,sn.anchor,et,ir))}}else{const zi=(Ln,ir)=>{const sn=x.getSymbolInstanceTextSize(Y,et,this.transform.zoom,ft,_),Cr=this.collisionIndex.placeCollisionBox(x,sn,Ln,new r.P(0,0),he,U,R,te.predicate);return Cr&&Cr.box&&Cr.box.length&&(this.markUsedOrientation(x,ir,et),this.placedOrientations[Rt]=ir),Cr};rn(()=>zi(Gn,r.bq.horizontal),()=>{const Ln=xt.verticalTextBox;return x.allowVerticalPlacement&&Bt>0&&Ln?(jn(Ln),zi(Ln,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),on(!!(pi&&pi.box&&pi.box.length))}}if(Ht=pi,Jt=Ht&&Ht.box&&Ht.box.length>0,Ri=Ht&&Ht.offscreen,Ki=Ht&&Ht.occluded,et.useRuntimeCollisionCircles){const on=x.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex>=0?et.centerJustifiedTextSymbolIndex:et.verticalPlacedTextSymbolIndex),rn=r.br(x.textSizeData,Y,on),zi=S.get("text-padding");Ci=this.collisionIndex.placeCollisionCircles(x,he,on,x.lineVertexArray,x.glyphOffsetArray,rn,R,D,k,u,xe,te.predicate,et.collisionCircleDiameter*rn/r.bw,zi,this.retainedQueryData[x.bucketInstanceId].tileID),Jt=he||Ci.circles.length>0&&!Ci.collisionDetected,Ri=Ri&&Ci.offscreen,Ki=Ci.occluded}if(xt.iconFeatureIndex&&(tr=xt.iconFeatureIndex),xt.iconBox){const on=rn=>{jn(rn);const zi=et.hasIconTextFit&&dn?bd(dn.x,dn.y,ue,xe,this.transform.angle):new r.P(0,0),Ln=x.getSymbolInstanceIconSize(X,this.transform.zoom,et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Ln,rn,zi,fe,U,R,te.predicate)};Fi&&Fi.box&&Fi.box.length&&xt.verticalIconBox?(ji=on(xt.verticalIconBox),ui=ji.box.length>0):(ji=on(xt.iconBox),ui=ji.box.length>0),Ri=Ri&&ji.offscreen,En=ji.occluded}const ds=ae||et.numHorizontalGlyphVertices===0&&Bt===0,Ir=me||et.numIconVertices===0;if(ds||Ir?Ir?ds||(ui=ui&&Jt):Jt=ui&&Jt:ui=Jt=ui&&Jt,Jt&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,S.get("text-ignore-placement"),x.bucketInstanceId,Fi&&Fi.box&&bn?bn:Zi,te.ID),ui&&ji&&this.collisionIndex.insertCollisionBox(ji.box,S.get("icon-ignore-placement"),x.bucketInstanceId,tr,te.ID),Ci&&(Jt&&this.collisionIndex.insertCollisionCircles(Ci.circles,S.get("text-ignore-placement"),x.bucketInstanceId,Zi,te.ID),u)){const on=x.bucketInstanceId;let rn=this.collisionCircleArrays[on];rn===void 0&&(rn=this.collisionCircleArrays[on]=new Ro);for(let zi=0;zi<Ci.circles.length;zi+=4)rn.circles.push(Ci.circles[zi+0]),rn.circles.push(Ci.circles[zi+1]),rn.circles.push(Ci.circles[zi+2]),rn.circles.push(Ci.collisionDetected?1:0)}const wn=x.projection.name!=="globe";tt=tt&&(wn||!Ki),We=We&&(wn||!En),this.placements[Rt]=new xd(Jt||tt,ui||We,Ri||x.justReloaded),n.add(Rt)};if(Me&&this.buildingIndex&&(this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.updateZOffset()),x.sortFeaturesByY){const et=x.getSortedSymbolIndexes(this.transform.angle);for(let ft=et.length-1;ft>=0;--ft){const xt=et[ft];nt(x.symbolInstances.get(xt),xt,x.collisionArrays[xt])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const et=x.getSortedIndexesByZOffset();for(let ft=0;ft<et.length;++ft){const xt=et[ft];nt(x.symbolInstances.get(xt),xt,x.collisionArrays[xt])}}else for(let et=t.symbolInstanceStart;et<t.symbolInstanceEnd;et++)nt(x.symbolInstances.get(et),et,x.collisionArrays[et]);if(u&&x.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[x.bucketInstanceId];r.ab.mat4.invert(et.invProjMatrix,R),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,n,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C,crossTileID:R}=u,D=r.bB(n),k=p===r.bq.vertical?C:D==="left"?_:D==="center"?x:D==="right"?S:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=k>=0&&_!==k?0:R),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=k>=0&&x!==k?0:R),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=k>=0&&S!==k?0:R),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=k>=0&&C!==k?0:R)}markUsedOrientation(t,n,u){const p=n===r.bq.horizontal||n===r.bq.horizontalOnly?n:0,_=n===r.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R}=u,D=t.text.placedSymbolArray;x>=0&&(D.get(x).placedOrientation=p),S>=0&&(D.get(S).placedOrientation=p),C>=0&&(D.get(C).placedOrientation=p),R>=0&&(D.get(R).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,_=n?n.opacities:{},x=n?n.variableOffsets:{},S=n?n.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],D=_[C];D?(this.opacities[C]=new Ns(D,p,R.text,R.icon,null,R.clipped),u=u||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[C]=new Ns(null,p,R.text,R.icon,R.skipFade,R.clipped),u=u||R.text||R.icon)}for(const C in _){const R=_[C];if(!this.opacities[C]){const D=new Ns(R,p,!1,!1);D.isHidden()||(this.opacities[C]=D,u=u||R.text.placed||R.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in S)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=S[C]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,u,p){const _=new Set;for(const x of n){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,_,x,x.collisionBoxArray,u,p,x.tileID,t.scope),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,x.tileID),S.updateZOffset()))}}updateBucketOpacities(t,n,u,p,_,x,S,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const R=t.layers[0].layout,D=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),B=new Ns(null,0,!1,!1,!0),U=R.get("text-allow-overlap"),Z=R.get("icon-allow-overlap"),q=R.get("text-variable-anchor"),Y=R.get("text-rotation-alignment")==="map",X=R.get("text-pitch-alignment")==="map",te=D.get("symbol-z-offset"),le=R.get("symbol-elevation-reference")==="sea",ae=!te.isConstant(),me=new Ns(null,0,U&&(Z||!t.hasIconData()||R.get("icon-optional")),Z&&(U||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const he=(ue,xe,Me)=>{for(let $e=0;$e<xe/4;$e++)ue.opacityVertexArray.emplaceBack(Me)};let fe=0;x&&t.updateReplacement(S,x);for(let ue=0;ue<t.symbolInstances.length;ue++){const xe=t.symbolInstances.get(ue),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:$e,crossTileID:ke,numIconVertices:Qe,tileAnchorX:Ke,tileAnchorY:Pe}=xe;let Ze=null;const lt=this.retainedQueryData[t.bucketInstanceId];ae&&xe&&lt&&(Ze=u.latestFeatureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:lt.bucketIndex,sourceLayerIndex:lt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ce=te.evaluate(Ze,{}),tt=n.has(ke);let We=this.opacities[ke];tt?We=B:We||(We=me,this.opacities[ke]=We),n.add(ke);const bt=Me>0||$e>0,nt=Qe>0,et=this.placedOrientations[ke],ft=et===r.bq.vertical,xt=et===r.bq.horizontal||et===r.bq.horizontalOnly;!bt&&!nt||We.isHidden()||fe++;let Rt=!1;if((bt||nt)&&x)for(const Bt of t.activeReplacements){if(r.bx(Bt,_,r.by.Symbol,C)||Bt.min.x>Ke||Ke>Bt.max.x||Bt.min.y>Pe||Pe>Bt.max.y)continue;const si=r.bz(Ke,Pe,S.canonical,Bt.footprintTileId.canonical);if(Rt=r.bA(si,Bt.footprint),Rt)break}if(bt){const Bt=Rt?Do:wd(We.text);he(t.text,Me,ft?Do:Bt),he(t.text,$e,xt?Do:Bt);const si=We.text.isHidden(),{leftJustifiedTextSymbolIndex:Xt,centerJustifiedTextSymbolIndex:Jt,rightJustifiedTextSymbolIndex:ui,verticalPlacedTextSymbolIndex:Ri}=xe,Ki=t.text.placedSymbolArray,En=si||ft?1:0;Xt>=0&&(Ki.get(Xt).hidden=En),Jt>=0&&(Ki.get(Jt).hidden=En),ui>=0&&(Ki.get(ui).hidden=En),Ri>=0&&(Ki.get(Ri).hidden=si||xt?1:0);const dn=this.variableOffsets[ke];dn&&this.markUsedJustification(t,dn.anchor,xe,et);const pi=this.placedOrientations[ke];pi&&(this.markUsedJustification(t,"left",xe,pi),this.markUsedOrientation(t,pi,xe))}if(nt){const Bt=Rt?Do:wd(We.icon),{placedIconSymbolIndex:si,verticalPlacedIconSymbolIndex:Xt}=xe,Jt=t.icon.placedSymbolArray,ui=We.icon.isHidden()?1:0;si>=0&&(he(t.icon,Qe,ft?Do:Bt),Jt.get(si).hidden=ui),Xt>=0&&(he(t.icon,xe.numVerticalIconVertices,xt?Do:Bt),Jt.get(Xt).hidden=ui)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Bt=t.collisionArrays[ue];if(Bt){let si=new r.P(0,0),Xt=!0;if(Bt.textBox||Bt.verticalTextBox){if(q){const ui=this.variableOffsets[ke];ui?(si=Gr(ui.anchor,ui.width,ui.height,ui.textOffset,ui.textScale),Y&&si._rotate(X?this.transform.angle:-this.transform.angle)):Xt=!1}k&&(Xt=!We.clipped),Bt.textBox&&pc(t.textCollisionBox.collisionVertexArray,We.text.placed,!Xt||ft,Ce,le,si.x,si.y),Bt.verticalTextBox&&pc(t.textCollisionBox.collisionVertexArray,We.text.placed,!Xt||xt,Ce,le,si.x,si.y)}const Jt=Xt&&!!(!xt&&Bt.verticalIconBox);Bt.iconBox&&pc(t.iconCollisionBox.collisionVertexArray,We.icon.placed,Jt,Ce,le,xe.hasIconTextFit?si.x:0,xe.hasIconTextFit?si.y:0),Bt.verticalIconBox&&pc(t.iconCollisionBox.collisionVertexArray,We.icon.placed,!Jt,Ce,le,xe.hasIconTextFit?si.x:0,xe.hasIconTextFit?si.y:0)}}}if(t.fullyClipped=fe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ue.invProjMatrix,t.placementViewportMatrix=ue.viewportMatrix,t.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function pc(c,t,n,u,p,_,x){c.emplaceBack(t?1:0,n?1:0,_||0,x||0,u,p?1:0),c.emplaceBack(t?1:0,n?1:0,_||0,x||0,u,p?1:0),c.emplaceBack(t?1:0,n?1:0,_||0,x||0,u,p?1:0),c.emplaceBack(t?1:0,n?1:0,_||0,x||0,u,p?1:0)}const mc=Math.pow(2,25),fy=Math.pow(2,24),py=Math.pow(2,17),_c=Math.pow(2,16),gc=Math.pow(2,9),my=Math.pow(2,8),rl=Math.pow(2,1);function wd(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,n=Math.floor(127*c.opacity);return n*mc+t*fy+n*py+t*_c+n*gc+t*my+n*rl+t}const Do=0;class Jo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,u,p,_,x){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(S,p,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(n.placeLayerBucketPart(C,this._seenCrossTileIDs,u,C.symbolInstanceStart===0,x),this._currentPartIndex++,_())return!0}return!1}}class _y{constructor(t,n,u,p,_,x,S,C,R){this.placement=new Fu(t,_,x,S,C,R),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u,p,_){const x=r.q.now(),S=()=>{const C=r.q.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=n[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const D=C,k=D.layout.get("symbol-z-elevate"),B=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=D.layout.get("symbol-z-order"),Z=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&B),q=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),Y=Z&&q,X=this._inProgressLayer=this._inProgressLayer||new Jo(D),te=r.aC(C.source,C.scope);if(X.continuePlacement(k||Y?p[te]:u[te],this.placement,this._showCollisionBoxes,C,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Td=512/r.ag/2;class gy{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this.index=new r.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*r.ag,_=t.canonical.y*r.ag;for(let x=0;x<n.length;x++){const{key:S,crossTileID:C,tileAnchorX:R,tileAnchorY:D}=n.get(x),k=Math.floor((p+R)*Td),B=Math.floor((_+D)*Td);this.index.add(k,B),this.keys.push(S),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),_=Td/Math.pow(2,n.canonical.z-this.tileID.canonical.z),x=n.canonical.x*r.ag,S=n.canonical.y*r.ag;for(let C=0;C<t.length;C++){const R=t.get(C);if(R.crossTileID)continue;const{key:D,tileAnchorX:k,tileAnchorY:B}=R,U=Math.floor((x+k)*_),Z=Math.floor((S+B)*_),q=this.index.range(U-p,Z-p,U+p,Z+p);for(const Y of q){const X=this.crossTileIDs[Y];if(this.keys[Y]===D&&!u.has(X)){u.add(X),R.crossTileID=X;break}}}}}class rm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const x in p){const S=p[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+n),_[S.tileID.key]=S}this.indexes[u]=_}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<n.symbolInstances.length;_++)n.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const S in x){const C=x[S];C.tileID.isChildOf(t)&&C.findMatches(n.symbolInstances,t,p)}else{const S=x[t.scaledTo(Number(_)).key];S&&S.findMatches(n.symbolInstances,t,p)}}for(let _=0;_<n.symbolInstances.length;_++){const x=n.symbolInstances.get(_);x.crossTileID||(x.crossTileID=u.generate(),p.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new gy(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],n=!0)}return n}}class Sd{constructor(){this.layerIndexes={},this.crossTileIDs=new rm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new yy);let x=!1;const S={};p.name!=="globe"&&_.handleWrapJump(u);for(const C of n){const R=C.getBucket(t);R&&t.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(C.tileID,R,this.crossTileIDs)&&(x=!0),S[R.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const va=771;class Ei{constructor(t,n,u,p){this.blendFunction=t,this.blendColor=n,this.mask=u,this.blendEquation=p}}Ei.Replace=[1,0,1,0],Ei.disabled=new Ei(Ei.Replace,r.aj.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,r.aj.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,va,1,va],r.aj.transparent,[!0,!0,!0,!0]),Ei.alphaBlendedNonPremultiplied=new Ei([770,va,770,va],r.aj.transparent,[!0,!0,!0,!0]),Ei.multiply=new Ei([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Kt{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const Bu=7680;class oi{constructor(t,n,u,p,_,x){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=_,this.pass=x}}oi.disabled=new oi({func:519,mask:0},0,0,Bu,Bu,Bu);const sl=1029,Nu=2305;class li{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}function ol(c,t){const n=r.bG(c,3);r.ab.mat4.fromQuat(c,t),r.bI(c,3,n)}function ba(c,t){const n=r.ab.quat.identity([]);return r.ab.quat.rotateZ(n,n,-t),r.ab.quat.rotateX(n,n,-c),n}function Ed(c,t){const n=[c[0],c[1],0],u=[t[0],t[1],0];if(r.ab.vec3.length(n)>=1e-15){const x=r.ab.vec3.normalize([],n);r.ab.vec3.scale(u,x,r.ab.vec3.dot(u,x)),t[0]=u[0],t[1]=u[1]}const p=r.ab.vec3.cross([],t,c);if(r.ab.vec3.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return ba(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}li.disabled=new li(!1,sl,Nu),li.backCCW=new li(!0,sl,Nu),li.backCW=new li(!0,sl,2304),li.frontCW=new li(!0,1028,2304),li.frontCCW=new li(!0,1028,Nu);class Vu{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof r.aa?t:new r.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=r.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(t)):0,_=r.aa.fromLngLat(t,p),x=[_.x-u.x,_.y-u.y,_.z-u.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Ed(x,n)}setPitchBearing(t,n){this.orientation=ba(r.ai(t),r.ai(-n))}}class qr{constructor(t,n){this._transform=r.ab.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new r.aa(t[0],t[1],t[2])}get position(){const t=r.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&r.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.ab.quat.identity([]),t&&ol(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=ba(t,n),ol(this._transform,this._orientation)}forward(){const t=r.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const u=new Float64Array(16);return r.ab.mat4.invert(u,this.getWorldToCamera(t,n)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,u){const p=this.position;r.ab.vec3.scale(p,p,-t);const _=new Float64Array(16);return r.ab.mat4.fromScaling(_,[u,u,u]),r.ab.mat4.translate(_,_,p),_[10]*=n,_}getWorldToCamera(t,n){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return r.ab.quat.conjugate(p,this._orientation),r.ab.vec3.scale(_,_,-t),r.ab.mat4.fromQuat(u,p),r.ab.mat4.translate(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=n,u[9]*=n,u[10]*=n,u[11]*=n,u}getCameraToClipPerspective(t,n,u,p){const _=new Float64Array(16);return r.ab.mat4.perspective(_,t,n,u,p),_}getCameraToClipOrthographic(t,n,u,p,_,x){const S=new Float64Array(16);return r.ab.mat4.ortho(S,t,n,u,p,_,x),S}getDistanceToElevation(t,n=!1){const u=t===0?0:r.bH(t,n?r.aS(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new qr([...this.position],[...this.orientation])}}const vr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class At{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=r.af(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=r.af(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=r.af(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=r.af(t.right,n.right,u)),this}getCenter(t,n){const u=r.aw((this.left+t-this.right)/2,0,t),p=r.aw((this.top+n-this.bottom)/2,0,n);return new r.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new At(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Md=(c,t,n)=>(1-n)*c+n*t,Uu=c=>c*c*c*c*c;class yc{constructor(t,n,u,p,_,x,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(x),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new At,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new yc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const u=this.getProjection(),p=!r.bn(n,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=r.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let x=0;x<n.length;x++){const S=new r.P(n[x][0]*this.width,u+n[x][1]*(this.height-u)),C=t.pointCoordinate(S);if(!C)continue;const R=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);p+=C[3]*R,_+=R}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*n,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const p=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,u));return r.aw(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!r.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];r.ab.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new Vu;return n.position=new r.aa(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!r.ab.quat.length(t))return!1;r.ab.quat.normalize(t,t);const n=r.ab.vec3.transformQuat([],[0,0,-1],t),u=r.ab.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=Ed(n,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=r.aw(t[2],p/u,p/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new r.bQ(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),p=this.pointCoordinate(new r.P(this.width,0)),_=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),S=Math.floor(Math.min(u.x,p.x,_.x,x.x)),C=Math.floor(Math.max(u.x,p.x,_.x,x.x)),R=1;for(let D=S-R;D<=C+R;D++)D!==0&&n.push(new r.bQ(D,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,u){let p=[];const _=u!==void 0,x=!_;if(x&&this.zoom<n||_&&u[0]===0&&u[1]===0)return p;const S=new Set,C=(D,k,B,U,Z)=>{const q=r.c5(k,D,B,U,Z);S.has(q)||(p.push(new r.aG(D,k,B,U,Z)),S.add(q))};for(let D=0;D<t.length;D++){const k=t[D];if(x&&k.canonical.z!==n)continue;const B=k.canonical,U=k.overscaledZ,Z=k.wrap,q=1<<B.z,Y=B.x+1<q,X=B.x>0,te=B.y+1<q,le=B.y>0,ae=k.wrap-(X?0:1),me=k.wrap+(Y?0:1),he=X?B.x-1:q-1,fe=Y?B.x+1:0;if(_)u[0]<0?(C(U,me,B.z,fe,B.y),u[1]<0&&te&&(C(U,Z,B.z,B.x,B.y+1),C(U,me,B.z,fe,B.y+1)),u[1]>0&&le&&(C(U,Z,B.z,B.x,B.y-1),C(U,me,B.z,fe,B.y-1))):u[0]>0?(C(U,ae,B.z,he,B.y),u[1]<0&&te&&(C(U,Z,B.z,B.x,B.y+1),C(U,ae,B.z,he,B.y+1)),u[1]>0&&le&&(C(U,Z,B.z,B.x,B.y-1),C(U,ae,B.z,he,B.y-1))):u[1]<0&&te?C(U,Z,B.z,B.x,B.y+1):le&&C(U,Z,B.z,B.x,B.y-1);else{const ue=k.visibleQuadrants;1&ue&&(C(U,ae,B.z,he,B.y),le&&(C(U,Z,B.z,B.x,B.y-1),C(U,ae,B.z,he,B.y-1))),2&ue&&(C(U,me,B.z,fe,B.y),le&&(C(U,Z,B.z,B.x,B.y-1),C(U,me,B.z,fe,B.y-1))),4&ue&&(C(U,ae,B.z,he,B.y),te&&(C(U,Z,B.z,B.x,B.y+1),C(U,ae,B.z,he,B.y+1))),8&ue&&(C(U,me,B.z,fe,B.y),te&&(C(U,Z,B.z,B.x,B.y+1),C(U,me,B.z,fe,B.y+1)))}}const R=[];for(const D of p)p.some(k=>D.isChildOf(k))||R.push(D);if(p=R.filter(D=>!t.some(k=>!!(D.overscaledZ<n&&k.isChildOf(D))||D.equals(k)||D.isChildOf(k))),x){const D=1<<n,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[D*k.x,D*k.y],U=4,Z=U*U;p=p.filter(q=>{const Y=q.canonical.x+.5-B[0],X=q.canonical.y+.5-B[1];return Y*Y+X*X<Z})}return p}coveringTiles(t){let n=this.coveringZoomLevel(t);const u=n,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const S=this.locationCoordinate(this.center),C=this.center.lat,R=1<<n,D=[R*S.x,R*S.y,0],k=this.projection.name==="globe",B=!k,U=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,B),Z=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=R*r.bH(1,this.center.lat),Y=this._camera.position[2]/r.bH(1,this.center.lat),X=[R*Z.x,R*Z.y,Y*(B?1:q)],te=k||p,le=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.isLODDisabled(!0)?n:0;let me;if(this._elevation&&t.isTerrainDEM)me=1e4*this._elevation.exaggeration();else if(this._elevation){const Ce=this._elevation.getMinMaxForVisibleTiles();me=Ce?Ce.max:this._centerAltitude}else me=this._centerAltitude;const he=t.isTerrainDEM?-me:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?r.bS(this):1,ue=Ce=>{const We=new r.aa(Ce.x+25e-6,Ce.y,Ce.z),bt=new r.aa(Ce.x,Ce.y+25e-6,Ce.z),nt=Ce.toLngLat(),et=We.toLngLat(),ft=bt.toLngLat(),xt=this.locationCoordinate(nt),Rt=this.locationCoordinate(et),Bt=this.locationCoordinate(ft),si=Math.hypot(Rt.x-xt.x,Rt.y-xt.y),Xt=Math.hypot(Bt.x-xt.x,Bt.y-xt.y);return Math.sqrt(si*Xt)*fe/25e-6},xe=Ce=>{const tt=me,We=he;return{aabb:r.bV(this,R,0,0,0,Ce,We,tt,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:tt,wrap:Ce,fullyVisible:!1}},Me=[];let $e=[];const ke=n,Qe=t.reparseOverscaled?u:n,Ke=(Y-this._centerAltitude)*q,Pe=Ce=>{if(!this._elevation||!Ce.tileID||!x)return;const tt=this._elevation.getMinMaxForTile(Ce.tileID),We=Ce.aabb;tt?(We.min[2]=tt.min,We.max[2]=tt.max,We.center[2]=(We.min[2]+We.max[2])/2):(Ce.shouldSplit=lt(Ce),Ce.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},Ze=(Ce,tt)=>{if(.707*tt<Ce)return 1;const We=tt/Ce;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},lt=Ce=>{if(Ce.zoom<ae)return!0;if(Ce.zoom===ke)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const tt=Ce.aabb.distanceX(X),We=Ce.aabb.distanceY(X);let bt=Ke,nt=1;if(k){bt=Ce.aabb.distanceZ(X);const Xt=Math.pow(2,Ce.zoom),Jt=r.aS((Ce.y+1)/Xt),ui=r.aS(Ce.y/Xt),Ri=Math.min(Math.max(C,Jt),ui),Ki=r.c9(Ri)/r.c9(C);if(nt=Ri===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ki/this._mercatorScaleRatio),this.zoom<=r.c6&&Ce.zoom===ke-1&&Ki>=.9)return!0}else if(_&&(bt=Ce.aabb.distanceZ(X)*q),this.projection.isReprojectedInTileSpace&&u<=5){const Xt=Math.pow(2,Ce.zoom),Jt=ue(new r.aa((Ce.x+.5)/Xt,(Ce.y+.5)/Xt));nt=Jt>.85?1:Jt}if(!x){const Xt=Math.sqrt(tt*tt+We*We+bt*bt);let Jt=(1<<ke-Ce.zoom)*le*nt;return Jt*=Ze(Math.max(bt,Ke),Xt),Xt<Jt}let et=Number.MAX_VALUE,ft=0;const xt=Ce.aabb.getCorners(),Rt=[];for(const Xt of xt){r.ab.vec3.sub(Rt,Xt,X),k||(_?Rt[2]*=q:Rt[2]=Ke);const Jt=r.ab.vec3.dot(Rt,this._camera.forward());Jt<et&&(et=Jt,ft=Math.abs(Rt[2]))}let Bt=(1<<ke-Ce.zoom)*le*nt;if(Bt*=Ze(Math.max(ft,Ke),et),et<Bt)return!0;const si=Ce.aabb.closestPoint(D);return si[0]===D[0]&&si[1]===D[1]};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)Me.push(xe(-Ce)),Me.push(xe(Ce));for(Me.push(xe(0));Me.length>0;){const Ce=Me.pop(),tt=Ce.x,We=Ce.y;let bt=Ce.fullyVisible;const nt=()=>this.projection.name==="globe"&&(Ce.y===0||Ce.y===(1<<Ce.zoom)-1);if(!bt){let et=te?Ce.aabb.intersects(U):Ce.aabb.intersectsFlat(U);if(et===0&&nt()){const ft=new r.bT(Ce.zoom,tt,We);et=r.bU(this,R,ft,!0).intersects(U)}if(et===0)continue;bt=et===2}if(Ce.zoom!==ke&&lt(Ce))for(let et=0;et<4;et++){const ft=(tt<<1)+et%2,xt=(We<<1)+(et>>1),Rt={aabb:x?Ce.aabb.quadrant(et):r.bV(this,R,Ce.zoom+1,ft,xt,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:ft,y:xt,wrap:Ce.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};_&&!k&&(Rt.tileID=new r.aG(Ce.zoom+1===ke?Qe:Ce.zoom+1,Ce.wrap,Ce.zoom+1,ft,xt),Pe(Rt)),Me.push(Rt)}else{const et=Ce.zoom===ke?Qe:Ce.zoom;if(t.minzoom&&t.minzoom>et)continue;let ft=0;if(!bt){let si=te?Ce.aabb.intersectsPrecise(U):Ce.aabb.intersectsPreciseFlat(U);if(si===0&&nt()){const Xt=new r.bT(Ce.zoom,tt,We);si=r.bU(this,R,Xt,!0).intersectsPrecise(U)}if(si===0)continue;if(t.calculateQuadrantVisibility)if(U.containsPoint(Ce.aabb.center))ft=15;else for(let Xt=0;Xt<4;Xt++)Ce.aabb.quadrant(Xt).intersects(U)!==0&&(ft|=1<<Xt)}const xt=D[0]-(.5+tt+(Ce.wrap<<Ce.zoom))*(1<<n-Ce.zoom),Rt=D[1]-.5-We,Bt=Ce.tileID?Ce.tileID:new r.aG(et,Ce.wrap,Ce.zoom,tt,We);t.calculateQuadrantVisibility&&(Bt.visibleQuadrants=ft),$e.push({tileID:Bt,distanceSq:xt*xt+Rt*Rt})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,tt=this.horizonLineFromTop();$e=$e.filter(We=>{const bt=[0,0,0,1],nt=[r.ag,r.ag,0,1],et=this.calculateFogTileMatrix(We.tileID.toUnwrapped());r.ab.vec4.transformMat4(bt,bt,et),r.ab.vec4.transformMat4(nt,nt,et);const ft=r.ab.vec4.min([],bt,nt),xt=r.ab.vec4.max([],bt,nt),Rt=r.bW(ft,xt);if(Rt===0)return!0;let Bt=!1;const si=this._elevation;if(si&&Rt>Ce&&tt!==0){const Xt=this.calculateProjMatrix(We.tileID.toUnwrapped());let Jt;t.isTerrainDEM||(Jt=si.getMinMaxForTile(We.tileID)),Jt||(Jt={min:he,max:me});const ui=r.c7(this.rotation),Ri=[ui[0]*r.ag,ui[1]*r.ag,Jt.max];r.ab.vec3.transformMat4(Ri,Ri,Xt),Bt=(1-Ri[1])*this.height*.5<tt}return Rt<Ce||Bt})}return $e.sort((Ce,tt)=>Ce.distanceSq-tt.distanceSq).map(Ce=>Ce.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=r.aw(t.lat,-r.bX,r.bX),u=this.projection.project(t.lng,n);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;u=(n.x-_.x)/S,p=(n.y-_.y)/S}else{const S=this.pointCoordinate(n),C=this.pointCoordinate(_);u=S.x-C.x,p=S.y-C.y}const x=this.locationCoordinate(t);this.setLocation(new r.aa(x.x-u,x.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const u=n?r.bH(n,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new r.aa(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const u=n??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];r.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),r.ab.vec4.transformMat4(_,_,this.pixelMatrixInverse);const x=_[3];r.ab.vec4.scale(p,p,1/p[3]),r.ab.vec4.scale(_,_,1/x);const S=p[2],C=_[2];return{p0:p,p1:_,t:S===C?0:(u-S)/(C-S)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return r.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),r.ab.vec4.transformMat4(u,u,this.pixelMatrixInverse),r.ab.vec4.scale(n,n,1/n[3]),r.ab.vec4.scale(u,u,1/u[3]),n[2]=r.bH(n[2],this._center.lat)*this.worldSize,u[2]=r.bH(u[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(n,n,1/this.worldSize),r.ab.vec4.scale(u,u,1/this.worldSize),new r.aq([n[0],n[1],n[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],u,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:u,t:p}=t,_=r.bH(n[2],this._center.lat),x=r.bH(u[2],this._center.lat);return new r.aa(r.af(n[0],u[0],p)/this.worldSize,r.af(n[1],u[1],p)/this.worldSize,r.af(_,x,p))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new r.aa(n[0],n[1],n[2]);let u=0,p=this.horizonLineFromTop();if(t.y>p)return this.pointCoordinate(t);const _=.02*p,x=t.clone();for(let S=0;S<10&&p-u>_;S++){x.y=r.af(u,p,.66);const C=this.projection.pointCoordinate3D(this,x.x,x.y);C?(p=x.y,n=C):u=x.y}return n?new r.aa(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const u=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return r.ab.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new r.P(p[0]/p[3],p[1]/p[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new r.P(n,t)),x=this.pointLocation3D(new r.P(p,t)),S=this.pointLocation3D(new r.P(p,u)),C=this.pointLocation3D(new r.P(n,u));let R=Math.min(_.lng,x.lng,S.lng,C.lng),D=Math.max(_.lng,x.lng,S.lng,C.lng),k=Math.min(_.lat,x.lat,S.lat,C.lat),B=Math.max(_.lat,x.lat,S.lat,C.lat);const U=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,q=(Y,X,te,le,ae)=>{const me=(Y+te)/2,he=(X+le)/2,fe=new r.P(me,he),{lng:ue,lat:xe}=this.pointLocation3D(fe),Me=Math.max(0,R-ue,k-xe,ue-D,xe-B);R=Math.min(R,ue),D=Math.max(D,ue),k=Math.min(k,xe),B=Math.max(B,xe),(ae<Z||Me>U)&&(q(Y,X,me,he,ae+1),q(me,he,te,le,ae+1))};if(q(n,t,p,t,1),q(p,t,p,u,1),q(p,u,n,u,1),q(n,u,n,t,1),this.projection.name==="globe"){const[Y,X]=r.bZ(this);Y?(B=90,D=180,R=-180):X&&(k=-90,D=180,R=-180)}return new r.az(new r.bO(R,k),new r.bO(D,B))}_getBoundsRectangular(t,n){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=new r.P(p,u),C=new r.P(x,u),R=new r.P(x,_),D=new r.P(p,_);let k=this.pointCoordinate(S,t),B=this.pointCoordinate(C,t);const U=this.pointCoordinate(R,n),Z=this.pointCoordinate(D,n),q=(Y,X)=>(X.y-Y.y)/(X.x-Y.x);return k.y>1&&B.y>=0?k=new r.aa((1-Z.y)/q(Z,k)+Z.x,1):k.y<0&&B.y<=1&&(k=new r.aa(-Z.y/q(Z,k)+Z.x,0)),B.y>1&&k.y>=0?B=new r.aa((1-U.y)/q(U,B)+U.x,1):B.y<0&&k.y<=1&&(B=new r.aa(-U.y/q(U,B)+U.x,0)),new r.az().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,u=this._distanceTileDataCache;if(u[n])return u[n];const p=t.canonical,_=1/this.height,x=this.cameraWorldSize,S=x/this.zoomScale(p.z),C=(p.x+Math.pow(2,p.z)*t.wrap)*S,R=p.y*S,D=this.point;D.x*=x/this.worldSize,D.y*=x/this.worldSize;const k=this.angle,B=Math.sin(-k),U=-Math.cos(-k);return u[n]={bearing:[B,U],center:[(D.x-C)*_,(D.y-R)*_],scale:S/r.ag*_},u[n]}calculateFogTileMatrix(t){const n=t.key,u=this._fogTileMatrixCache;if(u[n])return u[n];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.ab.mat4.multiply(p,this.worldToFogMatrix,p),u[n]=new Float32Array(p),u[n]}calculateProjMatrix(t,n=!1,u=!1){const p=t.key;let _;if(_=u?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const x=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(x,S,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[n])return u[n];const p=r.b_(t,this);return u[n]=p,u[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=r.ab.mat4.fromScaling([],[t,t,t]);return r.ab.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=r.bH(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(n),p=this._camera.forward(),_=r.bH(1,this._center.lat);u[2]/=_,p[2]/=_,r.ab.vec3.normalize(p,p);const x=t.raycast(u,p,t.exaggeration());if(x){const S=r.ab.vec3.scaleAndAdd([],u,p,x),C=new r.aa(S[0],S[1],r.bH(S[2],r.aS(S[1]))),R=(C.z+r.ab.vec3.length([C.x-u[0],C.y-u[1],C.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,u=r.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=n.getAtPointOrZero(new r.aa(...p)),x=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),C=p[2]-x;if(C<=S)if(C<0||t){const R=this.locationCoordinate(this._center,this._centerAltitude),D=[p[0],p[1],R.z-p[2]],k=r.ab.vec3.length(D);D[2]-=(S-C)/this._pixelsPerMercatorPixel;const B=r.ab.vec3.length(D);if(B===0)return;r.ab.vec3.scale(D,D,k/B*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],R.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=r.aw(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=r.aw(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:p}=this.point;let _=0,x=u,S=p;const C=this.width/2,R=this.height/2,D=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(p-R<D&&(S=D+R),p+R>k&&(S=k-R),k-D<this.height&&(_=Math.max(_,this.height/(k-D)),S=(k+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+U)/2;x=(u+Z+this.worldSize)%this.worldSize-Z,x-C<B&&(x=B+C),x+C>U&&(x=U-C),U-B<this.width&&(_=Math.max(_,this.width/(U-B)),x=(U+B)/2)}x===u&&S===p||(this.center=this.unproject(new r.P(x,S))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const p=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,_);let S;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let xe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Me=xe*this.aspect,$e=-Me,ke=-xe;Me-=t.x,$e-=t.x,xe+=t.y,ke+=t.y,S=this._camera.getCameraToClipOrthographic($e,Me,ke,xe,this._nearZ,this._farZ),((Qe,Ke,Pe,Ze)=>{for(let lt=0;lt<16;lt++)Qe[lt]=Md(Ke[lt],Pe[lt],Ze)})(S,S,C,Uu(this.pitch>=15?1:this.pitch/15))}else S=C;const R=r.ab.mat4.mul([],C,x);let D=r.ab.mat4.mul([],S,x);if(this.projection.isReprojectedInTileSpace){const xe=this.locationCoordinate(this.center),Me=r.ab.mat4.identity([]);r.ab.mat4.translate(Me,Me,[xe.x*this.worldSize,xe.y*this.worldSize,0]),r.ab.mat4.multiply(Me,Me,r.c0(this)),r.ab.mat4.translate(Me,Me,[-xe.x*this.worldSize,-xe.y*this.worldSize,0]),r.ab.mat4.multiply(D,D,Me),r.ab.mat4.multiply(R,R,Me),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],D,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=D,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),n){const xe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);xe[8]=2*-t.x/this.width,xe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],xe,x)}else this.expandedFarZProjMatrix=this.projMatrix;const k=r.ab.mat4.invert([],S);this.frustumCorners=r.c2.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const B=new Float32Array(16);r.ab.mat4.identity(B),r.ab.mat4.scale(B,B,[1,-1,1]),r.ab.mat4.rotateX(B,B,this._pitch),r.ab.mat4.rotateZ(B,B,this.angle);const U=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(U);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-t.x/this.width,U[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(B,U,B);const q=this.point,Y=q.x,X=q.y,te=this.width%2/2,le=this.height%2/2,ae=Math.cos(this.angle),me=Math.sin(this.angle),he=Y-Math.round(Y)+ae*te+me*le,fe=X-Math.round(X)+ae*le+me*te,ue=new Float64Array(D);if(r.ab.mat4.translate(ue,ue,[he>.5?he-1:he,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=ue,D=r.ab.mat4.create(),r.ab.mat4.scale(D,D,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=r.ab.mat4.create(),r.ab.mat4.scale(D,D,[1,-1,1]),r.ab.mat4.translate(D,D,[-1,-1,0]),r.ab.mat4.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},D=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const xe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(xe,xe,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,n];r.ab.vec3.scale(_,_,p),r.ab.vec3.scale(u,u,-1),r.ab.vec3.multiply(u,u,_);const x=r.ab.mat4.create();r.ab.mat4.translate(x,x,u),r.ab.mat4.scale(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,p)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,t/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((n-u)/p,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),S=Math.max((t[2]-_)/Math.cos(u),x),C=this._zoomFromMercatorZ(S);r.ab.vec3.scaleAndAdd(t,t,n,S),this._pitch=r.aw(u,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(p,-Math.PI,Math.PI),this._setZoom(r.aw(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,u=r.bY,p=0,_=1/0;for(;u-n>1e-6&&u>n;){const x=n+.5*(u-n),S=this.tileSize*Math.pow(2,x),C=this.getCameraToCenterDistance(this.projection,x,S),R=this.scaleZoom(C/(t*this.tileSize)),D=Math.abs(x-R);D<_&&(_=D,p=x),x<R?n=x:u=x}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const u=Math.min(t.x,n.x),p=Math.max(t.x,n.x),_=Math.min(t.y,n.y),x=Math.max(t.y,n.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new r.P(u,_),new r.P(p,x),new r.P(u,x),new r.P(p,_)],C=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const D of S){const k=this.pointRayIntersection(D);if(k.t<0)return!0;const B=this.rayIntersectionCoordinate(k);if(B.x<C||B.y<0||B.x>R||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,n){const u=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+n;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,u,p],_){const x=[n,u,p,1];r.ab.vec4.transformMat4(x,x,_);const S=x[3]=Math.max(x[3],1e-6);return x[0]/=S,x[1]/=S,x[2]/=S,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,u=this.worldSize){const p=r.b$(t,n,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,u,p);let x=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(x=Md(1,x,Uu(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Qo=(c,t)=>{if(t>0&&c.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=c.transform,u=Math.max(Math.abs(n._zoom-(c.minCutoffZoom-1)),1),p=n.isLODDisabled(!1)?r.ac(60,45,n.pitch):r.ac(30,15,n.pitch),_=n._farZ-n._nearZ,x=t*n.height,S=((1-(C=p))*n.cameraToCenterDistance+C*(n._farZ+x))*u;var C;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(S-n._nearZ)/_,(S-x-n._nearZ)/_]}}},ur={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class zo{constructor(t,n){this.aabb=t,this.lastCascade=n}}class Ad{add(t,n){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],n.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],n.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],n.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],n.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],n.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],n.max[2])):this.receivers[t.key]=new zo(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,u){const p=r.cd.fromPoints(t.points);let _=0;for(const x in this.receivers){const S=this.receivers[x];if(!S||!p.intersectsAabb(S.aabb))continue;S.aabb.min=p.closestPoint(S.aabb.min),S.aabb.max=p.closestPoint(S.aabb.max);const C=S.aabb.getCorners();for(let R=0;R<u.length;R++){let D=!0;for(const k of C){const B=[k[0]*n,k[1]*n,k[2]];if(r.ab.vec3.transformMat4(B,B,u[R].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){D=!1;break}}if(S.lastCascade=R,_=Math.max(_,R),D)break}}return _+1}}class wa{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ad,this._depthMode=new Kt(t.context.gl.LEQUAL,Kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ur,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ur,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ur,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const p=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((Z,q)=>{const Y=u.style._mergedLayers[q];return Z+(Y.hasShadowPass()&&!Y.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=u.context,x=ur.shadowMapResolution,S=ur.shadowMapResolution;if(this._cascades.length===0||ur.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<ur.cascadeCount;++Z){const q=u._shadowMapDebug,Y=_.gl,X=_.createFramebuffer(x,S,q,"texture"),te=new r.T(_,{width:x,height:S,data:null},Y.DEPTH_COMPONENT16);if(X.depthAttachment.set(te.texture),q){const le=new r.T(_,{width:x,height:S,data:null},Y.RGBA8);X.colorAttachment.set(le.texture)}this._cascades.push({framebuffer:X,texture:te,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=Sa(n);let C=0;if(t.elevation){const Z=t.elevation,q=[1e4,-1e4];Z.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{const X=Y.dem.tree;q[0]=Math.min(q[0],X.minimums[0]),q[1]=Math.max(q[1],X.maximums[0])}),q[0]!==1e4&&(C=(q[1]-q[0])*Z.exaggeration())}const R=1.5*t.cameraToCenterDistance,D=3*R,k=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const q=this._cascades[Z];let Y=t.height/50,X=1;ur.cascadeCount===1?X=D:Z===0?X=R:(Y=R,X=D);const[te,le]=xy(t,this.shadowDirection,Y,X,ur.shadowMapResolution,C);q.scale=t.scale,q.matrix=te,q.boundingSphereRadius=le,r.ab.mat4.invert(k,q.matrix),q.frustum=r.bR.fromInvProjectionMatrix(k,1,0,!0),q.far=X}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ur.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ur.shadowMapResolution,this._uniformValues.u_shadowmap_0=vr.ShadowMap0,this._uniformValues.u_shadowmap_1=vr.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=u.transform.elevation;for(const Z of this._groundShadowTiles){let q={min:0,max:0};if(U){const Y=U.getMinMaxForTile(Z);Y&&(q=Y)}this.addShadowReceiver(Z.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,ur.shadowMapResolution,ur.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:r.aj.white,depth:1});for(const x of t.order){const S=t._mergedLayers[x];if(!S.hasShadowPass()||S.isHidden(u.transform.zoom))continue;const C=t.getLayerSourceCache(S),R=C?n[C.id]:void 0;(S.type==="model"||R&&R.length)&&u.renderLayer(u,C,S,R)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,u=t.context,p=n.directionalLight,_=n.ambientLight;if(!p||!_)return;const x=[],S=Qo(t,t.longestCutoffRange);S.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const C=Id(n,p,_),R=new Kt(u.gl.LEQUAL,Kt.ReadOnly,t.depthRangeFor3D);for(const D of this._groundShadowTiles){const k=D.toUnwrapped(),B=t.isTileAffectedByFog(D),U=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:B});this.setupShadows(k,U),t.uploadCommonUniforms(u,U,k,null,S);const Z={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:C};U.draw(t,u.gl.TRIANGLES,R,oi.disabled,Ei.multiply,li.disabled,Z,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ei.unblended:Ei.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,u=n.calculatePosMatrix(t,n.worldSize);return r.ab.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return r.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,u,p=0){if(!this.enabled)return;const _=this.painter.transform,x=this.painter.context,S=x.gl,C=this._uniformValues,R=new Float64Array(16),D=_.calculatePosMatrix(t,_.worldSize);for(let k=0;k<this._cascades.length;k++)r.ab.mat4.multiply(R,this._cascades[k].matrix,D),C[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),x.activeTexture.set(S.TEXTURE0+vr.ShadowMap0+k),this._cascades[k].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const k=r.cc(t.canonical),B=2/_.tileSize*r.ag/ur.shadowMapResolution,U=B*this._cascades[0].boundingSphereRadius,Z=B*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));C.u_shadow_normal_offset=[k,U*q,Z*q],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(x,C)}setupShadowsFromMatrix(t,n,u=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,x=this._uniformValues,S=new Float64Array(16);for(let C=0;C<ur.cascadeCount;C++)r.ab.mat4.multiply(S,this._cascades[C].matrix,t),x[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),p.activeTexture.set(_.TEXTURE0+vr.ShadowMap0+C),this._cascades[C].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const C=ur.normalOffset;x.u_shadow_normal_offset=[1,C,C],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(p,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,u,p){if(p[2]>=0)return{};const _=function(C,R,D){const k=D/(1<<C.canonical.z);return new r.cd([C.canonical.x*k+C.wrap*D,C.canonical.y*k+C.wrap*D,0],[(C.canonical.x+1)*k+C.wrap*D,(C.canonical.y+1)*k+C.wrap*D,R])}(t,n,u).getCorners(),x=n/-p[2];p[0]<0?(r.ab.vec3.add(_[0],_[0],[p[0]*x,0,0]),r.ab.vec3.add(_[3],_[3],[p[0]*x,0,0])):p[0]>0&&(r.ab.vec3.add(_[1],_[1],[p[0]*x,0,0]),r.ab.vec3.add(_[2],_[2],[p[0]*x,0,0])),p[1]<0?(r.ab.vec3.add(_[0],_[0],[0,p[1]*x,0]),r.ab.vec3.add(_[1],_[1],[0,p[1]*x,0])):p[1]>0&&(r.ab.vec3.add(_[2],_[2],[0,p[1]*x,0]),r.ab.vec3.add(_[3],_[3],[0,p[1]*x,0]));const S={};return S.vertices=_,S.planes=[Ta(_[1],_[0],_[4]),Ta(_[2],_[1],_[5]),Ta(_[3],_[2],_[6]),Ta(_[0],_[3],_[7])],S}addShadowReceiver(t,n,u){this._receivers.add(t,r.cd.fromTileIdAndHeight(t,n,u))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function Ta(c,t,n){const u=r.ab.vec3.sub([],n,t),p=r.ab.vec3.sub([],c,t),_=r.ab.vec3.cross([],u,p),x=r.ab.vec3.length(_);return x===0?[0,0,1,0]:(r.ab.vec3.scale(_,_,1/x),[_[0],_[1],_[2],-r.ab.vec3.dot(_,t)])}function Sa(c){const t=c.properties.get("direction"),n=r.cb(t.x,t.y,t.z);n[2]=r.aw(n[2],0,75);const u=r.ce([n[0],n[1],n[2]]);return r.ab.vec3.fromValues(u.x,u.y,u.z)}function Id(c,t,n){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),_=t.properties.get("intensity"),x=t.properties.get("direction"),S=[x.x,x.y,x.z],C=n.properties.get("color-use-theme")==="none",R=n.properties.get("color"),D=n.properties.get("intensity"),k=Math.max(r.ab.vec3.dot([0,0,1],S),0),B=[0,0,0];r.ab.vec3.scale(B,R.toRenderColor(C?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),D);const U=[0,0,0];return r.ab.vec3.scale(U,p.toRenderColor(u?null:c.getLut(n.scope)).toArray01Linear().slice(0,3),k*_),r.cf([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function xy(c,t,n,u,p,_){const x=c.zoom,S=c.scale,C=c.worldSize,R=1/C,D=c.aspect,k=Math.sqrt(1+D*D)*Math.tan(.5*c.fovX),B=k*k,U=u-n,Z=u+n;let q,Y;B>U/Z?(q=u,Y=u*k):(q=.5*Z*(1+B),Y=.5*Math.sqrt(U*U+2*(u*u+n*n)*B+Z*Z*B*B));const X=c.projection.pixelsPerMeter(c.center.lat,C),te=c._camera.getCameraToWorldMercator(),le=[0,0,-q*R];r.ab.vec3.transformMat4(le,le,te);let ae=Y*R;const me=c._edgeInsets;if(!(me.left===0&&me.top===0&&me.right===0&&me.bottom===0||me.left===me.right&&me.top===me.bottom)){const bt=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?X:1),nt=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,n,u);nt[8]=2*-c.centerOffset.x/c.width,nt[9]=2*c.centerOffset.y/c.height;const et=new Float64Array(16);r.ab.mat4.mul(et,nt,bt);const ft=new Float64Array(16);r.ab.mat4.invert(ft,et);const xt=r.bR.fromInvProjectionMatrix(ft,C,x,!0);for(const Rt of xt.points){const Bt=((he=Rt)[0]/=S,he[1]/=S,he[2]=r.bH(he[2],c._center.lat),he);ae=Math.max(ae,r.ab.vec3.len(r.ab.vec3.subtract([],le,Bt)))}}var he;ae*=p/(p-1);const fe=Math.acos(t[2]),ue=Math.atan2(-t[0],-t[1]),xe=new qr;xe.position=le,xe.setPitchBearing(fe,ue);const Me=xe.getWorldToCamera(C,X),$e=ae*C,ke=Math.min(c._mercatorZfromZoom(17)*C*-2,-2*$e),Qe=xe.getCameraToClipOrthographic(-$e,$e,-$e,$e,ke,($e+_*X)/t[2]),Ke=new Float64Array(16);r.ab.mat4.multiply(Ke,Qe,Me);const Pe=r.ab.vec3.fromValues(Math.floor(1e6*le[0])/1e6*C,Math.floor(1e6*le[1])/1e6*C,0),Ze=.5*p,lt=[0,0,0];r.ab.vec3.transformMat4(lt,Pe,Ke),r.ab.vec3.scale(lt,lt,Ze);const Ce=[Math.floor(lt[0]),Math.floor(lt[1]),Math.floor(lt[2])],tt=[0,0,0];r.ab.vec3.sub(tt,lt,Ce),r.ab.vec3.scale(tt,tt,-1/Ze);const We=new Float64Array(16);return r.ab.mat4.identity(We),r.ab.mat4.translate(We,We,tt),r.ab.mat4.multiply(Ke,We,Ke),[Ke,$e]}class Cd extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return r.aM(this.requestManager.transformRequest(n,r.R.Model).url).then(u=>{if(!u)return;const p=r.aN(u),_=new r.aO(t,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${n}: ${u.message}`)))})}load(t,n,u={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const p=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+p.length;const _=[];for(const x of p)_.push(this.loadModel(x,t[x]));Promise.allSettled(_).then(x=>{for(let S=0;S<x.length;S++){const{status:C,value:R}=x[S];if(C==="fulfilled"&&R){const D=this.models[n][p[S]];this.models[n][p[S]]={model:R,numReferences:u.keepNumReferences&&D?D.numReferences:1}}}this.numModelsLoading[n]-=p.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(x=>{this.fire(new r.y(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.modelUris[u][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[u][t]},u)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u=this.modelUris[n];for(const p in t)this.models[n][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u={};for(const p of t)this.hasModel(p,n)?this.models[n][p].numReferences++:(this.modelUris[n][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[n][p]);this.load(u,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const u=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const u in this.models[n])this.models[n][u].model&&this.models[n][u].model.upload(t.context)}}const vy=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),sm={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Pd(c){return c=c||{},Object.assign(c,sm)}class Rd extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,S){const[C,R]=x,{center:D,radius:k}=S,[B,U]=D,Z=Math.abs(C-B);return Math.sqrt((Z>180?360-Z:Z)**2+(R-U)**2)<=k}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new r.P(this._map.transform.width/2,this._map.transform.height/2),p=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(t?p:u,n);_.length>0&&(this._selectedFloorplan&&_[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=_[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(_){const[[x,S],[C,R]]=_,D=(C-x+360)%360,k=D>180?360-D:D;return{center:[(x+k/2+360)%360,(S+R)/2],radius:Math.sqrt(k**2+(R-S)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const _ of this._indoorData.levels)_.id===this._selectedLevel.id&&(p=_.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),n){const _=this._indoorData.buildings.find(x=>x.id===n);this._buildingSelected(_,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const _=this._indoorData.levels.find(x=>x.id===u);this._updateLevels(_,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new r.z("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(n,!0)}this.fire(new r.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(R){const D=R.indexOf("/floor/");if(D===-1)return R;const k=D+7,B=R.indexOf("/",k);return B===-1?R.slice(k):R.slice(k,B)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],_={},x={},S={},C={};for(const R of this._indoorData.levels)if(p.push(R.id),_[R.id]=R.height,x[R.id]=R.base,t){if(this.mergeFloors){const D=u(t.id),k=u(R.id);S[R.id]=k===D?"true":"false"}else S[R.id]=R.id===t.id?"true":"false";C[R.id]=R.base<t.base?"true":"false"}else C[R.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",C]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const R=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),D=this._map.getZoom(),k=R.zoom?Math.abs(D-R.zoom):0;this._map.fitBounds(t.extent,k>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:D})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,n);if(p.length>0){for(const _ of p)if(JSON.parse(_.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=_,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function by(c){if(!c.metadata||!c.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:n,top:u,width:p,height:_}=c.metadata.content_area,x=n*t,S=u*t;return[x,S,x+p*t,S+_*t]}function om(c){if(c)return c.map(([t,n])=>[t*r.q.devicePixelRatio,n*r.q.devicePixelRatio])}const Ea=(c,t)=>eo(c,t&&t.filter(n=>n.identifier!=="source.canvas")),wy=r.ay(Mi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),am=r.ay(Mi,["setCenter","setZoom","setBearing","setPitch"]),Dd=new Set(["background","sky","slot","custom"]),xc={version:8,layers:[],sources:{}},lm={duration:300,delay:0};class Ss extends r.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=r.l({},lm),this._buildingIndex=new nm(this),this.crossTileSymbolIndex=new Sd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Be,this.dispatcher=n.dispatcher?n.dispatcher:new r.D(r.ci(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new _t(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new r.cj(t._requestManager,n.localFontFamily?r.ck.all:n.localIdeographFontFamily?r.ck.ideographs:r.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new Cd(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const u=this;this._rtlTextPluginCallback=Ss.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,x)=>{if(r.cm(_),x&&x.every(S=>S))for(const S in u._sourceCaches){const C=u._sourceCaches[S],R=C.getSource().type;R!=="vector"&&R!=="geojson"||C.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===_.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const n=r.cn(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${r.co(JSON.stringify(t))}`}_diffStyle(t,n,u){this.globalId=this._getGlobalId(t);const p=(_,x)=>{try{x(null,this.setState(_,u))}catch(S){x(S,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(_,r.R.Style);r.n(x,(S,C)=>{S?this.fire(new r.y(S)):C&&p(C,n)})}else typeof t=="object"&&p(t,n)}loadURL(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"}));const u=typeof n.validate=="boolean"?n.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const _=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(_,(x,S)=>{if(this._request=null,x)this.fire(new r.y(x));else if(S)return this.importsCache.set(t,S),this._load(S,u)})}loadJSON(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(xc,!1)}_loadImports(t,n,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const x=this._createFragmentStyle(_),S=new Promise(D=>{x.once("style.import.load",D),x.once("error",D)}).then(()=>this.mergeAll());if(p.push(S),this.resolvedImports.has(_.url)){x.loadEmpty();continue}const C=_.data||this.importsCache.get(_.url);C?(x.loadJSON(C,{validate:n}),this._isInternalStyle(C)&&(x.globalId=null)):_.url?x.loadURL(_.url,{validate:n}):x.loadEmpty();const R={style:x,id:_.id,config:_.config};if(u){const D=this.fragments.findIndex(({id:k})=>k===u);this.fragments=this.fragments.slice(0,D).concat(R).concat(this.fragments.slice(D))}else this.fragments.push(R)}return Promise.allSettled(p)}getImportGlobalIds(t=this,n=new Set){for(const u of t.fragments)u.style.globalId&&n.add(u.style.globalId),this.getImportGlobalIds(u.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?r.aC(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[n];(t.config||p)&&(u=r.l({},t.config,p));const _=new Ss(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const u=t.indoor?Pd(t.schema):t.schema;if(this._isInternalStyle(t)){const x=r.l({},xc,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,n)}if(this.updateConfig(this._config,u),n&&Ea(this,Wr(t)))return;this._loaded=!0,this.stylesheet=r.cp(t);const p=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const x=zu(this.stylesheet.layers);if(this._order=x.map(R=>R.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new $(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $(this.stylesheet.light)),this._layers={};for(const R of x){const D=r.cu(R,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const k=this.getOwnLayerSourceCache(D),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&D.canCastShadows()&&B&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new r.z(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const x=this._evaluateColorThemeData(_);this._loadColorTheme(x).then(()=>{p()}).catch(S=>{r.w(`Couldn't load color theme from the stylesheet: ${S}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,u,p,_,x,S,C,R,D;const k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(n=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(u=B.directionalLight);p=this._prioritizeTerrain(p,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(_=B.fog),B.stylesheet.snow&&B.snow!=null&&(x=B.snow),B.stylesheet.rain&&B.rain!=null&&(S=B.rain),B.stylesheet.camera!=null&&(D=B.stylesheet.camera),B.stylesheet.projection!=null&&(C=B.stylesheet.projection),B.stylesheet.transition!=null&&(R=B.stylesheet.transition),k[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=u,this.fog=_,this.snow=x,this.rain=S,this._styleColorThemeForScope=k,p===null?delete this.terrain:this.terrain=p,this.camera=D||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=r.l({},lm,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=u=>{for(const p of u.fragments)n(p.style);t(u)};n(this)}_prioritizeTerrain(t,n,u){const p=t&&t.drapeRenderMode===0;return u===null?n&&n.drapeRenderMode===0?n:p?t:null:n!=null&&(!t||p||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},u={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const x=r.aC(_,p.scope);t[x]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const x=r.aC(_,p.scope);n[x]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const x=r.aC(_,p.scope);u[x]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},n=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const x of _._order){const S=_._layers[x];if(S.type==="slot"){const C=r.cq(x);if(t[C])continue;t[C]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):n.push(S)}}),this._mergedOrder=[];const p=(_=[])=>{for(const x of _)if(x.type==="slot"){const S=r.cq(x.id);t[S]&&p(t[S]),this._mergedSlots.push(S)}else{const S=r.aC(x.id,x.scope);this._mergedOrder.push(S),u[S]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};p(n),this._mergedOrder.sort((_,x)=>{const S=u[_],C=u[x];return S.hasInitialOcclusionOpacityProperties?C.is3D()?1:0:S.is3D()&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,u,p){const _=r.l({},u);for(const S of Object.keys(r.a3.colorTheme))_[S]===void 0&&(_[S]=r.a3.colorTheme[S].default);const x=new r.a4(vy,n,new Map(p));return x.setTransitionOrValue(_,p),x.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let x=t;x.startsWith(_)||(x=_+x);const S="mapbox-reserved-lut",C=new Image;C.src=x,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void u();this._styleColorTheme.lutLoading=!1;const{width:R,height:D,data:k}=r.q.getImageData(C);if(D>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==D*D)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new r.r({width:R,height:D},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(S,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,u,p){let _,x,S;const C=r.q.devicePixelRatio>1?"@2x":"";let R=r.n(u.transformRequest(u.normalizeSpriteURL(n,C,".json"),r.R.SpriteJSON),(B,U)=>{R=null,S||(S=B,_=U,k())}),D=r.o(u.transformRequest(u.normalizeSpriteURL(n,C,".png"),r.R.SpriteImage),(B,U)=>{D=null,S||(S=B,x=U,k())});function k(){if(S)p(S);else if(_&&x){const B=r.q.getImageData(x),U={};for(const Z in _){const{width:q,height:Y,x:X,y:te,sdf:le,pixelRatio:ae,stretchX:me,stretchY:he,content:fe}=_[Z],ue=new r.r({width:q,height:Y});r.r.copy(B,ue,{x:X,y:te},{x:0,y:0},{width:q,height:Y},null),U[Z]={data:ue,pixelRatio:ae,sdf:le,stretchX:me,stretchY:he,content:fe,usvg:!1}}p(null,U)}}return{cancel(){R&&(R.cancel(),R=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,(n,u)=>{if(this._spriteRequest=null,n)this.fire(new r.y(n));else if(u)for(const p in u)this.imageManager.addImage(p,this.scope,u[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(_,x)=>{if(this._spriteRequest=null,_)n?this._loadSprite(t):this.fire(new r.y(_));else if(x)for(const S in x)this.imageManager.addImage(S,this.scope,x[S]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),r.R.Iconset),(_,x)=>{if(_)return void p(_);const S={},C=r.cg(new r.bh(x));for(const R of C.icons){const D={version:1,pixelRatio:r.q.devicePixelRatio,content:by(R),stretchX:R.metadata?om(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?om(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};S[R.name]=D}p(null,S)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const u=t.sourceLayer;u&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.y(new Error(`Source layer "${u}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const u=this.fragments[n];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const u=this._sourceCaches[n].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const n=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&n.push(p.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const x of _){const S=t.getDefaultProgramParams(x,n.zoom,this._styleColorTheme.lut);S&&(u.style=this,this.fog&&(u._fogVisible=!0,S.overrideFog=!0,u.getOrCreateProgram(x,S)),u._fogVisible=!1,S.overrideFog=!1,u.getOrCreateProgram(x,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,u.getOrCreateProgram(x,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const S in x){const{updatedIds:C,removedIds:R}=x[S];(C||R)&&(this._updateWorkerLayers(S,C,R),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const x in this._mergedSourceCaches){const S=this._mergedSourceCaches[x];_[x]=S.used,S.used=!1,S.tileCoverLift=0}for(const x of this._mergedOrder){const S=this._mergedLayers[x];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const C=this.getLayerSourceCache(S);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();for(const x in _){const S=this._mergedSourceCaches[x];_[x]!==S.used&&S.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:n?p._serializeLayers(n):[],scope:t,removedIds:u||[],options:p.options})}setState(t,n){if(this._checkLoaded(),Ea(this,Wr(t)))return!1;(t=r.cp(t)).layers=zu(t.layers);const u=function(x,S){if(!x)return[{command:Mi.setStyle,args:[S]}];let C=[];try{if(!r.bn(x.version,S.version))return[{command:Mi.setStyle,args:[S]}];if(r.bn(x.center,S.center)||C.push({command:Mi.setCenter,args:[S.center]}),r.bn(x.zoom,S.zoom)||C.push({command:Mi.setZoom,args:[S.zoom]}),r.bn(x.bearing,S.bearing)||C.push({command:Mi.setBearing,args:[S.bearing]}),r.bn(x.pitch,S.pitch)||C.push({command:Mi.setPitch,args:[S.pitch]}),r.bn(x.sprite,S.sprite)||C.push({command:Mi.setSprite,args:[S.sprite]}),r.bn(x.glyphs,S.glyphs)||C.push({command:Mi.setGlyphs,args:[S.glyphs]}),r.bn(x.imports,S.imports)||function(U=[],Z=[],q){Z=Z||[];const Y=(U=U||[]).map(Er),X=Z.map(Er),te=U.reduce(Co,{}),le=Z.reduce(Co,{}),ae=Y.slice();let me,he,fe,ue;for(me=0,he=0;me<Y.length;me++)fe=Y[me],le.hasOwnProperty(fe)?he++:(q.push({command:Mi.removeImport,args:[fe]}),ae.splice(ae.indexOf(fe,he),1));for(me=0,he=0;me<X.length;me++)fe=X[X.length-1-me],ae[ae.length-1-me]!==fe&&(te.hasOwnProperty(fe)?(q.push({command:Mi.removeImport,args:[fe]}),ae.splice(ae.lastIndexOf(fe,ae.length-he),1)):he++,ue=ae[ae.length-me],q.push({command:Mi.addImport,args:[le[fe],ue]}),ae.splice(ae.length-me,0,fe));for(const xe of Z){const Me=te[xe.id];Me&&!r.bn(Me,xe)&&q.push({command:Mi.updateImport,args:[xe.id,xe]})}}(x.imports,S.imports,C),r.bn(x.transition,S.transition)||C.push({command:Mi.setTransition,args:[S.transition]}),r.bn(x.light,S.light)||C.push({command:Mi.setLight,args:[S.light]}),r.bn(x.fog,S.fog)||C.push({command:Mi.setFog,args:[S.fog]}),r.bn(x.snow,S.snow)||C.push({command:Mi.setSnow,args:[S.snow]}),r.bn(x.rain,S.rain)||C.push({command:Mi.setRain,args:[S.rain]}),r.bn(x.projection,S.projection)||C.push({command:Mi.setProjection,args:[S.projection]}),r.bn(x.lights,S.lights)||C.push({command:Mi.setLights,args:[S.lights]}),r.bn(x.camera,S.camera)||C.push({command:Mi.setCamera,args:[S.camera]}),!r.bn(x["color-theme"],S["color-theme"]))return[{command:Mi.setStyle,args:[S]}];const R={},D=[];(function(U,Z,q,Y){let X;for(X in Z=Z||{},U=U||{})U.hasOwnProperty(X)&&(Z.hasOwnProperty(X)||ya(X,q,Y));for(X in Z){if(!Z.hasOwnProperty(X))continue;const te=Z[X];U.hasOwnProperty(X)?r.bn(U[X],te)||(U[X].type==="geojson"&&te.type==="geojson"&&Xi(U,Z,X)?q.push({command:Mi.setGeoJSONSourceData,args:[X,te.data]}):Vt(X,Z,q,Y)):Lu(X,Z,q)}})(x.sources,S.sources,D,R);const k=[];x.layers&&x.layers.forEach(U=>{U.source&&R[U.source]?C.push({command:Mi.removeLayer,args:[U.id]}):k.push(U)});let B=x.terrain;B&&R[B.source]&&(C.push({command:Mi.setTerrain,args:[void 0]}),B=void 0),C=C.concat(D),r.bn(B,S.terrain)||C.push({command:Mi.setTerrain,args:[S.terrain]}),function(U,Z,q){Z=Z||[];const Y=(U=U||[]).map(Er),X=Z.map(Er),te=U.reduce(Co,{}),le=Z.reduce(Co,{}),ae=Y.slice(),me=Object.create(null);let he,fe,ue,xe,Me,$e,ke;for(he=0,fe=0;he<Y.length;he++)ue=Y[he],le.hasOwnProperty(ue)?fe++:(q.push({command:Mi.removeLayer,args:[ue]}),ae.splice(ae.indexOf(ue,fe),1));for(he=0,fe=0;he<X.length;he++)ue=X[X.length-1-he],ae[ae.length-1-he]!==ue&&(te.hasOwnProperty(ue)?(q.push({command:Mi.removeLayer,args:[ue]}),ae.splice(ae.lastIndexOf(ue,ae.length-fe),1)):fe++,$e=ae[ae.length-he],q.push({command:Mi.addLayer,args:[le[ue],$e]}),ae.splice(ae.length-he,0,ue),me[ue]=!0);for(he=0;he<X.length;he++)if(ue=X[he],xe=te[ue],Me=le[ue],!me[ue]&&!r.bn(xe,Me))if(r.bn(xe.source,Me.source)&&r.bn(xe["source-layer"],Me["source-layer"])&&r.bn(xe.type,Me.type)){for(ke in ki(xe.layout,Me.layout,q,ue,null,Mi.setLayoutProperty),ki(xe.paint,Me.paint,q,ue,null,Mi.setPaintProperty),r.bn(xe.slot,Me.slot)||q.push({command:Mi.setSlot,args:[ue,Me.slot]}),r.bn(xe.filter,Me.filter)||q.push({command:Mi.setFilter,args:[ue,Me.filter]}),r.bn(xe.minzoom,Me.minzoom)&&r.bn(xe.maxzoom,Me.maxzoom)||q.push({command:Mi.setLayerZoomRange,args:[ue,Me.minzoom,Me.maxzoom]}),xe)xe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?ki(xe[ke],Me[ke],q,ue,ke.slice(6),Mi.setPaintProperty):r.bn(xe[ke],Me[ke])||q.push({command:Mi.setLayerProperty,args:[ue,ke,Me[ke]]}));for(ke in Me)Me.hasOwnProperty(ke)&&!xe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?ki(xe[ke],Me[ke],q,ue,ke.slice(6),Mi.setPaintProperty):r.bn(xe[ke],Me[ke])||q.push({command:Mi.setLayerProperty,args:[ue,ke,Me[ke]]}))}else q.push({command:Mi.removeLayer,args:[ue]}),$e=ae[ae.lastIndexOf(ue)+1],q.push({command:Mi.addLayer,args:[Me,$e]})}(k,S.layers,C)}catch(R){console.warn("Unable to compute style diff:",R),C=[{command:Mi.setStyle,args:[S]}]}return C}(this.serialize(),t).filter(x=>!(x.command in am));if(u.length===0)return!1;const p=u.filter(x=>!(x.command in wy));if(p.length>0)throw new Error(`Unimplemented: ${p.map(x=>x.command).join(", ")}.`);const _=[];return u.forEach(x=>{_.push(this[x.command].apply(this,x.args))}),n&&Promise.all(_).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n,u=!1){this.imageManager.updateImage(t,this.scope,n),u&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,u={}){return this._checkLoaded(),this._validate(sc,`models.${t}`,n,null,u)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Mo,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=Fr(t,n,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=x=>{const S=(x?"symbol:":"other:")+p.id,C=r.aC(S,this.scope),R=this._sourceCaches[S]=new ws(C,p,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=R,R.onAdd(this.map)};_(!1),n.type!=="vector"&&n.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const u=this.getOwnSourceCaches(t);for(const p of u){const _=r.cq(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const u=this.getOwnSourceCache(n);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const u=t[n]._tiles;for(const p in u){const _=u[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const p of t){if(this._validate(tl,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(n)}else this.ambientLight=new ii(p,Tt||(Tt=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(n)}else this.directionalLight=new ii(p,St||(St=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new r.a8(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const u=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),_=t.properties.get("intensity"),x=t.properties.get("direction"),S=1-r.cb(x.x,x.y,x.z)[2]/90,C=u(p)*_*S,R=n.properties.get("color").toRenderColor(null).toArray01(),D=n.properties.get("intensity"),k=u(R)*D;return Number(((C+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(r.cr(t)){const n=r.cs(t),u=this.fragments.find(({id:_})=>_===n);if(!u)throw new Error(`Style import '${t}' not found`);const p=r.cq(t);return u.style.getFragmentStyle(p)}{const n=this.fragments.find(({id:u})=>u===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},u=(p,_="")=>`${p}::${_}`;this._featuresetSelectors={};for(const p in t){const _=this._featuresetSelectors[p]=[];for(const x of t[p].selectors){if(x.featureNamespace){const C=this.getOwnLayer(x.layer);if(!C){r.w(`Layer is undefined for selector: ${x.layer}`);continue}const R=u(C.source,C.sourceLayer);if(R in n&&n[R]!==x.featureNamespace){r.w(`"featureNamespace ${x.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}n[R]=x.featureNamespace}let S;if(x.properties)for(const C in x.properties){const R=r.U(x.properties[C]);R.result==="success"&&(S=S||{},S[C]=R.value)}_.push({layerId:x.layer,namespace:x.featureNamespace,properties:S,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const u=[];for(const p in n.stylesheet.featuresets)u.push({featuresetId:p,importId:n.scope?n.scope:void 0});return u}getFeaturesetLayers(t,n){const u=this.getFragmentStyle(n),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const x of p[t].selectors){const S=u.getOwnLayer(x.layer);S&&_.push(S)}return _}getConfigProperty(t,n){const u=this.getFragmentStyle(t);if(!u)return null;const p=r.aC(n,u.scope),_=u.options.get(p),x=_?_.value||_.default:null;return x?x.serialize():null}setConfigProperty(t,n,u){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.indoor?Pd(p.stylesheet.schema):p.stylesheet.schema;if(!_||!_[n])return;const x=r.U(u);if(x.result!=="success")return void Ea(this,x.value);const S=x.value.expression,C=r.aC(n,p.scope),R=p.options.get(C);if(!R)return;let D;const{minValue:k,maxValue:B,stepValue:U,type:Z,values:q}=_[n],Y=r.U(_[n].default);Y.result==="success"&&(D=Y.value.expression),D?(this.options.set(C,Object.assign({},R,{value:S,default:D,minValue:k,maxValue:B,stepValue:U,type:Z,values:q})),this.updateConfigDependencies(n)):this.fire(new r.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const u=n.stylesheet.schema;if(!u)return null;const p={};for(const _ in u){const x=r.aC(_,n.scope),S=n.options.get(x),C=S?S.value||S.default:null;p[_]=C?C.serialize():null}return p}setConfig(t,n){const u=this.getFragmentStyle(t);u&&(u.updateConfig(n,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=n,u.updateConfig(u._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const u in n){let p,_;const x=r.U(n[u].default);if(x.result==="success"&&(p=x.value.expression),t&&t[u]!==void 0){const B=r.U(t[u]);B.result==="success"&&(_=B.value.expression)}const{minValue:S,maxValue:C,stepValue:R,type:D,values:k}=n[u];if(p){const B=r.aC(u,this.scope);this.options.set(B,{default:p,value:_,minValue:S,maxValue:C,stepValue:R,type:D,values:k})}else this.fire(new r.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const u=this.getLayer(n);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const u=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(u){const p=n._evaluateColorThemeData(u);(!n._styleColorTheme.lut&&p!==""||n._styleColorTheme.lut&&p!==n._styleColorTheme.lut.data)&&n.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new r.y(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(Ea(this,r.ct(t)))return;_=r.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=r.cp(t),t=r.l(t,{source:p})),this._validate(Cu,`layers.${p}`,t,{arrayIndex:-1},u))return;_=r.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let x=this._order.length;if(n){const D=this._order.indexOf(n);if(D===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));_.slot===this._layers[n].slot?x=D:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const S=this.getOwnLayerSourceCache(_),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&_.canCastShadows()&&C&&(S.castsShadows=!0);const R=this._changes.getRemovedLayer(_);if(R&&_.source&&S&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const D=r.aC(_.source,_.scope);R.type!==_.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===n)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(n){const x=this._order.indexOf(n);if(x===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));u.slot===this._layers[n].slot?_=x:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const p=this.getOwnLayerSourceCache(n);if(p&&p.castsShadows){let _=!1;for(const x in this._layers)if(this._layers[x].source===n.source&&this._layers[x].canCastShadows()){_=!0;break}p.castsShadows=_}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==n&&(u.slot=n,this._updateLayer(u))}setFilter(t,n,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!r.bn(p.filter,n))return n==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Wn,`layers.${p.id}.filter`,n,{layerType:p.type},u)||(p.filter=r.cp(n),this._updateLayer(p)))}getFilter(t){const n=this._checkLayer(t);if(n)return r.cp(n.filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!r.bn(_.getLayoutProperty(n),u)){if(u!=null&&(!p||p.validate!==!1)&&Ea(_,Pu.call(Wr,{key:`layers.${t}.layout.${n}`,layerType:_.type,objectKey:n,value:u,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(n,u),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,n){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(n)}setPaintProperty(t,n,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||r.bn(_.getPaintProperty(n),u)||u!=null&&(!p||p.validate!==!1)&&Ea(_,rc.call(Wr,{key:`layers.${t}.paint.${n}`,layerType:_.type,objectKey:n,value:u,styleSpec:r.a3})))return;const x=_.setPaintProperty(n,u);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),x&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,n){const u=this._checkLayer(t);if(u)return u.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,D=this.getFragmentStyle(R),k=D.getFeaturesetLayers(C);for(const{source:B,sourceLayer:U}of k)D.setFeatureState({id:t.id,source:B,sourceLayer:U},n)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.setFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},n)}return}const u=t.source,p=t.sourceLayer,_=this._checkSource(u);if(!_)return;const x=_.type;if(x==="geojson"&&p)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!p)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(u);for(const C of S)C.setFeatureState(p,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,D=this.getFragmentStyle(R),k=D.getFeaturesetLayers(C);for(const{source:B,sourceLayer:U}of k)D.removeFeatureState({id:t.id,source:B,sourceLayer:U},n)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.removeFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},n)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const _=p.type,x=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(u);for(const C of S)C.removeFeatureState(x,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:x,importId:S}=t.target,C=this.getFragmentStyle(S),R=C.getFeaturesetLayers(x);for(const{source:D,sourceLayer:k}of R){const B=C.getFeatureState({id:t.id,source:D,sourceLayer:k});if(B&&!_)_=B;else if(!r.bn(_,B))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,S=this.getLayer(x);_=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return _}const n=t.source,u=t.sourceLayer,p=this._checkSource(n);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(u,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),u=r.aC(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=S=>this._mergedLayers[S].is3D(),u=this.order,p={},_=[];for(let S=u.length-1;S>=0;S--){const C=u[S];if(n(C)){p[C]=S;for(const R of t){const D=R[C];if(D)for(const k of D)_.push(k)}}}_.sort((S,C)=>C.intersectionZ-S.intersectionZ);const x=[];for(let S=u.length-1;S>=0;S--){const C=u[S];if(n(C))for(let R=_.length-1;R>=0;R--){const D=_[R].feature;if(D.layer&&p[D.layer.id]<S)break;x.push(D),_.pop()}else for(const R of t){const D=R[C];if(D)for(const k of D)x.push(k.feature)}}return x}queryRenderedFeatures(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(Wn,"queryRenderedFeatures.filter",n.filter,null,n),p=r.aZ(n.filter));const _={},x=D=>{if(Dd.has(D.type))return;const k=this.getOwnLayerSourceCache(D),B=_[k.id]=_[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};D.is3D()&&(B.has3DLayers=!0),B.layers[D.fqid]=B.layers[D.fqid]||{styleLayer:D,targets:[]},B.layers[D.fqid].targets.push({filter:p})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const D of n.layers){const k=this._layers[D];if(!k)return this.fire(new r.y(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];x(k)}}else for(const D in this._layers)x(this._layers[D]);const S=this._queryRenderedFeatures(t,_,u),C=this._flattenAndSortRenderedFeatures(S),R=[];for(const D of C)r.cs(D.layer.id)===this.scope&&R.push(D);return R}queryRenderedFeatureset(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(Wn,"queryRenderedFeatures.filter",n.filter,null,n),p=r.aZ(n.filter));const _="mock",x=[];if(n&&n.target)x.push(Object.assign({},n,{targetId:_,filter:p}));else{const D=this.getFeaturesetDescriptors();for(const k of D)x.push({targetId:_,filter:p,target:k});for(const{style:k}of this.fragments){const B=k.getFeaturesetDescriptors();for(const U of B)x.push({targetId:_,filter:p,target:U})}}const S=this.queryRenderedTargets(t,x,u),C=[],R=new Set;for(const D of S)for(const k of D.variants[_])Ao(k,D,R)||C.push(new r.cw(D,k));return C}queryRenderedTargets(t,n,u){const p={},_=(S,C,R,D)=>{const k=p[C.id]=p[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(k.layers[S.fqid]=k.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D()&&(k.has3DLayers=!0),!D)return R.uniqueFeatureID=!1,void k.layers[S.fqid].targets.push(R);k.layers[S.fqid].targets.push(Object.assign({},R,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const S of n)if("featuresetId"in S.target){const{featuresetId:C,importId:R}=S.target,D=this.getFragmentStyle(R);if(!D||!D._featuresetSelectors)continue;const k=D._featuresetSelectors[C];if(!k){this.fire(new r.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of k){const U=D.getOwnLayer(B.layerId);U&&!Dd.has(U.type)&&_(U,D.getOwnLayerSourceCache(U),S,B)}}else if("layerId"in S.target){const{layerId:C}=S.target,R=this.getLayer(C);if(!R||Dd.has(R.type))continue;_(R,this.getLayerSourceCache(R),S)}const x=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,n,u){const p=[],_=!!this.map._showQueryGeometry,x=ei.createFromScreenPoints(t,u);for(const S in n){const C=ac(x,n[S],this._availableImages,u,_);Object.keys(C).length&&p.push(C)}if(this.placement)for(const S in n){if(!n[S].sourceCache._onlySymbols)continue;const C=hd(x.screenGeometry,n[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(C).length&&p.push(C)}return p}querySourceFeatures(t,n){const u=n&&n.filter;u&&this._validate(Wn,"querySourceFeatures.filter",u,null,n);let p=[];const _=this.getOwnSourceCaches(t);for(const x of _)p=p.concat(tm(x,n));return p}addSourceType(t,n,u){return Ss.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Ss.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,u={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const S in t)if(!r.bn(t[S],p[S])){_=!0;break}if(!_)return;const x=this._getTransitionParameters();this.light.setLight(t,n,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const S="terrain-dem-src";this.addSource(S,u.source),u=r.cp(u),u=r.l(u,{source:S})}const _=r.l({},u),x={};if(this.terrain&&p){_.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(x.style=S.serialize())}if(this._validate(il,"terrain",_,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&n!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,n),this.fire(new r.z("data",{dataType:"style"}))}else{const _=this.terrain,x=_.get();for(const S of Object.keys(r.a3.terrain))!u.hasOwnProperty(S)&&r.a3.terrain[S].default&&(u[S]=r.a3.terrain[S].default);for(const S in t)if(!r.bn(t[S],x[S])){_.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});_.updateTransitions(C),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new Ne(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createSnow(t){const n=this.snow=new Yt(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createRain(t){const n=this.rain=new ti(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(n);this._loadColorTheme(u).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(p=>{r.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=n,u._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):n.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const u=this.terrain=new J(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,u,p,_={}){if(_&&_.validate===!1)return!1;const x=r.l({},this.serialize());return Ea(this,t.call(Wr,r.l({key:n,style:x,value:u,styleSpec:r.a3},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const u of n)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const u of n)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=Sa(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,u,p,_,x,S=!1){let C=!1,R=!1;const D={},k={};for(const B of this._mergedOrder){const U=this._mergedLayers[B];if(U.type!=="symbol")continue;const Z=r.aC(U.source,U.scope);let q=D[Z];if(!q){const X=this.getLayerSourceCache(U);if(!X)continue;const te=X.getRenderableIds(!0).map(le=>X.getTileByID(le));k[Z]=te.slice(),q=D[Z]=te.sort((le,ae)=>ae.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(ae.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(U,q,n.center.lng,n.projection);C=C||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),n.zoom))&&(this.pauseablePlacement=new _y(n,this._mergedOrder,S,u,p,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C){this._buildingIndex.onNewFrame(n.zoom);for(let B=0;B<this._mergedOrder.length;B++){const U=this._mergedLayers[this._mergedOrder[B]];if(U.type!=="symbol")continue;const Z=this.isLayerClipped(U);this.placement.updateLayerOpacities(U,D[r.aC(U.source,U.scope)],B,Z?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:_})=>_===n);return p===-1&&this.fire(new r.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==u[p].url&&this.setImportUrl(t,n.url),r.bn(n.config,u[p].config)||this.setImportConfig(t,n.config,n.data.schema),r.bn(n.data,u[p].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(n);if(_===-1)return this;const x=u[p],S=this.fragments[p];return u=u.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=u.slice(0,_).concat(x).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(S).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=n;const _=this.fragments[p];return _.style=this._createFragmentStyle(u[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:n?(this.fragments[u].style.setState(n),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,n,u){this._checkLoaded();const p=this.getImportIndex(t),_=this.stylesheet.imports||[];if(p===-1)return this;n?_[p].config=n:delete _[p].config;const x=this.fragments[p];u&&x.style.stylesheet&&(x.style.stylesheet.schema=u);const S=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=n,x.style.updateConfig(n,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(n.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return n===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[n];u&&t.push(u.getSource())}return t}getSource(t,n){const u=this.getSourceCache(t,n);return u&&u.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const u=r.aC(t,n);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const n=r.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const u=t[n];u==="reload"?this.reloadSource(n):u==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const u of n){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getImages(t,n,u){this.imageManager.getImages(n.icons,n.scope,u),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(n.tileID.key,n.type,n.icons)};p(this._otherSourceCaches[n.source]),p(this._symbolSourceCaches[n.source])}rasterizeImages(t,n,u){this.imageManager.rasterizeImages(n,u)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,n.scope,u)}getResource(t,n,u){return r.cy(n,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(u||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ss.getSourceType=function(c){return er[c]},Ss.setSourceType=function(c,t){er[c]=t},Ss.registerForPluginStateChange=r.ch;var ju=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,vc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Gu=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ea="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",qu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,zd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ma=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,al=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,bc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,wc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Aa=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ia=[];Ca(ju,Ia),Ca(Gu,Ia),Ca(vc,Ia);const ll={"_prelude_fog.vertex.glsl":zd,"_prelude_terrain.vertex.glsl":qu,"_prelude_shadow.vertex.glsl":wc,"_prelude_fog.fragment.glsl":Ma,"_prelude_shadow.fragment.glsl":Aa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":al,"_prelude_raster_particle.glsl":bc},Tc={};Di("",qu),Di(Ma,zd),Di(Aa,wc),Di(al,""),Di(bc,"");const Hu=Di(vc,Gu),Sc=ju;var cl={background:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Di("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Di("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Di("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Di(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Di(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Di(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Di("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Di("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Di(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Di(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Di("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Di(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxGradient:Di(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxCapture:Di(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Di(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Di(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Di("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Di("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Di("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Di("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ca(c,t){const n=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of n)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function Di(c,t){const n=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(R=>{const D=R.split(" ");return D[D.length-1]}),p=[...new Set(p)]);const _={},x=[],S=[];if(c=c.replace(n,(R,D)=>(S.push(D),"")),(t=t.replace(n,(R,D)=>(x.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...Ia];Ca(c,C),Ca(t,C);for(const R of[...x,...S])ll[R]||console.error(`Undefined include: ${R}`),Tc[R]||(Tc[R]=[],Ca(ll[R],Tc[R])),C=[...C,...Tc[R]];return{fragmentSource:c=c.replace(u,(R,D,k,B,U)=>(_[U]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${k} ${B} ${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = u_${U};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${k} ${B} ${U};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(R,D,k,B,U)=>{const Z=B==="float"?"vec2":B,q=U.match(/color/)?"color":Z;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${k} ${B} a_${U};
#endif
`:_[U]?D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${k} ${Z} a_${U};
out ${k} ${B} ${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:D==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${k} ${B} a_${U};
    out ${k} ${B} ${U};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${k} ${Z} a_${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:D==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${k} ${B} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${Z} a_${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${k} ${B} ${U} = a_${U};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = a_${U};
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);
#else
    ${k} ${B} ${U} = u_${U};
#endif
`}),staticAttributes:p,usedDefines:C,vertexIncludes:x,fragmentIncludes:S}}class cm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,u,p,_,x,S,C){this.context=t;let R=this.boundPaintVertexBuffers.length!==p.length;for(let k=0;!R&&k<p.length;k++)this.boundPaintVertexBuffers[k]!==p[k]&&(R=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!D&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(D=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||R||D||this.boundIndexBuffer!==_||this.boundVertexOffset!==x)this.freshBind(n,u,p,_,x,S,C);else{t.bindVertexArrayOES.set(this.vao);for(const k of S)k&&(k.bind(),C&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,n,C));_&&_.dynamicDraw&&_.bind()}}freshBind(t,n,u,p,_,x,S){const C=t.numAttributes,R=this.context,D=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=x,n.enableAttributes(D,t),n.bind(),n.setVertexAttribPointers(D,t,_);for(const k of u)k.enableAttributes(D,t),k.bind(),k.setVertexAttribPointers(D,t,_);for(const k of x)k&&(k.enableAttributes(D,t),k.bind(),k.setVertexAttribPointers(D,t,_),S&&k.instanceCount&&k.setVertexAttribDivisor(D,t,S));p&&p.bind(),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ul(c,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new r.aa(0,u/n).toLngLat().lat,new r.aa(0,(u+1)/n).toLngLat().lat]}function um(c,t,n,u,p,_,x){const S=c.context,C=S.gl,R=n.hillshadeFBO;if(!R)return;c.prepareDrawTile();const D=c.isTileAffectedByFog(t),k=c.getOrCreateProgram("hillshade",{overrideFog:D});S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get());const B=((Y,X,te,le)=>{const ae=te.paint.get("hillshade-shadow-color"),me=te.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",he=te.paint.get("hillshade-highlight-color"),fe=te.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ue=te.paint.get("hillshade-accent-color"),xe=te.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Me=te.paint.get("hillshade-emissive-strength");let $e=r.ai(te.paint.get("hillshade-illumination-direction"));if(te.paint.get("hillshade-illumination-anchor")==="viewport")$e-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const Qe=Y.style.directionalLight.properties.get("direction"),Ke=r.cb(Qe.x,Qe.y,Qe.z);$e=r.ai(Ke[1])}const ke=!Y.options.moving;return{u_matrix:le||Y.transform.calculateProjMatrix(X.tileID.toUnwrapped(),ke),u_image:0,u_latrange:ul(0,X.tileID),u_light:[te.paint.get("hillshade-exaggeration"),$e],u_shadow:ae.toRenderColor(me?null:te.lut),u_highlight:he.toRenderColor(fe?null:te.lut),u_emissive_strength:Me,u_accent:ue.toRenderColor(xe?null:te.lut)}})(c,n,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(S,k,t.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:Z,tileBoundsSegments:q}=c.getTileBoundsBuffers(n);k.draw(c,C.TRIANGLES,p,_,x,li.disabled,B,u.id,U,Z,q)}function hm(c,t,n){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(n.stride);const _=n.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new r.T(u,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ty(c,t,n){const u=c.context,p=u.gl;if(!t.dem)return;const _=t.dem;if(u.activeTexture.set(p.TEXTURE1),hm(c,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const x=_.dim;u.activeTexture.set(p.TEXTURE0);let S=t.hillshadeFBO;if(!S){const B=new r.T(u,{width:x,height:x,data:null},p.RGBA8);B.bind(p.LINEAR,p.CLAMP_TO_EDGE),S=t.hillshadeFBO=u.createFramebuffer(x,x,!0,"renderbuffer"),S.colorAttachment.set(B.texture)}u.bindFramebuffer.set(S.framebuffer),u.viewport.set([0,0,x,x]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:D}=c.getMercatorTileBoundsBuffers(),k=[];c.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(c,p.TRIANGLES,Kt.disabled,oi.disabled,Ei.unblended,li.disabled,((B,U)=>{const Z=U.stride,q=r.ab.mat4.create();return r.ab.mat4.ortho(q,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(q,q,[0,-r.ag,0]),{u_matrix:q,u_image:1,u_dimension:[Z,Z],u_zoom:B.overscaledZ}})(t.tileID,_),n.id,C,R,D),t.needsHillshadePrepare=!1}class pn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ld extends pn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Od extends pn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class kd extends pn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Fd extends pn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class dm extends pn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class fm extends pn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Sy extends pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ec extends pn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Mc extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class pm extends pn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xr extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Bd extends pn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class $u extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Zu extends pn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Nd extends pn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vd extends pn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Wu extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Ud extends pn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class jd extends pn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Xu=class extends pn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class mm extends pn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _m extends pn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hl extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ey extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class My extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ay extends pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Iy extends pn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cy extends pn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Py extends pn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Gd extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qd extends pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Yu extends pn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class dl extends Yu{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Hd extends Yu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class gm extends Yu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ym extends Hd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $d=(c,t,n)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),ta=(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:n,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:x,u_frustum_tr:S,u_frustum_br:C,u_frustum_bl:R,u_globe_pos:D,u_globe_radius:k,u_viewport:B,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:Z});function Zd(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const ls=new class{constructor(){this.operations={}}newMorphing(c,t,n,u,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==n.tileID.key&&(_.queued=n)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:n,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const n=this.operations[t];for(n.phase=(c-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Ku={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ac(c,t,n){if(t===0)return 0;const u=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function xm(c,t){const n=1<<c.z;return!t&&(c.x===0||c.x===n-1)||c.y===0||c.y===n-1}const Ju=c=>({u_matrix:c});function Ic(c,t,n,u,p){if(p>0){const _=r.q.now(),x=(_-c.timeAdded)/p,S=t?(_-t.timeAdded)/p:-1,C=n.getSource(),R=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(c.tileID.overscaledZ-R),k=D&&c.refreshedUponExpiration?1:r.aw(D?x:1-S,0,1);return c.refreshedUponExpiration&&x>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Wd extends ws{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new r.D(r.ci(),null),p=Fr("mock-dem",n,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class Ry extends ws{constructor(t){const n=Fr("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.ci(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const S=new Yo(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[x.key]=S}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const u=Object.values(n);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xd extends r.aG{constructor(t,n,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=u}}class fl extends r.cJ{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=function(C){const R=new r.b4,D=new r.aU,k=131;R.reserve(17161),D.reserve(33800);const B=r.ag/128,U=r.ag+B/2,Z=U+B;for(let Y=-B;Y<Z;Y+=B)for(let X=-B;X<Z;X+=B){const te=X<0||X>U||Y<0||Y>U?24575:0,le=r.aw(Math.round(X),0,r.ag),ae=r.aw(Math.round(Y),0,r.ag);R.emplaceBack(le+te,ae)}const q=(Y,X)=>{const te=X*k+Y;D.emplaceBack(te+1,te,te+k),D.emplaceBack(te+k,te+k+1,te+1)};for(let Y=1;Y<129;Y++)for(let X=1;X<129;X++)q(X,Y);return[0,129].forEach(Y=>{for(let X=0;X<130;X++)q(X,Y),q(Y,X)}),[R,D,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(u,r.b6.members),this.gridIndexBuffer=x.createIndexBuffer(p),this.gridSegments=r.b7.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ry(n.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const S=x.gl;this._overlapStencilMode=new oi({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Wd(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const S=t.terrain&&t.terrain.scope,C=p.get("source"),R=_?this._mockSourceCache:t.getSourceCache(C,S);if(!R)return void r.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=R,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(n):p.get("exaggeration"),!n.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(n,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),n.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=n!=null?u-n:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(_);let S=_-this._previousZoom;const C=this._previousUpdateTimestamp;let R=_;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(_-R)>.5&&(S=.5*(_-R+S)),S*p<0&&(R+=S)),this._evaluationZoom=R;const D=x.getExaggeration(R),k=D===x.getExaggeration(Math.max(0,R-.1));if(k&&Math.abs(D-this._exaggeration)<.01)return D;let B=Math.min(.1,.00375*(this._updateTimestamp-C));return(k||D<.1||Math.abs(S)<1e-4)&&(B=Math.min(.2,4*B)),r.af(this._exaggeration,D,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=n.getIds().map(C=>{const R=n.getTileByID(C).tileID;return R.projMatrix=u.calculateProjMatrix(R.toUnwrapped()),R});(function(C,R){const D=R.transform.pointCoordinate(R.transform.getCameraPoint()),k=new r.P(D.x,D.y);C.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;const Z=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=new r.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=k.mult(1<<B.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(Z)-Y.distSqr(q)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const C in x){const R=x[C];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,t[C],_),R.usedForTerrain))continue;const D=t[C];R.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[n.id]=p.map(C=>new Xd(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const R=this.terrainTileForTile[C.key];if(!R)continue;const D=R.tileID.key;D in S||(this._visibleDemTiles.push(R),S[D]=D)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const u=this._findTileCoveringTileID(n,this.sourceCache);u&&(this.terrainTileForTile[n.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),hm(this.painter,p,_))}}_prepareDemTileUniforms(t,n,u,p){if(!n||n.demTexture==null)return!1;const _=t.tileID.canonical,x=Math.pow(2,n.tileID.canonical.z-_.z),S=p||"";return u[`u_dem_tl${S}`]=[_.x*x%1,_.y*x%1],u[`u_dem_scale${S}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&t++,u+_},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new r.cK({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new r.T(t,p,n.R32F,{premultiply:!1}),_}setupElevationDraw(t,n,u){const p=this.painter.context,_=p.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let S=null,C=null,R=1;if(u&&u.morphing&&this._useVertexMorphing){const U=u.morphing.srcDemTile,Z=u.morphing.dstDemTile;R=u.morphing.phase,U&&Z&&(this._prepareDemTileUniforms(t,U,x,"_prev")&&(C=U),this._prepareDemTileUniforms(t,Z,x)&&(S=Z))}const D=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let k=null;var B;if(this.enabled?C&&S?(k=S.demTexture,p.activeTexture.set(_.TEXTURE4),C.demTexture.bind(D(C),_.CLAMP_TO_EDGE),x.u_dem_lerp=R):(S=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,S,x)?S.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),k&&(x.u_dem_size=(B=k).size[0]===1?1:B.size[0]-2,k.bind(D(S),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,n,x),u&&u.useMeterToDem&&S){const U=(1<<S.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=U}if(u&&u.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),n.setTerrainUniformValues(p,x),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);n.setGlobeUniformValues(p,U)}}globeUniformValues(t,n,u){const p=t.projection;return{u_tile_tl_up:p.upVector(n,0,0),u_tile_tr_up:p.upVector(n,r.ag,0),u_tile_br_up:p.upVector(n,r.ag,r.ag),u_tile_bl_up:p.upVector(n,0,r.ag),u_tile_up_scale:u?r.cL(1):p.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,x,S,C){if(p.transform.projection.name==="globe")(function(R,D,k,B,U){const Z=R.context,q=Z.gl;let Y,X;const te=R.transform,le=r.cC(R,Z,te),ae=(Qe,Ke)=>{if(X===Ke)return;const Pe=[Ku[Ke],"PROJECTION_GLOBE_VIEW"];le&&Pe.push("CUSTOM_ANTIALIASING");const Ze=R.isTileAffectedByFog(Qe);Y=R.getOrCreateProgram("globeRaster",{defines:Pe,overrideFog:Ze}),X=Ke},me=R.colorModeForRenderPass(),he=new Kt(q.LEQUAL,Kt.ReadWrite,R.depthRangeFor3D);ls.update(U);const fe=r.cD(te),ue=[r.at(te.center.lng),r.aA(te.center.lat)],xe=R.globeSharedBuffers,Me=[te.width*r.q.devicePixelRatio,te.height*r.q.devicePixelRatio],$e=Float32Array.from(te.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const Qe=R.transform,Ke=Ac(Qe.zoom,D.exaggeration(),D.sourceCache._source.tileSize);X=-1;const Pe=q.TRIANGLES;for(const Ze of B){const lt=k.getTile(Ze),Ce=oi.disabled,tt=D.prevTerrainTileForTile[Ze.key],We=D.terrainTileForTile[Ze.key];Zd(tt,We)&&ls.newMorphing(Ze.key,tt,We,U,250),Z.activeTexture.set(q.TEXTURE0),lt.texture&&lt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const bt=ls.getMorphValuesForProxy(Ze.key),nt=bt?1:0;bt&&r.J(ke,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:r.cB(bt.phase)}});const et=r.cE(Ze.canonical),ft=r.cF(et.getCenter().lat),xt=r.cG(Ze.canonical,et,ft,Qe.worldSize/Qe._pixelsPerMercatorPixel),Rt=r.bb(r.cH(Ze.canonical)),Bt=ta(Qe.expandedFarZProjMatrix,$e,fe,Rt,r.ae(Qe.zoom),ue,Qe.frustumCorners.TL,Qe.frustumCorners.TR,Qe.frustumCorners.BR,Qe.frustumCorners.BL,Qe.globeCenterInViewSpace,Qe.globeRadius,Me,Ke,Qe._farZ,xt);if(ae(Ze,nt),Y&&(D.setupElevationDraw(lt,Y,ke),R.uploadCommonUniforms(Z,Y,Ze.toUnwrapped()),xe)){const[si,Xt,Jt]=xe.getGridBuffers(ft,Ke!==0);Y.draw(R,Pe,he,Ce,me,li.backCCW,Bt,"globe_raster",si,Xt,Jt)}}}if(xe&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&Qe.push("CUSTOM_ANTIALIASING"),Y=R.getOrCreateProgram("globeRaster",{defines:Qe});for(const Ke of B){const{x:Pe,y:Ze,z:lt}=Ke.canonical,Ce=Ze===0,tt=Ze===(1<<lt)-1,[We,bt,nt,et]=xe.getPoleBuffers(lt,!1);if(et&&(Ce||tt)){const ft=k.getTile(Ke);Z.activeTexture.set(q.TEXTURE0),ft.texture&&ft.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let xt=r.cI(lt,Pe,te);const Rt=r.bb(r.cH(Ke.canonical)),Bt=(si,Xt)=>si.draw(R,q.TRIANGLES,he,oi.disabled,me,li.disabled,ta(te.expandedFarZProjMatrix,xt,xt,Rt,0,ue,te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.globeCenterInViewSpace,te.globeRadius,Me,0,te._farZ),"globe_pole_raster",Xt,nt,et);D.setupElevationDraw(ft,Y,ke),R.uploadCommonUniforms(Z,Y,Ke.toUnwrapped()),Ce&&R.renderDefaultNorthPole&&Bt(Y,We),tt&&R.renderDefaultSouthPole&&(xt=r.ab.mat4.scale(r.ab.mat4.create(),xt,[1,-1,1]),Bt(Y,bt))}}}})(p,_,x,S,C);else{const R=p.context,D=R.gl;let k,B;const U=p.shadowRenderer,Z=Qo(p,p.longestCutoffRange),q=me=>{if(B===me)return;const he=[];he.push(Ku[me]),Z.shouldRenderCutoff&&he.push("RENDER_CUTOFF"),U&&(he.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&he.push("NORMAL_OFFSET")),k=p.getOrCreateProgram("terrainRaster",{defines:he}),B=me},Y=p.colorModeForRenderPass(),X=new Kt(D.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D);ls.update(C);const te=p.transform,le=Ac(te.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let ae=[0,0,0];if(U){const me=p.style.directionalLight,he=p.style.ambientLight;me&&he&&(ae=Id(p.style,me,he))}{B=-1;const me=D.TRIANGLES,[he,fe]=[_.gridIndexBuffer,_.gridSegments];for(const ue of S){const xe=x.getTile(ue),Me=oi.disabled,$e=_.prevTerrainTileForTile[ue.key],ke=_.terrainTileForTile[ue.key];Zd($e,ke)&&ls.newMorphing(ue.key,$e,ke,C,250),R.activeTexture.set(D.TEXTURE0),xe.texture&&xe.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Qe=ls.getMorphValuesForProxy(ue.key),Ke=Qe?1:0;let Pe;Qe&&(Pe={morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:r.cB(Qe.phase)}});const Ze=$d(ue.projMatrix,xm(ue.canonical,te.renderWorldCopies)?le/10:le,ae);if(q(Ke),!k)continue;_.setupElevationDraw(xe,k,Pe);const lt=ue.toUnwrapped();U&&U.setupShadows(lt,k),p.uploadCommonUniforms(R,k,lt,null,Z),k.draw(p,me,X,Me,Y,li.backCCW,Ze,"terrain_raster",_.gridBuffer,he,fe)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],x=this._drapedRenderBatches.shift(),S=n.style.order,C=[];let R=0;for(const D of _){const k=p.getTileByID(D.proxyTileKey),B=p.proxyCachedFBO[D.key]?p.proxyCachedFBO[D.key][t]:void 0,U=B!==void 0?p.renderCache[B]:this.pool[R++],Z=B!==void 0;if(k.texture=U.tex,Z&&!U.dirty){C.push(k.tileID);continue}let q;u.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(u.clear({color:r.aj.transparent,stencil:0}),U.dirty=!1);for(let Y=x.start;Y<=x.end;++Y){const X=n.style._mergedLayers[S[Y]];if(X.isHidden(n.transform.zoom))continue;const te=n.style.getLayerSourceCache(X),le=te?this.proxyToSource[D.key][te.id]:[D];if(!le)continue;const ae=le;u.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(te?te.id:null)&&(this._setupStencil(U,le,X,te),q=te?te.id:null),n.renderLayer(n,te,X,ae)}if(this._drapedRenderBatches.length===0)for(const Y of this._pendingGroundEffectLayers){const X=n.style._mergedLayers[S[Y]];if(X.isHidden(n.transform.zoom))continue;const te=n.style.getLayerSourceCache(X),le=te?this.proxyToSource[D.key][te.id]:[D];if(!le)continue;const ae=le;u.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(te?te.id:null)&&(this._setupStencil(U,le,X,te),q=te?te.id:null),n.renderLayer(n,te,X,ae)}this.renderedToTile?(U.dirty=!0,C.push(k.tileID)):Z||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let u=-1,p=n;for(let _=0;_<n;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?u=Math.max(u,_):p=Math.min(p,_);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,S=1<<x.overscaledZ,{x:C,y:R}=x.canonical,D=C/S,k=(C+1)/S,B=R/S,U=(R+1)/S;return{minx:D,miny:B,maxx:k,maxy:U,t:_.dem.tree.raycastRoot(D,B,k,U,t,n,u),tile:_}});p.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,n,u);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,n=t.gl,u=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const p=new r.T(t,{width:u[0],height:u[1],data:null},n.RGBA8);p.bind(n.LINEAR,n.CLAMP_TO_EDGE);const _=t.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new ym(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],u=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!u&&n.shouldRedrape():!u&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Fn){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(_&&!n[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof r.a9){n[_.id]=!0;for(const x of this.proxyCoords){const S=this.proxyToSource[x.key][_.id];if(S)for(const C of S)this._clearRenderCacheForTile(_.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof to){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(!_||n[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const x=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][_.id];if(C)for(const R of C){const D=Ic(_.getTile(R),_.findLoadedParent(R,0),_,this.painter.transform,x);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(_.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,_=0,x=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<n;)x=this._style._mergedLayers[t[_]];for(;_<n;++_){const S=this._style._mergedLayers[t[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?p===void 0&&(p=_):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(u.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:_-1}),u.length!==0){const S=u[u.length-1];this._pendingGroundEffectLayers.every(C=>C>S.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const x=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let S=0;S<x.length;++S){const C=Object.values(x[S]);n.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let x=u.length-1;x>=0;x--){const S=u[x];if(n.getTileByID(S.key),n.proxyCachedFBO[S.key]!==void 0){const C=t[S.key],R=this.proxyToSource[S.key];let D=0;for(const k in R){const B=R[k],U=C[k];if(!U||U.length!==B.length||B.some((Z,q)=>Z!==U[q]||p[k]&&p[k].hasOwnProperty(Z.key))){D=-1;break}++D}for(const k in n.proxyCachedFBO[S.key])n.renderCache[n.proxyCachedFBO[S.key][k]].dirty=D<0||D!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((x,S)=>S.end-S.start-(x.end-x.start));for(const x of _)for(const S of u){if(n.proxyCachedFBO[S.key])continue;let C=n.renderCachePool.pop();C===void 0&&n.renderCache.length<50&&(C=n.renderCache.length,n.renderCache.push(this._createFBO())),C!==void 0&&(n.proxyCachedFBO[S.key]={},n.proxyCachedFBO[S.key][x.start]=C,n.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let S;if(u.isTileClipped())S=n.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):oi.disabled}_renderTileClippingMasks(t,n){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(Ei.disabled),p.setDepthMode(Kt.disabled);const x=u.getOrCreateProgram("clippingMask");for(const S of t){const C=u._tileClippingMaskIDs[S.key]=--n;x.draw(u,_.TRIANGLES,Kt.disabled,new oi({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),Ei.disabled,li.disabled,Ju(S.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const u=[t.x,t.y,1,1];r.ab.vec4.transformMat4(u,u,n.pixelMatrixInverse),r.ab.vec4.scale(u,u,1/u[3]),u[0]/=n.worldSize,u[1]/=n.worldSize;const p=n._camera.position,_=r.bH(1,n.center.lat),x=[p[0],p[1],p[2]/_,0],S=r.ab.vec3.subtract([],u.slice(0,3),x);r.ab.vec3.normalize(S,S);const C=this.raycast(x,S,this._exaggeration);return C!==null&&C?(r.ab.vec3.scaleAndAdd(x,x,S,C),x[3]=x[2],x[2]*=_,x):null}_setupProxiedCoordsForOrtho(t,n,u){if(t.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(t,n,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let C=0;C<_.length;C++){const R=_[C],D=this._findTileCoveringTileID(R,t);if(D){const k=this._createProxiedId(R,D,u[R.key]&&u[R.key][t.id]);p.push(k),this.proxyToSource[R.key][t.id]=[k]}}let x=!1;const S=new Set;for(let C=0;C<n.length;C++){const R=t.getTile(n[C]);if(!R||!R.hasData())continue;const D=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==R.tileID.canonical.z){const k=this.proxyToSource[D.tileID.key][t.id],B=this._createProxiedId(D.tileID,R,u[D.tileID.key]&&u[D.tileID.key][t.id]);k?k.splice(k.length-1,0,B):this.proxyToSource[D.tileID.key][t.id]=[B];const U=this.proxyToSource[D.tileID.key][t.id];S.has(U)||S.add(U),p.push(B),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const C of S)C.sort((R,D)=>D.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,x=t.getSource(),S=x.tileID;if(!S)return;const C=new r.P(S.x,S.y)._div(1<<S.z),R=x.coordinates.map(r.aa.fromLngLat).reduce((k,B)=>(k.min.x=Math.min(k.min.x,B.x-C.x),k.min.y=Math.min(k.min.y,B.y-C.y),k.max.x=Math.max(k.max.x,B.x-C.x),k.max.y=Math.max(k.max.y,B.y-C.y),k),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(k,B)=>{const U=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z),q=r.ag/(1<<k.canonical.z),Y=B.wrap+B.canonical.x/(1<<B.canonical.z),X=B.canonical.y/(1<<B.canonical.z);return U+q<Y+R.min.x||U>Y+R.max.x||Z+q<X+R.min.y||Z>X+R.max.y};for(let k=0;k<_.length;k++){const B=_[k];for(let U=0;U<n.length;U++){const Z=t.getTile(n[U]);if(!Z||!Z.hasData()||D(B,Z.tileID))continue;const q=this._createProxiedId(B,Z,u[B.key]&&u[B.key][t.id]),Y=this.proxyToSource[B.key][t.id];Y?Y.push(q):this.proxyToSource[B.key][t.id]=[q],p.push(q)}}}_createProxiedId(t,n,u){let p=this.orthoMatrix;if(u){const _=u.find(x=>x.key===n.tileID.key);if(_)return _}if(n.tileID.key!==t.key){const _=t.canonical.z-n.tileID.canonical.z;let x,S,C;p=r.ab.mat4.create();const R=n.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(x=r.ag>>_,S=x*((n.tileID.canonical.x<<_)-t.canonical.x+R),C=x*((n.tileID.canonical.y<<_)-t.canonical.y)):(x=r.ag<<-_,S=r.ag*(n.tileID.canonical.x-(t.canonical.x+R<<-_)),C=r.ag*(n.tileID.canonical.y-(t.canonical.y<<-_))),r.ab.mat4.ortho(p,0,x,0,x,0,1),r.ab.mat4.translate(p,p,[S,C,0])}return new Xd(n.tileID,t.key,p)}_findTileCoveringTileID(t,n){let u=n.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[n.id],_=p[t.key];if(u=_?n.getTileByID(_):null,u&&u.hasData()||_===null)return u;let x=u?u.tileID:t,S=x.overscaledZ;const C=n.getSource().minzoom,R=[];if(!_){const k=n.getSource().maxzoom;if(t.canonical.z>=k){const B=t.canonical.z-k;n.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,n.transform.tileZoom),x=new r.aG(S,t.wrap,k,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(S=k,x=new r.aG(S,t.wrap,k,t.canonical.x>>B,t.canonical.y>>B))}x.key!==t.key&&(R.push(x.key),u=n.getTile(x))}const D=k=>{R.forEach(B=>{p[B]=k}),R.length=0};for(S-=1;S>=C&&(!u||!u.hasData());S--){u&&D(u.tileID.key);const k=x.calculateScaledKey(S);if(u=n.getTileByID(k),u&&u.hasData())break;const B=p[k];if(B===null)break;B===void 0?R.push(k):u=n.getTileByID(B)}return D(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[n.key]=!0}}function Dy(c,t,n){const u=function(S,C,R){const D=r.ab.vec3.dot(C,S),k=r.ab.vec3.dot(R,[.2126,.7152,.0722]),B=(Z,q,Y)=>(1-Y)*Z+Y*q,U=B(1-.3*Math.min(k,1),1,Math.min(D+1,1));return B(.92,1,Math.asin(r.aw(C[2],-1,1))/Math.PI+.5)*U}(c,[0,0,1],t),p=[0,0,0];r.ab.vec3.scale(p,n.slice(0,3),u);const _=[0,0,0];r.ab.vec3.scale(_,t.slice(0,3),c[2]);const x=[0,0,0];return r.ab.vec3.add(x,p,_),r.cf(x)}const zy=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class bm{static cacheKey(t,n,u,p){let _=`${n}${p?p.cacheKey:""}`;for(const x of u)t.usedDefines.includes(x)&&(_+=`/${x}`);return _}constructor(t,n,u,p,_,x){const S=t.gl;this.program=S.createProgram(),this.configuration=p,this.name=n,this.fixedDefines=[...x];const C=p?p.getBinderAttributes():[],R=(u.staticAttributes||[]).concat(C);let D=p?p.defines():[];D=D.concat(x.map(Y=>`#define ${Y}`));const k=`#version 300 es
`;let B=k+D.concat("precision mediump float;",Sc,Hu.fragmentSource).join(`
`);for(const Y of u.fragmentIncludes)B+=`
${ll[Y]}`;B+=`
${u.fragmentSource}`;let U=k+D.concat("precision highp float;",Sc,Hu.vertexSource).join(`
`);for(const Y of u.vertexIncludes)U+=`
${ll[Y]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const Z=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Z,B),S.compileShader(Z),S.attachShader(this.program,Z);const q=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(q,U),S.compileShader(q),S.attachShader(this.program,q),this.attributes={},this.numAttributes=R.length;for(let Y=0;Y<this.numAttributes;Y++)if(R[Y]){const X=R[Y].startsWith("a_")?R[Y]:`a_${R[Y]}`;S.bindAttribLocation(this.program,Y,X),this.attributes[X]=Y}S.linkProgram(this.program),S.deleteShader(q),S.deleteShader(Z),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new r.bN(Y)}))(t)),(x.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(Y=>({u_dem:new r.bN(Y),u_dem_prev:new r.bN(Y),u_dem_tl:new r.bK(Y),u_dem_scale:new r.bM(Y),u_dem_tl_prev:new r.bK(Y),u_dem_scale_prev:new r.bM(Y),u_dem_size:new r.bM(Y),u_dem_lerp:new r.bM(Y),u_exaggeration:new r.bM(Y),u_depth:new r.bN(Y),u_depth_size_inv:new r.bK(Y),u_depth_range_unpack:new r.bK(Y),u_occluder_half_size:new r.bM(Y),u_occlusion_depth_offset:new r.bM(Y),u_meter_to_dem:new r.bM(Y),u_label_plane_matrix_inv:new r.bJ(Y)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new r.bL(Y),u_tile_tr_up:new r.bL(Y),u_tile_br_up:new r.bL(Y),u_tile_bl_up:new r.bL(Y),u_tile_up_scale:new r.bM(Y)}))(t)),x.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new r.bJ(Y),u_fog_range:new r.bK(Y),u_fog_color:new r.ca(Y),u_fog_horizon_blend:new r.bM(Y),u_fog_vertical_limit:new r.bK(Y),u_fog_temporal_offset:new r.bM(Y),u_frustum_tl:new r.bL(Y),u_frustum_tr:new r.bL(Y),u_frustum_br:new r.bL(Y),u_frustum_bl:new r.bL(Y),u_globe_pos:new r.bL(Y),u_globe_radius:new r.bM(Y),u_globe_transition:new r.bM(Y),u_is_globe:new r.bN(Y),u_viewport:new r.bK(Y)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new r.ca(Y)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new r.bL(Y),u_lighting_directional_dir:new r.bL(Y),u_lighting_directional_color:new r.bL(Y),u_ground_radiance:new r.bL(Y)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new r.bJ(Y),u_light_matrix_1:new r.bJ(Y),u_fade_range:new r.bK(Y),u_shadow_normal_offset:new r.bL(Y),u_shadow_intensity:new r.bM(Y),u_shadow_texel_size:new r.bM(Y),u_shadow_map_resolution:new r.bM(Y),u_shadow_direction:new r.bL(Y),u_shadow_bias:new r.bL(Y),u_shadowmap_0:new r.bN(Y),u_shadowmap_1:new r.bN(Y)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}_drawDebugWireframe(t,n,u,p,_,x,S,C,R,D){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const B=t.context;if(!(()=>!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!zy.includes(this.name))||!(!k.layers3D||!vm.includes(this.name)))())return;const U=B.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,B);if(!Z)return;const q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");const Y=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});B.program.set(Y.program);const X=(ae,me,he)=>{if(me[ae]&&he[ae])for(const fe in me[ae])he[ae][fe]&&he[ae][fe].set(he.program,fe,me[ae][fe].current)};R&&R.setUniforms(Y.program,B,Y.binderUniforms,S,{zoom:C}),X("fixedUniforms",this,Y),X("terrainUniforms",this,Y),X("globeUniforms",this,Y),X("fogUniforms",this,Y),X("lightsUniforms",this,Y),X("shadowUniforms",this,Y),Z.bind(),B.setColorMode(new Ei([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],r.aj.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Kt(n.func===U.LESS?U.LEQUAL:n.func,Kt.ReadOnly,n.range)),B.setStencilMode(oi.disabled);const te=3*x.primitiveLength*2,le=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ae=D||1;for(let me=0;me<ae;++me)Y.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),U.drawElements(U.LINES,te,U.UNSIGNED_SHORT,le)}else D&&D>1?U.drawElementsInstanced(U.LINES,te,U.UNSIGNED_SHORT,le,D):U.drawElements(U.LINES,te,U.UNSIGNED_SHORT,le);_.bind(),B.program.set(this.program),B.setDepthMode(n),B.setStencilMode(u),B.setColorMode(p)}checkUniforms(t,n,u){if(this.fixedDefines.includes(n)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${n} being defined`)}}draw(t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y){const X=t.context,te=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(u),X.setStencilMode(p),X.setColorMode(_),X.setCullFace(x);for(const me of Object.keys(this.fixedUniforms))this.fixedUniforms[me].set(this.program,me,S[me]);Z&&Z.setUniforms(this.program,X,this.binderUniforms,B,{zoom:U});const le={[te.POINTS]:1,[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[n];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ae=Y&&Y>0?1:void 0;for(const me of k.get()){const he=me.vaos||(me.vaos={});if((he[C]||(he[C]=new cm)).bind(X,this,R,Z?Z.getPaintVertexBuffers():[],D,me.vertexOffset,q||[],ae),this.forceManualRenderingForInstanceIDShaders){const fe=Y||1;for(let ue=0;ue<fe;++ue)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ue),D?te.drawElements(n,me.primitiveLength*le,te.UNSIGNED_SHORT,me.primitiveOffset*le*2):te.drawArrays(n,me.vertexOffset,me.vertexLength)}else Y&&Y>1?te.drawElementsInstanced(n,me.primitiveLength*le,te.UNSIGNED_SHORT,me.primitiveOffset*le*2,Y):D?te.drawElements(n,me.primitiveLength*le,te.UNSIGNED_SHORT,me.primitiveOffset*le*2):te.drawArrays(n,me.vertexOffset,me.vertexLength);n===te.TRIANGLES&&D&&this._drawDebugWireframe(t,u,p,_,D,me,B,U,Z,Y)}}}function Qu(c,t){const n=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,c.transform.tileZoom)/n,p=u*(t.tileID.canonical.x+t.tileID.wrap*n),_=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(t,1,c.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const pl={terrain:0,flat:1},ml=r.ab.mat4.create(),eh=(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X)=>{const te=t.style.light,le=te.properties.get("position"),ae=[le.x,le.y,le.z],me=r.ab.mat3.create();te.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(me,-t.transform.angle),r.ab.vec3.transformMat3(ae,ae,me));const he=te.properties.get("color"),fe=t.transform,ue={u_matrix:c,u_lightpos:ae,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+n,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ml,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:pl[R],u_base_type:pl[D],u_ao:p,u_edge_radius:_,u_width_scale:x,u_flood_light_color:Z,u_vertical_scale:q,u_flood_light_intensity:Y,u_ground_shadow_factor:X};return fe.projection.name==="globe"&&(ue.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ue.u_zoom_transition=k,ue.u_inv_rot_matrix=U,ue.u_merc_center=B,ue.u_up_dir=fe.projection.upVector(new r.bT(0,0,0),B[0]*r.ag,B[1]*r.ag),ue.u_height_lift=C),ue},Cc=(c,t,n,u,p,_)=>({u_matrix:c,u_edge_radius:t,u_width_scale:n,u_vertical_scale:u,u_height_type:pl[p],u_base_type:pl[_]}),wm=(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y)=>{const X=eh(c,t,n,u,p,_,x,S,R,D,k,B,U,Z,q,Y,1,[0,0,0]),te={u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8};return r.l(X,Qu(t,C),te)},Pc=(c,t)=>({u_matrix:c,u_emissive_strength:t}),Rc=(c,t,n,u)=>r.l(Pc(c,t),Qu(n,u)),Yd=(c,t,n)=>({u_matrix:c,u_world:n,u_emissive_strength:t}),Tm=(c,t,n,u,p)=>r.l(Rc(c,t,n,u),{u_world:p}),Ly=(c,t,n,u)=>{const p=r.ag/n.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Pa=(c,t,n=1)=>({u_matrix:c,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),th=r.ab.mat4.create(),Nt=(c,t,n,u,p,_,x)=>{const S=c.transform,C=S.projection.name==="globe",R=C?r.cN(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:r.ar(n,1,_),D={u_matrix:t.projMatrix,u_extrude_scale:R,u_intensity:x,u_inv_rot_matrix:th,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=u,D.u_merc_center=p,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=r.ae(S.zoom);const k=p[0]*r.ag,B=p[1]*r.ag;D.u_up_dir=S.projection.upVector(new r.bT(0,0,0),k,B)}return D};function Kd(c,[t,n,u,p],[_,x]){if(_===x)return[0,0,0,0];const S=255*(c-1)/(c*(x-_));return[t*S,n*S,u*S,p*S]}function Jd(c,t,[n,u]){return n===u?0:.5/c+(t-n)*(c-1)/(c*(u-n))}const ia=(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X,te,le,ae)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(k.paint.get("raster-saturation")),u_contrast_factor:r.cP(k.paint.get("raster-contrast")),u_spin_weights:Ra(k.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:C,u_colorization_mix:Kd(r.cQ,q,X),u_colorization_offset:Jd(r.cQ,Y,X),u_color_ramp:Z,u_texture_offset:[le/(te+2*le),te/(te+2*le)],u_texture_res:[te+2*le,te+2*le],u_emissive_strength:ae});function Ra(c){c*=Math.PI/180;const t=Math.sin(c),n=Math.cos(c);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const qt=.05,Qd=(c,t,n,u,p,_,x,S,C,R,D,k)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:x,u_merc_center:S,u_cutoff_params:C}),Oy=(c,t,n,u,p,_,x,S,C,R)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:u,u_color_ramp:_,u_velocity_res:p,u_max_speed:x,u_uv_offset:S,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[qt,qt]}),ky=(c,t,n,u,p,_,x,S,C,R)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:u,u_max_speed:p,u_speed_factor:_,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[qt,qt]}),ih=r.ab.mat4.create(),ef=(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X,te,le,ae,me)=>{const he=p.transform,fe={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:he.getCameraToCenterDistance(te),u_rotate_symbol:+n,u_aspect_ratio:he.width/he.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+R,u_elevation_from_sea:C?1:0,u_pitch_with_map:+u,u_texsize:D,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ih,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ih,u_up_vector:[0,-1,0],u_color_adj_mat:le,u_icon_transition:ae||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(te)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:+B,u_scale_factor:me||1};return te.name==="globe"&&(fe.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],fe.u_zoom_transition=Z,fe.u_inv_rot_matrix=Y,fe.u_merc_center=q,fe.u_camera_forward=he._camera.forward(),fe.u_ecef_origin=r.cR(he.globeMatrix,U.toUnwrapped()),fe.u_tile_matrix=Float32Array.from(he.globeMatrix),fe.u_up_vector=X),fe},tf=(c,t,n,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:n,u_color:u}),Sm=(c,t,n,u,p,_,x,S,C)=>r.l(function(R,D,k,B,U,Z){const{width:q,height:Y}=B.imageManager.getPixelSize(D),X=Math.pow(2,Z.tileID.overscaledZ),te=Z.tileSize*Math.pow(2,B.transform.tileZoom)/X,le=te*(Z.tileID.canonical.x+Z.tileID.wrap*X),ae=te*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[q,Y],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:U?[B.transform.width,-1*B.transform.height]:[1/r.ar(Z,1,B.transform.tileZoom),1/r.ar(Z,1,B.transform.tileZoom)],u_pixel_coord_upper:[le>>16,ae>>16],u_pixel_coord_lower:[65535&le,65535&ae]}}(0,_,x,u,S,C),{u_matrix:c,u_emissive_strength:t,u_opacity:n}),nf=new Float32Array(r.ab.mat4.identity([])),Dc=(c,t,n,u,p,_,x,S,C,R,D,k,B,U=[0,0,0],Z)=>{const q=p.style.light,Y=q.properties.get("position"),X=[-Y.x,-Y.y,Y.z],te=r.ab.mat3.create();q.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(te,-p.transform.angle),r.ab.vec3.transformMat3(X,X,te));const le=D.alphaMode==="MASK",ae=q.properties.get("color").toRenderColor(null),me=B.paint.get("model-ambient-occlusion-intensity"),he=B.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),fe=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:u||nf,u_lightpos:X,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:U,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+le,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:C,u_roughnessFactor:R,u_baseColorTexture:vr.BaseColor,u_metallicRoughnessTexture:vr.MetallicRoughness,u_normalTexture:vr.Normal,u_occlusionTexture:vr.Occlusion,u_emissionTexture:vr.Emission,u_lutTexture:vr.LUT,u_color_mix:[he.r,he.g,he.b,fe],u_aoIntensity:me,u_emissive_strength:k,u_occlusionTextureTransform:Z||[0,0,0,0]}},nh=(c,t=nf,n=nf)=>({u_matrix:c,u_instance:t,u_node_matrix:n}),rf={fillExtrusion:c=>({u_matrix:new r.bJ(c),u_lightpos:new r.bL(c),u_lightintensity:new r.bM(c),u_lightcolor:new r.bL(c),u_vertical_gradient:new r.bM(c),u_opacity:new r.bM(c),u_edge_radius:new r.bM(c),u_width_scale:new r.bM(c),u_ao:new r.bK(c),u_height_type:new r.bN(c),u_base_type:new r.bN(c),u_tile_id:new r.bL(c),u_zoom_transition:new r.bM(c),u_inv_rot_matrix:new r.bJ(c),u_merc_center:new r.bK(c),u_up_dir:new r.bL(c),u_height_lift:new r.bM(c),u_flood_light_color:new r.bL(c),u_vertical_scale:new r.bM(c),u_flood_light_intensity:new r.bM(c),u_ground_shadow_factor:new r.bL(c)}),fillExtrusionDepth:c=>({u_matrix:new r.bJ(c),u_edge_radius:new r.bM(c),u_width_scale:new r.bM(c),u_vertical_scale:new r.bM(c),u_height_type:new r.bN(c),u_base_type:new r.bN(c)}),fillExtrusionPattern:c=>({u_matrix:new r.bJ(c),u_lightpos:new r.bL(c),u_lightintensity:new r.bM(c),u_lightcolor:new r.bL(c),u_vertical_gradient:new r.bM(c),u_height_factor:new r.bM(c),u_edge_radius:new r.bM(c),u_width_scale:new r.bM(c),u_ao:new r.bK(c),u_height_type:new r.bN(c),u_base_type:new r.bN(c),u_tile_id:new r.bL(c),u_zoom_transition:new r.bM(c),u_inv_rot_matrix:new r.bJ(c),u_merc_center:new r.bK(c),u_up_dir:new r.bL(c),u_height_lift:new r.bM(c),u_image:new r.bN(c),u_texsize:new r.bK(c),u_pixel_coord_upper:new r.bK(c),u_pixel_coord_lower:new r.bK(c),u_tile_units_to_pixels:new r.bM(c),u_opacity:new r.bM(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new r.bJ(c),u_opacity:new r.bM(c),u_ao_pass:new r.bM(c),u_meter_to_tile:new r.bM(c),u_ao:new r.bK(c),u_flood_light_intensity:new r.bM(c),u_flood_light_color:new r.bL(c),u_attenuation:new r.bM(c),u_edge_radius:new r.bM(c),u_fb:new r.bN(c),u_fb_size:new r.bM(c),u_dynamic_offset:new r.bM(c)}),fill:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c)}),fillPattern:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c),u_image:new r.bN(c),u_texsize:new r.bK(c),u_pixel_coord_upper:new r.bK(c),u_pixel_coord_lower:new r.bK(c),u_tile_units_to_pixels:new r.bM(c)}),fillOutline:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c),u_world:new r.bK(c)}),fillOutlinePattern:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c),u_world:new r.bK(c),u_image:new r.bN(c),u_texsize:new r.bK(c),u_pixel_coord_upper:new r.bK(c),u_pixel_coord_lower:new r.bK(c),u_tile_units_to_pixels:new r.bM(c)}),circle:r.cS,collisionBox:c=>({u_matrix:new r.bJ(c),u_camera_to_center_distance:new r.bM(c),u_extrude_scale:new r.bK(c)}),collisionCircle:c=>({u_matrix:new r.bJ(c),u_inv_matrix:new r.bJ(c),u_camera_to_center_distance:new r.bM(c),u_viewport_size:new r.bK(c)}),debug:c=>({u_color:new r.cz(c),u_matrix:new r.bJ(c),u_overlay:new r.bN(c),u_overlay_scale:new r.bM(c)}),clippingMask:c=>({u_matrix:new r.bJ(c)}),heatmap:c=>({u_extrude_scale:new r.bM(c),u_intensity:new r.bM(c),u_matrix:new r.bJ(c),u_inv_rot_matrix:new r.bJ(c),u_merc_center:new r.bK(c),u_tile_id:new r.bL(c),u_zoom_transition:new r.bM(c),u_up_dir:new r.bL(c)}),heatmapTexture:c=>({u_image:new r.bN(c),u_color_ramp:new r.bN(c),u_opacity:new r.bM(c)}),hillshade:c=>({u_matrix:new r.bJ(c),u_image:new r.bN(c),u_latrange:new r.bK(c),u_light:new r.bK(c),u_shadow:new r.cz(c),u_highlight:new r.cz(c),u_emissive_strength:new r.bM(c),u_accent:new r.cz(c)}),hillshadePrepare:c=>({u_matrix:new r.bJ(c),u_image:new r.bN(c),u_dimension:new r.bK(c),u_zoom:new r.bM(c)}),line:r.cT,linePattern:r.cU,raster:c=>({u_matrix:new r.bJ(c),u_normalize_matrix:new r.bJ(c),u_globe_matrix:new r.bJ(c),u_merc_matrix:new r.bJ(c),u_grid_matrix:new r.cA(c),u_tl_parent:new r.bK(c),u_scale_parent:new r.bM(c),u_fade_t:new r.bM(c),u_opacity:new r.bM(c),u_image0:new r.bN(c),u_image1:new r.bN(c),u_brightness_low:new r.bM(c),u_brightness_high:new r.bM(c),u_saturation_factor:new r.bM(c),u_contrast_factor:new r.bM(c),u_spin_weights:new r.bL(c),u_perspective_transform:new r.bK(c),u_raster_elevation:new r.bM(c),u_zoom_transition:new r.bM(c),u_merc_center:new r.bK(c),u_cutoff_params:new r.ca(c),u_colorization_mix:new r.ca(c),u_colorization_offset:new r.bM(c),u_color_ramp:new r.bN(c),u_texture_offset:new r.bK(c),u_texture_res:new r.bK(c),u_emissive_strength:new r.bM(c)}),rasterParticle:c=>({u_matrix:new r.bJ(c),u_normalize_matrix:new r.bJ(c),u_globe_matrix:new r.bJ(c),u_merc_matrix:new r.bJ(c),u_grid_matrix:new r.cA(c),u_tl_parent:new r.bK(c),u_scale_parent:new r.bM(c),u_fade_t:new r.bM(c),u_opacity:new r.bM(c),u_image0:new r.bN(c),u_image1:new r.bN(c),u_raster_elevation:new r.bM(c),u_zoom_transition:new r.bM(c),u_merc_center:new r.bK(c),u_cutoff_params:new r.ca(c)}),rasterParticleTexture:c=>({u_texture:new r.bN(c),u_opacity:new r.bM(c)}),rasterParticleDraw:c=>({u_particle_texture:new r.bN(c),u_particle_texture_side_len:new r.bM(c),u_tile_offset:new r.bK(c),u_velocity:new r.bN(c),u_color_ramp:new r.bN(c),u_velocity_res:new r.bK(c),u_max_speed:new r.bM(c),u_uv_offset:new r.bK(c),u_data_scale:new r.bK(c),u_data_offset:new r.bM(c),u_particle_pos_scale:new r.bM(c),u_particle_pos_offset:new r.bK(c)}),rasterParticleUpdate:c=>({u_particle_texture:new r.bN(c),u_particle_texture_side_len:new r.bM(c),u_velocity:new r.bN(c),u_velocity_res:new r.bK(c),u_max_speed:new r.bM(c),u_speed_factor:new r.bM(c),u_reset_rate:new r.bM(c),u_rand_seed:new r.bM(c),u_uv_offset:new r.bK(c),u_data_scale:new r.bK(c),u_data_offset:new r.bM(c),u_particle_pos_scale:new r.bM(c),u_particle_pos_offset:new r.bK(c)}),symbol:c=>({u_is_size_zoom_constant:new r.bN(c),u_is_size_feature_constant:new r.bN(c),u_size_t:new r.bM(c),u_size:new r.bM(c),u_camera_to_center_distance:new r.bM(c),u_rotate_symbol:new r.bN(c),u_aspect_ratio:new r.bM(c),u_fade_change:new r.bM(c),u_matrix:new r.bJ(c),u_label_plane_matrix:new r.bJ(c),u_coord_matrix:new r.bJ(c),u_is_text:new r.bN(c),u_elevation_from_sea:new r.bN(c),u_pitch_with_map:new r.bN(c),u_texsize:new r.bK(c),u_texsize_icon:new r.bK(c),u_texture:new r.bN(c),u_texture_icon:new r.bN(c),u_gamma_scale:new r.bM(c),u_device_pixel_ratio:new r.bM(c),u_tile_id:new r.bL(c),u_zoom_transition:new r.bM(c),u_inv_rot_matrix:new r.bJ(c),u_merc_center:new r.bK(c),u_camera_forward:new r.bL(c),u_tile_matrix:new r.bJ(c),u_up_vector:new r.bL(c),u_ecef_origin:new r.bL(c),u_is_halo:new r.bN(c),u_icon_transition:new r.bM(c),u_color_adj_mat:new r.bJ(c),u_scale_factor:new r.bM(c)}),background:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c),u_opacity:new r.bM(c),u_color:new r.cz(c)}),backgroundPattern:c=>({u_matrix:new r.bJ(c),u_emissive_strength:new r.bM(c),u_opacity:new r.bM(c),u_image:new r.bN(c),u_pattern_tl:new r.bK(c),u_pattern_br:new r.bK(c),u_texsize:new r.bK(c),u_pattern_size:new r.bK(c),u_pixel_coord_upper:new r.bK(c),u_pixel_coord_lower:new r.bK(c),u_pattern_units_to_pixels:new r.bK(c)}),terrainRaster:c=>({u_matrix:new r.bJ(c),u_image0:new r.bN(c),u_skirt_height:new r.bM(c),u_ground_shadow_factor:new r.bL(c)}),skybox:c=>({u_matrix:new r.bJ(c),u_sun_direction:new r.bL(c),u_cubemap:new r.bN(c),u_opacity:new r.bM(c),u_temporal_offset:new r.bM(c)}),skyboxGradient:c=>({u_matrix:new r.bJ(c),u_color_ramp:new r.bN(c),u_center_direction:new r.bL(c),u_radius:new r.bM(c),u_opacity:new r.bM(c),u_temporal_offset:new r.bM(c)}),skyboxCapture:c=>({u_matrix_3f:new r.cA(c),u_sun_direction:new r.bL(c),u_sun_intensity:new r.bM(c),u_color_tint_r:new r.ca(c),u_color_tint_m:new r.ca(c),u_luminance:new r.bM(c)}),globeRaster:c=>({u_proj_matrix:new r.bJ(c),u_globe_matrix:new r.bJ(c),u_normalize_matrix:new r.bJ(c),u_merc_matrix:new r.bJ(c),u_zoom_transition:new r.bM(c),u_merc_center:new r.bK(c),u_image0:new r.bN(c),u_grid_matrix:new r.cA(c),u_skirt_height:new r.bM(c),u_far_z_cutoff:new r.bM(c),u_frustum_tl:new r.bL(c),u_frustum_tr:new r.bL(c),u_frustum_br:new r.bL(c),u_frustum_bl:new r.bL(c),u_globe_pos:new r.bL(c),u_globe_radius:new r.bM(c),u_viewport:new r.bK(c)}),globeAtmosphere:c=>({u_frustum_tl:new r.bL(c),u_frustum_tr:new r.bL(c),u_frustum_br:new r.bL(c),u_frustum_bl:new r.bL(c),u_horizon:new r.bM(c),u_transition:new r.bM(c),u_fadeout_range:new r.bM(c),u_color:new r.ca(c),u_high_color:new r.ca(c),u_space_color:new r.ca(c),u_temporal_offset:new r.bM(c),u_horizon_angle:new r.bM(c)}),model:c=>({u_matrix:new r.bJ(c),u_lighting_matrix:new r.bJ(c),u_normal_matrix:new r.bJ(c),u_node_matrix:new r.bJ(c),u_lightpos:new r.bL(c),u_lightintensity:new r.bM(c),u_lightcolor:new r.bL(c),u_camera_pos:new r.bL(c),u_opacity:new r.bM(c),u_baseColorFactor:new r.ca(c),u_emissiveFactor:new r.ca(c),u_metallicFactor:new r.bM(c),u_roughnessFactor:new r.bM(c),u_baseTextureIsAlpha:new r.bN(c),u_alphaMask:new r.bN(c),u_alphaCutoff:new r.bM(c),u_baseColorTexture:new r.bN(c),u_metallicRoughnessTexture:new r.bN(c),u_normalTexture:new r.bN(c),u_occlusionTexture:new r.bN(c),u_emissionTexture:new r.bN(c),u_lutTexture:new r.bN(c),u_color_mix:new r.ca(c),u_aoIntensity:new r.bM(c),u_emissive_strength:new r.bM(c),u_occlusionTextureTransform:new r.ca(c)}),modelDepth:c=>({u_matrix:new r.bJ(c),u_instance:new r.bJ(c),u_node_matrix:new r.bJ(c)}),groundShadow:c=>({u_matrix:new r.bJ(c),u_ground_shadow_factor:new r.bL(c)}),stars:c=>({u_matrix:new r.bJ(c),u_up:new r.bL(c),u_right:new r.bL(c),u_intensity_multiplier:new r.bM(c)}),snowParticle:c=>({u_modelview:new r.bJ(c),u_projection:new r.bJ(c),u_time:new r.bM(c),u_cam_pos:new r.bL(c),u_velocityConeAperture:new r.bM(c),u_velocity:new r.bM(c),u_horizontalOscillationRadius:new r.bM(c),u_horizontalOscillationRate:new r.bM(c),u_boxSize:new r.bM(c),u_billboardSize:new r.bM(c),u_simpleShapeParameters:new r.bK(c),u_screenSize:new r.bK(c),u_thinningCenterPos:new r.bK(c),u_thinningShape:new r.bL(c),u_thinningAffectedRatio:new r.bM(c),u_thinningParticleOffset:new r.bM(c),u_particleColor:new r.ca(c),u_direction:new r.bL(c)}),rainParticle:c=>({u_modelview:new r.bJ(c),u_projection:new r.bJ(c),u_time:new r.bM(c),u_cam_pos:new r.bL(c),u_texScreen:new r.bN(c),u_velocityConeAperture:new r.bM(c),u_velocity:new r.bM(c),u_boxSize:new r.bM(c),u_rainDropletSize:new r.bK(c),u_distortionStrength:new r.bM(c),u_rainDirection:new r.bL(c),u_color:new r.ca(c),u_screenSize:new r.bK(c),u_thinningCenterPos:new r.bK(c),u_thinningShape:new r.bL(c),u_thinningAffectedRatio:new r.bM(c),u_thinningParticleOffset:new r.bM(c),u_shapeDirectionalPower:new r.bM(c),u_shapeNormalPower:new r.bM(c),u_mode:new r.bM(c)}),vignette:c=>({u_vignetteShape:new r.bL(c),u_vignetteColor:new r.ca(c)}),occlusion:c=>({u_matrix:new r.bJ(c),u_anchorPos:new r.bL(c),u_screenSizePx:new r.bK(c),u_occluderSizePx:new r.bK(c),u_color:new r.ca(c)})};class oo{constructor(t,n,u,p){this.id=oo.uniqueIdxCounter,oo.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=oo.uniqueIdxCounter,oo.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}oo.uniqueIdxCounter=0;const Yr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class na{constructor(t,n,u,p,_,x){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.instanceCount=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||_||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],x=n.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[Yr[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,n,u){for(let p=0;p<this.attributes.length;p++){const _=n.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sf{constructor(t,n,u,p,_){this.context=t,this.width=n,this.height=u;const x=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new dl(t,x)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Hd(t,x):new gm(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class of{constructor(t,n){this.gl=t,this.clearColor=new Ld(this),this.clearDepth=new Od(this),this.clearStencil=new kd(this),this.colorMask=new Fd(this),this.depthMask=new dm(this),this.stencilMask=new fm(this),this.stencilFunc=new Sy(this),this.stencilOp=new Ec(this),this.stencilTest=new Mc(this),this.depthRange=new pm(this),this.depthTest=new Xr(this),this.depthFunc=new Bd(this),this.blend=new $u(this),this.blendFunc=new Zu(this),this.blendColor=new Nd(this),this.blendEquation=new Vd(this),this.cullFace=new Wu(this),this.cullFaceSide=new Ud(this),this.frontFace=new jd(this),this.program=new Xu(this),this.activeTexture=new mm(this),this.viewport=new _m(this),this.bindFramebuffer=new hl(this),this.bindRenderbuffer=new Ey(this),this.bindTexture=new My(this),this.bindVertexBuffer=new Ay(this),this.bindElementBuffer=new Iy(this),this.bindVertexArrayOES=new Cy(this),this.pixelStoreUnpack=new Py(this),this.pixelStoreUnpackPremultiplyAlpha=new Gd(this),this.pixelStoreUnpackFlipY=new qd(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,u){return new oo(this,t,n,u)}createVertexBuffer(t,n,u,p,_){return new na(this,t,n,u,p,_)}createRenderbuffer(t,n,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),_}createFramebuffer(t,n,u,p){return new sf(this,t,n,u,p)}clear({color:t,depth:n,stencil:u,colorMask:p}){const _=this.gl;let x=0;t&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),n!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bn(t.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let _l;function rh(c,t,n,u,p,_,x){const S=c.context,C=S.gl,R=c.transform,D=c.getOrCreateProgram("collisionBox"),k=[];let B=0,U=0;for(let ae=0;ae<u.length;ae++){const me=u[ae],he=t.getTile(me),fe=he.getBucket(n);if(!fe)continue;const ue=Bs(me,fe,R);let xe=ue;p[0]===0&&p[1]===0||(xe=c.translatePosMatrix(ue,he,p,_));const Me=x?fe.textCollisionBox:fe.iconCollisionBox,$e=fe.collisionCircleArray;if($e.length>0){const ke=r.ab.mat4.create(),Qe=xe;r.ab.mat4.mul(ke,fe.placementInvProjMatrix,R.glCoordMatrix),r.ab.mat4.mul(ke,ke,fe.placementViewportMatrix),k.push({circleArray:$e,circleOffset:U,transform:Qe,invTransform:ke,projection:fe.getProjection()}),B+=$e.length/4,U=B}Me&&(c.terrain&&c.terrain.setupElevationDraw(he,D),D.draw(c,C.LINES,Kt.disabled,oi.disabled,c.colorModeForRenderPass(),li.disabled,Ly(xe,R,he,fe.getProjection()),n.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,R.zoom,null,[Me.collisionVertexBuffer,Me.collisionVertexBufferExt]))}if(!x||!k.length)return;const Z=c.getOrCreateProgram("collisionCircle"),q=new r.cV;q.resize(4*B),q._trim();let Y=0;for(const ae of k)for(let me=0;me<ae.circleArray.length/4;me++){const he=4*me,fe=ae.circleArray[he+0],ue=ae.circleArray[he+1],xe=ae.circleArray[he+2],Me=ae.circleArray[he+3];q.emplace(Y++,fe,ue,xe,Me,0),q.emplace(Y++,fe,ue,xe,Me,1),q.emplace(Y++,fe,ue,xe,Me,2),q.emplace(Y++,fe,ue,xe,Me,3)}(!_l||_l.length<2*B)&&(_l=function(ae){const me=2*ae,he=new r.aU;he.resize(me),he._trim();for(let fe=0;fe<me;fe++){const ue=6*fe;he.uint16[ue+0]=4*fe+0,he.uint16[ue+1]=4*fe+1,he.uint16[ue+2]=4*fe+2,he.uint16[ue+3]=4*fe+2,he.uint16[ue+4]=4*fe+3,he.uint16[ue+5]=4*fe+0}return he}(B));const X=S.createIndexBuffer(_l,!0),te=S.createVertexBuffer(q,r.cW.members,!0);for(const ae of k){const me={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(le=R).getCameraToCenterDistance(ae.projection),u_viewport_size:[le.width,le.height]};Z.draw(c,C.TRIANGLES,Kt.disabled,oi.disabled,c.colorModeForRenderPass(),li.disabled,me,n.id,te,X,r.b7.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,R.zoom)}var le;te.destroy(),X.destroy()}const zc=r.ab.mat4.create();function cs(c){const t=c._camera.getWorldToCamera(c.worldSize,1),n=r.ab.mat4.multiply([],t,c.globeMatrix);r.ab.mat4.invert(n,n);const u=[0,0,0],p=[0,1,0,0];return r.ab.vec4.transformMat4(p,p,n),u[0]=p[0],u[1]=p[1],u[2]=p[2],r.ab.vec3.normalize(u,u),u}function un({width:c,height:t,anchor:n,textOffset:u,textScale:p},_){const{horizontalAlign:x,verticalAlign:S}=r.bD(n),C=-(x-.5)*c,R=-(S-.5)*t,D=r.bC(n,u);return new r.P((C/p+D[0])*_,(R/p+D[1])*_)}function sh(c,t,n,u,p,_,x,S,C,R,D){const k=c.text.placedSymbolArray,B=c.text.dynamicLayoutVertexArray,U=c.icon.dynamicLayoutVertexArray,Z={},q=c.getProjection(),Y=xa(S,q,_),X=_.elevation,te=q.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;B.clear();for(let le=0;le<k.length;le++){const ae=k.get(le),{tileAnchorX:me,tileAnchorY:he,numGlyphs:fe}=ae,ue=ae.hidden||!ae.crossTileID||c.allowVerticalPlacement&&!ae.placedOrientation?null:u[ae.crossTileID];if(ue){let xe=0,Me=0,$e=0;if(X){const We=X?X.getAtTileOffset(S,me,he):0,[bt,nt,et]=q.upVector(S.canonical,me,he);xe=We*bt*te,Me=We*nt*te,$e=We*et*te}let[ke,Qe,Ke,Pe]=jr(ae.projectedAnchorX+xe,ae.projectedAnchorY+Me,ae.projectedAnchorZ+$e,n?Y:x);const Ze=Ou(_.getCameraToCenterDistance(q),Pe);let lt=p.evaluateSizeForFeature(c.textSizeData,R,ae)*Ze/r.bw;n&&(lt*=c.tilePixelRatio/C);const Ce=un(ue,lt);n?({x:ke,y:Qe,z:Ke}=q.projectTilePoint(me+Ce.x,he+Ce.y,S.canonical),[ke,Qe,Ke]=jr(ke+xe,Qe+Me,Ke+$e,x)):(t&&Ce._rotate(-_.angle),ke+=Ce.x,Qe+=Ce.y,Ke=0);const tt=c.allowVerticalPlacement&&ae.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let We=0;We<fe;We++)r.bt(B,ke,Qe,Ke,tt);D&&ae.associatedIconIndex>=0&&(Z[ae.associatedIconIndex]={x:ke,y:Qe,z:Ke,angle:tt})}else An(fe,B)}if(D){U.clear();const le=c.icon.placedSymbolArray;for(let ae=0;ae<le.length;ae++){const me=le.get(ae),{numGlyphs:he}=me,fe=Z[ae];if(me.hidden||!fe)An(he,U);else{const{x:ue,y:xe,z:Me,angle:$e}=fe;for(let ke=0;ke<he;ke++)r.bt(U,ue,xe,Me,$e)}}c.icon.dynamicLayoutVertexBuffer.updateData(U)}c.text.dynamicLayoutVertexBuffer.updateData(B)}function Lc(c,t,n,u,p,_,x={}){const S=n.paint.get("icon-translate"),C=n.paint.get("text-translate"),R=n.paint.get("icon-translate-anchor"),D=n.paint.get("text-translate-anchor"),k=n.layout.get("icon-rotation-alignment"),B=n.layout.get("text-rotation-alignment"),U=n.layout.get("icon-pitch-alignment"),Z=n.layout.get("text-pitch-alignment"),q=n.layout.get("icon-keep-upright"),Y=n.layout.get("text-keep-upright"),X=n.paint.get("icon-color-saturation"),te=n.paint.get("icon-color-contrast"),le=n.paint.get("icon-color-brightness-min"),ae=n.paint.get("icon-color-brightness-max"),me=n.layout.get("symbol-elevation-reference")==="sea",he=c.context,fe=he.gl,ue=c.transform,xe=k==="map",Me=B==="map",$e=U==="map",ke=Z==="map",Qe=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ke=!1;const Pe=c.depthModeForSublayer(0,Kt.ReadOnly),Ze=[r.at(ue.center.lng),r.aA(ue.center.lat)],lt=n.layout.get("text-variable-anchor"),Ce=ue.projection.name==="globe",tt=[],We=[0,-1,0];for(const bt of u){const nt=t.getTile(bt),et=nt.getBucket(n);if(!et||et.projection.name==="mercator"&&Ce||et.fullyClipped)continue;const ft=et.projection.name==="globe",xt=ft?r.ae(ue.zoom):0,Rt=xa(bt,et.getProjection(),ue),Bt=ue.calculatePixelsToTileUnitsMatrix(nt),si=lt&&et.hasTextData(),Xt=et.hasIconTextFit()&&si&&et.hasIconData(),Jt=et.getProjection().createInversionMatrix(ue,bt.canonical),ui=ji=>{ue.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||c.terrain)&&(ji.push("DEPTH_D24"),ji.push("DEPTH_OCCLUSION"))},Ri=()=>{const ji=xe&&n.layout.get("symbol-placement")!=="point",Zi=[];ui(Zi);const bn=ji||Xt,tr=n.paint.get("icon-image-cross-fade").constantOr(0);c.terrainRenderModeElevated()&&$e&&Zi.push("PITCH_WITH_MAP_TERRAIN"),ft&&(Zi.push("PROJECTION_GLOBE_VIEW"),bn&&Zi.push("PROJECTED_POS_ON_VIEWPORT")),tr>0&&Zi.push("ICON_TRANSITION"),et.icon.zOffsetVertexBuffer&&Zi.push("Z_OFFSET"),X===0&&te===0&&le===0&&ae===1||Zi.push("COLOR_ADJUSTMENT"),et.sdfIcons&&Zi.push("RENDER_SDF");const jn=et.icon.programConfigurations.get(n.id),Gn=c.getOrCreateProgram("symbol",{config:jn,defines:Zi}),ds=nt.imageAtlasTexture?nt.imageAtlasTexture.size:[0,0],Ir=et.iconSizeData,wn=r.bp(Ir,ue.zoom),on=$e||ue.pitch!==0,rn=lr(Rt,nt.tileID.canonical,$e,xe,ue,et.getProjection(),Bt),zi=gd(Rt,nt.tileID.canonical,$e,xe,ue,et.getProjection(),Bt),Ln=c.translatePosMatrix(zi,nt,S,R,!0),ir=c.translatePosMatrix(Rt,nt,S,R),sn=bn?zc:rn,Cr=xe&&!$e&&!ji;let Ms=We;!Ce&&!ue.mercatorFromTransition||xe||(Ms=cs(ue));const Qr=ft?Ms:We,Hr=n.getColorAdjustmentMatrix(X,te,le,ae),fo=ef(Ir.kind,wn,Cr,$e,c,ir,sn,Ln,me,!1,ds,[0,0],!0,bt,xt,Ze,Jt,Qr,et.getProjection(),Hr,tr),As=nt.imageAtlasTexture?nt.imageAtlasTexture:null,fs=n.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear,Na=et.sdfIcons||c.options.rotating||c.options.zooming||fs||on?fe.LINEAR:fe.NEAREST,po=et.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Va=c.terrain&&$e&&ji?r.ab.mat4.invert(r.ab.mat4.create(),rn):zc;if(ji&&et.icon){const Cl=ue.elevation,bh=Cl?Cl.getAtTileOffsetFunc(bt,ue.center.lat,ue.worldSize,et.getProjection()):null,Cf=Pn(Rt,nt.tileID.canonical,$e,xe,ue,et.getProjection(),Bt);ku(et,Rt,c,!1,Cf,zi,$e,q,bh,bt)}return{program:Gn,buffers:et.icon,uniformValues:fo,atlasTexture:As,atlasTextureIcon:null,atlasInterpolation:Na,atlasInterpolationIcon:null,isSDF:et.sdfIcons,hasHalo:po,tile:nt,labelPlaneMatrixInv:Va}},Ki=()=>{const ji=Me&&n.layout.get("symbol-placement")!=="point",Zi=[],bn=ji||lt||Xt;c.terrainRenderModeElevated()&&ke&&Zi.push("PITCH_WITH_MAP_TERRAIN"),ft&&(Zi.push("PROJECTION_GLOBE_VIEW"),bn&&Zi.push("PROJECTED_POS_ON_VIEWPORT")),et.text.zOffsetVertexBuffer&&Zi.push("Z_OFFSET"),et.iconsInText&&Zi.push("RENDER_TEXT_AND_SYMBOL"),Zi.push("RENDER_SDF"),ui(Zi);const tr=et.text.programConfigurations.get(n.id),jn=c.getOrCreateProgram("symbol",{config:tr,defines:Zi});let Gn,ds=[0,0],Ir=null;const wn=et.textSizeData;et.iconsInText&&(ds=nt.imageAtlasTexture?nt.imageAtlasTexture.size:[0,0],Ir=nt.imageAtlasTexture?nt.imageAtlasTexture:null,Gn=ke||ue.pitch!==0||c.options.rotating||c.options.zooming||wn.kind==="composite"||wn.kind==="camera"?fe.LINEAR:fe.NEAREST);const on=nt.glyphAtlasTexture?nt.glyphAtlasTexture.size:[0,0],rn=n.layout.get("text-size-scale-range"),zi=r.aw(c.scaleFactor,rn[0],rn[1]),Ln=r.bp(wn,ue.zoom,zi),ir=lr(Rt,nt.tileID.canonical,ke,Me,ue,et.getProjection(),Bt),sn=gd(Rt,nt.tileID.canonical,ke,Me,ue,et.getProjection(),Bt),Cr=c.translatePosMatrix(sn,nt,C,D,!0),Ms=c.translatePosMatrix(Rt,nt,C,D),Qr=bn?zc:ir,Hr=Me&&!ke&&!ji;let fo=We;!Ce&&!ue.mercatorFromTransition||Me||(fo=cs(ue));const As=ef(wn.kind,Ln,Hr,ke,c,Ms,Qr,Cr,me,!0,on,ds,!0,bt,xt,Ze,Jt,ft?fo:We,et.getProjection(),null,null,zi),fs=nt.glyphAtlasTexture?nt.glyphAtlasTexture:null,Na=fe.LINEAR,po=n.paint.get("text-halo-width").constantOr(1)!==0,Va=c.terrain&&ke&&ji?r.ab.mat4.invert(r.ab.mat4.create(),ir):zc;if(ji&&et.text){const Cl=ue.elevation,bh=Cl?Cl.getAtTileOffsetFunc(bt,ue.center.lat,ue.worldSize,et.getProjection()):null,Cf=Pn(Rt,nt.tileID.canonical,ke,Me,ue,et.getProjection(),Bt);ku(et,Rt,c,!0,Cf,sn,ke,Y,bh,bt)}return{program:jn,buffers:et.text,uniformValues:As,atlasTexture:fs,atlasTextureIcon:Ir,atlasInterpolation:Na,atlasInterpolationIcon:Gn,isSDF:!0,hasHalo:po,tile:nt,labelPlaneMatrixInv:Va}},En=et.icon.segments.get().length,dn=et.text.segments.get().length,pi=En&&!x.onlyText?Ri():null,Fi=dn&&!x.onlyIcons?Ki():null,Ht=n.paint.get("icon-opacity").constantOr(1),Ci=n.paint.get("text-opacity").constantOr(1);if(Qe&&et.canOverlap){Ke=!0;const ji=Ht&&!x.onlyText?et.icon.segments.get():[],Zi=Ci&&!x.onlyIcons?et.text.segments.get():[];for(const bn of ji)tt.push({segments:new r.b7([bn]),sortKey:bn.sortKey,state:pi});for(const bn of Zi)tt.push({segments:new r.b7([bn]),sortKey:bn.sortKey,state:Fi})}else x.onlyText||tt.push({segments:Ht?et.icon.segments:new r.b7([]),sortKey:0,state:pi}),x.onlyIcons||tt.push({segments:Ci?et.text.segments:new r.b7([]),sortKey:0,state:Fi})}Ke&&tt.sort((bt,nt)=>bt.sortKey-nt.sortKey);for(const bt of tt){const nt=bt.state;if(nt)if(c.terrain?c.terrain.setupElevationDraw(nt.tile,nt.program,{useDepthForOcclusion:ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:nt.labelPlaneMatrixInv}):c.setupDepthForOcclusion(ue.depthOcclusionForSymbolsAndCircles,nt.program),he.activeTexture.set(fe.TEXTURE0),nt.atlasTexture&&nt.atlasTexture.bind(nt.atlasInterpolation,fe.CLAMP_TO_EDGE,!0),nt.atlasTextureIcon&&(he.activeTexture.set(fe.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,fe.CLAMP_TO_EDGE,!0)),c.uploadCommonLightUniforms(c.context,nt.program),nt.hasHalo){const et=nt.uniformValues;et.u_is_halo=1,oh(nt.buffers,bt.segments,n,c,nt.program,Pe,p,_,et,2),et.u_is_halo=0}else{if(nt.isSDF){const et=nt.uniformValues;nt.hasHalo&&(et.u_is_halo=1,oh(nt.buffers,bt.segments,n,c,nt.program,Pe,p,_,et,1)),et.u_is_halo=0}oh(nt.buffers,bt.segments,n,c,nt.program,Pe,p,_,nt.uniformValues,1)}}}function oh(c,t,n,u,p,_,x,S,C,R){const D=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,_,x,S,li.disabled,C,n.id,c.layoutVertexBuffer,c.indexBuffer,t,n.paint,u.transform.zoom,c.programConfigurations.get(n.id),D,R)}function af(c,t,n,u,p,_,x){const S=c.context.gl,C=n.paint.get("fill-pattern"),R=n.is3D(),D=R?c.stencilModeFor3D():oi.disabled,k=C&&C.constantOr(1);let B,U,Z,q,Y;x?(U=k&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(U=k?"fillPattern":"fill",B=S.TRIANGLES);for(const X of u){const te=t.getTile(X);if(k&&!te.patternsLoaded())continue;const le=te.getBucket(n);if(!le)continue;c.prepareDrawTile();const ae=le.programConfigurations.get(n.id),me=c.isTileAffectedByFog(X),he=c.getOrCreateProgram(U,{config:ae,overrideFog:me});k&&(c.context.activeTexture.set(S.TEXTURE0),te.imageAtlasTexture&&te.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ae.updatePaintBuffers());const fe=C.constantOr(null);if(fe&&te.imageAtlas){const Me=te.imageAtlas,$e=r.A.from(fe).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),ke=Me.patternPositions[$e];ke&&ae.setConstantPatternPositions(ke)}const ue=c.translatePosMatrix(X.projMatrix,te,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),xe=n.paint.get("fill-emissive-strength");if(x){q=le.indexBuffer2,Y=le.segments2;const Me=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Z=U==="fillOutlinePattern"&&k?Tm(ue,xe,c,te,Me):Yd(ue,xe,Me)}else q=le.indexBuffer,Y=le.segments,Z=k?Rc(ue,xe,c,te):Pc(ue,xe);c.uploadCommonUniforms(c.context,he,X.toUnwrapped()),he.draw(c,B,p,R?D:c.stencilModeForClipping(X),_,li.disabled,Z,n.id,le.layoutVertexBuffer,q,Y,n.paint,c.transform.zoom,ae,void 0)}}function Oc(c,t,n,u,p,_,x,S){n.resetLayerRenderingStats(c);const C=c.context,R=C.gl,D=c.transform,k=n.paint.get("fill-extrusion-pattern"),B=k.constantOr(1),U=n.paint.get("fill-extrusion-opacity"),Z=c.style.enable3dLights(),q=n.paint.get(Z&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Y=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],X=n.layout.get("fill-extrusion-edge-radius"),te=X>0&&!n.paint.get("fill-extrusion-rounded-roof"),le=te?0:X,ae=D.projection.name==="globe"?r.d3():0,me=D.projection.name==="globe",he=me?r.ae(D.zoom):0,fe=[r.at(D.center.lng),r.aA(D.center.lat)],ue=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",xe=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(ue?null:n.lut).toArray01().slice(0,3),Me=n.paint.get("fill-extrusion-flood-light-intensity"),$e=n.paint.get("fill-extrusion-vertical-scale"),ke=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=n.paint.get("fill-extrusion-height-alignment"),Ke=n.paint.get("fill-extrusion-base-alignment"),Pe=Qo(c,n.paint.get("fill-extrusion-cutoff-fade-range")),Ze=[];let lt;me&&Ze.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&Ze.push("FAUX_AO"),te&&Ze.push("ZERO_ROOF_RADIUS"),S&&Ze.push("HAS_CENTROID"),Me>0&&Ze.push("FLOOD_LIGHT"),Pe.shouldRenderCutoff&&Ze.push("RENDER_CUTOFF"),ke&&Ze.push("RENDER_WALL_MODE");const Ce=c.renderPass==="shadow",tt=c.shadowRenderer,We=Ce&&!!tt;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(tt){const ft=c.style.directionalLight,xt=c.style.ambientLight;ft&&xt&&(bt=Id(c.style,ft,xt)),Ce||(Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),tt.useNormalOffset&&Ze.push("NORMAL_OFFSET")),lt=Ze.concat(["SHADOWS_SINGLE_CASCADE"])}const nt=We?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",et=n.getLayerRenderingStats();for(const ft of u){const xt=t.getTile(ft),Rt=xt.getBucket(n);if(!Rt||Rt.projection.name!==D.projection.name)continue;let Bt=!1;tt&&(Bt=tt.getMaxCascadeForTile(ft.toUnwrapped())===0);const si=c.isTileAffectedByFog(ft),Xt=Rt.programConfigurations.get(n.id),Jt=c.getOrCreateProgram(nt,{config:Xt,defines:Bt?lt:Ze,overrideFog:si});if(c.terrain&&c.terrain.setupElevationDraw(xt,Jt,{useMeterToDem:!0}),!Rt.centroidVertexBuffer){const Fi=Jt.attributes.a_centroid_pos;Fi!==void 0&&R.vertexAttrib2f(Fi,0,0)}!Ce&&tt&&tt.setupShadows(xt.tileID.toUnwrapped(),Jt,"vector-tile",xt.tileID.overscaledZ),B&&(c.context.activeTexture.set(R.TEXTURE0),xt.imageAtlasTexture&&xt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Xt.updatePaintBuffers());const ui=k.constantOr(null);if(ui&&xt.imageAtlas){const Fi=xt.imageAtlas,Ht=r.A.from(ui).getPrimary().scaleSelf(r.q.devicePixelRatio),Ci=Fi.patternPositions[Ht.serialize()];Ci&&Xt.setConstantPatternPositions(Ci)}const Ri=n.paint.get("fill-extrusion-vertical-gradient"),Ki=1/Rt.tileToMeter;let En;if(Ce&&tt){if(vl(xt.tileID,Rt,c))continue;const Fi=tt.calculateShadowPassMatrixFromTile(xt.tileID.toUnwrapped());En=Cc(Fi,le,Ki,$e,Qe,Ke)}else{const Fi=c.translatePosMatrix(ft.expandedProjMatrix,xt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ht=D.projection.createInversionMatrix(D,ft.canonical);En=B?wm(Fi,c,Ri,U,Y,le,Ki,ft,xt,ae,Qe,Ke,he,fe,Ht,xe,$e):eh(Fi,c,Ri,U,Y,le,Ki,ft,ae,Qe,Ke,he,fe,Ht,xe,$e,Me,bt)}c.uploadCommonUniforms(C,Jt,ft.toUnwrapped(),null,Pe);let dn=Rt.segments;if(D.projection.name==="mercator"&&!Ce&&(dn=Rt.getVisibleSegments(xt.tileID,c.terrain,c.transform.getFrustum(0)),!dn.get().length))continue;if(et)if(Ce)for(const Fi of dn.get())et.numRenderedVerticesInShadowPass+=Fi.primitiveLength;else for(const Fi of dn.get())et.numRenderedVerticesInTransparentPass+=Fi.primitiveLength;const pi=[];(c.terrain||S)&&pi.push(Rt.centroidVertexBuffer),me&&pi.push(Rt.layoutVertexExtBuffer),ke&&pi.push(Rt.wallVertexBuffer),Jt.draw(c,C.gl.TRIANGLES,p,_,x,li.backCCW,En,n.id,Rt.layoutVertexBuffer,Rt.indexBuffer,dn,n.paint,c.transform.zoom,Xt,pi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function gl(c,t,n,u,p,_,x,S,C,R,D,k,B,U,Z,q,Y,X,te){const le=c.context,ae=le.gl,me=c.transform,he=c.transform.zoom,fe=[],ue=Qo(c,n.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(fe.push("CLEAR_SUBPASS"),te&&(fe.push("CLEAR_FROM_TEXTURE"),le.activeTexture.set(ae.TEXTURE0),te.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):R==="sdf"&&fe.push("SDF_SUBPASS"),Y&&fe.push("HAS_CENTROID"),ue.shouldRenderCutoff&&fe.push("RENDER_CUTOFF");const xe=n.layout.get("fill-extrusion-edge-radius"),Me=($e,ke,Qe,Ke,Pe)=>{const Ze=ke.programConfigurations.get(n.id),lt=c.isTileAffectedByFog($e),Ce=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:fe,overrideFog:lt}),tt=((bt,nt,et,ft,xt,Rt,Bt,si,Xt,Jt,ui)=>({u_matrix:nt,u_opacity:et,u_ao_pass:ft?1:0,u_meter_to_tile:xt,u_ao:Rt,u_flood_light_intensity:Bt,u_flood_light_color:si,u_attenuation:Xt,u_edge_radius:Jt,u_fb:0,u_fb_size:ui,u_dynamic_offset:1}))(0,Ke,D,C,Pe,[k,B*Pe],U,Z,q,he>=17?0:xe*Pe,te?te.size[0]:0),We=[];Y&&We.push(ke.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(le,Ce,$e.toUnwrapped(),null,ue),Ce.draw(c,le.gl.TRIANGLES,p,_,x,S,tt,n.id,ke.vertexBuffer,ke.indexBuffer,Qe,n.paint,he,Ze,We)};for(const $e of u){const ke=t.getTile($e),Qe=ke.getBucket(n);if(!Qe||Qe.projection.name!==me.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const Ke=Qe.groundEffect,Pe=1/Qe.tileToMeter;{const Ze=c.translatePosMatrix($e.projMatrix,ke,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),lt=Ke.getDefaultSegment();Me($e,Ke,lt,Ze,Pe)}if(X)for(let Ze=0;Ze<4;Ze++){const lt=r.d4[Ze]($e),Ce=t.getTile(lt);if(!Ce)continue;const tt=Ce.getBucket(n);if(!tt||tt.projection.name!==me.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;const We=tt.groundEffect;let bt,nt;Ze===0?(bt=[-r.ag,0,0],nt=1):Ze===1?(bt=[r.ag,0,0],nt=0):Ze===2?(bt=[0,-r.ag,0],nt=3):(bt=[0,r.ag,0],nt=2);const et=We.regionSegments[nt];if(!et)continue;const ft=new Float32Array(16);r.ab.mat4.translate(ft,$e.projMatrix,bt),Me($e,We,et,c.translatePosMatrix(ft,ke,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Pe)}}}function yl(c,t,n,u,p,_,x){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const S=_?_.findDEMTileFor(n):null;if(!(S&&S.dem||x))return;_&&S&&S.dem&&u.selfDEMTileTimestamp!==S.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=S.dem._timestamp);const C=X=>new r.P(Math.ceil((X+r.d7)*r.d8),0),R=X=>{const te=t.getSource().minzoom,le=me=>{const he=t.getTileByID(me);if(he&&he.hasData())return he.getBucket(p)},ae=[0,-1,1];for(const me of ae){if(X.overscaledZ+me<te)continue;const he=le(X.calculateScaledKey(X.overscaledZ+me));if(he)return he}},D=[0,0,0],k=(X,te)=>(D[0]=Math.min(X.min.y,te.min.y),D[1]=Math.max(X.max.y,te.max.y),D[2]=r.ag-te.min.x>X.max.x?te.min.x-r.ag:X.max.x,D),B=(X,te)=>(D[0]=Math.min(X.min.x,te.min.x),D[1]=Math.max(X.max.x,te.max.x),D[2]=r.ag-te.min.y>X.max.y?te.min.y-r.ag:X.max.y,D),U=[(X,te)=>k(X,te),(X,te)=>k(te,X),(X,te)=>B(X,te),(X,te)=>B(te,X)],Z=(X,te,le,ae,me,he,fe)=>{if(!_)return 0;const ue=[[he?le:X,he?X:le,0],[he?le:te,he?te:le,0]],xe=fe<0?r.ag+fe:fe,Me=[he?xe:(X+te)/2,he?(X+te)/2:xe,0];return le===0&&fe<0||le!==0&&fe>0?_.getForTilePoints(me,[Me],!0,ae):ue.push(Me),_.getForTilePoints(n,ue,!0,S),Math.max(ue[0][2],ue[1][2],Me[2])/_.exaggeration()};for(let X=0;X<4;X++){const te=u.borderFeatureIndices[X];if(te.length===0)continue;const le=r.d4[X](n),ae=R(le);if(!(ae&&ae instanceof r.d5))continue;const me=_?_.findDEMTileFor(le):null;if(!(me&&me.dem||x)||(_&&me&&me.dem&&u.borderDEMTileTimestamp[X]!==me.dem._timestamp&&(u.borderDoneWithNeighborZ[X]=-1,u.borderDEMTileTimestamp[X]=me.dem._timestamp),u.borderDoneWithNeighborZ[X]===ae.canonical.z))continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();const he=(X<2?1:5)-X,fe=ae.borderDoneWithNeighborZ[he]!==u.canonical.z,ue=ae.borderFeatureIndices[he];let xe=0;if(u.canonical.z!==ae.canonical.z){for(const Me of te)u.showCentroid(u.featuresOnBorder[Me]);if(fe)for(const Me of ue)ae.showCentroid(ae.featuresOnBorder[Me]);u.borderDoneWithNeighborZ[X]=ae.canonical.z,ae.borderDoneWithNeighborZ[he]=u.canonical.z}for(const Me of te){const $e=u.featuresOnBorder[Me],ke=u.centroidData[$e.centroidDataIndex],Qe=$e.borders[X];let Ke;for(;xe<ue.length;){Ke=ae.featuresOnBorder[ue[xe]];const Pe=Ke.borders[he];if(Pe[1]>Qe[0]+3||Pe[0]>Qe[0]-3)break;ae.showCentroid(Ke),xe++}if(Ke&&xe<ue.length){const Pe=xe;let Ze=0;for(;!(Ke.borders[he][0]>Qe[1]-3)&&(Ze++,++xe!==ue.length);)Ke=ae.featuresOnBorder[ue[xe]];Ke=ae.featuresOnBorder[ue[Pe]];let lt=!1;if(Ze>=1){const We=Ke.borders[he];Math.abs(Qe[0]-We[0])<3&&Math.abs(Qe[1]-We[1])<3&&(Ze=1,lt=!0,xe=Pe+1)}else if(Ze===0){u.showCentroid($e);continue}const Ce=ae.centroidData[Ke.centroidDataIndex];x&&lt&&(((q=ke).flags|(Y=Ce).flags)&r.d6?(q.flags|=r.d6,Y.flags|=r.d6):(q.flags&=~r.d6,Y.flags&=~r.d6));const tt=$e.intersectsCount()>1||Ke.intersectsCount()>1;if(Ze>1)xe=Pe,ke.centroidXY=Ce.centroidXY=new r.P(0,0);else if(me&&me.dem&&!tt){const We=U[X](ke,Ce),bt=X%2?r.ag-1:0,nt=Z(We[0],Math.min(r.ag-1,We[1]),bt,me,le,X<2,We[2]);ke.centroidXY=Ce.centroidXY=C(nt)}else tt?ke.centroidXY=Ce.centroidXY=new r.P(0,0):(ke.centroidXY=u.encodeBorderCentroid($e),Ce.centroidXY=ae.encodeBorderCentroid(Ke));u.writeCentroidToBuffer(ke),ae.writeCentroidToBuffer(Ce)}else u.showCentroid($e)}u.borderDoneWithNeighborZ[X]=ae.canonical.z,ae.borderDoneWithNeighborZ[he]=u.canonical.z}var q,Y;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const xl=[1,0,0],yt=[0,1,0],Dt=[0,0,1];function vl(c,t,n){const u=n.transform,p=n.shadowRenderer;if(!p)return!0;const _=c.toUnwrapped(),x=u.tileSize*p._cascades[n.currentShadowCascade].scale;let S=t.maxHeight;if(u.elevation){const q=u.elevation.getMinMaxForTile(c);q&&(S+=q.max)}const C=[...p.shadowDirection];C[2]=-C[2];const R=p.computeSimplifiedTileShadowVolume(_,S,x,C);if(!R)return!1;const D=[xl,yt,Dt,C,[C[0],0,C[2]],[0,C[1],C[2]]],k=u.projection.name==="globe",B=u.scaleZoom(x),U=r.bR.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,B,!k),Z=p.getCurrentCascadeFrustum();return U.intersectsPrecise(R.vertices,R.planes,D)===0||Z.intersectsPrecise(R.vertices,R.planes,D)===0}function vn(c){return[c[0]*r.d9,c[1]*r.d9,c[2]*r.d9,0]}function Fe(c,t,n,u,p,_,x,S,C){const R=u.getSource(),D=n.globeSharedBuffers;if(!D)return;let k,B,U;if(t&&(k=u.getTile(t)),R instanceof r.aJ?(B=R.texture,U=r.cI(0,0,n.transform)):k&&t&&(B=k.texture,U=r.cI(t.canonical.z,t.canonical.x,n.transform)),!B||!U)return;c||(U=r.ab.mat4.scale(r.ab.mat4.create(),U,[1,-1,1]));const Z=n.context,q=Z.gl,Y=p.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,X=n.colorModeForDrapableLayerRenderPass(_),te=x.defines;te.push("GLOBE_POLES");const le=new Kt(q.LEQUAL,Kt.ReadWrite,n.depthRangeFor3D),ae=Float32Array.from(n.transform.expandedFarZProjMatrix),me=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),Z.activeTexture.set(q.TEXTURE0),B.bind(Y,q.CLAMP_TO_EDGE),Z.activeTexture.set(q.TEXTURE1),B.bind(Y,q.CLAMP_TO_EDGE),B.useMipmap&&Z.extTextureFilterAnisotropic&&n.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[he,fe,ue,xe]=t?D.getPoleBuffers(t.canonical.z,!1):D.getPoleBuffers(0,!0),Me=p.paint.get("raster-elevation");let $e;c?($e=he,n.renderDefaultNorthPole=Me!==0):($e=fe,n.renderDefaultSouthPole=Me!==0);const ke=vn(x.mix),Qe=((Pe,Ze,lt,Ce,tt,We,bt,nt,et,ft,xt,Rt,Bt)=>ia(Pe,Ze,lt,new Float32Array(16),new Float32Array(9),[0,0],Ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],nt,2,ft,xt,Rt,1,0,Bt))(ae,me,U,r.ae(n.transform.zoom),0,p,0,Me,0,ke,x.offset,x.range,_),Ke=n.getOrCreateProgram("raster",{defines:te});n.uploadCommonUniforms(Z,Ke,null),Ke.draw(n,q.TRIANGLES,le,C,X,S,Qe,p.id,$e,ue,xe)}function Em(c){const t=c._nearZ,n=c.projection.farthestPixelDistance(c),u=n-t,p=.2*c.height,_=t+p;return[t,n,(_-p-t)/u,(_-t)/u]}function ah(c,t,n,u){if(c)return t instanceof Xn&&c instanceof Ko?t.getTextureDescriptor(c,n,!0):{texture:c.texture,mix:vn(u.mix),offset:u.offset,buffer:0,tileSize:1}}var lf=r.da([{name:"a_index",type:"Int16",components:1}]);class Mm{constructor(t,n,u,p){const _={width:u[0],height:u[1],data:null},x=t.gl;this.targetColorTexture=new r.T(t,_,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,_,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,p),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=n.width*n.height;this.particleTexture0=new r.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1});const _=new r.db;_.reserve(p);for(let x=0;x<p;x++)_.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(_,lf.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Am(c,t,n){if(!c)return null;const u=t.getTextureDescriptor(c,n,!0);if(!u)return null;let{texture:p,mix:_,offset:x,tileSize:S,buffer:C,format:R}=u;if(!p||!R)return null;let D=!1;return R==="uint32"&&(D=!0,_[3]=0,_=Kd(r.dc,_,[0,n.paint.get("raster-particle-max-speed")]),x=Jd(r.dc,x,[0,n.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[C/(S+2*C),S/(S+2*C)],tileSize:S,scalarData:D,scale:_,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function Im(c){const t=c._nearZ,n=c.projection.farthestPixelDistance(c),u=n-t,p=.2*c.height,_=t+p;return[t,n,(_-p-t)/u,(_-t)/u]}const bl=new r.aj(1,0,0,1),Fy=new r.aj(0,1,0,1),By=new r.aj(0,0,1,1),Cm=new r.aj(1,0,1,1),lh=new r.aj(0,1,1,1);function ra(c,t,n,u,p,_,x){const S=c.context,C=c.transform,R=S.gl,D=C.projection.name==="globe",k=D?["PROJECTION_GLOBE_VIEW"]:[];let B=r.ab.mat4.clone(n.projMatrix);if(D&&r.ae(C.zoom)>0){const ke=r.ba(n.canonical,C),Qe=r.dd(ke);B=r.ab.mat4.multiply(new Float32Array(16),C.globeMatrix,Qe),r.ab.mat4.multiply(B,C.projMatrix,B)}const U=r.ab.mat4.create();U[12]+=2*p/(r.q.devicePixelRatio*C.width),U[13]+=2*_/(r.q.devicePixelRatio*C.height),r.ab.mat4.multiply(B,U,B);const Z=c.getOrCreateProgram("debug",{defines:k}),q=t.getTileByID(n.key);c.terrain&&c.terrain.setupElevationDraw(q,Z);const Y=Kt.disabled,X=oi.disabled,te=c.colorModeForRenderPass(),le="$debug";S.activeTexture.set(R.TEXTURE0),c.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),D?q._makeGlobeTileDebugBuffers(c.context,C):q._makeDebugTileBoundsBuffers(c.context,C.projection);const ae=q._tileDebugBuffer||c.debugBuffer,me=q._tileDebugIndexBuffer||c.debugIndexBuffer,he=q._tileDebugSegments||c.debugSegments;if(Z.draw(c,R.LINE_STRIP,Y,X,te,li.disabled,Pa(B,u),le,ae,me,he,null,null,null,[q._globeTileDebugBorderBuffer]),x){const ke=q.latestRawTileData,Qe=Math.floor((ke&&ke.byteLength||0)/1024);let Ke=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Ke+=` => ${n.overscaledZ}`),Ke+=` ${q.state}`,Ke+=` ${Qe}kb`,function(Pe,Ze){Pe.initDebugOverlayCanvas();const lt=Pe.debugOverlayCanvas,Ce=Pe.context.gl,tt=Pe.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,lt.width,lt.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(Ze,5,5),tt.strokeText(Ze,5,5),Pe.debugOverlayTexture.update(lt),Pe.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(c,Ke)}const fe=t.getTile(n).tileSize,ue=512/Math.min(fe,512)*(n.overscaledZ/C.zoom)*.5,xe=q._tileDebugTextBuffer||c.debugBuffer,Me=q._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,$e=q._tileDebugTextSegments||c.debugSegments;Z.draw(c,R.TRIANGLES,Y,X,Ei.alphaBlended,li.disabled,Pa(B,r.aj.transparent,ue),le,xe,Me,$e,null,null,null,[q._globeTileDebugTextBuffer])}function cf(c,t,n,u){Da(c,0,t+n/2,c.transform.width,n,u)}function uf(c,t,n,u){Da(c,t-n/2,0,n,c.transform.height,u)}function Da(c,t,n,u,p,_){const x=c.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*r.q.devicePixelRatio,n*r.q.devicePixelRatio,u*r.q.devicePixelRatio,p*r.q.devicePixelRatio),x.clear({color:_}),S.disable(S.SCISSOR_TEST)}const ch=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ao}=ch;function Lo(c,t,n,u){c.emplaceBack(t,n,u)}class Pm{constructor(t){this.vertexArray=new r.de,this.indices=new r.aU,Lo(this.vertexArray,-1,-1,1),Lo(this.vertexArray,1,-1,1),Lo(this.vertexArray,-1,1,1),Lo(this.vertexArray,1,1,1),Lo(this.vertexArray,-1,-1,-1),Lo(this.vertexArray,1,-1,-1),Lo(this.vertexArray,-1,1,-1),Lo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ao),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function sr(c,t,n,u,p,_){const x=c.context.gl,S=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),R=t.paint.get("sky-atmosphere-sun-intensity"),D=((k,B,U,Z,q)=>({u_matrix_3f:k,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),u),p,R,S,C);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),n.draw(c,x.TRIANGLES,Kt.disabled,oi.disabled,Ei.unblended,li.frontCW,D,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ny=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class kc{constructor(t){const n=new r.df;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const u=new r.aU;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Ny.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const hn=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class $i{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Rm{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ei([1,va,1,va],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ei([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new $i,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new kc(n);const u=this.params.sizeRange,p=this.params.intensityRange,_=function(D){const k=r.di(30),B=[];for(let U=0;U<D;++U){const Z=2*Math.PI*k(),q=Math.acos(1-2*k())-.5*Math.PI;B.push(r.ab.vec3.fromValues(Math.cos(q)*Math.cos(Z),Math.cos(q)*Math.sin(Z),Math.sin(q)))}return B}(this.params.starsCount),x=r.di(300),S=new r.dg,C=new r.aU;let R=0;for(let D=0;D<_.length;++D){const k=r.ab.vec3.scale([],_[D],200),B=Math.max(0,1+.01*u*(1*x()-.5)),U=Math.max(0,1+.01*p*(1*x()-.5));S.emplaceBack(k[0],k[1],k[2],-1,-1,B,U),S.emplaceBack(k[0],k[1],k[2],1,-1,B,U),S.emplaceBack(k[0],k[1],k[2],1,1,B,U),S.emplaceBack(k[0],k[1],k[2],-1,1,B,U),C.emplaceBack(R+0,R+1,R+2),C.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=n.createVertexBuffer(S,hn.members),this.starsIdx=n.createIndexBuffer(C),this.starsSegments=r.b7.simpleSegment(0,0,S.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const u=t.context,p=u.gl,_=t.transform,x=new Kt(p.LEQUAL,Kt.ReadOnly,[0,1]),S=r.ae(_.zoom),C=t.style.getLut(n.scope),R=n.properties.get("color-use-theme")==="none",D=n.properties.get("color").toRenderColor(R?null:C).toArray01(),k=n.properties.get("high-color-use-theme")==="none",B=n.properties.get("high-color").toRenderColor(k?null:C).toArray01(),U=n.properties.get("space-color-use-theme")==="none",Z=n.properties.get("space-color").toRenderColor(U?null:C).toArray01PremultipliedAlpha(),q=5e-4,Y=r.dh(n.properties.get("horizon-blend"),0,1,q,.25),X=r.cC(t,u,_)&&Y===q?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,te=t.frameCounter/1e3%1,le=r.ab.vec3.length(_.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(le,2)-Math.pow(X,2)),me=Math.acos(ae/le),he=fe=>{const ue=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&ue.push("ALPHA_PASS");const xe=t.getOrCreateProgram("globeAtmosphere",{defines:ue}),Me=((ke,Qe,Ke,Pe,Ze,lt,Ce,tt,We,bt,nt,et)=>({u_frustum_tl:ke,u_frustum_tr:Qe,u_frustum_br:Ke,u_frustum_bl:Pe,u_horizon:Ze,u_transition:lt,u_fadeout_range:Ce,u_color:tt,u_high_color:We,u_space_color:bt,u_temporal_offset:nt,u_horizon_angle:et}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,S,Y,D,B,Z,te,me);t.uploadCommonUniforms(u,xe);const $e=this.atmosphereBuffer;$e&&xe.draw(t,p.TRIANGLES,x,oi.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,li.backCW,Me,fe?"atmosphere_glow_alpha":"atmosphere_glow",$e.vertexBuffer,$e.indexBuffer,$e.segments)};he(!1),he(!0)}drawStars(t,n){const u=r.aw(n.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,_=p.gl,x=t.transform,S=t.getOrCreateProgram("stars"),C=r.ab.quat.identity([]);r.ab.quat.rotateX(C,C,-x._pitch),r.ab.quat.rotateZ(C,C,-x.angle),r.ab.quat.rotateX(C,C,r.ai(x._center.lat)),r.ab.quat.rotateY(C,C,-r.ai(x._center.lng));const R=r.ab.mat4.fromQuat(new Float32Array(16),C),D=r.ab.mat4.multiply([],x.starsProjMatrix,R),k=r.ab.mat3.fromMat4([],R),B=r.ab.mat3.invert([],k),U=[0,1,0];r.ab.vec3.transformMat3(U,U,B),r.ab.vec3.scale(U,U,this.params.sizeMultiplier);const Z=[1,0,0];r.ab.vec3.transformMat3(Z,Z,B),r.ab.vec3.scale(Z,Z,this.params.sizeMultiplier);const q=(Y=U,X=Z,te=u,{u_matrix:Float32Array.from(D),u_up:Y,u_right:X,u_intensity_multiplier:te});var Y,X,te;t.uploadCommonUniforms(p,S),this.starsVx&&this.starsIdx&&S.draw(t,_.TRIANGLES,Kt.disabled,oi.disabled,this.colorModeAlphaBlendedWriteRGB,li.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Oo(c,t){const n=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=r.ab.mat4.identity([]);return r.ab.mat4.scale(p,p,[u,u,1]),r.ab.mat4.multiply(n,p,n),r.ab.mat4.multiply(n,t.worldToFogMatrix,n),n}function wl(c,t,n,u,p){const _=n.material,x=u.context,{baseColorTexture:S,metallicRoughnessTexture:C}=_.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:D,emissionTexture:k}=_;function B(Z,q,Y){if(Z&&(c.push(q),x.activeTexture.set(x.gl.TEXTURE0+Y),Z.gfxTexture)){const{minFilter:X,magFilter:te,wrapS:le,wrapT:ae}=Z.sampler;Z.gfxTexture.bindExtraParam(X,te,le,ae)}}B(S,"HAS_TEXTURE_u_baseColorTexture",vr.BaseColor),B(C,"HAS_TEXTURE_u_metallicRoughnessTexture",vr.MetallicRoughness),B(R,"HAS_TEXTURE_u_normalTexture",vr.Normal),B(D,"HAS_TEXTURE_u_occlusionTexture",vr.Occlusion),B(k,"HAS_TEXTURE_u_emissionTexture",vr.Emission),p&&(p.texture||(p.texture=new r.dk(u.context,p.image,[p.image.height,p.image.height,p.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+vr.LUT),p.texture&&p.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(c.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||c.push("DIFFUSE_SHADED");const U=u.shadowRenderer;U&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&c.push("NORMAL_OFFSET"))}function ko(c,t,n,u,p,_){const x=n.paint.get("model-opacity").constantOr(1),S=t.context,C=new Kt(t.context.gl.LEQUAL,Kt.ReadWrite,t.depthRangeFor3D),R=t.transform,D=c.mesh,k=D.material,B=k.pbrMetallicRoughness,U=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:r.ab.mat4.multiply([],u.zScaleMatrix,c.nodeModelMatrix),r.ab.mat4.multiply(Z,u.negCameraPosMatrix,Z);const q=r.ab.mat4.invert([],Z);r.ab.mat4.transpose(q,q);const Y=n.paint.get("model-color-use-theme").constantOr("default")==="none",X=n.paint.get("model-emissive-strength").constantOr(0),te=Dc(new Float32Array(c.worldViewProjection),new Float32Array(Z),new Float32Array(q),null,t,x,B.baseColorFactor.toRenderColor(null),k.emissiveFactor,B.metallicFactor,B.roughnessFactor,k,X,n),le={defines:[]},ae=[],me=t.shadowRenderer;me&&(me.useNormalOffset=!1),wl(le.defines,ae,D,t,Y?null:n.lut);let he=null;if(U){const xe=Oo(c.nodeModelMatrix,t.transform);if(he=new Float32Array(xe),R.projection.name!=="globe"){const Me=D.aabb.min,$e=D.aabb.max,[ke,Qe]=U.getOpacityForBounds(xe,Me[0],Me[1],$e[0],$e[1]);le.overrideFog=ke>=pe||Qe>=pe}}const fe=Qo(t,n.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&le.defines.push("RENDER_CUTOFF");const ue=t.getOrCreateProgram("model",le);t.uploadCommonUniforms(S,ue,null,he,fe),t.renderPass!=="shadow"&&me&&me.setupShadowsFromMatrix(c.nodeModelMatrix,ue),ue.draw(t,S.gl.TRIANGLES,C,p,_,D.material.doubleSided?li.disabled:li.backCCW,te,n.id,D.vertexBuffer,D.indexBuffer,D.segments,n.paint,t.transform.zoom,void 0,ae)}function uh(c,t,n,u,p,_,x){let S;S=c.projection.name==="globe"?r.dl(n,c):[...n],r.ab.mat4.multiply(S,S,t.matrix);const C=r.ab.mat4.multiply([],u,S);if(t.meshes)for(const R of t.meshes){if(R.material.alphaMode!=="BLEND"){x.push({mesh:R,depth:0,modelIndex:p,worldViewProjection:C,nodeModelMatrix:S});continue}const D=r.ab.vec3.transformMat4([],R.centroid,C);!c.isOrthographic&&D[2]<=0||_.push({mesh:R,depth:D[2],modelIndex:p,worldViewProjection:C,nodeModelMatrix:S})}if(t.children)for(const R of t.children)uh(c,R,n,u,p,_,x)}function Fc(c,t,n,u){const p=n.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),x=p.getShadowPassColorMode(),S=p.calculateShadowPassMatrixFromMatrix(t),C=nh(S);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,_,oi.disabled,x,li.backCCW,C,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,n.transform.zoom,void 0,void 0)}function lo(c,t,n){const u=t.updateZoomBasedPaintProperties(),p=function(_,x,S){let C,R,D,k=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&k>0){const B=_.terrain,U=B.findDEMTileFor(S);U&&U.dem?C=r.dn.create(B,S,U):k=0}if(k===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),k===x.validForExaggeration&&(k===0||C&&C._demTile&&C._demTile.tileID===x.validForDEMTile.id&&C._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const B in x.instancesPerModel){const U=x.instancesPerModel[B];for(let Z=0;Z<U.instancedDataArray.length;++Z){const q=(C?k*C.getElevationAt(0|U.instancedDataArray.float32[16*Z],0|U.instancedDataArray.float32[16*Z+1],!0,!0):0)+U.instancesEvaluatedElevation[Z];U.instancedDataArray.float32[16*Z+6]=q,R=R?Math.min(x.terrainElevationMin,q):q,D=D?Math.max(x.terrainElevationMax,q):q}}return x.terrainElevationMin=R||0,x.terrainElevationMax=D||0,x.validForExaggeration=k,x.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,n);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Ar={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function hh(c,t){const n=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,_=c.canonical.x/n,x=(c.canonical.x+1)/n,S=c.canonical.y/n,C=(c.canonical.y+1)/n;let R=t._centerAltitude;if(p){const U=p.getMinMaxForTile(c);U&&U.max>R&&(R=U.max)}const D=r.aw(u.x,_,x)-u.x,k=r.aw(u.y,S,C)-u.y,B=r.bH(R,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(D*D+k*k+B*B))}function Bc(c,t,n,u,p,_,x){const S=c.context,C=c.renderPass==="shadow",R=c.shadowRenderer,D=C&&R?R.getShadowPassDepthMode():new Kt(S.gl.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D),k=c.isTileAffectedByFog(_);if(n.meshes)for(const B of n.meshes){const U=["MODEL_POSITION_ON_GPU"],Z=[];let q,Y,X;u.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");const te=Qo(c,t.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),C&&R)q=c.getOrCreateProgram("modelDepth",{defines:U}),Y=nh(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(n.matrix)),X=R.getShadowPassColorMode();else{wl(U,Z,B,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),q=c.getOrCreateProgram("model",{defines:U,overrideFog:k});const ae=B.material,me=ae.pbrMetallicRoughness,he=t.paint.get("model-opacity").constantOr(1),fe=t.paint.get("model-emissive-strength").constantOr(0);Y=Dc(_.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,c,he,me.baseColorFactor.toRenderColor(null),ae.emissiveFactor,me.metallicFactor,me.roughnessFactor,ae,fe,t,p),R&&(x.shadowUniformsInitialized?q.setShadowUniformValues(S,R.getShadowUniformValues()):(R.setupShadows(_.toUnwrapped(),q,"model-tile",_.overscaledZ),x.shadowUniformsInitialized=!0)),X=te.shouldRenderCutoff||he<1||ae.alphaMode!=="OPAQUE"?Ei.alphaBlended:Ei.unblended}c.uploadCommonUniforms(S,q,_.toUnwrapped(),null,te);const le=B.material.doubleSided?li.disabled:li.backCCW;if(u.instancedDataArray.length>20)Z.push(u.instancedDataBuffer),q.draw(c,S.gl.TRIANGLES,D,oi.disabled,X,le,Y,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,c.transform.zoom,void 0,Z,u.instancedDataArray.length);else{const ae=C?"u_instance":"u_normal_matrix";for(let me=0;me<u.instancedDataArray.length;++me)Y[ae]=new Float32Array(u.instancedDataArray.arrayBuffer,64*me,16),q.draw(c,S.gl.TRIANGLES,D,oi.disabled,X,le,Y,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,c.transform.zoom,void 0,Z)}}if(n.children)for(const B of n.children)Bc(c,t,B,u,p,_,x)}const hf=[1,-1,1];function df(c,t,n,u){if(!n.modelManager)return!0;const p=n.modelManager;if(!n.shadowRenderer)return!0;const _=n.shadowRenderer,x=t.aabb;let S=!0,C=c.maxHeight;if(C===0){let D=0;for(const k in c.instancesPerModel){const B=p.getModel(k,u);B?D=Math.max(D,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):S=!1}C=c.maxScale*D*1.41+c.maxVerticalOffset,S&&(c.maxHeight=C)}x.max[2]=C,x.min[2]+=c.terrainElevationMin,x.max[2]+=c.terrainElevationMax,r.ab.vec3.transformMat4(x.min,x.min,t.tileMatrix),r.ab.vec3.transformMat4(x.max,x.max,t.tileMatrix);const R=x.intersects(_.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=R===2),R===0}function za(c,t){const n=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],_=c.uniformValues.u_cutoff_params[3];return u===n||_===p?1:r.aw(((t-n)/(u-n)-p)/(_-p),0,1)}function ff(c,t,n,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();r.ab.mat4.multiply(p,p,c);const _=r.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let x=r.ab.vec4.transformMat4(r.ab.vec4.create(),_,p),S=x,C=x;_[1]=n.max[1],x=r.ab.vec4.transformMat4(r.ab.vec4.create(),_,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C,_[0]=n.max[0],x=r.ab.vec4.transformMat4(r.ab.vec4.create(),_,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C,_[1]=n.min[1],x=r.ab.vec4.transformMat4(r.ab.vec4.create(),_,p),S=x[1]<S[1]?x:S,C=x[1]>C[1]?x:C;const R=r.aw(u[0],0,1),D=100*t.pixelsPerMeter*r.aw(u[1],0,1),k=r.aw(u[2],0,1),B=r.ab.vec4.lerp(r.ab.vec4.create(),S,C,R),U=Math.tan(.5*t.fovX),Z=-B[2]*U;if(D===0)return B[1]<-Math.abs(Z)?k:1;const q=(-Math.abs(Z)-B[1])/D,Y=(te,le,ae)=>(1-ae)*te+ae*le,X=r.aw(Y(1,k,q),k,1);return Y(1,X,r.aw((t.pitch-20)/20,0,1))}class sa{}class pf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,u){{const k=this._storage.get(n.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const p=u.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),x=new ArrayBuffer(_),S=new Int16Array(x);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const C=new r.dq;for(let k=0;k<_/2;k+=3){const B=S[k],U=S[k+1],Z=S[k+2];C.emplaceBack(B,U),C.emplaceBack(U,Z),C.emplaceBack(Z,B)}const R=u.bindVertexArrayOES.current,D=new sa;return D.buf=new oo(u,C),D.lastUsedFrameIdx=t,this._storage.set(n.id,D),u.bindVertexArrayOES.set(R),D.buf}update(t){for(const[n,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class dh{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const mf=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class _f{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class hr{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const gf=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class yf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new r.dr,S=new r.aU;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,gf.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const p=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const x={u_vignetteShape:(_={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,Kt.disabled,oi.disabled,Ei.alphaBlended,li.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,p,{})}var _}}class Nc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),_=u.toLngLat(),x=r.ai(_.lng),S=r.ai(_.lat),C=t.pixelsPerMeter/n,R=x*r.ds,D=r.ds*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const k=-this._offsetYPrev+D,B=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*C,this._accumulatedOffsetY+=k*C,this._accumulatedElevation+=B*C,this._offsetXPrev=R,this._offsetYPrev=D,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function oa(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function fh(c){const t=r.di(1323123451230),n=[];for(let u=0;u<c;++u){const p=2*t()-1,_=2*t()-1,x=2*t()-1;n.push(r.ab.vec3.fromValues(p,_,x))}return n}function co(c,t,n,u,p){const _=r.aw((p-n)/(u-n),0,1);return(1-_)*c+_*t}class ph{constructor(t){this._movement=new Nc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new yf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,_=r.ab.quat.identity([]);r.ab.quat.rotateX(_,_,r.ai(90)-u._pitch),r.ab.quat.rotateZ(_,_,-u.angle);const x=r.ab.mat4.fromQuat(new Float32Array(16),_),S=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=r.ab.mat4.transpose([],S),R=r.ab.mat4.multiply([],C,x),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*n,this._prevTime=D,{projectionMatrix:p,modelviewMatrix:R}}}class Tl extends ph{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new hr(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=fh(this.particlesCount),p=new r.dt,_=new r.aU;let x=0;const S=r.di(1323123451230);for(let C=0;C<u.length;++C){const R=u[C],D=[2*S()-1,S(),S(),S()];p.emplaceBack(R[0],R[1],R[2],-1,-1,...D),p.emplaceBack(R[0],R[1],R[2],1,-1,...D),p.emplaceBack(R[0],R[1],R[2],1,1,...D),p.emplaceBack(R[0],R[1],R[2],-1,1,...D),_.emplaceBack(x+0,x+1,x+2),_.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,mf.members),this.particlesIdx=n.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(n.revealStart>u)return;const p=co(0,1,n.revealStart,n.revealStart+n.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let x=[-_.direction.x,_.direction.y,-100];r.ab.vec3.normalize(x,x);const S=structuredClone(this._vignetteParams);S.strength*=p,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,_.timeFactor),R=t.context,D=R.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(R,{width:t.width,height:t.height,data:null},D.RGBA8)),_.distortionStrength>0&&(R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(R,B),R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const U=[_.color.r,_.color.g,_.color.b,_.color.a],Z=(q,Y)=>{const X=oa(this._movement.getPosition(),q),te=_.dropletSizeX,le=_.dropletSizeX*_.dropletSizeYScale,ae=t.width/2,me=t.height/2,he=co(0,_.screenThinning.start,0,1,_.screenThinning.intensity),fe=co(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),ue=co(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),xe=(Me={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:q,rainDropletSize:[te,le],distortionStrength:_.distortionStrength,rainDirection:x,color:U,screenSize:[k.width,k.height],thinningCenterPos:[ae,me],thinningShape:[he,fe,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:Y?0:1},{u_modelview:Float32Array.from(Me.modelview),u_projection:Float32Array.from(Me.projection),u_time:Me.time,u_cam_pos:Me.camPos,u_texScreen:0,u_velocityConeAperture:Me.velocityConeAperture,u_velocity:Me.velocity,u_boxSize:Me.boxSize,u_rainDropletSize:Me.rainDropletSize,u_distortionStrength:Me.distortionStrength,u_rainDirection:Me.rainDirection,u_color:Me.color,u_screenSize:Me.screenSize,u_thinningCenterPos:Me.thinningCenterPos,u_thinningShape:Me.thinningShape,u_thinningAffectedRatio:Me.thinningAffectedRatio,u_thinningParticleOffset:Me.thinningParticleOffset,u_shapeDirectionalPower:Me.shapeDirectionalPower,u_shapeNormalPower:Me.shapeNormalPower,u_mode:Me.mode});var Me;const $e=Math.round(_.intensity*this.particlesCount),ke=r.b7.simpleSegment(0,0,4*$e,2*$e);B.draw(t,D.TRIANGLES,Kt.disabled,oi.disabled,Ei.alphaBlended,li.disabled,xe,"rain_particles",this.particlesVx,this.particlesIdx,ke,{})};_.distortionStrength>0&&Z(_.boxSize,!0),Z(_.boxSize,!1),this._vignette.draw(t,S)}}const xf=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class vf extends ph{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new hr(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=fh(this.particlesCount),p=new r.du,_=new r.aU;let x=0;const S=r.di(1323123451230);for(let C=0;C<u.length;++C){const R=u[C],D=S(),k=S(),B=S(),U=[C/u.length,D,k,B],Z=[S(),S()];p.emplaceBack(R[0],R[1],R[2],-1,-1,...U,...Z),p.emplaceBack(R[0],R[1],R[2],1,-1,...U,...Z),p.emplaceBack(R[0],R[1],R[2],1,1,...U,...Z),p.emplaceBack(R[0],R[1],R[2],-1,1,...U,...Z),_.emplaceBack(x+0,x+1,x+2),_.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,xf.members),this.particlesIdx=n.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let u=[-n.direction.x,n.direction.y,-100];r.ab.vec3.normalize(u,u);const p=structuredClone(this._vignetteParams),_=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(_.revealStart>x)return;const S=co(0,1,_.revealStart,_.revealStart+_.revealRange,x);p.strength*=S,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=t.context,D=R.gl,k=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(R,B),((U,Z,q)=>{const Y=oa(this._movement.getPosition(),U),X=k.width/2,te=k.height/2,le=co(0,q.screenThinning.start,0,1,q.screenThinning.intensity),ae=co(.001,q.screenThinning.range,0,1,q.screenThinning.intensity),me=co(0,q.screenThinning.particleOffset,0,1,q.screenThinning.intensity),he=(fe={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:q.velocityConeAperture,velocity:q.velocity,horizontalOscillationRadius:q.horizontalOscillationRadius,horizontalOscillationRate:q.horizontalOscillationRate,boxSize:U,billboardSize:1*q.billboardSize,simpleShapeParameters:[q.shapeFadeStart,q.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[X,te],thinningShape:[le,ae,Math.pow(10,q.screenThinning.fadePower)],thinningAffectedRatio:q.screenThinning.affectedRatio,thinningParticleOffset:me,color:[q.color.r,q.color.g,q.color.b,q.color.a],direction:u},{u_modelview:Float32Array.from(fe.modelview),u_projection:Float32Array.from(fe.projection),u_time:fe.time,u_cam_pos:fe.camPos,u_velocityConeAperture:fe.velocityConeAperture,u_velocity:fe.velocity,u_horizontalOscillationRadius:fe.horizontalOscillationRadius,u_horizontalOscillationRate:fe.horizontalOscillationRate,u_boxSize:fe.boxSize,u_billboardSize:fe.billboardSize,u_simpleShapeParameters:fe.simpleShapeParameters,u_screenSize:fe.screenSize,u_thinningCenterPos:fe.thinningCenterPos,u_thinningShape:fe.thinningShape,u_thinningAffectedRatio:fe.thinningAffectedRatio,u_thinningParticleOffset:fe.thinningParticleOffset,u_particleColor:fe.color,u_direction:fe.direction});var fe;const ue=Math.round(q.intensity*this.particlesCount),xe=r.b7.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&B.draw(t,D.TRIANGLES,Kt.disabled,oi.disabled,Ei.alphaBlended,li.disabled,he,"snow_particles",this.particlesVx,this.particlesIdx,xe,{})})(n.boxSize,0,n),this._vignette.draw(t,p)}}const Vc={symbol:function(c,t,n,u,p){if(c.renderPass!=="translucent")return;const _=oi.disabled,x=c.colorModeForRenderPass(),S=n.layout.get("text-variable-anchor"),C=n.layout.get("text-size-scale-range"),R=r.aw(c.scaleFactor,C[0],C[1]);S&&function(B,U,Z,q,Y,X,te,le){const ae=U.transform,me=Y==="map",he=X==="map";for(const fe of B){const ue=q.getTile(fe),xe=ue.getBucket(Z);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const Me=r.bp(xe.textSizeData,ae.zoom,le),$e=xa(fe,xe.getProjection(),ae),ke=ae.calculatePixelsToTileUnitsMatrix(ue),Qe=lr($e,ue.tileID.canonical,he,me,ae,xe.getProjection(),ke),Ke=xe.hasIconTextFit()&&xe.hasIconData();if(Me){const Pe=Math.pow(2,ae.zoom-ue.tileID.overscaledZ);sh(xe,me,he,te,r.cX,ae,Qe,fe,Pe,Me,Ke)}}}(u,c,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),p,R);const D=n.paint.get("icon-opacity").constantOr(1)!==0,k=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||k)?Lc(c,t,n,u,_,x):(D&&Lc(c,t,n,u,_,x,{onlyIcons:!0}),k&&Lc(c,t,n,u,_,x,{onlyText:!0})),t.map.showCollisionBoxes&&(rh(c,t,n,u,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),rh(c,t,n,u,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,n,u){if(c.renderPass!=="translucent")return;const p=n.paint.get("circle-opacity"),_=n.paint.get("circle-stroke-width"),x=n.paint.get("circle-stroke-opacity"),S=n.layout.get("circle-sort-key").constantOr(1)!==void 0,C=n.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const R=c.context,D=R.gl,k=c.transform,B=c.depthModeForSublayer(0,Kt.ReadOnly),U=oi.disabled,Z=c.colorModeForDrapableLayerRenderPass(C),q=k.projection.name==="globe",Y=[r.at(k.center.lng),r.aA(k.center.lat)],X=[];for(let le=0;le<u.length;le++){const ae=u[le],me=t.getTile(ae),he=me.getBucket(n);if(!he||he.projection.name!==k.projection.name)continue;const fe=he.programConfigurations.get(n.id),ue=r.cY(n),xe=c.isTileAffectedByFog(ae);q&&ue.push("PROJECTION_GLOBE_VIEW"),ue.push("DEPTH_D24"),c.terrain&&k.depthOcclusionForSymbolsAndCircles&&ue.push("DEPTH_OCCLUSION");const Me=c.getOrCreateProgram("circle",{config:fe,defines:ue,overrideFog:xe}),$e=he.layoutVertexBuffer,ke=he.globeExtVertexBuffer,Qe=he.indexBuffer,Ke=k.projection.createInversionMatrix(k,ae.canonical),Pe={programConfiguration:fe,program:Me,layoutVertexBuffer:$e,globeExtVertexBuffer:ke,indexBuffer:Qe,uniformValues:r.cZ(c,ae,me,Ke,Y,n),tile:me};if(S){const Ze=he.segments.get();for(const lt of Ze)X.push({segments:new r.b7([lt]),sortKey:lt.sortKey,state:Pe})}else X.push({segments:he.segments,sortKey:0,state:Pe})}S&&X.sort((le,ae)=>le.sortKey-ae.sortKey);const te={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const le of X){const{programConfiguration:ae,program:me,layoutVertexBuffer:he,globeExtVertexBuffer:fe,indexBuffer:ue,uniformValues:xe,tile:Me}=le.state,$e=le.segments;c.terrain&&c.terrain.setupElevationDraw(Me,me,te),c.uploadCommonUniforms(R,me,Me.tileID.toUnwrapped()),me.draw(c,D.TRIANGLES,B,U,Z,li.disabled,xe,n.id,he,ue,$e,n.paint,k.zoom,ae,[fe])}},heatmap:function(c,t,n,u){if(n.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,x=oi.disabled,S=new Ei([_.ONE,_.ONE,_.ONE,_.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(U,Z,q,Y){const X=U.gl,te=Z.width*Y,le=Z.height*Y;U.activeTexture.set(X.TEXTURE1),U.viewport.set([0,0,te,le]);let ae=q.heatmapFbo;if(!ae||ae&&(ae.width!==te||ae.height!==le)){ae&&ae.destroy();const me=X.createTexture();X.bindTexture(X.TEXTURE_2D,me),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ae=q.heatmapFbo=U.createFramebuffer(te,le,!0,null),function(he,fe,ue,xe,Me,$e){const ke=he.gl;ke.texImage2D(ke.TEXTURE_2D,0,he.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Me,$e,0,ke.RGBA,he.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),xe.colorAttachment.set(ue)}(U,0,me,ae,te,le)}else X.bindTexture(X.TEXTURE_2D,ae.colorAttachment.get()),U.bindFramebuffer.set(ae.framebuffer)})(p,c,n,c.transform.projection.name==="globe"?.5:.25),p.clear({color:r.aj.transparent});const C=c.transform,R=C.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:[],k=R?li.frontCCW:li.disabled,B=[r.at(C.center.lng),r.aA(C.center.lat)];for(let U=0;U<u.length;U++){const Z=u[U];if(t.hasRenderableParent(Z))continue;const q=t.getTile(Z),Y=q.getBucket(n);if(!Y||Y.projection.name!==C.projection.name)continue;const X=c.isTileAffectedByFog(Z),te=Y.programConfigurations.get(n.id),le=c.getOrCreateProgram("heatmap",{config:te,defines:D,overrideFog:X}),{zoom:ae}=c.transform;c.terrain&&c.terrain.setupElevationDraw(q,le),c.uploadCommonUniforms(p,le,Z.toUnwrapped());const me=C.projection.createInversionMatrix(C,Z.canonical);le.draw(c,_.TRIANGLES,Kt.disabled,x,S,k,Nt(c,Z,q,me,B,ae,n.paint.get("heatmap-intensity")),n.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,n.paint,c.transform.zoom,te,R?[Y.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,_){const x=p.context,S=x.gl,C=_.heatmapFbo;if(!C)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let R=_.colorRampTexture;R||(R=_.colorRampTexture=new r.T(x,_.colorRamp,S.RGBA8)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,S.TRIANGLES,Kt.disabled,oi.disabled,p.colorModeForRenderPass(),li.disabled,((D,k,B,U)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(c,n))},line:function(c,t,n,u){if(c.renderPass!=="translucent")return;const p=n.paint.get("line-opacity"),_=n.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const x=n.paint.get("line-emissive-strength"),S=n.paint.get("line-occlusion-opacity"),C=n.layout.get("line-elevation-reference"),R=n.layout.get("line-width-unit")==="meters",D=C==="sea",k=c.context,B=k.gl;if(n.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const U=n.layout.get("line-cross-slope"),Z=U!==void 0,q=U<1,Y=c.colorModeForDrapableLayerRenderPass(x),X=c.terrain&&c.terrain.renderingToTexture,te=X?1:r.q.devicePixelRatio,le=n.paint.get("line-dasharray"),ae=le.constantOr(1),me=n.layout.get("line-cap"),he=le.constantOr(null),fe=me.constantOr(null),ue=n.paint.get("line-pattern"),xe=ue.constantOr(1),Me=ue.constantOr(null),$e=n.paint.get("line-opacity").constantOr(1);let ke=!xe&&$e!==1||c.depthOcclusion&&S>0&&S<1;const Qe=n.paint.get("line-gradient"),Ke=xe?"linePattern":"line",Pe=r.c_(n);let Ze;if(X&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(ke=!1),S!==0&&c.depthOcclusion){const Ce=n.paint._values["line-opacity"];Ce&&Ce.value&&Ce.value.kind==="constant"?Ze=Ce.value:r.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Pe.push("VARIABLE_LINE_WIDTH");const lt=(Ce,tt,We,bt,nt)=>{for(const et of Ce){const ft=t.getTile(et);if(xe&&!ft.patternsLoaded())continue;const xt=ft.getBucket(n);if(!xt||xt.hasZOffset&&!nt||!xt.hasZOffset&&nt)continue;c.prepareDrawTile();const Rt=xt.programConfigurations.get(n.id),Bt=c.isTileAffectedByFog(et),si=c.getOrCreateProgram(Ke,{config:Rt,defines:tt,overrideFog:Bt,overrideRtt:!nt&&void 0});if(Me&&ft.imageAtlas){const pi=r.A.from(Me).getPrimary().scaleSelf(te).serialize(),Fi=ft.imageAtlas.patternPositions[pi];Fi&&Rt.setConstantPatternPositions(Fi)}if(!xe&&he&&fe&&ft.lineAtlas){const pi=ft.lineAtlas.getDash(he,fe);pi&&Rt.setConstantPatternPositions(pi)}let[Xt,Jt]=n.paint.get("line-trim-offset");(fe==="round"||fe==="square")&&Xt!==Jt&&(Xt===0&&(Xt-=1),Jt===1&&(Jt+=1));const ui=X?et.projMatrix:null,Ri=R?1/xt.tileToMeter/r.ar(ft,1,c.transform.zoom):1,Ki=R?1/xt.tileToMeter/r.ar(ft,1,Math.floor(c.transform.zoom)):1,En=xe?r.c$(c,ft,n,ui,te,Ri,Ki,[Xt,Jt]):r.d0(c,ft,n,ui,xt.lineClipsArray.length,te,Ri,Ki,[Xt,Jt]);if(Qe){const pi=xt.gradients[n.id];let Fi=pi.texture;if(n.gradientVersion!==pi.version){let Ht=256;if(n.stepInterpolant){const Ci=t.getSource().maxzoom,ji=et.canonical.z===Ci?Math.ceil(1<<c.transform.maxZoom-et.canonical.z):1;Ht=r.aw(r.d1(xt.maxLineLength/r.ag*1024*ji),256,k.maxTextureSize)}pi.gradient=r.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:pi.gradient||void 0,clips:xt.lineClipsArray}),pi.texture?pi.texture.update(pi.gradient):pi.texture=new r.T(k,pi.gradient,B.RGBA8),pi.version=n.gradientVersion,Fi=pi.texture}k.activeTexture.set(B.TEXTURE1),Fi.bind(n.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ae&&(k.activeTexture.set(B.TEXTURE0),ft.lineAtlasTexture&&ft.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Rt.updatePaintBuffers()),xe&&(k.activeTexture.set(B.TEXTURE0),ft.imageAtlasTexture&&ft.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Rt.updatePaintBuffers()),nt&&!D&&c.terrain.setupElevationDraw(ft,si),c.uploadCommonUniforms(k,si,et.toUnwrapped());const dn=pi=>{Ze!=null&&(Ze.value=$e*S),si.draw(c,B.TRIANGLES,We,pi,Y,li.disabled,En,n.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,n.paint,c.transform.zoom,Rt,[xt.layoutVertexBuffer2,xt.patternVertexBuffer,xt.zOffsetVertexBuffer]),Ze!=null&&(Ze.value=$e)};if(ke&&!nt){const pi=c.stencilModeForClipping(et).ref;pi===0&&X&&k.clear({stencil:0});const Fi={func:B.EQUAL,mask:255};En.u_alpha_discard_threshold=.8,dn(new oi(Fi,pi,255,B.KEEP,B.KEEP,B.INVERT)),En.u_alpha_discard_threshold=0,dn(new oi(Fi,pi,255,B.KEEP,B.KEEP,B.KEEP))}else ke&&nt&&(En.u_alpha_discard_threshold=.001),dn(nt?bt:c.stencilModeForClipping(et))}};if(n.hasNonElevatedBuckets){const Ce=!X&&c.terrain;S!==0&&Ce?r.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ce?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):lt(u,Pe,c.depthModeForSublayer(0,Kt.ReadOnly),oi.disabled,!1)}if(n.hasElevatedBuckets){Pe.push("ELEVATED"),Z&&Pe.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Pe.push("ELEVATION_REFERENCE_SEA");const Ce=ke?c.stencilModeFor3D():oi.disabled,tt=new Kt(c.depthOcclusion?B.GREATER:B.LEQUAL,Kt.ReadOnly,c.depthRangeFor3D);c.forceTerrainMode=!0,lt(u,Pe,tt,Ce,!0),c.forceTerrainMode=!1}ke&&(c.resetStencilClippingMasks(),X&&k.clear({stencil:0})),S===0||c.depthOcclusion||X||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,n,u){const p=n.paint.get("fill-color"),_=n.paint.get("fill-opacity"),x=n.is3D(),S=new Kt(c.context.gl.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D);if(_.constantOr(1)===0)return;const C=n.paint.get("fill-emissive-strength"),R=c.colorModeForDrapableLayerRenderPass(C),D=n.paint.get("fill-pattern"),k=c.opaquePassEnabledForLayer()&&!D.constantOr(1)&&p.constantOr(r.aj.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===k){const B=x?S:c.depthModeForSublayer(1,c.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly);af(c,t,n,u,B,R,!1)}if(!x&&c.renderPass==="translucent"&&n.paint.get("fill-antialias")){const B=x?S:c.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);af(c,t,n,u,B,R,!0)}},"fill-extrusion":function(c,t,n,u){const p=n.paint.get("fill-extrusion-opacity"),_=c.context,x=_.gl,S=c.terrain,C=S&&S.renderingToTexture;if(p===0)return;const R=c.conflationActive&&c.style.isLayerClipped(n,t.getSource()),D=c.style.order.indexOf(n.fqid);if(R&&function(k,B,U,Z,q){for(const Y of Z){const X=B.getTile(Y).getBucket(U);X&&(X.updateReplacement(Y,k.replacementSource,q),X.uploadCentroid(k.context))}}(c,t,n,u,D),S||R)for(const k of u){const B=t.getTile(k).getBucket(n);B&&yl(c.context,t,k,B,n,S,R)}if(c.renderPass==="shadow"&&c.shadowRenderer){const k=c.shadowRenderer;if(S&&p<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const B=k.getShadowPassDepthMode(),U=k.getShadowPassColorMode();Oc(c,t,n,u,B,oi.disabled,U,R)}else if(c.renderPass==="translucent"){const k=!n.paint.get("fill-extrusion-pattern").constantOr(1),B=n.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!C&&B.a!==0){const U=new Kt(c.context.gl.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D);p===1&&k?Oc(c,t,n,u,U,oi.disabled,Ei.unblended,R):(Oc(c,t,n,u,U,oi.disabled,Ei.disabled,R),Oc(c,t,n,u,U,c.stencilModeFor3D(),c.colorModeForRenderPass(),R),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&k&&(!S&&c.transform.projection.name!=="globe"||C)){const U=n.paint.get("fill-extrusion-opacity"),Z=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Y=n.paint.get("fill-extrusion-flood-light-intensity"),X=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",te=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(X?null:n.lut).toArray01().slice(0,3),le=Z>0&&q>0,ae=Y>0,me=(fe,ue,xe)=>(1-xe)*fe+xe*ue,he=fe=>{const ue=c.depthModeForSublayer(1,Kt.ReadOnly,x.LEQUAL,!0),xe=n.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=me(.1,3,xe),$e=c._showOverdrawInspector;if(!$e){const ke=new oi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Qe=new Ei([x.ONE,x.ONE,x.ONE,x.ONE],r.aj.transparent,[!1,!1,!1,!0],x.MIN);gl(c,t,n,u,ue,ke,Qe,li.disabled,fe,"sdf",U,Z,q,Y,te,Me,R,!1)}{const ke=$e?oi.disabled:new oi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Qe=$e?c.colorModeForRenderPass():new Ei([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.aj.transparent,[!0,!0,!0,!0]);gl(c,t,n,u,ue,ke,Qe,li.disabled,fe,"color",U,Z,q,Y,te,Me,R,!1)}};if(C){const fe=(ue,xe,Me)=>{const $e=c.depthModeForSublayer(1,Kt.ReadOnly,x.LEQUAL,!1),ke=n.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=me(.1,3,ke);{const Ke=new Ei([x.ONE,x.ONE,x.ONE,x.ONE],r.aj.transparent,[!1,!1,!1,!0]);gl(c,t,n,u,$e,oi.disabled,Ke,li.disabled,ue,"clear",U,Z,q,Y,te,Qe,R,xe)}{const Ke=new oi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Pe=new Ei([x.ONE,x.ONE,x.ONE,x.ONE],r.aj.transparent,[!1,!1,!1,!0],x.MIN);gl(c,t,n,u,$e,Ke,Pe,li.disabled,ue,"sdf",U,Z,q,Y,te,Qe,R,xe)}{const Ke=ue?x.ZERO:x.ONE_MINUS_DST_ALPHA,Pe=new oi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ze=new Ei([Ke,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.aj.transparent,[!0,!0,!0,!0]);gl(c,t,n,u,$e,Pe,Ze,li.disabled,ue,"color",U,Z,q,Y,te,Qe,R,xe)}{const Ke=new Ei([x.ONE,x.ONE,x.ONE,ue?x.ZERO:x.ONE],r.aj.transparent,[!1,!1,!1,!0],ue?x.FUNC_ADD:x.MAX);gl(c,t,n,u,$e,oi.disabled,Ke,li.disabled,ue,"clear",U,Z,q,Y,te,Qe,R,xe,Me)}};if(le||ae){let ue;if(c.prepareDrawTile(),S){const xe=S.drapeBufferSize[0],Me=S.drapeBufferSize[1];ue=S.framebufferCopyTexture,ue&&(!ue||ue.size[0]===xe&&ue.size[1]===Me)||(ue&&ue.destroy(),ue=S.framebufferCopyTexture=new r.T(_,new r.r({width:xe,height:Me}),x.RGBA8)),ue.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,xe,Me)}le&&fe(!0,!1,ue),ae&&fe(!1,!0,ue)}}else le&&he(!0),ae&&he(!1),(le||ae)&&c.resetStencilClippingMasks()}}},hillshade:function(c,t,n,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,_=c.terrain&&c.terrain.renderingToTexture,[x,S]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(const C of S){const R=t.getTile(C);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")Ty(c,R,n);else if(c.renderPass==="translucent"){const D=c.depthModeForSublayer(0,Kt.ReadOnly),k=n.paint.get("hillshade-emissive-strength"),B=c.colorModeForDrapableLayerRenderPass(k),U=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(C):x[C.overscaledZ];um(c,C,R,n,D,U,B)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,n,u,p,_){if(c.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const x=c.transform.projection.name==="globe",S=n.paint.get("raster-elevation")!==0,C=S&&x;if(c.renderElevatedRasterBackface&&!C)return;const R=c.context,D=R.gl,k=t.getSource(),B=function(he,fe,ue,xe){const Me=fe.paint.get("raster-color"),$e=he.type==="raster-array",ke=[],Qe=fe.paint.get("raster-resampling"),Ke=fe.paint.get("raster-color-mix");let Pe=fe.paint.get("raster-color-range");const Ze=[Ke[0],Ke[1],Ke[2],0],lt=Ke[3];let Ce=Qe==="nearest"?xe.NEAREST:xe.LINEAR;if($e&&(ke.push("RASTER_ARRAY"),Me||ke.push("RASTER_COLOR"),Qe==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),Ce=xe.NEAREST,!Pe&&he.rasterLayers)){const tt=he.rasterLayers.find(({id:We})=>We===fe.sourceLayer);tt&&tt.fields&&tt.fields.range&&(Pe=tt.fields.range)}if(Pe=Pe||[0,1],Me){ke.push("RASTER_COLOR"),ue.activeTexture.set(xe.TEXTURE2),fe.updateColorRamp(Pe);let tt=fe.colorRampTexture;tt||(tt=fe.colorRampTexture=new r.T(ue,fe.colorRamp,xe.RGBA8)),tt.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}return{mix:Ze,range:Pe,offset:lt,defines:ke,resampling:Ce}}(k,n,R,D);if(k instanceof r.aJ&&!u.length&&!x)return;const U=n.paint.get("raster-emissive-strength"),Z=c.colorModeForDrapableLayerRenderPass(U),q=c.terrain&&c.terrain.renderingToTexture,Y=!c.options.moving,X=n.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(k instanceof r.aJ&&!u.length&&(k.onNorthPole||k.onSouthPole)){const he=S?c.stencilModeFor3D():oi.disabled;return void Fe(!!k.onNorthPole,null,c,t,n,U,B,li.disabled,he)}if(!u.length)return;const[te,le]=k instanceof r.aJ||q?[{},u]:c.stencilConfigForOverlap(u),ae=le[le.length-1].overscaledZ;C&&B.defines.push("PROJECTION_GLOBE_VIEW"),S&&B.defines.push("RENDER_CUTOFF");const me=(he,fe,ue)=>{for(const xe of he){const Me=xe.toUnwrapped(),$e=t.getTile(xe);if(q&&(!$e||!$e.hasData()))continue;R.activeTexture.set(D.TEXTURE0);const ke=ah($e,k,n,B);if(!ke||!ke.texture)continue;const{texture:Qe,mix:Ke,offset:Pe,tileSize:Ze,buffer:lt}=ke;let Ce,tt;q?(Ce=Kt.disabled,tt=xe.projMatrix):S?(Ce=new Kt(D.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D),tt=x?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(Me,Y)):(Ce=c.depthModeForSublayer(xe.overscaledZ-ae,n.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,D.LESS),tt=c.transform.calculateProjMatrix(Me,Y));const We=c.terrain&&q?c.terrain.stencilModeForRTTOverlap(xe):te[xe.overscaledZ],bt=_?0:n.paint.get("raster-fade-duration");$e.registerFadeDuration(bt);const nt=t.findLoadedParent(xe,0),et=Ic($e,nt,t,c.transform,bt);let ft,xt;c.terrain&&c.terrain.prepareDrawTile(),R.activeTexture.set(D.TEXTURE0),Qe.bind(X,D.CLAMP_TO_EDGE),R.activeTexture.set(D.TEXTURE1),nt?(nt.texture&&nt.texture.bind(X,D.CLAMP_TO_EDGE),ft=Math.pow(2,nt.tileID.overscaledZ-$e.tileID.overscaledZ),xt=[$e.tileID.canonical.x*ft%1,$e.tileID.canonical.y*ft%1]):Qe.bind(X,D.CLAMP_TO_EDGE),Qe.useMipmap&&R.extTextureFilterAnisotropic&&c.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Rt=c.transform;let Bt;const si=S?Em(Rt):[0,0,0,0];let Xt,Jt,ui,Ri,Ki,En=0;if(C&&k instanceof r.aJ&&k.coordinates.length>3)Xt=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Jt=Float32Array.from(Rt.globeMatrix),ui=Float32Array.from(r.cD(Rt)),Ri=[r.at(Rt.center.lng),r.aA(Rt.center.lat)],Bt=k.elevatedGlobePerspectiveTransform,Ki=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Ht=r.cE(xe.canonical);En=r.cF(Ht.getCenter().lat),Xt=Float32Array.from(r.bb(r.cH(xe.canonical))),Jt=Float32Array.from(Rt.globeMatrix),ui=Float32Array.from(r.cD(Rt)),Ri=[r.at(Rt.center.lng),r.aA(Rt.center.lat)],Bt=[0,0],Ki=Float32Array.from(r.cG(xe.canonical,Ht,En,Rt.worldSize/Rt._pixelsPerMercatorPixel))}else Bt=k instanceof r.aJ?k.perspectiveTransform:[0,0],Xt=new Float32Array(16),Jt=new Float32Array(9),ui=new Float32Array(16),Ri=[0,0],Ki=new Float32Array(9);const dn=ia(tt,Xt,Jt,ui,Ki,xt||[0,0],r.ae(c.transform.zoom),Ri,si,ft||1,et,n,Bt,S?n.paint.get("raster-elevation"):0,2,Ke,Pe,B.range,Ze,lt,U),pi=c.isTileAffectedByFog(xe),Fi=c.getOrCreateProgram("raster",{defines:B.defines,overrideFog:pi});if(c.uploadCommonUniforms(R,Fi,Me),k instanceof r.aJ){const Ht=k.elevatedGlobeVertexBuffer,Ci=k.elevatedGlobeIndexBuffer;if(q||!x)k.boundsBuffer&&k.boundsSegments&&Fi.draw(c,D.TRIANGLES,Ce,oi.disabled,Z,li.disabled,dn,n.id,k.boundsBuffer,c.quadTriangleIndexBuffer,k.boundsSegments);else if(Ht&&Ci){const ji=Rt.zoom<=r.c6?k.elevatedGlobeSegments:k.getSegmentsForLongitude(Rt.center.lng);ji&&Fi.draw(c,D.TRIANGLES,Ce,oi.disabled,Z,fe,dn,n.id,Ht,Ci,ji)}}else if(C){Ce=new Kt(D.LEQUAL,Kt.ReadOnly,c.depthRangeFor3D);const Ht=c.globeSharedBuffers;if(Ht){const[Ci,ji,Zi]=Ht.getGridBuffers(En,!1);Fi.draw(c,D.TRIANGLES,Ce,ue||We,c.colorModeForRenderPass(),fe,dn,n.id,Ci,ji,Zi)}}else{const{tileBoundsBuffer:Ht,tileBoundsIndexBuffer:Ci,tileBoundsSegments:ji}=c.getTileBoundsBuffers($e);Fi.draw(c,D.TRIANGLES,Ce,We,Z,li.disabled,dn,n.id,Ht,Ci,ji)}}if(!(k instanceof r.aJ)&&C)for(const xe of he){const Me=xe.canonical.y===(1<<xe.canonical.z)-1;xe.canonical.y===0&&Fe(!0,xe,c,t,n,U,B,fe,ue||oi.disabled),Me&&Fe(!1,xe,c,t,n,U,B,fe===li.frontCW?li.backCW:li.frontCW,ue||oi.disabled)}};C?me(le,c.renderElevatedRasterBackface?li.backCW:li.frontCW,c.stencilModeFor3D()):me(le,li.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,n,u,p,_){c.renderPass==="offscreen"&&function(x,S,C,R){if(!R.length)return;const D=x.context,k=D.gl,B=S.getSource();if(!(B instanceof Xn))return;const U=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let Z=C.particlePositionRGBAImage;if(!Z||Z.width!==U){const le=function(ae){const me=ae*ae,he=new Uint8Array(4*me),fe=function(xe){return xe|=0,xe=Math.imul(2747636419^xe,2654435769),xe=Math.imul(xe^xe>>>16,2654435769),((xe=Math.imul(xe^xe>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let xe=0;xe<me;xe++){const Me=ue*(fe(2*xe+0)+qt),$e=ue*(fe(2*xe+1)+qt),ke=255*Me%1,Qe=255*$e%1,Ke=ke,Pe=$e-Qe/255,Ze=Qe;he[4*xe+0]=255*(Me-ke/255),he[4*xe+1]=255*Ke,he[4*xe+2]=255*Pe,he[4*xe+3]=255*Ze}return he}(U);Z=C.particlePositionRGBAImage=new r.r({width:U,height:U},le)}let q=C.particleFramebuffer;q?q.width!==U&&(q.destroy(),q=C.particleFramebuffer=D.createFramebuffer(U,U,!0,null)):q=C.particleFramebuffer=D.createFramebuffer(U,U,!0,null);const Y=[];for(const le of R){const ae=S.getTile(le);if(!(ae instanceof Ko))continue;const me=Am(ae,B,C);if(!me)continue;const he=[ae.tileSize,ae.tileSize];let fe=C.tileFramebuffer;fe||(fe=C.tileFramebuffer=D.createFramebuffer(he[0],he[1],!0,null));let ue=ae.rasterParticleState;ue||(ue=ae.rasterParticleState=new Mm(D,le,he,Z));const xe=ue.update(C.lastInvalidatedAt);ue.particleTextureDimension!==U&&ue.updateParticleTexture(le,Z);const Me=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=Me;const $e=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=$e,Y.push([le,me,ue,xe])}if(Y.length===0)return;const X=r.q.now(),te=C.previousDrawTimestamp?.001*(X-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=X,C.hasColorMap()){D.activeTexture.set(k.TEXTURE0+2);let le=C.colorRampTexture;le||(le=C.colorRampTexture=new r.T(D,C.colorRamp,k.RGBA8)),le.bind(k.LINEAR,k.CLAMP_TO_EDGE)}D.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(le,ae,me){const he=le.context,fe=he.gl,ue=ae.tileFramebuffer;he.activeTexture.set(fe.TEXTURE0);const xe={u_texture:0,u_opacity:1.05*($e=ae.paint.get("raster-particle-fade-opacity-factor"))/($e+.05)},Me=le.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var $e;for(const ke of me){const[,,Qe,Ke]=ke;ue.colorAttachment.set(Qe.targetColorTexture.texture),he.viewport.set([0,0,ue.width,ue.height]),he.clear({color:r.aj.transparent}),Ke&&(Qe.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),Me.draw(le,fe.TRIANGLES,Kt.disabled,oi.disabled,Ei.alphaBlended,li.disabled,xe,ae.id,le.viewportBuffer,le.quadTriangleIndexBuffer,le.viewportSegments))}}(x,C,Y),function(le,ae,me,he){const fe=le.context,ue=fe.gl,xe=me.tileFramebuffer,Me=le.transform.projection.name==="globe",$e=me.paint.get("raster-particle-max-speed");for(const ke of he){const[Qe,Ke,Pe]=ke;fe.activeTexture.set(ue.TEXTURE0+0),Ke.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),xe.colorAttachment.set(Pe.targetColorTexture.texture);const Ze=le.getOrCreateProgram("rasterParticleDraw",{defines:Ke.defines,overrideFog:!1});fe.activeTexture.set(ue.TEXTURE0+1);const lt=Ke.scalarData?[]:[0,1,2,3].map(We=>r.d4[We](Qe));lt.push(Qe);const Ce=Qe.canonical.x,tt=Qe.canonical.y;for(const We of lt){const bt=ae.getTile(Me?We.wrapped():We);if(!bt)continue;const nt=bt.rasterParticleState;if(!nt)continue;const et=We.canonical.x+(1<<We.canonical.z)*(We.wrap-Qe.wrap),ft=We.canonical.y;nt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const xt=Oy(1,nt.particleTexture0.size[0],[et-Ce,ft-tt],0,Ke.texture.size,2,$e,Ke.textureOffset,Ke.scale,Ke.offset);Ze.draw(le,ue.POINTS,Kt.disabled,oi.disabled,Ei.alphaBlended,li.disabled,xt,me.id,nt.particleIndexBuffer,void 0,nt.particleSegment)}}}(x,S,C,Y),D.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(le,ae,me,he){const fe=le.context,ue=fe.gl,xe=ae.paint.get("raster-particle-max-speed"),Me=he*ae.paint.get("raster-particle-speed-factor")*.15,$e=function(Qe){return Math.pow(Qe,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),ke=ae.particleFramebuffer;fe.viewport.set([0,0,ke.width,ke.height]);for(const Qe of me){const[,Ke,Pe]=Qe;fe.activeTexture.set(ue.TEXTURE0+0),Ke.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),fe.activeTexture.set(ue.TEXTURE0+1);const Ze=Pe.particleTexture0;Ze.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const lt=ky(1,Ze.size[0],0,Ke.texture.size,xe,Me,$e,Ke.textureOffset,Ke.scale,Ke.offset);ke.colorAttachment.set(Pe.particleTexture1.texture),fe.clear({color:r.aj.transparent}),le.getOrCreateProgram("rasterParticleUpdate",{defines:Ke.defines}).draw(le,ue.TRIANGLES,Kt.disabled,oi.disabled,Ei.unblended,li.disabled,lt,ae.id,le.viewportBuffer,le.quadTriangleIndexBuffer,le.viewportSegments)}}(x,C,Y,te)}(c,t,n,u),c.renderPass==="translucent"&&(function(x,S,C,R,D){const k=x.context,B=k.gl,U=S.getSource().tileSize,Z=5*(1-r.ac(r.bY,r.bY+1,x.transform.zoom))*U+C.paint.get("raster-particle-elevation"),q=!x.options.moving,Y=x.transform.projection.name==="globe";if(!R.length)return;const[X,te]=x.stencilConfigForOverlap(R),le=[];Y&&le.push("PROJECTION_GLOBE_VIEW");const ae=x.stencilModeFor3D();for(const me of te){const he=me.toUnwrapped(),fe=S.getTile(me);if(!fe.rasterParticleState)continue;const ue=fe.rasterParticleState,xe=100;fe.registerFadeDuration(xe);const Me=S.findLoadedParent(me,0),$e=Ic(fe,Me,S,x.transform,xe);let ke,Qe;x.terrain&&x.terrain.prepareDrawTile(),k.activeTexture.set(B.TEXTURE0),ue.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),k.activeTexture.set(B.TEXTURE1),Me&&Me.rasterParticleState?(Me.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ke=Math.pow(2,Me.tileID.overscaledZ-fe.tileID.overscaledZ),Qe=[fe.tileID.canonical.x*ke%1,fe.tileID.canonical.y*ke%1]):ue.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Ke=Y?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(he,q),Pe=x.transform,Ze=Im(Pe),lt=r.cE(me.canonical),Ce=r.cF(lt.getCenter().lat);let tt,We,bt,nt,et;Y?(tt=Float32Array.from(r.bb(r.cH(me.canonical))),We=Float32Array.from(Pe.globeMatrix),bt=Float32Array.from(r.cD(Pe)),nt=[r.at(Pe.center.lng),r.aA(Pe.center.lat)],et=Float32Array.from(r.cG(me.canonical,lt,Ce,Pe.worldSize/Pe._pixelsPerMercatorPixel))):(tt=new Float32Array(16),We=new Float32Array(9),bt=new Float32Array(16),nt=[0,0],et=new Float32Array(9));const ft=Qd(Ke,tt,We,bt,et,Qe||[0,0],r.ae(x.transform.zoom),nt,Ze,ke||1,$e,Z),xt=x.isTileAffectedByFog(me),Rt=x.getOrCreateProgram("rasterParticle",{defines:le,overrideFog:xt});if(x.uploadCommonUniforms(k,Rt,he),Y){const Bt=new Kt(B.LEQUAL,Kt.ReadOnly,x.depthRangeFor3D),si=0,Xt=x.globeSharedBuffers;if(Xt){const[Jt,ui,Ri]=Xt.getGridBuffers(Ce,si!==0);Rt.draw(x,B.TRIANGLES,Bt,ae,Ei.alphaBlended,x.renderElevatedRasterBackface?li.frontCCW:li.backCCW,ft,C.id,Jt,ui,Ri)}}else{const Bt=x.depthModeForSublayer(0,Kt.ReadOnly),si=X[me.overscaledZ],{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:Jt,tileBoundsSegments:ui}=x.getTileBoundsBuffers(fe);Rt.draw(x,B.TRIANGLES,Bt,si,Ei.alphaBlended,li.disabled,ft,C.id,Xt,Jt,ui)}}x.resetStencilClippingMasks()}(c,t,n,u),c.style.map.triggerRepaint())},background:function(c,t,n,u){const p=n.paint.get("background-color"),_=n.paint.get("background-color-use-theme").constantOr("default")==="none",x=n.paint.get("background-opacity"),S=n.paint.get("background-emissive-strength"),C=n.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const R=c.context,D=R.gl,k=c.transform,B=k.tileSize,U=n.paint.get("background-pattern");let Z;if(U!==void 0&&(U===null||(Z=c.imageManager.getPattern(U.toString(),n.scope,c.style.getLut(n.scope)),!Z)))return;const q=!U&&p.a===1&&x===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==q)return;const Y=oi.disabled,X=c.depthModeForSublayer(0,q==="opaque"?Kt.ReadWrite:Kt.ReadOnly),te=c.colorModeForDrapableLayerRenderPass(S),le=U?"backgroundPattern":"background";let ae,me=u;if(me||(ae=c.getBackgroundTiles(),me=Object.values(ae).map(he=>he.tileID)),U&&(R.activeTexture.set(D.TEXTURE0),c.imageManager.bind(c.context,n.scope)),C){const he=c.getOrCreateProgram(le,{overrideFog:!1,overrideRtt:!0}),fe=new Float32Array(r.ab.mat4.identity([])),ue=new r.aG(0,0,0,0,0),xe=U?Sm(fe,S,x,c,0,n.scope,Z,C,{tileID:ue,tileSize:B}):tf(fe,S,x,p.toRenderColor(_?null:n.lut));he.draw(c,D.TRIANGLES,X,Y,te,li.disabled,xe,n.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const he of me){const fe=c.isTileAffectedByFog(he),ue=c.getOrCreateProgram(le,{overrideFog:fe}),xe=he.toUnwrapped(),Me=u?he.projMatrix:c.transform.calculateProjMatrix(xe);c.prepareDrawTile();const $e=t?t.getTile(he):ae?ae[he.key]:new Yo(he,B,k.zoom,c),ke=U?Sm(Me,S,x,c,0,n.scope,Z,C,{tileID:he,tileSize:B}):tf(Me,S,x,p.toRenderColor(_?null:n.lut));c.uploadCommonUniforms(R,ue,xe);const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:Ke,tileBoundsSegments:Pe}=c.getTileBoundsBuffers($e);ue.draw(c,D.TRIANGLES,X,Y,te,li.disabled,ke,n.id,Qe,Ke,Pe)}},sky:function(c,t,n){const u=c._atmosphere?r.ae(c.transform.zoom):1,p=n.paint.get("sky-opacity")*u;if(p===0)return;const _=c.context,x=n.paint.get("sky-type"),S=new Kt(_.gl.LEQUAL,Kt.ReadOnly,[0,1]),C=c.frameCounter/1e3%1;x==="atmosphere"?c.renderPass==="offscreen"?n.needsSkyboxCapture(c)&&(function(R,D,k,B){const U=R.context,Z=U.gl;let q=D.skyboxFbo;if(!q){q=D.skyboxFbo=U.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Pm(U),D.skyboxTexture=U.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,D.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let le=0;le<6;++le)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(q.framebuffer),U.viewport.set([0,0,32,32]);const Y=D.getCenter(R,!0),X=R.getOrCreateProgram("skyboxCapture"),te=new Float64Array(16);r.ab.mat4.identity(te),r.ab.mat4.rotateY(te,te,.5*-Math.PI),sr(R,D,X,te,Y,0),r.ab.mat4.identity(te),r.ab.mat4.rotateY(te,te,.5*Math.PI),sr(R,D,X,te,Y,1),r.ab.mat4.identity(te),r.ab.mat4.rotateX(te,te,.5*-Math.PI),sr(R,D,X,te,Y,2),r.ab.mat4.identity(te),r.ab.mat4.rotateX(te,te,.5*Math.PI),sr(R,D,X,te,Y,3),r.ab.mat4.identity(te),sr(R,D,X,te,Y,4),r.ab.mat4.identity(te),r.ab.mat4.rotateY(te,te,Math.PI),sr(R,D,X,te,Y,5),U.viewport.set([0,0,R.width,R.height])}(c,n),n.markSkyboxValid(c)):c.renderPass==="sky"&&function(R,D,k,B,U){const Z=R.context,q=Z.gl,Y=R.transform,X=R.getOrCreateProgram("skybox");Z.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,D.skyboxTexture);const te=((le,ae,me,he,fe)=>({u_matrix:le,u_sun_direction:ae,u_cubemap:0,u_opacity:he,u_temporal_offset:fe}))(Y.skyboxMatrix,D.getCenter(R,!1),0,B,U);R.uploadCommonUniforms(Z,X),X.draw(R,q.TRIANGLES,k,oi.disabled,R.colorModeForRenderPass(),li.backCW,te,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(c,n,S,p,C):x==="gradient"&&c.renderPass==="sky"&&function(R,D,k,B,U){const Z=R.context,q=Z.gl,Y=R.transform,X=R.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Pm(Z)),Z.activeTexture.set(q.TEXTURE0);let te=D.colorRampTexture;te||(te=D.colorRampTexture=new r.T(Z,D.colorRamp,q.RGBA8)),te.bind(q.LINEAR,q.CLAMP_TO_EDGE);const le=((ae,me,he,fe,ue)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:me,u_radius:r.ai(he),u_opacity:fe,u_temporal_offset:ue}))(Y.skyboxMatrix,D.getCenter(R,!1),D.paint.get("sky-gradient-radius"),B,U);R.uploadCommonUniforms(Z,X),X.draw(R,q.TRIANGLES,k,oi.disabled,R.colorModeForRenderPass(),li.backCW,le,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(c,n,S,p,C)},debug:function(c,t,n,u,p,_){for(let x=0;x<n.length;x++)if(p){const R=new r.aj(u.r*.8,u.g*.8,u.b*.8,1);ra(c,t,n[x],u,-1,-1,_),ra(c,t,n[x],u,-1,1,_),ra(c,t,n[x],u,1,1,_),ra(c,t,n[x],u,1,-1,_),ra(c,t,n[x],R,0,0,_)}else ra(c,t,n[x],u,0,0,_)},custom:function(c,t,n,u){const p=c.context,_=n.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&n.isDraped(t)){if(c.renderPass==="offscreen"){const x=_.prerender;if(x){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const S=c.transform.pointMerc;x.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.ae(c.transform.zoom),[S.x,S.y],c.transform.pixelsPerMeterRatio)}else x.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const S=_.renderToTile;if(S){const C=u[0].canonical,R=new r.aa(C.x+u[0].wrap*(1<<C.z),C.y,C.z);p.setDepthMode(Kt.disabled),p.setStencilMode(oi.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),S.call(_,p.gl,R),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(oi.disabled);const x=_.renderingMode==="3d"?new Kt(c.context.gl.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Kt.ReadOnly);if(p.setDepthMode(x),c.transform.projection.name==="globe"){const S=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.ae(c.transform.zoom),[S.x,S.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,n,u){if(c.renderPass==="opaque")return;const p=n.paint.get("model-opacity").constantOr(1);if(p===0)return;const _=n.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!_||c.terrain&&p<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const x=c.shadowRenderer,S=n.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,S||(x.enabled=!1));const C=()=>{x&&(x.useNormalOffset=!0,S||(x.enabled=!0))},R=t.getSource();if(c.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(X,te,le,ae,me){const he=X.transform;if(he.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${he.projection.name} projection is not yet implemented`);const fe=he.getFreeCameraOptions().position;if(!X.modelManager)return;const ue=X.modelManager;le.modelManager=ue;const xe=X.shadowRenderer;if(!le._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Me=le._unevaluatedLayout._values["model-id"],$e=Object.assign({},le.layout.get("model-id").parameters),ke=X.style.order.indexOf(le.fqid);for(const Qe of ae){const Ke=te.getTile(Qe).getBucket(le);if(!Ke||Ke.projection.name!==he.projection.name)continue;const Pe=Ke.getModelUris();Pe&&!Ke.modelsRequested&&(ue.addModelsFromBucket(Pe,me),Ke.modelsRequested=!0);const Ze=hh(Qe,he);$e.zoom=Ze;const lt=Me.possiblyEvaluate($e);if(lo(X,Ke,Qe),Ar.shadowUniformsInitialized=!1,Ar.useSingleShadowCascade=!!xe&&xe.getMaxCascadeForTile(Qe.toUnwrapped())===0,X.renderPass==="shadow"&&xe){if(X.currentShadowCascade===1&&Ke.isInsideFirstShadowMapFrustum)continue;const We=he.calculatePosMatrix(Qe.toUnwrapped(),he.worldSize);if(Ar.tileMatrix.set(We),Ar.shadowTileMatrix=Float32Array.from(xe.calculateShadowPassMatrixFromMatrix(We)),Ar.aabb.min.fill(0),Ar.aabb.max[0]=Ar.aabb.max[1]=r.ag,Ar.aabb.max[2]=0,df(Ke,Ar,X,le.scope))continue}const Ce=1<<Qe.canonical.z,tt=[((fe.x-Qe.wrap)*Ce-Qe.canonical.x)*r.ag,(fe.y*Ce-Qe.canonical.y)*r.ag,fe.z*Ce*r.ag];X.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&X.style.isLayerClipped(le,te.getSource())&&Ke.updateReplacement(Qe,X.replacementSource,ke,me)&&(Ke.uploaded=!1,Ke.upload(X.context));for(let We in Ke.instancesPerModel){const bt=Ke.instancesPerModel[We];bt.features.length>0&&(We=lt.evaluate(bt.features[0].feature,{}));const nt=ue.getModel(We,me);if(nt&&nt.uploaded)for(const et of nt.nodes)Bc(X,le,et,bt,tt,Qe,Ar)}}}(c,t,n,u,R.type==="vector"?n.scope:""),void C();if(!R.loaded())return;if(R.type==="batched-model")return function(X,te,le,ae){le.resetLayerRenderingStats(X);const me=X.context,he=X.transform,fe=X.style.fog,ue=X.shadowRenderer;if(he.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);const xe=X.transform.getFreeCameraOptions().position,Me=r.ab.vec3.scale([],[xe.x,xe.y,xe.z],X.transform.worldSize),$e=r.ab.vec3.negate([],Me),ke=r.ab.mat4.identity([]),Qe=r.dj(he.center.lat,he.zoom),Ke=r.ab.mat4.fromScaling([],[1,1,1/Qe]);r.ab.mat4.translate(ke,ke,$e);const Pe=le.paint.get("model-opacity").constantOr(1),Ze=new Kt(me.gl.LEQUAL,Kt.ReadWrite,X.depthRangeFor3D),lt=new Kt(me.gl.LEQUAL,Kt.ReadOnly,X.depthRangeFor3D),Ce=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),tt=X.renderPass==="shadow",We=tt&&ue?ue.getCurrentCascadeFrustum():he.getFrustum(he.scaleZoom(he.worldSize)),bt=le.paint.get("model-front-cutoff"),nt=bt[2]<1,et=Qo(X,le.paint.get("model-cutoff-fade-range")),ft=le.getLayerRenderingStats();(function(xt,Rt,Bt,si){const Xt=xt.terrain?xt.terrain.exaggeration():0,Jt=xt.transform.zoom;for(const ui of si){const Ri=Rt.getTile(ui).getBucket(Bt);Ri&&(xt.conflationActive&&Ri.updateReplacement(ui,xt.replacementSource),Ri.evaluateScale(xt,Bt),xt.terrain&&Xt>0&&Ri.elevationUpdate(xt.terrain,Xt,ui,Bt.source),Ri.needsReEvaluation(xt,Jt,Bt)&&Ri.evaluate(Bt))}})(X,te,le,ae),function(){let xt,Rt,Bt;nt?(xt=ae.length-1,Rt=-1,Bt=-1):(xt=0,Rt=ae.length,Bt=1);const si=new Float64Array(16),Xt=r.ab.vec3.create(),Jt=new r.P(0,0);for(let ui=xt;ui!==Rt;ui+=Bt){const Ri=ae[ui],Ki=te.getTile(Ri).getBucket(le);if(!Ki||!Ki.uploaded)continue;let En=!1;ue&&(En=ue.getMaxCascadeForTile(Ri.toUnwrapped())===0);const dn=he.calculatePosMatrix(Ri.toUnwrapped(),he.worldSize),pi=Ki.modelTraits;!tt&&nt&&(r.ab.mat4.invert(si,dn),r.ab.vec3.transformMat4(Xt,Me,si),Jt.x=Xt[0],Jt.y=Xt[1]);const Fi=[];for(const Ht of Ki.getNodesInfo()){if(Ht.hiddenByReplacement||!Ht.node.meshes)continue;const Ci=Ht.node;let ji=0;X.terrain&&Ci.elevation&&(ji=Ci.elevation*X.terrain.exaggeration());const Zi=(()=>{const zi=Ht.aabb;return Ce.min=[...zi.min],Ce.max=[...zi.max],Ce.min[2]+=ji,Ce.max[2]+=ji,r.ab.vec3.transformMat4(Ce.min,Ce.min,dn),r.ab.vec3.transformMat4(Ce.max,Ce.max,dn),Ce})(),bn=Ht.evaluatedScale;if(bn[0]<=1&&bn[1]<=1&&bn[2]<=1&&Zi.intersects(We)===0)continue;if(!tt&&nt){const zi=.16666666666666666;Ht.cameraCollisionOpacity=Me[0]>Zi.min[0]&&Me[0]<Zi.max[0]&&Me[1]>Zi.min[1]&&Me[1]<Zi.max[1]&&Me[2]*Qe<Zi.max[2]&&Ci.footprint&&r.bA(Jt,Ci.footprint)?Math.max(Ht.cameraCollisionOpacity-zi,0):Math.min(1,Ht.cameraCollisionOpacity+zi)}const tr=[...dn],jn=Ci.anchor?Ci.anchor[0]:0,Gn=Ci.anchor?Ci.anchor[1]:0;r.ab.mat4.translate(tr,tr,[jn*(bn[0]-1),Gn*(bn[1]-1),ji]),r.ab.vec3.exactEquals(bn,r.dm)||r.ab.mat4.scale(tr,tr,bn);const ds=r.ab.mat4.multiply([],tr,Ci.matrix),Ir=r.ab.mat4.multiply([],he.expandedFarZProjMatrix,ds),wn=r.ab.mat4.multiply([],he.expandedFarZProjMatrix,tr),on=r.ab.vec4.transformMat4([],[jn,Gn,ji,1],Ir)[2];Ci.hidden=!1;let rn=Pe;tt||(nt&&(rn*=Ht.cameraCollisionOpacity,rn*=ff(tr,he,Ht.aabb,bt)),rn*=za(et,on)),rn!==0?Fi.push({nodeInfo:Ht,depth:on,opacity:rn,wvpForNode:Ir,wvpForTile:wn,nodeModelMatrix:ds,tileModelMatrix:tr}):Ci.hidden=!0}tt||Fi.sort((Ht,Ci)=>!nt||Ht.opacity===1&&Ci.opacity===1?Ht.depth<Ci.depth?-1:1:Ht.opacity===1?-1:Ci.opacity===1?1:Ht.depth>Ci.depth?-1:1);for(const Ht of Fi){const Ci=Ht.nodeInfo,ji=Ci.node;let Zi=r.ab.mat4.multiply([],Ke,Ht.tileModelMatrix);r.ab.mat4.multiply(Zi,ke,Zi);const bn=r.ab.mat4.invert([],Zi);r.ab.mat4.transpose(bn,bn),r.ab.mat4.scale(bn,bn,hf),Zi=r.ab.mat4.multiply(Zi,Zi,ji.matrix);const tr=X.renderPass==="light-beam",jn=le.paint.get("model-color-use-theme").constantOr("default")==="none",Gn=pi&r.dp.HasMapboxMeshFeatures,ds=Gn?0:Ci.evaluatedRMEA[0][2];for(let Ir=0;Ir<ji.meshes.length;++Ir){const wn=ji.meshes[Ir],on=Ir===ji.lightMeshIndex;let rn=Ht.wvpForNode;if(on){if(!tr&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}rn=Ht.wvpForTile}else if(tr)continue;const zi={defines:[]},Ln=[];if(!tt&&ue&&(ue.useNormalOffset=!!wn.normalBuffer),wl(zi.defines,Ln,wn,X,jn?null:le.lut),Gn||zi.defines.push("DIFFUSE_SHADED"),En&&zi.defines.push("SHADOWS_SINGLE_CASCADE"),ft&&(tt?ft.numRenderedVerticesInShadowPass+=wn.vertexArray.length:ft.numRenderedVerticesInTransparentPass+=wn.vertexArray.length),tt){Fc(wn,Ht.nodeModelMatrix,X,le);continue}let ir=null;if(fe){const fo=Oo(Ht.nodeModelMatrix,X.transform);if(ir=new Float32Array(fo),he.projection.name!=="globe"){const As=wn.aabb.min,fs=wn.aabb.max,[Na,po]=fe.getOpacityForBounds(fo,As[0],As[1],fs[0],fs[1]);zi.overrideFog=Na>=pe||po>=pe}}const sn=wn.material;let Cr;sn.occlusionTexture&&sn.occlusionTexture.offsetScale&&(Cr=sn.occlusionTexture.offsetScale,zi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ms=X.getOrCreateProgram("model",zi);!tt&&ue&&ue.setupShadowsFromMatrix(Ht.tileModelMatrix,Ms,ue.useNormalOffset),X.uploadCommonUniforms(me,Ms,null,ir);const Qr=sn.pbrMetallicRoughness;Qr.metallicFactor=.9,Qr.roughnessFactor=.5;const Hr=Dc(new Float32Array(rn),new Float32Array(Zi),new Float32Array(bn),new Float32Array(ji.matrix),X,Ht.opacity,Qr.baseColorFactor.toRenderColor(null),sn.emissiveFactor,Qr.metallicFactor,Qr.roughnessFactor,sn,ds,le,[0,0,0],Cr);!on&&(Ci.hasTranslucentParts||Ht.opacity<1)&&Ms.draw(X,me.gl.TRIANGLES,Ze,oi.disabled,Ei.disabled,li.backCCW,Hr,le.id,wn.vertexBuffer,wn.indexBuffer,wn.segments,le.paint,X.transform.zoom,void 0,Ln),Ms.draw(X,me.gl.TRIANGLES,on?lt:Ze,oi.disabled,on||Ht.opacity<1||Ci.hasTranslucentParts?Ei.alphaBlended:Ei.unblended,li.backCCW,Hr,le.id,wn.vertexBuffer,wn.indexBuffer,wn.segments,le.paint,X.transform.zoom,void 0,Ln)}}}}()}(c,t,n,u),void C();if(R.type!=="model")return;const D=R.getModels(),k=[],B=c.transform.getFreeCameraOptions().position,U=r.ab.vec3.scale([],[B.x,B.y,B.z],c.transform.worldSize);r.ab.vec3.negate(U,U);const Z=[],q=[];let Y=0;for(const X of D){const te=n.paint.get("model-rotation").constantOr(null),le=n.paint.get("model-scale").constantOr(null),ae=n.paint.get("model-translation").constantOr(null);X.computeModelMatrix(c,te,le,ae,!0,!0,!1);const me=r.ab.mat4.identity([]),he=r.dj(X.position.lat,c.transform.zoom),fe=r.ab.mat4.fromScaling([],[1,1,1/he]);r.ab.mat4.translate(me,me,U),k.push({zScaleMatrix:fe,negCameraPosMatrix:me});for(const ue of X.nodes)uh(c.transform,ue,X.matrix,c.transform.expandedFarZProjMatrix,Y,Z,q);Y++}if(Z.sort((X,te)=>te.depth-X.depth),c.renderPass!=="shadow"){if(p===1)for(const X of q)ko(X,c,n,k[X.modelIndex],oi.disabled,c.colorModeForRenderPass());else{for(const X of q)ko(X,c,n,k[X.modelIndex],oi.disabled,Ei.disabled);for(const X of q)ko(X,c,n,k[X.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const X of Z)ko(X,c,n,k[X.modelIndex],oi.disabled,c.colorModeForRenderPass());C()}else{for(const X of q)Fc(X.mesh,X.nodeModelMatrix,c,n);for(const X of Z)Fc(X.mesh,X.nodeModelMatrix,c,n);C()}}},Uc={line:function(c,t,n){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const _=t.getTile(p).getBucket(c);if(_&&(_.hasZOffset?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,n){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const _ of p)_.upload(n.context)},raster:function(c,t,n){const u=t.getSource();if(!(u instanceof Xn&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-array-band")||u.getInitialBand(p);if(_==null)return;const x=t.getIds().map(S=>t.getTileByID(S));for(const S of x)S.updateNeeded(p,_)&&u.prepareTile(S,p,_)},"raster-particle":function(c,t,n){const u=t.getSource();if(!(u instanceof Xn&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(_==null)return;const x=t.getIds().map(S=>t.getTileByID(S));for(const S of x)S.updateNeeded(p,_)&&u.prepareTile(S,p,_)}};class bf{constructor(t,n,u,p,_){this.context=new of(t,n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const C of x)this._debugParams.enabledLayers[C]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const C of x)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],C);this.occlusionParams=new dh(_),this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wa(this),this._wireframeDebugCache=new pf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,S,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,n){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fl(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,n),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=n.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new fl(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*r.q.devicePixelRatio,this.height=n*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,n=new r.b4;n.emplaceBack(0,0),n.emplaceBack(r.ag,0),n.emplaceBack(0,r.ag),n.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=t.createVertexBuffer(n,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const u=new r.b4;u.emplaceBack(0,0),u.emplaceBack(r.ag,0),u.emplaceBack(0,r.ag),u.emplaceBack(r.ag,r.ag),this.debugBuffer=t.createVertexBuffer(u,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const p=new r.b4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const _=new r.aT;_.emplaceBack(0,0,0,0),_.emplaceBack(r.ag,0,r.ag,0),_.emplaceBack(0,r.ag,0,r.ag),_.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(_,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const x=new r.aU;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const S=new r.b5;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.ab.mat4.create();const C=this.context.gl;this.stencilClearMode=new oi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Kt.disabled,this.stencilClearMode,Ei.disabled,li.disabled,Ju(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,u){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const C of u)if(this._tileClippingMaskIDs[C.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=n.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Ei.disabled),p.setDepthMode(Kt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of u){const C=n.getTile(S),R=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:k,tileBoundsSegments:B}=this.getTileBoundsBuffers(C);x.draw(this,_.TRIANGLES,Kt.disabled,new oi({func:_.ALWAYS,mask:0},R,255,_.KEEP,_.KEEP,_.REPLACE),Ei.disabled,li.disabled,Ju(S.projMatrix),"$clipping",D,k,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new oi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new oi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let S=0;S<_;S++)x[S+p]=new oi({func:n.GEQUAL,mask:255},S+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=_,[x,u]}return[{[p]:oi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ei([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new Ei([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,u,p=!1){if(this.depthOcclusion)return new Kt(this.context.gl.GREATER,Kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Kt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Kt(u||this.context.gl.LEQUAL,n,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&u!==0&&(this.depthFBO=new sf(this.context,n,u,!1,"texture"),this.depthTexture=new r.T(this.context,{width:n,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,u,0,0,n,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const u=r.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const p=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(_).filter(Pe=>{const Ze=p[Pe];return!(Ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ze.type]});let S=x(),C=!1,R=!1;for(const Pe of S){const Ze=p[Pe];Ze.type==="circle"&&(C=!0),Ze.type==="symbol"&&(Ze.hasInitialOcclusionOpacityProperties?R=!0:C=!0)}let D=S.map(Pe=>p[Pe]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let B=0,U=!1;for(const Pe in k){const Ze=k[Pe];Ze.used&&(Ze.prepare(this.context),Ze.getSource().usedInConflation&&++B)}let Z=!1;for(const Pe of D)Pe.isHidden(this.transform.zoom)||(Pe.type==="clip"&&(Z=!0),this.prepareLayer(Pe));const q={},Y={},X={},te={},le={};for(const Pe in k){const Ze=k[Pe];q[Pe]=Ze.getVisibleCoordinates(),Y[Pe]=q[Pe].slice().reverse(),X[Pe]=Ze.getVisibleCoordinates(!0).reverse(),te[Pe]=Ze.getShadowCasterCoordinates(),le[Pe]=Ze.sortCoordinatesByDistance(q[Pe])}const ae=Pe=>{const Ze=this.style.getLayerSourceCache(Pe);return Ze&&Ze.used?Ze.getSource():null};if(B||Z||this._clippingActiveLastFrame){const Pe=[],Ze=[];let lt=0;for(const Ce of D)this.isSourceForClippingOrConflation(Ce,ae(Ce))&&(Pe.push(Ce),Ze.push(lt)),lt++;if(Pe&&(Z||Pe.length>1)||this._clippingActiveLastFrame){Z=!1;const Ce=[];for(let tt=0;tt<Pe.length;tt++){const We=Pe[tt],bt=Ze[tt],nt=this.style.getLayerSourceCache(We);if(!nt||!nt.used||!nt.getSource().usedInConflation&&We.type!=="clip")continue;let et=r.dx,ft=r.by.None;const xt=[];let Rt=!0;if(We.type==="clip"){et=bt;for(const Bt of We.layout.get("clip-layer-types"))ft|=Bt==="model"?r.by.Model:Bt==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const Bt of We.layout.get("clip-layer-scope"))xt.push(Bt);We.isHidden(this.transform.zoom)?Rt=!1:Z=!0}Rt&&Ce.push({layer:We.fqid,cache:nt,order:et,clipMask:ft,clipScope:xt})}this.replacementSource.setSources(Ce),U=!0}}this._clippingActiveLastFrame=Z,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Pe=0;Pe<D.length;Pe++){const Ze=D[Pe],lt=Ze.cutoffRange();if(this.longestCutoffRange=Math.max(lt,this.longestCutoffRange),lt>0){const Ce=ae(Ze);Ce&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom)),Ze.minzoom&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom))}Ze.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Pe),this._lastOcclusionLayer=Pe)}const me=this.style&&this.style.fog;me?(this._fogVisible=me.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=me.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(X),this.opaquePassCutoff=0,S=x(),D=S.map(Pe=>p[Pe]));const he=this._shadowRenderer;if(he){he.updateShadowParameters(this.transform,this.style.directionalLight);for(const Pe in k)for(const Ze of q[Pe]){let lt={min:0,max:0};this.terrain&&(lt=this.terrain.getMinMaxForTile(Ze)||lt),he.addShadowReceiver(Ze.toUnwrapped(),lt.min,lt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Rm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(fe&&!this._snow&&(this._snow=new vf(this)),!fe&&this._snow&&(this._snow.destroy(),delete this._snow),ue&&!this._rain&&(this._rain=new Tl(this)),!ue&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ks.has(this.context.gl))return;this.renderPass="offscreen";for(const Pe of D){const Ze=t.getLayerSourceCache(Pe);if(!Pe.hasOffscreenPass()||Pe.isHidden(this.transform.zoom))continue;const lt=Ze?Y[Ze.id]:void 0;(Pe.type==="custom"||Pe.type==="raster"||Pe.type==="raster-particle"||Pe.isSky()||lt&&lt.length)&&this.renderLayer(this,Ze,Pe,lt)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,te)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Me=(()=>{if(n.showOverdrawInspector)return r.aj.black;const Pe=this.style.fog;if(Pe&&this.transform.projection.supportsFog){const Ze=this.style.getLut(Pe.scope);if(!xe){const lt=Pe.properties.get("color-use-theme")==="none",Ce=Pe.properties.get("color").toRenderColor(lt?null:Ze).toArray01();return new r.aj(...Ce)}if(xe){const lt=Pe.properties.get("space-color-use-theme")==="none",Ce=Pe.properties.get("space-color").toRenderColor(lt?null:Ze).toArray01();return new r.aj(...Ce)}}return r.aj.transparent})();if(this.context.clear({color:Me,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const Pe=D[this.currentLayer],Ze=t.getLayerSourceCache(Pe);if(Pe.isSky())continue;const lt=Ze?(Pe.is3D()?le:Y)[Ze.id]:void 0;this._renderTileClippingMasks(Pe,Ze,lt),this.renderLayer(this,Ze,Pe,lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const Pe=D[this.currentLayer],Ze=t.getLayerSourceCache(Pe);Pe.isSky()&&this.renderLayer(this,Ze,Pe,Ze?Y[Ze.id]:void 0)}function $e(Pe,Ze){let lt;return Ze&&(lt=(Pe.type==="symbol"?X:Pe.is3D()?le:Y)[Ze.id]),lt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const Pe=D[this.currentLayer];if(Pe.type==="raster"||Pe.type==="raster-particle"){const Ze=t.getLayerSourceCache(Pe);this.renderLayer(this,Ze,Pe,$e(Pe,Ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ke=0;he&&(ke=he.getShadowCastingLayerCount());let Qe=!1,Ke=-1;for(let Pe=0;Pe<S.length;++Pe){const Ze=D[Pe];Ze.isHidden(this.transform.zoom)||Ze.is3D()&&(Ke=Pe)}for(R&&Ke===-1&&(C=!0);this.currentLayer<S.length;){const Pe=D[this.currentLayer],Ze=t.getLayerSourceCache(Pe);if(Pe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Pe)){if(Pe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(C&&!Qe&&this.terrain&&!this.transform.isOrthographic&&(Qe=!0,this.blitDepth()),R&&Ke!==-1&&this.currentLayer===Ke+1&&!this.transform.isOrthographic&&this.blitDepth(),Pe.is3D()||this.terrain||this._renderTileClippingMasks(Pe,Ze,Ze?q[Ze.id]:void 0),this.renderLayer(this,Ze,Pe,$e(Pe,Ze)),!this.terrain&&he&&ke>0&&Pe.hasShadowPass()&&--ke==0&&(he.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const lt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=lt;this.currentLayer++){const Ce=D[this.currentLayer];if(!Ce.hasLightBeamPass())continue;const tt=t.getLayerSourceCache(Ce);this.renderLayer(this,tt,Ce,tt?Y[tt.id]:void 0)}this.currentLayer=lt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const lt=this.currentLayer;this.depthOcclusion=!0;for(const Ce of this.layersWithOcclusionOpacity){this.currentLayer=Ce;const tt=D[this.currentLayer],We=t.getLayerSourceCache(tt),bt=We?Y[We.id]:void 0;tt.is3D()||this.terrain||this._renderTileClippingMasks(tt,We,We?q[We.id]:void 0),this.renderLayer(this,We,tt,bt)}this.depthOcclusion=!1,this.currentLayer=lt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Pe=null;D.forEach(Ze=>{const lt=t.getLayerSourceCache(Ze);lt&&!Ze.isHidden(this.transform.zoom)&&lt.getVisibleCoordinates().length&&(!Pe||Pe.getSource().maxzoom<lt.getSource().maxzoom)&&(Pe=lt)}),Pe&&this.options.showTileBoundaries&&Vc.debug(this,Pe,Pe.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Vc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Pe){const Ze=Pe.transform.padding;cf(Pe,Pe.transform.height-(Ze.top||0),3,bl),cf(Pe,Ze.bottom||0,3,Fy),uf(Pe,Ze.left||0,3,By),uf(Pe,Pe.transform.width-(Ze.right||0),3,Cm);const lt=Pe.transform.centerPoint;(function(Ce,tt,We,bt){Da(Ce,tt-1,We-10,2,20,bt),Da(Ce,tt-10,We-1,20,2,bt)})(Pe,lt.x,Pe.transform.height-lt.y,lh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,u=!n||!n.includes(t.type);if(Uc[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);Uc[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,n,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Vc[u.type](t,n,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(n.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,u=n.createQuery();this.deferredRenderGpuTimeQueries.push(u),n.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const u in t){const p=t[u],_=this.context.extTimerQuery,x=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),n[u]=x}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let u=0;for(const p of t)u+=n.getQueryParameter(p,n.QUERY_RESULT)/1e6,n.deleteQuery(p);return u}translatePosMatrix(t,n,u,p,_){if(!u[0]&&!u[1])return t;const x=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const R=Math.sin(x),D=Math.cos(x);u=[u[0]*D-u[1]*R,u[0]*R+u[1]*D]}const S=[_?u[0]:r.ar(n,u[0],this.transform.zoom),_?u[1]:r.ar(n,u[1],this.transform.zoom),0],C=new Float32Array(16);return r.ab.mat4.translate(C,t,S),C}saveTileTexture(t){const n=t.size[0],u=this._tileTextures[n];u?u.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||n!==void 0&&!n||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,n){this.cache=this.cache||{};const u=n&&n.defines||[],p=n&&n.config,_=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(u),x=bm.cacheKey(cl[t],t,_,p);return this.cache[x]||(this.cache[x]=new bm(this.context,t,cl[t],p,rf[t],_)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const _=((x,S,C)=>{const R=x.properties.get("direction"),D=x.properties.get("color-use-theme")==="none",k=x.properties.get("color").toRenderColor(D?null:C.getLut(x.scope)).toArray01(),B=x.properties.get("intensity"),U=S.properties.get("color-use-theme")==="none",Z=S.properties.get("color").toRenderColor(U?null:C.getLut(S.scope)).toArray01(),q=S.properties.get("intensity"),Y=[R.x,R.y,R.z],X=r.cM(Z,q),te=r.cM(k,B);return{u_lighting_ambient_color:X,u_lighting_directional_dir:Y,u_lighting_directional_color:te,u_ground_radiance:Dy(Y,te,X)}})(u,p,this.style);n.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,n,u,p,_){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const S=x.getOpacity(this.transform.pitch),C=((R,D,k,B,U,Z,q,Y,X,te,le,ae)=>{const me=R.transform,he=D.properties.get("color-use-theme")==="none",fe=D.properties.get("color").toRenderColor(he?null:R.style.getLut(D.scope)).toArray01();fe[3]=B;const ue=R.frameCounter/1e3%1,[xe,Me]=D.properties.get("vertical-range");return{u_fog_matrix:k?me.calculateFogTileMatrix(k):ae||R.identityMat,u_fog_range:D.getFovAdjustedRange(me._fov),u_fog_color:fe,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(xe,Me),Me],u_fog_temporal_offset:ue,u_frustum_tl:U,u_frustum_tr:Z,u_frustum_br:q,u_frustum_bl:Y,u_globe_pos:X,u_globe_radius:te,u_viewport:le,u_globe_transition:r.ae(me.zoom),u_is_globe:+(me.projection.name==="globe")}})(this,x,u,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],p);n.setFogUniformValues(t,C)}_&&n.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)n[p.key]=t[p.key]||new Yo(p,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=pe||n[1]>=pe}setupDepthForOcclusion(t,n,u){const p=this.context,_=p.gl,x=!!u;var S;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),x||n.setTerrainUniformValues(p,u)}}function mh(c,t){let n=!1,u=null;const p=()=>{u=null,n&&(c(),u=setTimeout(p,t),n=!1)};return()=>(n=!0,u||p(),u)}class Dm{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=mh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=wf(t);if(this._hashName){const u=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(x=>{const S=x.split("=")[0];return S===u?(p=!0,`${S}=${n}`):x}).filter(x=>x);return p||_.push(`${u}=${n}`),`#${_.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(n=u)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function wf(c,t){const n=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),x=Math.round(n.lng*_)/_,S=Math.round(n.lat*_)/_,C=c.getBearing(),R=c.getPitch();let D=t?`/${x}/${S}/${u}`:`${u}/${S}/${x}`;return(C||R)&&(D+="/"+Math.round(10*C)/10),R&&(D+=`/${Math.round(R)}`),D}const jc={linearity:.3,easing:r.dy(0,0,.3,1)},zm=r.l({deceleration:2500,maxSpeed:1400},jc),Lm=r.l({deceleration:20,maxSpeed:1400},jc),Om=r.l({deceleration:1e3,maxSpeed:360},jc),km=r.l({deceleration:1e3,maxSpeed:90},jc);class Fm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=r.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)n.zoom+=_.zoomDelta||0,n.bearing+=_.bearingDelta||0,n.pitch+=_.pitchDelta||0,_.panDelta&&n.pan._add(_.panDelta),_.around&&(n.around=_.around),_.pinchAround&&(n.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const _=qc(n.pan.mag(),u,r.l({},zm,t||{}));p.offset=n.pan.mult(_.amount/n.pan.mag()),p.center=this._map.transform.center,Gc(p,_)}if(n.zoom){const _=qc(n.zoom,u,Lm);p.zoom=this._map.transform.zoom+_.amount,Gc(p,_)}if(n.bearing){const _=qc(n.bearing,u,Om);p.bearing=this._map.transform.bearing+r.aw(_.amount,-179,179),Gc(p,_)}if(n.pitch){const _=qc(n.pitch,u,km);p.pitch=this._map.transform.pitch+_.amount,Gc(p,_)}if(p.zoom||p.bearing){const _=n.pinchAround===void 0?n.around:n.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Gc(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function qc(c,t,n){const{maxSpeed:u,linearity:p,deceleration:_}=n,x=r.aw(c*p/(t/1e3),-u,u),S=Math.abs(x)/(_*p);return{easing:n.easing,duration:1e3*S,amount:x*(S/2)}}class Kr extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){const _=zt(n.getCanvasContainer(),u),x=n.unproject(_);super(t,r.l({point:_,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class Hc extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,_=ut(n.getCanvasContainer(),p),x=_.map(C=>n.unproject(C)),S=_.reduce((C,R,D,k)=>C.add(R.div(k.length)),new r.P(0,0));super(t,{points:_,point:S,lngLats:x,lngLat:n.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Bm extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Vy{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Bm(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Kr(t.type,this._map,t))}mouseup(t){this._map.fire(new Kr(t.type,this._map,t))}preclick(t){const n=r.l({},t);n.type="preclick",this._map.fire(new Kr(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Kr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Kr(t.type,this._map,t))}mouseover(t){this._map.fire(new Kr(t.type,this._map,t))}mouseout(t){this._map.fire(new Kr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Hc(t.type,this._map,t))}touchmove(t){this._map.fire(new Hc(t.type,this._map,t))}touchend(t){this._map.fire(new Hc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Hc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uy{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Kr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Kr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ve(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Le("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(p.x,u.x),S=Math.max(p.x,u.x),C=Math.min(p.y,u.y),R=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=S-x+"px",this._box.style.height=R-C+"px")})}mouseupWindow(t,n){if(!this._active)return;const u=this._startPos,p=n;if(u&&t.button===0){if(this.reset(),dt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new r.z(t,{originalEvent:n}))}}function _h(c,t){const n={};for(let u=0;u<c.length;u++)n[c[u].identifier]=t[u];return n}class jy{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const _=new r.P(0,0);for(const x of p)_._add(x);return _.div(p.length)}(n),this.touches=_h(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=_h(u,n);for(const _ in this.touches){const x=p[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Tf{constructor(t){this.singleTap=new jy(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class $c{constructor(){this._zoomIn=new Tf({numTouches:1,numTaps:2}),this._zoomOut=new Tf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),_=this._zoomOut.touchend(t,n,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nm={0:1,2:2};class Zc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const u=Je(t);this._correctButton(t,u)&&(this._lastPoint=n,this._eventButton=u)}mousemoveWindow(t,n){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,_){const x=Nm[_];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(u,n)}}mouseupWindow(t){this._lastPoint&&Je(t)===this._eventButton&&(this._moved&&dt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh extends Zc{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class uo extends Zc{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const u=.8*(n.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){t.preventDefault()}}class Wc extends Zc{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const u=-.5*(n.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){t.preventDefault()}}class zn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,u)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=_h(u,n),_=new r.P(0,0),x=new r.P(0,0);let S=0;for(const R in p){const D=p[R],k=this._touches[R];k&&(_._add(D),x._add(D.sub(k)),S++,p[R]=D)}if(this._touches=p,S<this._minTouches||!x.mag())return;const C=x.div(S);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Le("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Es{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,u){return{}}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,x]=p,S=Sl(u,n,_),C=Sl(u,n,x);if(!S||!C)return;const R=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],R,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,x=Sl(u,n,p),S=Sl(u,n,_);x&&S||(this._active&&dt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Sl(c,t,n){for(let u=0;u<c.length;u++)if(c[u].identifier===n)return t[u]}function Xc(c,t){return Math.log(c/t)/Math.LN2}class Vm extends Es{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xc(this._distance,u),pinchAround:n}}}function Um(c,t){return 180*c.angleWith(t)/Math.PI}class Yc extends Es{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Um(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=Um(t,u);return Math.abs(p)<n}}function Sf(c){return Math.abs(c.y)>Math.abs(c.x)}class Gy extends Es{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Sf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),x=t[1].sub(p[1]);return this._map._cooperativeGestures&&!r.dz()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=n.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return Sf(t)&&Sf(n)&&x}}const Ef={panStep:100,bearingStep:15,pitchStep:10};class Mf{constructor(){const t=Ef;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:S=>{const C=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:La,zoom:n?Math.round(C)+n*(t.shiftKey?2:1):C,bearing:S.getBearing()+u*this._bearingStep,pitch:S.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function La(c){return c*(2-c)}const Oa=4.000244140625,Fo=1/450;class Vs{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Fo,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=r.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%Oa==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=zt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Oa?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const k=n(),B=Math.pow(2,k),U=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(U*D))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n(),p=this._startZoom,_=this._easing;let x,S=!1;if(this._type==="wheel"&&p&&_){const R=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),D=_(R);x=r.af(p,u,D),R<1?this._frameId||(this._frameId=!0):S=!0}else x=u,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=x-n();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=r.dA;if(this._prevEase){const u=this._prevEase,p=(r.q.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-x*x);n=r.dy(x,S,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Le("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class aa{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ka{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la{constructor(){this._tap=new Tf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=n[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,n,u))}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,n,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qy{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hy{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $y{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yh=c=>c.zoom||c.drag||c.pitch||c.rotate;class jm extends r.z{}class Nr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const u=r.ab.vec3.sub([],n,t);this.radius=r.ab.vec3.length(u[2]<0?r.ab.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){r.ab.vec3.div(t,t,this.constants),r.ab.vec3.normalize(t,t),r.ab.vec3.mul(t,t,this.constants);const n=r.ab.vec3.scale([],t,this.radius);if(n[2]>0){const u=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(n,[0,0,1])),p=r.ab.vec3.scale([],r.ab.vec3.normalize([],[n[0],n[1],0]),this.radius),_=r.ab.vec3.add([],n,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],p,u),n),2));n[0]=_[0],n[1]=_[1]}return n}}function El(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Gm{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fm(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),r.aP(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,x]of this._listeners){const S=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,S,x)}}destroy(){for(const[t,n,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,p,u)}}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new Vy(n,t));const p=n.boxZoom=new Rn(n,t);this._add("boxZoom",p);const _=new $c,x=new ka;n.doubleClickZoom=new aa(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const S=new la;this._add("tapDragZoom",S);const C=n.touchPitch=new Gy(n);this._add("touchPitch",C);const R=new uo(t),D=new Wc(t);n.dragRotate=new Hy(t,R,D),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const k=new gh(t),B=new zn(n,t);n.dragPan=new qy(u,k,B),this._add("mousePan",k),this._add("touchPan",B,["touchZoom","touchRotate"]);const U=new Yc,Z=new Vm;n.touchZoomRotate=new $y(u,Z,U,S),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uy(n));const q=n.scrollZoom=new Vs(n,this);this._add("scrollZoom",q,["mousePan"]);const Y=n.keyboard=new Mf;this._add("keyboard",Y);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&n[X].enable(t[X])}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}handleEvent(t,n){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,_={needsRenderFrame:!1},x={},S={},C=t.touches?this._getMapTouches(t.touches):void 0,R=C?ut(this._el,C):u?void 0:zt(this._el,t);for(const{handlerName:B,handler:U,allowed:Z}of this._handlers){if(!U.isEnabled())continue;let q;this._blockedByActive(S,Z,B)?U.reset():U[n||t.type]&&(q=U[n||t.type](t,R,C),this.mergeHandlerResult(_,x,q,B,p),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||U.isActive())&&(S[B]=U)}const D={};for(const B in this._previousActiveHandlers)S[B]||(D[B]=p);this._previousActiveHandlers=S,(Object.keys(D).length||El(_))&&(this._changes.push([_,x,D]),this._triggerRenderFrame()),(Object.keys(S).length||El(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=_;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,n,u,p,_){if(!u)return;r.l(t,u);const x={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(n.zoom=x),u.panDelta!==void 0&&(n.drag=x),u.pitchDelta!==void 0&&(n.pitch=x),u.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},u={};for(const[p,_,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),r.l(n,_),r.l(u,x);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,_=p.transform,x=te=>[te.x,te.y,te.z];if((te=>{const le=this._eventsInProgress.drag;return le&&!this._handlersById[le.handlerName].isActive()})()&&!El(t)){const te=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),te!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!El(t))return void this._fireEvents(n,u,!0);let{panDelta:S,zoomDelta:C,bearingDelta:R,pitchDelta:D,around:k,aroundCoord:B,pinchAround:U}=t;_._isCameraConstrained&&(C>0&&(C=0),_._isCameraConstrained=!1),U!==void 0&&(k=U),(C||(te=>n[te]&&!this._eventsInProgress[te])("drag"))&&k&&(this._dragOrigin=x(_.pointCoordinate3D(k)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),k=k||p.transform.centerPoint,R&&(_.bearing+=R),D&&(_.pitch+=D),_._updateCameraState();const Z=[0,0,0];if(S)if(_.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k).dir),le=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k.sub(S)).dir);Z[0]=le[0]-te[0],Z[1]=le[1]-te[1]}else{const te=_.pointCoordinate(k);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const le=_._pixelsPerMercatorPixel/_.worldSize;Z[0]=-S.x*r.dB(r.aS(te.y))*le,Z[1]=-S.y*r.dB(_.center.lat)*le}else{const le=_.pointCoordinate(k.sub(S));te&&le&&(Z[0]=le.x-te.x,Z[1]=le.y-te.y)}}const q=_.zoom,Y=[0,0,0];if(C){const te=x(B||_.pointCoordinate3D(k)),le={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],te,_._camera.position))};if(le.dir[2]<0){const ae=_.zoomDeltaToMovement(te,C);r.ab.vec3.scale(Y,le.dir,ae)}}const X=r.ab.vec3.add(Z,Z,Y);_._translateCameraConstrained(X),C&&Math.abs(_.zoom-q)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const p=yh(this._eventsInProgress),_=yh(t),x={};for(const D in t){const{originalEvent:k}=t[D];this._eventsInProgress[D]||(x[`${D}start`]=k),this._eventsInProgress[D]=t[D]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const D in x)this._fireEvent(D,x[D]);_&&this._fireEvent("move",_.originalEvent);for(const D in t){const{originalEvent:k}=t[D];this._fireEvent(D,k)}const S={};let C;for(const D in this._eventsInProgress){const{handlerName:k,originalEvent:B}=this._eventsInProgress[D];this._handlersById[k].isActive()||(delete this._eventsInProgress[D],C=n[k]||B,S[`${D}end`]=C)}for(const D in S)this._fireEvent(D,S[D]);const R=yh(this._eventsInProgress);if(u&&(p||_)&&!R){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;D?(k(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:C})):(this._map.fire(new r.z("moveend",{originalEvent:C})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new r.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new jm("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ml extends r.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},n),u)}panTo(t,n,u){return this.easeTo(r.l({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(r.l({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(r.l({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,r.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=r.az.convert(t);const u=n&&n.bearing||0,p=n&&n.pitch||0,_=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,_,x,u,p,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?r.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},n,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const u=n.max[0]-n.min[0],p=n.max[1]-n.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,u,p,_,x){const S=t.clone(),C=this._extendCameraOptions(x);S.bearing=p,S.pitch=_;const R=r.bO.convert(n),D=r.bO.convert(u),k=.5*(R.lat+D.lat),B=.5*(R.lng+D.lng),U=r.dC(k,B),Z=r.ab.vec3.normalize([],U),q=r.ab.vec3.normalize([],r.ab.vec3.cross([],Z,[0,1,0])),Y=r.ab.vec3.cross([],q,Z),X=[q[0],q[1],q[2],0,Y[0],Y[1],Y[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],te=[U,r.dC(R.lat,R.lng),r.dC(D.lat,R.lng),r.dC(D.lat,D.lng),r.dC(R.lat,D.lng),r.dC(k,R.lng),r.dC(k,D.lng),r.dC(R.lat,B),r.dC(D.lat,B)];let le=r.cd.fromPoints(te.map(We=>[r.ab.vec3.dot(q,We),r.ab.vec3.dot(Y,We),r.ab.vec3.dot(Z,We)]));const ae=r.ab.vec3.transformMat4([],le.center,X);r.ab.vec3.squaredLength(ae)===0&&r.ab.vec3.set(ae,0,0,1),r.ab.vec3.normalize(ae,ae),r.ab.vec3.scale(ae,ae,r.ax),S.center=r.dD(ae);const me=S.getWorldToCameraMatrix(),he=r.ab.mat4.invert(new Float64Array(16),me);le=r.cd.applyTransform(le,r.ab.mat4.multiply([],me,X));const fe=this._extendAABB(le,S,C,p);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");le=fe,r.ab.vec3.transformMat4(ae,ae,me);const ue=.5*(le.max[2]-le.min[2]),xe=this._minimumAABBFrustumDistance(S,le),Me=r.ab.vec3.scale([],[0,0,1],ue),$e=r.ab.vec3.add(Me,ae,Me),ke=xe+(S.pitch===0?0:r.ab.vec3.distance(ae,$e)),Qe=S.globeCenterInViewSpace,Ke=r.ab.vec3.sub([],ae,[Qe[0],Qe[1],Qe[2]]);r.ab.vec3.normalize(Ke,Ke),r.ab.vec3.scale(Ke,Ke,ke);const Pe=r.ab.vec3.add([],ae,Ke);r.ab.vec3.transformMat4(Pe,Pe,he);const Ze=r.ds/r.ax,lt=r.ab.vec3.length(Pe),Ce=r.bH(Math.max(lt*Ze-r.ds,Number.EPSILON),0),tt=Math.min(S.zoomFromMercatorZAdjusted(Ce),C.maxZoom);return tt>.5*(r.c6+r.bY)?(S.setProjection({name:"mercator"}),S.zoom=tt,this._cameraForBounds(S,n,u,p,_,x)):{center:S.center,zoom:tt,bearing:p,pitch:_}}_extendAABB(t,n,u,p){const _=.5*((u.padding.left||0)+(u.padding.right||0)),x=.5*((u.padding.top||0)+(u.padding.bottom||0)),S=x,C=_,R=_,D=x,k=n.width-(C+R),B=n.height-(S+D),U=r.ab.vec3.sub([],t.max,t.min),Z=Math.min(k/U[0],B/U[1]),q=Math.min(n.scaleZoom(n.scale*Z),u.maxZoom);if(isNaN(q))return null;const Y=n.scale/n.zoomScale(q),X=new r.cd([t.min[0]-C*Y,t.min[1]-D*Y,t.min[2]],[t.max[0]+R*Y,t.max[1]+S*Y,t.max[2]]),te=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.ai(p));return X.center[0]-=te.x*Y,X.center[1]+=te.y*Y,X}queryTerrainElevation(t,n){const u=this.transform.elevation;return u?(n=r.l({},{exaggerated:!0},n),u.getAtPoint(r.aa.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,u,p,_,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,u,p,_,x);const S=t.clone(),C=this._extendCameraOptions(x);S.bearing=p,S.pitch=_;const R=r.bO.convert(n),D=r.bO.convert(u),k=new r.bO(R.lng,D.lat),B=new r.bO(D.lng,R.lat),U=S.project(R),Z=S.project(D),q=this.queryTerrainElevation(R),Y=this.queryTerrainElevation(D),X=this.queryTerrainElevation(k),te=this.queryTerrainElevation(B),le=[[U.x,U.y,Math.min(q||0,Y||0,X||0,te||0)],[Z.x,Z.y,Math.max(q||0,Y||0,X||0,te||0)]];let ae=r.cd.fromPoints(le);const me=S.getWorldToCameraMatrix(),he=r.ab.mat4.invert(new Float64Array(16),me);ae=r.cd.applyTransform(ae,me);const fe=this._extendAABB(ae,S,C,p);if(!fe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=fe;const ue=.5*r.ab.vec3.sub([],ae.max,ae.min)[2],xe=this._minimumAABBFrustumDistance(S,ae),Me=[0,0,1,0];r.ab.vec4.transformMat4(Me,Me,me),r.ab.vec4.normalize(Me,Me);const $e=r.ab.vec3.scale([],Me,xe+ue),ke=r.ab.vec3.add([],ae.center,$e);r.ab.vec3.transformMat4(ae.center,ae.center,he),r.ab.vec3.transformMat4(ke,ke,he);const Qe=S.unproject(new r.P(ae.center[0],ae.center[1])),Ke=r.dE(S.projection,Qe),Pe=Math.pow(2,Ke),Ze=Math.min(S._zoomFromMercatorZ(ke[2]*S.pixelsPerMeter*Pe/S.worldSize),C.maxZoom);return S.mercatorFromTransition&&Ze<.5*(r.c6+r.bY)?(S.setProjection({name:"globe"}),S.zoom=Ze,this._cameraForBounds(S,n,u,p,_,x)):{center:Qe,zoom:Ze,bearing:p,pitch:_}}fitBounds(t,n,u){const p=this.cameraForBounds(t,n);return this._fitInternal(p,n,u)}fitScreenCoordinates(t,n,u,p,_){const x=r.P.convert(t),S=r.P.convert(n),C=new r.P(Math.min(x.x,S.x),Math.min(x.y,S.y)),R=new r.P(Math.max(x.x,S.x),Math.max(x.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,S))return this;const D=this.transform.pointLocation3D(C),k=this.transform.pointLocation3D(R),B=this.transform.pointLocation3D(new r.P(C.x,R.y)),U=this.transform.pointLocation3D(new r.P(R.x,C.y)),Z=[Math.min(D.lng,k.lng,B.lng,U.lng),Math.min(D.lat,k.lat,B.lat,U.lat)],q=[Math.max(D.lng,k.lng,B.lng,U.lng),Math.max(D.lat,k.lat,B.lat,U.lat)],Y=p&&p.pitch?p.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,Z,q,u,Y,p);return this._fitInternal(X,p,_)}_fitInternal(t,n,u){return t?(n=r.l(t,n)).linear?this.easeTo(n,u):this.flyTo(n,u):this}jumpTo(t,n){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,x=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=r.bO.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(_=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(S))if(t.retainPadding===!1){const C=u.clone();C.padding=S,u.setLocationAtPoint(u.center,C.centerPoint)}else u.padding=S;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),p&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),_&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),x&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(qm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(qm),this;this.stop();const p=u.zoom,_=u.pitch,x=u.bearing;u.setFreeCameraOptions(t);const S=p!==u.zoom,C=_!==u.pitch,R=x!==u.bearing;return this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),S&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),R&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),C&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),S=this.getPadding(),C="zoom"in t?+t.zoom:p,R="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:x,k=this._extendPadding(t.padding),B=r.P.convert(t.offset);let U,Z,q;if(u.projection.name==="globe"){const Me=r.aa.fromLngLat(u.center),$e=B.rotate(-u.angle);Me.x+=$e.x/u.worldSize,Me.y+=$e.y/u.worldSize;const ke=Me.toLngLat(),Qe=r.bO.convert(t.center||ke);this._normalizeCenter(Qe),U=u.centerPoint.add($e),Z=new r.P(Me.x,Me.y).mult(u.worldSize),q=new r.P(r.at(Qe.lng),r.aA(Qe.lat)).mult(u.worldSize).sub(Z)}else{U=u.centerPoint.add(B);const Me=u.pointLocation(U),$e=r.bO.convert(t.center||Me);this._normalizeCenter($e),Z=u.project(Me),q=u.project($e).sub(Z)}const Y=u.zoomScale(C-p);let X,te;t.around&&(X=r.bO.convert(t.around),te=u.locationPoint(X));const le=this._zooming||C!==p,ae=this._rotating||_!==R,me=this._pitching||D!==x,he=!u.isPaddingEqual(k),fe=t.retainPadding===!1?u.clone():u,ue=Me=>$e=>{if(le&&(Me.zoom=r.af(p,C,$e)),ae&&(Me.bearing=r.af(_,R,$e)),me&&(Me.pitch=r.af(x,D,$e)),he&&(fe.interpolatePadding(S,k,$e),U=fe.centerPoint.add(B)),X)Me.setLocationAtPoint(X,te);else{const ke=Me.zoomScale(Me.zoom-p),Qe=C>p?Math.min(2,Y):Math.max(.5,Y),Ke=Math.pow(Qe,1-$e),Pe=Me.unproject(Z.add(q.mult($e*Ke)).mult(ke));Me.setLocationAtPoint(Me.renderWorldCopies?Pe.wrap():Pe,U)}return t.preloadOnly||this._fireMoveEvents(n),Me};if(t.preloadOnly){const Me=this._emulate(ue,t.duration,u);return this._preloadTiles(Me),this}const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=le,this._rotating=ae,this._pitching=me,this._padding=he,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,xe),this._ease(ue(u),Me=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(n,Me)},t),this}_prepareEase(t,n,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||u.moving||this.fire(new r.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.z("zoomend",t)),p&&this.fire(new r.z("rotateend",t)),_&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const We=r.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,n)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},t);const u=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),S=this.getPadding(),C="zoom"in t?r.aw(+t.zoom,u.minZoom,u.maxZoom):p,R="bearing"in t?this._normalizeBearing(t.bearing,_):_,D="pitch"in t?+t.pitch:x,k=this._extendPadding(t.padding),B=u.zoomScale(C-p),U=r.P.convert(t.offset);let Z=u.centerPoint.add(U);const q=u.pointLocation(Z),Y=r.bO.convert(t.center||q);this._normalizeCenter(Y);const X=u.project(q),te=u.project(Y).sub(X);let le=t.curve;const ae=Math.max(u.width,u.height),me=ae/B,he=te.mag();if("minZoom"in t){const We=r.aw(Math.min(t.minZoom,p,C),u.minZoom,u.maxZoom),bt=ae/u.zoomScale(We-p);le=Math.sqrt(bt/he*2)}const fe=le*le;function ue(We){const bt=(me*me-ae*ae+(We?-1:1)*fe*fe*he*he)/(2*(We?me:ae)*fe*he);return Math.log(Math.sqrt(bt*bt+1)-bt)}function xe(We){return(Math.exp(We)-Math.exp(-We))/2}function Me(We){return(Math.exp(We)+Math.exp(-We))/2}const $e=ue(0);let ke=function(We){return Me($e)/Me($e+le*We)},Qe=function(We){return ae*((Me($e)*(xe(bt=$e+le*We)/Me(bt))-xe($e))/fe)/he;var bt},Ke=(ue(1)-$e)/le;if(Math.abs(he)<1e-6||!isFinite(Ke)){if(Math.abs(ae-me)<1e-6)return this.easeTo(t,n);const We=me<ae?-1:1;Ke=Math.abs(Math.log(me/ae))/le,Qe=function(){return 0},ke=function(bt){return Math.exp(We*le*bt)}}t.duration="duration"in t?+t.duration:1e3*Ke/("screenSpeed"in t?+t.screenSpeed/le:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Pe=_!==R,Ze=D!==x,lt=!u.isPaddingEqual(k),Ce=t.retainPadding===!1?u.clone():u,tt=We=>bt=>{const nt=bt*Ke,et=1/ke(nt);We.zoom=bt===1?C:p+We.scaleZoom(et),Pe&&(We.bearing=r.af(_,R,bt)),Ze&&(We.pitch=r.af(x,D,bt)),lt&&(Ce.interpolatePadding(S,k,bt),Z=Ce.centerPoint.add(U));const ft=bt===1?Y:We.unproject(X.add(te.mult(Qe(nt))).mult(et));return We.setLocationAtPoint(We.renderWorldCopies?ft.wrap():ft,Z),We._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),We};if(t.preloadOnly){const We=this._emulate(tt,t.duration,u);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=Pe,this._pitching=Ze,this._padding=lt,this._prepareEase(n,!1),this._ease(tt(u),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=r.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=r.bF(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,u){const p=Math.ceil(15*n/1e3),_=[],x=t(u.clone());for(let S=0;S<=p;S++){const C=x(S/p);_.push(C.clone())}return _}_preloadTiles(t,n){}}class xh{constructor(t={}){this.options=t,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Le("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Le("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Le("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const u=n.reduce((p,_,x)=>(_.value&&(p+=`${_.key}=${_.value}${x<n.length-1?"&":""}`),p),"?");t.href=`${r.e.FEEDBACK_URL}/${u}#${wf(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style._mergedSourceCaches;for(const p in n){const _=n[p];if(_.used){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((p,_)=>p.length-_.length),t=t.filter((p,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class us{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Le("div","mapboxgl-ctrl");const n=Le("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const u=t[n].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class hs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Al{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=r.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,u){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+u}}const Fa={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ba extends r.z{constructor(t,n,u,p){const{point:_,lngLat:x,originalEvent:S,target:C}=t;super(t.type,{point:_,lngLat:x,originalEvent:S,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=u,this.feature=p}}class Af{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=n.filter;let p=n.type;u&&this.filters.set(t,r.aZ(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const _=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):_.size===0&&this.map.on(p,this.handleType),_.size===0&&this.interactionsByType.set(p,_),_.set(t,n),this.typeById.set(t,p)}get(t){const n=this.typeById.get(t);if(!n)return;const u=this.interactionsByType.get(n);return u?u.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(n);u&&(u.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const u=[];for(const[p,_]of n)_.target&&u.push({targetId:p,target:_.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const u=new Map;for(const[p,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(_.id,_);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!n;n=n||this.queryTargets(t.point,u);const _=t.type==="mouseenter";let x=!1;const S=new Set;for(const C of n){for(const[R,D]of u){if(!D.target)continue;const k=C.variants?C.variants[R]:null;if(k){for(const B of k){if(Ao(B,C,S,R))continue;const U=new r.cw(C,B),Z=oc(B,C,R);p&&(U.state=this.map.getFeatureState(U));const q=_?this.prevHoveredFeatures.get(Z):null,Y=new Ba(t,R,D,U),X=q?q.stop:D.handler(Y);if(_&&this.hoveredFeatures.set(Z,{feature:C,stop:X}),X!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[C,R]of u){const{handler:D,target:k}=R;if(!k&&D(new Ba(t,C,R,null))!==!1)break}}}function Ni(c,t){if(Array.isArray(c)&&Array.isArray(t)){const n=new Set(c),u=new Set(t);return n.size===u.size&&c.every(p=>u.has(p))}return r.bn(c,t)}const ca={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Zy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Wy{constructor(t,n,u=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new uo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Wc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),Ve()}move(t,n){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,n),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,n),S=x&&x.pitchDelta;S&&u.setPitch(u.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),zt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,zt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ut(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ut(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function vh(c,t,n){if(c=new r.bO(c.lng,c.lat),t){const u=new r.bO(c.lng-360,c.lat),p=new r.bO(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-n.center.lng)/360),x=n.locationPoint(c).distSqr(t),S=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(u).distSqr(t)<x&&(S||Math.abs(u.lng-n.center.lng)<_)?c=u:n.locationPoint(p).distSqr(t)<x&&(S||Math.abs(p.lng-n.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-n.center.lng)>180;){const u=n.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;c.lng>n.center.lng?c.lng-=360:c.lng+=360}return c}const ho={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Us extends r.E{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=r.l({element:t},n)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Le("div");const _=41,x=27,S=ct("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),C=ct("radialGradient",{id:"shadowGradient"},ct("defs",{},S));ct("stop",{offset:"10%","stop-opacity":.4},C),ct("stop",{offset:"100%","stop-opacity":.05},C),ct("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),ct("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),ct("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),ct("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=r.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const u=this._element.classList;for(const _ in ho)u.remove(`mapboxgl-marker-anchor-${_}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];u.add(...p),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,u=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,u=this._element;this._popup&&(n===u||u.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const u=t.unproject(n),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(n);let p;t._showingGlobe()&&r.dH(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ho[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,u=this.getPitchAlignment();if(!n||!t||u!=="map")return"";if(!n._showingGlobe()){const C=n.getPitch();return C?`rotateX(${C}deg)`:""}const p=r.c4(r.dI(n.transform,this._lngLat)),_=t.sub(r.dJ(n.transform)),x=Math.abs(_.x)+Math.abs(_.y);if(x===0)return"";const S=p/x;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(n._showingGlobe()){const _=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),x=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);u=r.c4(Math.atan2(x.y,x.x))-90}else u=-n.getBearing();else if(p==="horizon"){const _=r.ac(4,6,n.getZoom()),x=r.dJ(n.transform);x.y+=_*n.transform.height;const S=t.sub(x),C=r.c4(Math.atan2(S.y,S.x));u=(C>90?C-270:C+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=vh(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||n._clickTolerance;if(t.point.dist(u)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,u=this._pos;n&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jr={maxWidth:100,unit:"metric"},dr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Hm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Dn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function If(c=new r.P(0,0),t="bottom"){if(typeof c=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new r.P(0,c);case"top-left":return new r.P(n,n);case"top-right":return new r.P(-n,n);case"bottom":return new r.P(0,-c);case"bottom-left":return new r.P(n,-n);case"bottom-right":return new r.P(-n,-n);case"left":return new r.P(c,0);case"right":return new r.P(-c,0)}return new r.P(0,0)}return c instanceof r.P||Array.isArray(c)?r.P.convert(c):r.P.convert(c[t]||[0,0])}return{version:W,supported:Oe.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends Ml{constructor(c){Q.mark(ne.create);const t=c;if((c=r.l({},ca,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&r.dF(window)&&(c.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yc(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new hs,this._domRenderTaskQueue=new hs,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},Fa,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Al(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new vi(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const n=document.getElementById(c.container);if(!n)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=n}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new _f),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Gm(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||r.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new Rd(this),c.hash&&(this._hash=new Dm(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const n=c.bounds;n&&(this.resize(),this.fitBounds(n,r.l({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new xh({customAttribution:c.customAttribution})),this._logoControl=new us,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.z(`${n.dataType}dataloading`,n))}),this._interactions=new Af(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),this.fire(new r.z("resize",c)),t&&this.fire(new r.z("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(r.az.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let n;t==="globe"&&c.zoom>=r.bY?(c.setMercatorFromTransition(),n=!0):t==="mercator"&&c.zoom<r.bY&&(c.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c){return this.transform.locationPoint3D(r.bO.convert(c))}unproject(c){return this.transform.pointLocation3D(r.P.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,n){const u=p=>{let _=[];if(Array.isArray(t)){const x=t.filter(S=>this.getLayer(S));_=x.length?this.queryRenderedFeatures(p,{layers:x}):[]}else _=this.queryRenderedFeatures(p,{target:t});return _};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:x=>{const S=u(x.point);S.length?p||(p=!0,n.call(this,new Kr(c,this,x.originalEvent,{features:S}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:S=>{u(S.point).length?p=!0:p&&(p=!1,n.call(this,new Kr(c,this,S.originalEvent)))},mouseout:S=>{p&&(p=!1,n.call(this,new Kr(c,this,S.originalEvent)))}}}}{const p=_=>{const x=u(_.point);x.length&&(_.features=x,n.call(this,_),delete _.features)};return{listener:n,targets:t,delegates:{[c]:p}}}}on(c,t,n){if(typeof t=="function"||n===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,n){if(typeof t=="function"||n===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,n);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,n){if(typeof t=="function"||n===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let _=0;_<p.length;_++){const x=p[_];if(x.listener===n&&Ni(x.targets,t)){for(const S in x.delegates)this.off(S,x.delegates[S]);return p.splice(_,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof r.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(c,void 0,this.transform),x=this.style.queryRenderedFeatureset(c,void 0,this.transform);return _.concat(x)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),n&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}setStyle(c,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(n,u)=>{n?(r.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(c,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const n=r.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Ss(this,n).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ss(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(c)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,n)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:n=1,sdf:u=!1,stretchX:p,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:S,height:C,data:R}=r.q.getImageData(t);this.style.addImage(c,{data:new r.r({width:S,height:C},R),pixelRatio:n,stretchX:p,stretchY:_,content:x,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=t,R=t;this.style.addImage(c,{data:new r.r({width:S,height:C},new Uint8Array(R.data)),pixelRatio:n,stretchX:p,stretchY:_,content:x,sdf:u,usvg:!1,version:0,userImage:R}),R.onAdd&&R.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const n=this.style.getImage(c);if(!n)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:p,height:_,data:x}=u;if(p===void 0||_===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||_!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let C=!1;n.usvg?(n.data=new r.r({width:p,height:_},new Uint8Array(x)),n.usvg=!1,n.icon=void 0,C=!0):n.data.replace(x,S),this.style.updateImage(c,n,C)}hasImage(c){return c?!!this.style&&!!this.style.getImage(c):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){r.o(this._requestManager.transformRequest(c,r.R.Image),(n,u)=>{t(n,u instanceof HTMLImageElement?r.q.getImageData(u):u)})}listImages(){return this.style.listImages()}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,n){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,n),this._update(!0)):this}setFilter(c,t,n={}){return this._isValidId(c)?(this.style.setFilter(c,t,n),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,n,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,n,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,n,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,n,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,n){return this.style.setConfigProperty(c,t,n),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,u,p,_=this._container;for(;_&&(!u||!p);){const x=window.getComputedStyle(_).transform;x&&x!=="none"&&(n=x.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(u=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(p=n[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Le("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Le("div","mapboxgl-canvas-container",c);this._canvas=Le("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Le("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Le("div",`mapboxgl-ctrl-${p}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const n=r.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(c),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=r.l({},Oe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(Js(t,!0),this.painter=new bf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new r.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,u=r.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=this.transform.pitch,k=r.q.now(),B=new r.a8(R,{now:k,fadeDuration:_,pitch:D,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(u),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(u);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Q.mark(ne.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const R=r.q.now()-u;p.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const D=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:R,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(R);this.fire(new r.z("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(R);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(C||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(x=this._updateAverageElevation(u,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,Q.mark(ne.fullLoad),this._performanceMetricsCollection&&Zr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const n=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const x=Math.abs(p-_);if(x>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),n(_);this._averageElevation.easeTo(_,c,300)}else if(x>1e-4)return this._averageElevation.jumpTo(_),n(_)}return!!this._averageElevation.isEasing(c)&&n(this._averageElevation.getValue(c))}_authenticate(){Te(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===Wt||c.status===401)){const t=this.painter.context.gl;Js(t,!1),this._logoControl instanceof us&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),nc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&vs(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,u=n.createFramebuffer();function p(_){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,_,0);const x=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,x),x}return n.bindFramebuffer(n.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,n){let u=n[1]-n[0];const p=c.length/4;for(let _=0;_<t.length;_++){const x=t[_];let S=0;for(let C=0;C<x.length;C+=4)x[C]===c[C]&&x[C+1]===c[C+1]&&x[C+2]===c[C+2]&&x[C+3]===c[C+3]&&(S+=1);u+=(n[_+2]-n[_+1])*(1-S/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ks.delete(this.painter.context.gl),So.remove(),mi.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return r.bl(t,(n,u)=>n._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){r.dG(c,t)}get version(){return W}},NavigationControl:class{constructor(c={}){this.options=r.l({},Zy,c),this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Le("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Le("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Le("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),n=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wy(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const n=Le("button",c,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(c,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",n),c.firstElementChild&&c.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends r.E{constructor(c={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},Vr,c),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=mh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,c(n)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),n=c.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",c)),this._finish()}}_updateCamera(c){const t=new r.bO(c.coords.longitude,c.coords.latitude),n=c.coords.accuracy,u=this._map.getBearing(),p=r.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new r.bO(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=r.bH(1,c._center.lat)*c.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Le("button","mapboxgl-ctrl-geolocate",this._container),Le("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Le("div","mapboxgl-user-location"),this._dotElement.appendChild(Le("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Le("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Us({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Le("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Us({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xh,ScaleControl:class{constructor(c={}){this.options=r.l({},Jr,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,n]),_=t.unproject([u+c,n]),x=p.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*x;S>5280?this._setScale(c,S/5280,"mile"):this._setScale(c,S,"foot")}else this.options.unit==="nautical"?this._setScale(c,x/1852,"nautical-mile"):x>=1e3?this._setScale(c,x/1e3,"kilometer"):this._setScale(c,x,"meter")}_setScale(c,t,n){this._map._requestDomTask(()=>{const u=function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(S),x*S}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(u):`${u}&nbsp;${dr[n]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Le("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Le("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(c){super(),this.options=r.l(Object.create(Hm),c),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=r.bO.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=c;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Le("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const n=this._closeButton=Le("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,u=this._pos;if(!t||!n||!u)return"bottom";const p=n.offsetWidth,_=n.offsetHeight,x=u.x<p/2,S=u.x>t.transform.width-p/2;if(u.y+c<_)return x?"top-left":S?"top-right":"top";if(u.y>t.transform.height-_){if(x)return"bottom-left";if(S)return"bottom-right"}return x?"left":S?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let u=this._container;if(u||(u=this._container=Le("div","mapboxgl-popup",t.getContainer()),this._tip=Le("div","mapboxgl-popup-tip",u),u.appendChild(n)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vh(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof r.P?c:t.project(this._lngLat),_=If(this.options.offset),x=this._anchor=this._getAnchor(_.y),S=If(this.options.offset,x),C=p.add(S).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${ho[x]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=r.dH(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Dn);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Us,Style:Ss,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:Vu,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(c){r.e.ACCESS_TOKEN=c},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(c){r.e.API_URL=c},get workerCount(){return r.dO.workerCount},set workerCount(c){r.dO.workerCount=c},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){r.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){r.dP(c)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(c){r.dQ.workerUrl=c},get workerClass(){return r.dQ.workerClass},set workerClass(c){r.dQ.workerClass=c},get workerParams(){return r.dQ.workerParams},set workerParams(c){r.dQ.workerParams=c},get dracoUrl(){return r.dR()},set dracoUrl(c){r.dS(c)},get meshoptUrl(){return r.dT()},set meshoptUrl(c){r.dU(c)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var F=P;return F})})(_A);var Rk=_A.exports;const ts=Pk(Rk);const hy=(a,d)=>{const y=a.__vccOpts||a;for(const[A,P]of d)y[A]=P;return y},Dk={props:{musicos:{type:Array,required:!1,default:()=>[]},user:{type:Object,required:!0}},data(){return{map:null,localMusicos:[],restaurantes:[],modoAgregar:!1,marcadorPersonal:null,usuarioId:null}},mounted(){this.user&&this.user.idUsuario?(this.usuarioId=this.user.idUsuario,console.log("Usuario ID:",this.usuarioId),this.initializeMap()):console.error("No se ha proporcionado el usuario correctamente."),this.initializeMap()},methods:{initializeMap(){ts.accessToken="pk.eyJ1Ijoiam9yZGl0dXMiLCJhIjoiY203d2VoMHgzMDNxcjJxc2Nqd2h3bTN0YyJ9.TcKwh0g8Wl9deYIYYVzK9w",this.map=new ts.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[2.154007,41.390205],zoom:12}),this.map.addControl(new ts.NavigationControl),this.map.on("click",a=>{if(this.modoAgregar){const{lng:d,lat:y}=a.lngLat;this.marcadorPersonal?this.marcadorPersonal.setLngLat([d,y]):this.marcadorPersonal=new ts.Marker({color:"green"}).setLngLat([d,y]).addTo(this.map),this.store(y,d),this.modoAgregar=!1}}),this.obtenerMusicos(),this.obtenerDirecciones()},async obtenerMusicos(){try{const a=await Xa.get("http://localhost:80/melodiaconectada/docker/melodia-emja/public/api/obtener-coordenadas");this.localMusicos=a.data.musicos,this.agregarMarcadoresMusicos()}catch(a){console.error("Error al obtener datos de músicos:",a)}},agregarMarcadoresMusicos(){if(!this.localMusicos||this.localMusicos.length===0){console.warn("No hay músicos disponibles para mostrar en el mapa.");return}this.localMusicos.forEach(a=>{new ts.Marker({color:"blue"}).setLngLat([a.long,a.lat]).setPopup(new ts.Popup().setHTML(`<h3>${a.descripcion}</h3>`)).addTo(this.map)})},async obtenerDirecciones(){try{const a=await Xa.get("http://localhost:80/melodiaconectada/docker/melodia-emja/public/api/obtener-direcciones");this.restaurantes=a.data.restaurantes,this.restaurantes.forEach(d=>{this.geocodificarDireccion(d)})}catch(a){console.error("Error al obtener direcciones:",a)}},geocodificarDireccion(a){const d=a.direccion;fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(d)}.json?access_token=${ts.accessToken}`).then(y=>y.json()).then(y=>{if(!y.features||y.features.length===0){console.error(`No se pudo geocodificar: ${d}`);return}const A=y.features[0].center,P=a.nombreUsuario||"Sin nombre",L=a.descripcionUsuario||"Sin descripción";new ts.Marker({color:"red"}).setLngLat(A).setPopup(new ts.Popup().setHTML(`
                                <h3>${P}</h3>
                                <p>Dirección: ${a.direccion}</p>
                                <p>Descripción: ${L}</p>
                            `)).addTo(this.map)}).catch(y=>{console.error(`Error al geocodificar ${d}:`,y)})},activarModoAgregar(){this.modoAgregar=!0,alert("Haz clic en el mapa para colocar tu ubicación."),this.map.once("click",a=>{const d=a.lngLat.lng,y=a.lngLat.lat;this.marcadorPersonal&&this.marcadorPersonal.remove(),this.marcadorPersonal=new ts.Marker({color:"green"}).setLngLat([d,y]).addTo(this.map),this.store(y,d)})},store(a,d){Xa.post("http://localhost:80/melodiaconectada/docker/melodia-emja/public/api/store",{idUsuario:this.usuarioId,lat:a,long:d}).then(y=>{alert("Ubicación guardada correctamente"),console.log("Respuesta:",y.data)}).catch(y=>{console.error("Error al guardar la ubicación:",y),alert("Hubo un error al guardar la ubicación")})}},beforeDestroy(){this.map&&this.map.remove()}};function zk(a,d,y,A,P,L){return Ds(),_a("div",null,[yn("button",{onClick:d[0]||(d[0]=(...F)=>L.activarModoAgregar&&L.activarModoAgregar(...F)),class:"btn btn-primary mb-2"}," Añadir/Actualizar mi posición "),d[1]||(d[1]=yn("div",{id:"map",style:{width:"100%",height:"500px"}},null,-1))])}const Lk=hy(Dk,[["render",zk],["__scopeId","data-v-301ec1eb"]]);const Ok={data(){return{map:null}},mounted(){this.initializeMap()},methods:{initializeMap(){ts.accessToken="pk.eyJ1Ijoiam9yZGl0dXMiLCJhIjoiY203d2VoMHgzMDNxcjJxc2Nqd2h3bTN0YyJ9.TcKwh0g8Wl9deYIYYVzK9w",this.map=new ts.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[2.154007,41.390205],zoom:12}),this.map.addControl(new ts.NavigationControl),this.obtenerDirecciones()},async obtenerDirecciones(){try{(await Xa.get("http://localhost:8080/melodiaconectada/docker/melodia-emja/public/api/obtener-direcciones")).data.restaurantes.forEach(y=>{this.geocodificarDireccion(y)})}catch(a){console.error("Error al obtener direcciones desde el backend:",a)}},geocodificarDireccion(a){const d=a.direccion;fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(d)}.json?access_token=${ts.accessToken}`).then(y=>y.json()).then(y=>{if(!y.features||y.features.length===0){console.error(`Error: No se pudo geocodificar la dirección: ${d}`);return}const A=y.features[0].center,P=a.nombreUsuario||"Sin nombre",L=a.descripcionUsuario||"Sin descripción";new ts.Marker().setLngLat(A).setPopup(new ts.Popup().setHTML(`
                  <h3>${P}</h3>
                  <p>Dirección: ${a.direccion}</p>
                  <p>Descripción: ${L}</p>
                `)).addTo(this.map),this.map.getZoom()===2&&(this.map.setCenter(A),this.map.setZoom(10))}).catch(y=>{console.error(`Error al geocodificar la dirección: ${d}`,y)})}}};function kk(a,d,y,A,P,L){return Ds(),_a("div",null,d[0]||(d[0]=[yn("div",{id:"map",style:{width:"100%",height:"500px"}},null,-1)]))}const Fk=hy(Ok,[["render",kk],["__scopeId","data-v-e1ede1a1"]]);const Bk={data(){return{isOpen:!1,imagen:null}},methods:{openModal(){this.isOpen=!0},closeModal(){this.isOpen=!1,this.imagen=null},handleFileUpload(a){this.imagen=a.target.files[0]},async uploadImage(){if(!this.imagen){alert("Selecciona una imagen");return}let a=new FormData;a.append("imagen",this.imagen),a.append("usuaris_idusuaris",1);try{let d=await Xa.post("http://localhost:8080/melodiaconectada/docker/melodia-emja/public/api/guardar-imagen",a,{headers:{"Content-Type":"multipart/form-data"}});console.log(d.data),alert("Imagen subida con éxito"),this.closeModal()}catch(d){console.error("Error subiendo imagen",d),alert("Error subiendo la imagen")}}}},Nk={key:0,class:"modal fade show",style:{display:"block",background:"rgba(0, 0, 0, 0.5)"}},Vk={class:"modal-dialog"},Uk={class:"modal-content"},jk={class:"modal-header"},Gk={class:"modal-body"},qk={class:"modal-footer"},Hk=["disabled"];function $k(a,d,y,A,P,L){return Ds(),_a("div",null,[yn("button",{class:"btn btn-primary",onClick:d[0]||(d[0]=(...F)=>L.openModal&&L.openModal(...F))},"Subir Imagen"),P.isOpen?(Ds(),_a("div",Nk,[yn("div",Vk,[yn("div",Uk,[yn("div",jk,[d[5]||(d[5]=yn("h5",{class:"modal-title"},"Subir Imagen",-1)),yn("button",{type:"button",class:"btn-close",onClick:d[1]||(d[1]=(...F)=>L.closeModal&&L.closeModal(...F))})]),yn("div",Gk,[yn("input",{type:"file",onChange:d[2]||(d[2]=(...F)=>L.handleFileUpload&&L.handleFileUpload(...F)),class:"form-control"},null,32)]),yn("div",qk,[yn("button",{class:"btn btn-secondary",onClick:d[3]||(d[3]=(...F)=>L.closeModal&&L.closeModal(...F))},"Cancelar"),yn("button",{class:"btn btn-success",onClick:d[4]||(d[4]=(...F)=>L.uploadImage&&L.uploadImage(...F)),disabled:!P.imagen},"Subir",8,Hk)])])])])):WE("",!0)])}const Zk=hy(Bk,[["render",$k],["__scopeId","data-v-11a4696f"]]);const Wk={data(){return{restaurantes:[],musicos:[],contrato:{idRestaurante:"",idMusico:"",fechaContrato:"",precioContrato:""}}},mounted(){this.obtenerContratos()},methods:{async obtenerContratos(){try{const d=(await Xa.get("http://localhost/melodiaconectada/docker/melodia-emja/public/api/contrato")).data.data;this.restaurantes=d.map(y=>y.restaurante).filter((y,A,P)=>P.findIndex(L=>L.idRestaurante===y.idRestaurante)===A),this.musicos=d.map(y=>y.musico).filter((y,A,P)=>P.findIndex(L=>L.idMusico===y.idMusico)===A)}catch(a){console.error("Error al obtener contratos:",a)}},async crearContrato(){try{const a={idMusico:this.contrato.idMusico,idRestaurante:this.contrato.idRestaurante,fechaContrato:this.contrato.fechaContrato,precioContrato:this.contrato.precioContrato};console.log("Enviando datos del contrato:",a);const d=await Xa.post("http://localhost/melodiaconectada/docker/melodia-emja/public/api/contrato",a,{headers:{"Content-Type":"application/json"}});console.log("Respuesta del servidor:",d.data),alert("Contrato creado exitosamente"),this.contrato={idRestaurante:"",idMusico:"",fechaContrato:"",precioContrato:""}}catch(a){console.error("Error al crear contrato:",a.response?a.response.data:a),alert("Error al crear contrato. Revisa la consola para más detalles.")}}}},Xk={class:"container mt-4"},Yk={class:"mb-3"},Kk=["value"],Jk={class:"mb-3"},Qk=["value"],eF={class:"mb-3"},tF={class:"mb-3"};function iF(a,d,y,A,P,L){return Ds(),_a("div",Xk,[d[10]||(d[10]=yn("h2",null,"Crear Contrato",-1)),yn("form",{onSubmit:d[4]||(d[4]=bM((...F)=>L.crearContrato&&L.crearContrato(...F),["prevent"]))},[yn("div",Yk,[d[5]||(d[5]=yn("label",{for:"restaurante",class:"form-label"},"Restaurante",-1)),_p(yn("select",{"onUpdate:modelValue":d[0]||(d[0]=F=>P.contrato.idRestaurante=F),class:"form-select",required:""},[(Ds(!0),_a(wr,null,Nx(P.restaurantes,F=>(Ds(),_a("option",{key:F.idRestaurante,value:F.idRestaurante},Gh(F.usuario.nombre)+" ( "+Gh(F.idRestaurante)+") ",9,Kk))),128))],512),[[Tg,P.contrato.idRestaurante]])]),yn("div",Jk,[d[6]||(d[6]=yn("label",{for:"musico",class:"form-label"},"Músico",-1)),_p(yn("select",{"onUpdate:modelValue":d[1]||(d[1]=F=>P.contrato.idMusico=F),class:"form-select",required:""},[(Ds(!0),_a(wr,null,Nx(P.musicos,F=>(Ds(),_a("option",{key:F.idMusico,value:F.idMusico},Gh(F.usuario.nombre)+" ( "+Gh(F.idMusico)+") ",9,Qk))),128))],512),[[Tg,P.contrato.idMusico]])]),yn("div",eF,[d[7]||(d[7]=yn("label",{for:"precio",class:"form-label"},"Precio",-1)),_p(yn("input",{type:"number","onUpdate:modelValue":d[2]||(d[2]=F=>P.contrato.precioContrato=F),class:"form-control",required:""},null,512),[[td,P.contrato.precioContrato]])]),yn("div",tF,[d[8]||(d[8]=yn("label",{for:"fecha",class:"form-label"},"Fecha",-1)),_p(yn("input",{type:"date","onUpdate:modelValue":d[3]||(d[3]=F=>P.contrato.fechaContrato=F),class:"form-control",required:""},null,512),[[td,P.contrato.fechaContrato]])]),d[9]||(d[9]=yn("button",{type:"submit",class:"btn btn-primary"},"Crear Contrato",-1))],32)])}const nF=hy(Wk,[["render",iF],["__scopeId","data-v-f716e05e"]]);Xa.defaults.baseURL="http://localhost:8080/melodiaconectada/docker/melodia-emja/public/api";const em=Sg({});em.component("map-component",Lk);em.component("local-component",Fk);em.component("multimedia-component",Zk);em.component("contrato-component",nF);em.mount("#app");
